{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { useStore } from 'vuex';\nimport { ref, computed, onMounted, onUnmounted, nextTick } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport { Html5Qrcode } from 'html5-qrcode';\nexport default {\n  name: 'DeviceActivation',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const activationCode = ref('');\n    const isActivating = ref(false);\n    const errorMessage = ref('');\n    const successMessage = ref('');\n    const showQRScanner = ref(false);\n    const isScanning = ref(false);\n    const qrScannerError = ref('');\n    let html5QrCode = null;\n\n    // Computed properties from store\n    const isAuthenticated = computed(() => store.getters.isAuthenticated);\n    const user = computed(() => store.getters.currentUser);\n    const token = computed(() => store.getters.token);\n\n    // Format activation code (uppercase, remove spaces)\n    const formatCode = () => {\n      activationCode.value = activationCode.value.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 8);\n    };\n\n    // Extract activation code from QR code URL or text\n    const extractCodeFromQR = qrData => {\n      try {\n        // Check if it's a URL with code parameter\n        const url = new URL(qrData);\n        const code = url.searchParams.get('code');\n        if (code) {\n          return code.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 8);\n        }\n      } catch (e) {\n        // Not a URL, might be direct code\n      }\n\n      // Try to extract 8-character code from the string\n      const codeMatch = qrData.match(/[A-Z0-9]{8}/);\n      if (codeMatch) {\n        return codeMatch[0];\n      }\n\n      // Return the string itself if it's 8 characters\n      const cleaned = qrData.toUpperCase().replace(/[^A-Z0-9]/g, '');\n      if (cleaned.length === 8) {\n        return cleaned;\n      }\n      return null;\n    };\n\n    // Check camera permissions\n    const checkCameraPermissions = async () => {\n      try {\n        // Check if getUserMedia is available\n        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n          throw new Error('Camera API not supported in this browser');\n        }\n\n        // Try to access camera to request permission\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: {\n            facingMode: 'environment'\n          }\n        });\n\n        // Stop the stream immediately - we just needed permission\n        stream.getTracks().forEach(track => track.stop());\n        return true;\n      } catch (error) {\n        console.error('Camera permission error:', error);\n        throw error;\n      }\n    };\n\n    // Open QR Scanner\n    const openQRScanner = async () => {\n      // Clean up any existing scanner first\n      if (html5QrCode) {\n        try {\n          await stopQRScanner();\n        } catch (e) {\n          console.log('Error cleaning up before restart:', e);\n        }\n      }\n      try {\n        showQRScanner.value = true;\n        qrScannerError.value = '';\n        isScanning.value = false;\n\n        // Check HTTPS\n        if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {\n          qrScannerError.value = 'Camera requires HTTPS connection. Please use https:// or localhost.';\n          return;\n        }\n\n        // Wait for DOM to update and element to be available\n        await nextTick();\n        await new Promise(resolve => setTimeout(resolve, 300));\n\n        // Check if element exists\n        const qrReaderElement = document.getElementById(\"qr-reader\");\n        if (!qrReaderElement) {\n          throw new Error('QR reader element not found');\n        }\n\n        // Request camera permissions first\n        try {\n          await checkCameraPermissions();\n        } catch (permError) {\n          if (permError.name === 'NotAllowedError' || permError.name === 'PermissionDeniedError') {\n            qrScannerError.value = 'Camera permission denied. Please allow camera access in your browser settings and try again.';\n            return;\n          } else if (permError.name === 'NotFoundError' || permError.name === 'DevicesNotFoundError') {\n            qrScannerError.value = 'No camera found on your device. Please connect a camera and try again.';\n            return;\n          } else if (permError.name === 'NotReadableError' || permError.name === 'TrackStartError') {\n            qrScannerError.value = 'Camera is being used by another application. Please close other apps using the camera and try again.';\n            return;\n          }\n          throw permError;\n        }\n        const qrCodeSuccessCallback = decodedText => {\n          console.log('QR Code scanned:', decodedText);\n          const extractedCode = extractCodeFromQR(decodedText);\n          if (extractedCode && extractedCode.length === 8) {\n            activationCode.value = extractedCode;\n            formatCode();\n            stopQRScanner();\n            showQRScanner.value = false;\n\n            // Show success message\n            store.dispatch('showToast', {\n              message: 'QR Code scanned successfully!',\n              type: 'success'\n            });\n          } else {\n            qrScannerError.value = 'Invalid QR code. Please scan a valid activation code QR.';\n          }\n        };\n        const qrCodeErrorCallback = errorMessage => {\n          // Ignore continuous scanning errors\n          if (errorMessage && (errorMessage.includes('NotFoundException') || errorMessage.includes('No MultiFormat Readers'))) {\n            return;\n          }\n          console.log('QR Code error:', errorMessage);\n        };\n\n        // Stop any existing scanner first\n        if (html5QrCode) {\n          try {\n            await html5QrCode.stop();\n            await html5QrCode.clear();\n          } catch (e) {\n            console.log('Error stopping existing scanner:', e);\n          }\n        }\n        html5QrCode = new Html5Qrcode(\"qr-reader\");\n\n        // Try to get available cameras first\n        let cameras = [];\n        try {\n          cameras = await Html5Qrcode.getCameras();\n          console.log('Available cameras:', cameras);\n        } catch (camError) {\n          console.warn('Could not get camera list:', camError);\n          // Continue with facingMode fallback\n        }\n        let cameraId = null;\n        if (cameras && cameras.length > 0) {\n          // Prefer back camera (environment)\n          const backCamera = cameras.find(cam => cam.label.toLowerCase().includes('back') || cam.label.toLowerCase().includes('rear') || cam.label.toLowerCase().includes('environment'));\n          cameraId = backCamera ? backCamera.id : cameras[0].id;\n          console.log('Using camera:', cameraId);\n        }\n\n        // Start scanning with multiple fallback options\n        const config = {\n          fps: 10,\n          qrbox: {\n            width: 250,\n            height: 250\n          },\n          aspectRatio: 1.0,\n          disableFlip: false\n        };\n        let started = false;\n\n        // Try 1: Use specific camera ID if available\n        if (cameraId && !started) {\n          try {\n            await html5QrCode.start(cameraId, config, qrCodeSuccessCallback, qrCodeErrorCallback);\n            started = true;\n          } catch (err) {\n            console.warn('Failed to start with camera ID, trying fallback:', err);\n          }\n        }\n\n        // Try 2: Use environment facing mode\n        if (!started) {\n          try {\n            await html5QrCode.start({\n              facingMode: \"environment\"\n            }, config, qrCodeSuccessCallback, qrCodeErrorCallback);\n            started = true;\n          } catch (err) {\n            console.warn('Failed to start with environment mode, trying user mode:', err);\n          }\n        }\n\n        // Try 3: Use user facing mode (front camera)\n        if (!started) {\n          try {\n            await html5QrCode.start({\n              facingMode: \"user\"\n            }, config, qrCodeSuccessCallback, qrCodeErrorCallback);\n            started = true;\n          } catch (err) {\n            console.warn('Failed to start with user mode:', err);\n          }\n        }\n\n        // Try 4: Use any available camera (first one)\n        if (!started && cameras && cameras.length > 0) {\n          try {\n            await html5QrCode.start(cameras[0].id, config, qrCodeSuccessCallback, qrCodeErrorCallback);\n            started = true;\n          } catch (err) {\n            console.error('Failed to start with any camera:', err);\n          }\n        }\n        if (!started) {\n          throw new Error('Unable to access camera. Please check permissions and try again.');\n        }\n        isScanning.value = true;\n        qrScannerError.value = '';\n      } catch (error) {\n        console.error('QR Scanner error:', error);\n        let errorMsg = 'Failed to start camera. ';\n        if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {\n          errorMsg = 'Camera permission denied. Please allow camera access in your browser settings.';\n        } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {\n          errorMsg = 'No camera found on your device.';\n        } else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {\n          errorMsg = 'Camera is being used by another application. Please close other apps and try again.';\n        } else if (error.message) {\n          errorMsg += error.message;\n        } else {\n          errorMsg += 'Please check camera permissions and try again.';\n        }\n        qrScannerError.value = errorMsg;\n        isScanning.value = false;\n        // Don't close modal on error, let user see the error message\n      }\n    };\n\n    // Stop QR Scanner\n    const stopQRScanner = async () => {\n      if (html5QrCode) {\n        try {\n          if (isScanning.value) {\n            await html5QrCode.stop();\n          }\n          await html5QrCode.clear();\n        } catch (error) {\n          // Ignore errors when stopping - scanner might already be stopped\n          console.log('Error stopping QR scanner (may already be stopped):', error);\n        } finally {\n          html5QrCode = null;\n          isScanning.value = false;\n        }\n      } else {\n        isScanning.value = false;\n      }\n    };\n\n    // Close QR Scanner\n    const closeQRScanner = async () => {\n      await stopQRScanner();\n      showQRScanner.value = false;\n      qrScannerError.value = '';\n    };\n\n    // Activate device\n    const activateDevice = async () => {\n      if (!isAuthenticated.value || !activationCode.value || activationCode.value.length !== 8) {\n        return;\n      }\n      isActivating.value = true;\n      errorMessage.value = '';\n      successMessage.value = '';\n      try {\n        // Set authorization header\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token.value}`;\n\n        // Call activation API\n        const response = await axios.post('/users/api/device-activation/', {\n          activation_code: activationCode.value,\n          device_id: `web_${Date.now()}`,\n          // Generate a temporary device ID\n          device_name: 'Web Activation',\n          device_type: 'web',\n          phone: user.value.phone\n        });\n        if (response.data.status === 'success') {\n          successMessage.value = 'Device activated successfully! Your TV should now have access to premium content.';\n\n          // Show success toast\n          store.dispatch('showToast', {\n            message: 'Device activated successfully!',\n            type: 'success'\n          });\n\n          // Redirect to profile after a delay\n          setTimeout(() => {\n            router.push('/profile');\n          }, 3000);\n        } else {\n          throw new Error(response.data.message || 'Failed to activate device');\n        }\n      } catch (error) {\n        console.error('Activation error:', error);\n        errorMessage.value = error.response?.data?.message || 'Failed to activate device. Please try again.';\n\n        // Show error toast\n        store.dispatch('showToast', {\n          message: errorMessage.value,\n          type: 'error'\n        });\n      } finally {\n        isActivating.value = false;\n      }\n    };\n\n    // Check for code in URL parameters\n    onMounted(() => {\n      const urlParams = new URLSearchParams(window.location.search);\n      const code = urlParams.get('code');\n      if (code) {\n        activationCode.value = code;\n        formatCode();\n      }\n    });\n\n    // Cleanup on unmount\n    onUnmounted(async () => {\n      await stopQRScanner();\n    });\n    return {\n      activationCode,\n      isActivating,\n      errorMessage,\n      successMessage,\n      isAuthenticated,\n      user,\n      showQRScanner,\n      isScanning,\n      qrScannerError,\n      formatCode,\n      activateDevice,\n      openQRScanner,\n      stopQRScanner,\n      closeQRScanner\n    };\n  }\n};","map":{"version":3,"names":["useStore","ref","computed","onMounted","onUnmounted","nextTick","useRouter","axios","Html5Qrcode","name","setup","store","router","activationCode","isActivating","errorMessage","successMessage","showQRScanner","isScanning","qrScannerError","html5QrCode","isAuthenticated","getters","user","currentUser","token","formatCode","value","toUpperCase","replace","slice","extractCodeFromQR","qrData","url","URL","code","searchParams","get","e","codeMatch","match","cleaned","length","checkCameraPermissions","navigator","mediaDevices","getUserMedia","Error","stream","video","facingMode","getTracks","forEach","track","stop","error","console","openQRScanner","stopQRScanner","log","location","protocol","hostname","Promise","resolve","setTimeout","qrReaderElement","document","getElementById","permError","qrCodeSuccessCallback","decodedText","extractedCode","dispatch","message","type","qrCodeErrorCallback","includes","clear","cameras","getCameras","camError","warn","cameraId","backCamera","find","cam","label","toLowerCase","id","config","fps","qrbox","width","height","aspectRatio","disableFlip","started","start","err","errorMsg","closeQRScanner","activateDevice","defaults","headers","common","response","post","activation_code","device_id","Date","now","device_name","device_type","phone","data","status","push","urlParams","URLSearchParams","window","search"],"sources":["/Users/saisudhakarmanchala/Documents/No1OTT/ott_frontend_mpd/src/views/DeviceActivation.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-gradient-to-br from-[#0a0a0a] via-[#1a1a1a] to-[#0f0f0f] text-white\">\n    <!-- Header -->\n    <div class=\"px-4 py-6\">\n      <div class=\"max-w-7xl mx-auto\">\n        <router-link to=\"/\" class=\"flex items-center gap-3 text-white/80 hover:text-white transition-colors group\">\n          <div class=\"w-10 h-10 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-lg flex items-center justify-center group-hover:scale-105 transition-transform\">\n            <i class=\"fas fa-arrow-left text-lg\"></i>\n          </div>\n          <span class=\"font-medium\">Back to Home</span>\n        </router-link>\n      </div>\n    </div>\n\n    <!-- Main Content -->\n    <div class=\"px-4 py-8\">\n      <div class=\"max-w-4xl mx-auto\">\n        <div class=\"text-center mb-12\">\n          <h1 class=\"text-4xl md:text-5xl font-bold mb-4\">\n            Activate Your <span class=\"text-[#c30059]\">TV Device</span>\n          </h1>\n          <p class=\"text-lg text-white/70 max-w-2xl mx-auto\">\n            Enter the activation code displayed on your TV screen to link your device to your account\n          </p>\n        </div>\n\n        <div class=\"bg-gradient-to-br from-[#1a1a1a] to-[#2a2a2a] rounded-3xl border border-white/10 p-8 max-w-2xl mx-auto\">\n          <!-- Activation Form -->\n          <div class=\"space-y-6\">\n            <div>\n              <label class=\"block text-sm font-medium text-white/80 mb-3\">Activation Code</label>\n              <div class=\"flex gap-3 items-stretch\">\n                <input \n                  v-model=\"activationCode\"\n                  type=\"text\"\n                  class=\"flex-1 bg-[#0a0a0a] border border-white/10 rounded-xl h-14 px-4 text-white text-lg font-mono tracking-wider focus:border-[#c30059] focus:outline-none focus:ring-2 focus:ring-[#c30059]/20 transition-all uppercase placeholder-white/40 text-center min-w-0\"\n                  placeholder=\"ENTER CODE\"\n                  maxlength=\"8\"\n                  @input=\"formatCode\"\n                />\n                <button\n                  @click=\"openQRScanner\"\n                  type=\"button\"\n                  class=\"h-14 px-4 sm:px-6 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] text-white font-medium rounded-xl hover:shadow-lg hover:shadow-[#c30059]/25 transition-all duration-300 flex items-center justify-center gap-2 min-w-[60px] sm:min-w-[120px] flex-shrink-0\"\n                  title=\"Scan QR Code\"\n                >\n                  <i class=\"fas fa-qrcode text-lg sm:text-xl\"></i>\n                  <span class=\"hidden sm:inline whitespace-nowrap\">Scan QR</span>\n                </button>\n              </div>\n            </div>\n\n            <!-- User Info (if logged in) -->\n            <div v-if=\"isAuthenticated\" class=\"bg-[#0a0a0a]/50 border border-white/10 rounded-xl p-4\">\n              <div class=\"flex items-center gap-3\">\n                <div class=\"w-10 h-10 rounded-full bg-gradient-to-r from-[#c30059] to-[#ff6b9d] flex items-center justify-center\">\n                  <i class=\"fas fa-user text-white\"></i>\n                </div>\n                <div>\n                  <div class=\"font-medium text-white\">{{ user.first_name }} {{ user.last_name }}</div>\n                  <div class=\"text-sm text-white/60\">{{ user.phone }}</div>\n                </div>\n              </div>\n            </div>\n\n            <!-- Login Prompt (if not logged in) -->\n            <div v-else class=\"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4\">\n              <div class=\"flex items-start gap-3\">\n                <i class=\"fas fa-exclamation-triangle text-amber-400 mt-0.5\"></i>\n                <div>\n                  <div class=\"font-medium text-amber-400 mb-1\">Login Required</div>\n                  <p class=\"text-sm text-amber-300\">\n                    You need to be logged in to activate your device. Please login or create an account.\n                  </p>\n                  <router-link \n                    to=\"/login\" \n                    class=\"inline-block mt-3 px-4 py-2 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] text-white text-sm font-medium rounded-lg hover:shadow-lg hover:shadow-[#c30059]/25 transition-all\"\n                  >\n                    Login to Continue\n                  </router-link>\n                </div>\n              </div>\n            </div>\n\n            <!-- Activate Button -->\n            <button \n              @click=\"activateDevice\"\n              :disabled=\"!isAuthenticated || !activationCode || activationCode.length !== 8 || isActivating\"\n              class=\"w-full py-4 px-6 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] text-white font-bold rounded-xl hover:shadow-lg hover:shadow-[#c30059]/25 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-none\"\n            >\n              <span v-if=\"isActivating\">\n                <i class=\"fas fa-spinner fa-spin mr-2\"></i>\n                Activating...\n              </span>\n              <span v-else>\n                <i class=\"fas fa-tv mr-2\"></i>\n                Activate Device\n              </span>\n            </button>\n\n            <!-- Error Message -->\n            <div v-if=\"errorMessage\" class=\"p-4 bg-red-500/10 border border-red-500/30 rounded-xl\">\n              <div class=\"flex items-center gap-2 text-red-400\">\n                <i class=\"fas fa-exclamation-circle\"></i>\n                <span>{{ errorMessage }}</span>\n              </div>\n            </div>\n\n            <!-- Success Message -->\n            <div v-if=\"successMessage\" class=\"p-4 bg-green-500/10 border border-green-500/30 rounded-xl\">\n              <div class=\"flex items-center gap-2 text-green-400\">\n                <i class=\"fas fa-check-circle\"></i>\n                <span>{{ successMessage }}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Instructions -->\n        <div class=\"mt-12 max-w-3xl mx-auto\">\n          <h2 class=\"text-2xl font-bold text-center mb-8\">How to Activate</h2>\n          <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <div class=\"bg-[#1a1a1a]/50 border border-white/10 rounded-2xl p-6 text-center\">\n              <div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-2xl flex items-center justify-center\">\n                <span class=\"text-2xl font-bold text-white\">1</span>\n              </div>\n              <h3 class=\"text-lg font-bold mb-2\">Open App on TV</h3>\n              <p class=\"text-white/60 text-sm\">\n                Launch the OTT TV app on your smart TV or streaming device\n              </p>\n            </div>\n            \n            <div class=\"bg-[#1a1a1a]/50 border border-white/10 rounded-2xl p-6 text-center\">\n              <div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-2xl flex items-center justify-center\">\n                <span class=\"text-2xl font-bold text-white\">2</span>\n              </div>\n              <h3 class=\"text-lg font-bold mb-2\">Get Activation Code</h3>\n              <p class=\"text-white/60 text-sm\">\n                Note the 8-character code displayed on your TV screen\n              </p>\n            </div>\n            \n            <div class=\"bg-[#1a1a1a]/50 border border-white/10 rounded-2xl p-6 text-center\">\n              <div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-2xl flex items-center justify-center\">\n                <span class=\"text-2xl font-bold text-white\">3</span>\n              </div>\n              <h3 class=\"text-lg font-bold mb-2\">Enter Code Here</h3>\n              <p class=\"text-white/60 text-sm\">\n                Type the code above and click Activate Device\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- QR Scanner Modal -->\n    <div v-if=\"showQRScanner\" class=\"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4\">\n      <div class=\"bg-gradient-to-br from-[#1a1a1a] to-[#2a2a2a] rounded-3xl border border-white/10 p-6 max-w-md w-full\">\n        <div class=\"flex items-center justify-between mb-4\">\n          <h3 class=\"text-xl font-bold text-white\">Scan QR Code</h3>\n          <button\n            @click=\"closeQRScanner\"\n            class=\"text-white/60 hover:text-white transition-colors\"\n          >\n            <i class=\"fas fa-times text-2xl\"></i>\n          </button>\n        </div>\n        \n        <div class=\"mb-4 relative\">\n          <div id=\"qr-reader\" class=\"w-full rounded-xl overflow-hidden bg-black/50\" style=\"min-height: 300px;\"></div>\n          <div v-if=\"!isScanning && !qrScannerError\" class=\"absolute inset-0 flex items-center justify-center bg-black/50 rounded-xl pointer-events-none\">\n            <div class=\"text-center\">\n              <i class=\"fas fa-spinner fa-spin text-white text-3xl mb-2\"></i>\n              <p class=\"text-white text-sm\">Initializing camera...</p>\n            </div>\n          </div>\n        </div>\n        \n        <div v-if=\"qrScannerError\" class=\"mb-4 p-4 bg-red-500/10 border border-red-500/30 rounded-xl\">\n          <div class=\"flex items-start gap-3\">\n            <i class=\"fas fa-exclamation-triangle text-red-400 mt-0.5\"></i>\n            <div class=\"flex-1\">\n              <p class=\"text-red-400 text-sm font-medium mb-2\">{{ qrScannerError }}</p>\n              <div class=\"text-red-300 text-xs space-y-1\">\n                <p><strong>Tips:</strong></p>\n                <ul class=\"list-disc list-inside space-y-1 ml-2\">\n                  <li>Make sure you've allowed camera permissions in your browser</li>\n                  <li>Close other apps that might be using the camera</li>\n                  <li>Try refreshing the page and scanning again</li>\n                  <li>On mobile: Check Settings → Privacy → Camera permissions</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"flex gap-3\">\n          <button\n            @click=\"closeQRScanner\"\n            class=\"flex-1 py-3 px-4 bg-white/10 text-white font-medium rounded-xl hover:bg-white/20 transition-all\"\n          >\n            Cancel\n          </button>\n          <button\n            @click=\"stopQRScanner\"\n            v-if=\"isScanning\"\n            class=\"flex-1 py-3 px-4 bg-red-500/20 text-red-400 font-medium rounded-xl hover:bg-red-500/30 transition-all\"\n          >\n            Stop Scanner\n          </button>\n          <button\n            @click=\"openQRScanner\"\n            v-if=\"qrScannerError && !isScanning\"\n            class=\"flex-1 py-3 px-4 bg-gradient-to-r from-[#c30059] to-[#ff4d4d] text-white font-medium rounded-xl hover:opacity-90 transition-all\"\n          >\n            <i class=\"fas fa-redo mr-2\"></i>\n            Try Again\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { useStore } from 'vuex';\nimport { ref, computed, onMounted, onUnmounted, nextTick } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport { Html5Qrcode } from 'html5-qrcode';\n\nexport default {\n  name: 'DeviceActivation',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    \n    const activationCode = ref('');\n    const isActivating = ref(false);\n    const errorMessage = ref('');\n    const successMessage = ref('');\n    const showQRScanner = ref(false);\n    const isScanning = ref(false);\n    const qrScannerError = ref('');\n    let html5QrCode = null;\n    \n    // Computed properties from store\n    const isAuthenticated = computed(() => store.getters.isAuthenticated);\n    const user = computed(() => store.getters.currentUser);\n    const token = computed(() => store.getters.token);\n    \n    // Format activation code (uppercase, remove spaces)\n    const formatCode = () => {\n      activationCode.value = activationCode.value\n        .toUpperCase()\n        .replace(/[^A-Z0-9]/g, '')\n        .slice(0, 8);\n    };\n    \n    // Extract activation code from QR code URL or text\n    const extractCodeFromQR = (qrData) => {\n      try {\n        // Check if it's a URL with code parameter\n        const url = new URL(qrData);\n        const code = url.searchParams.get('code');\n        if (code) {\n          return code.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 8);\n        }\n      } catch (e) {\n        // Not a URL, might be direct code\n      }\n      \n      // Try to extract 8-character code from the string\n      const codeMatch = qrData.match(/[A-Z0-9]{8}/);\n      if (codeMatch) {\n        return codeMatch[0];\n      }\n      \n      // Return the string itself if it's 8 characters\n      const cleaned = qrData.toUpperCase().replace(/[^A-Z0-9]/g, '');\n      if (cleaned.length === 8) {\n        return cleaned;\n      }\n      \n      return null;\n    };\n    \n    // Check camera permissions\n    const checkCameraPermissions = async () => {\n      try {\n        // Check if getUserMedia is available\n        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n          throw new Error('Camera API not supported in this browser');\n        }\n        \n        // Try to access camera to request permission\n        const stream = await navigator.mediaDevices.getUserMedia({ \n          video: { facingMode: 'environment' } \n        });\n        \n        // Stop the stream immediately - we just needed permission\n        stream.getTracks().forEach(track => track.stop());\n        \n        return true;\n      } catch (error) {\n        console.error('Camera permission error:', error);\n        throw error;\n      }\n    };\n    \n    // Open QR Scanner\n    const openQRScanner = async () => {\n      // Clean up any existing scanner first\n      if (html5QrCode) {\n        try {\n          await stopQRScanner();\n        } catch (e) {\n          console.log('Error cleaning up before restart:', e);\n        }\n      }\n      \n      try {\n        showQRScanner.value = true;\n        qrScannerError.value = '';\n        isScanning.value = false;\n        \n        // Check HTTPS\n        if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {\n          qrScannerError.value = 'Camera requires HTTPS connection. Please use https:// or localhost.';\n          return;\n        }\n        \n        // Wait for DOM to update and element to be available\n        await nextTick();\n        await new Promise(resolve => setTimeout(resolve, 300));\n        \n        // Check if element exists\n        const qrReaderElement = document.getElementById(\"qr-reader\");\n        if (!qrReaderElement) {\n          throw new Error('QR reader element not found');\n        }\n        \n        // Request camera permissions first\n        try {\n          await checkCameraPermissions();\n        } catch (permError) {\n          if (permError.name === 'NotAllowedError' || permError.name === 'PermissionDeniedError') {\n            qrScannerError.value = 'Camera permission denied. Please allow camera access in your browser settings and try again.';\n            return;\n          } else if (permError.name === 'NotFoundError' || permError.name === 'DevicesNotFoundError') {\n            qrScannerError.value = 'No camera found on your device. Please connect a camera and try again.';\n            return;\n          } else if (permError.name === 'NotReadableError' || permError.name === 'TrackStartError') {\n            qrScannerError.value = 'Camera is being used by another application. Please close other apps using the camera and try again.';\n            return;\n          }\n          throw permError;\n        }\n        \n        const qrCodeSuccessCallback = (decodedText) => {\n          console.log('QR Code scanned:', decodedText);\n          \n          const extractedCode = extractCodeFromQR(decodedText);\n          if (extractedCode && extractedCode.length === 8) {\n            activationCode.value = extractedCode;\n            formatCode();\n            stopQRScanner();\n            showQRScanner.value = false;\n            \n            // Show success message\n            store.dispatch('showToast', {\n              message: 'QR Code scanned successfully!',\n              type: 'success'\n            });\n          } else {\n            qrScannerError.value = 'Invalid QR code. Please scan a valid activation code QR.';\n          }\n        };\n        \n        const qrCodeErrorCallback = (errorMessage) => {\n          // Ignore continuous scanning errors\n          if (errorMessage && (\n            errorMessage.includes('NotFoundException') || \n            errorMessage.includes('No MultiFormat Readers')\n          )) {\n            return;\n          }\n          console.log('QR Code error:', errorMessage);\n        };\n        \n        // Stop any existing scanner first\n        if (html5QrCode) {\n          try {\n            await html5QrCode.stop();\n            await html5QrCode.clear();\n          } catch (e) {\n            console.log('Error stopping existing scanner:', e);\n          }\n        }\n        \n        html5QrCode = new Html5Qrcode(\"qr-reader\");\n        \n        // Try to get available cameras first\n        let cameras = [];\n        try {\n          cameras = await Html5Qrcode.getCameras();\n          console.log('Available cameras:', cameras);\n        } catch (camError) {\n          console.warn('Could not get camera list:', camError);\n          // Continue with facingMode fallback\n        }\n        \n        let cameraId = null;\n        if (cameras && cameras.length > 0) {\n          // Prefer back camera (environment)\n          const backCamera = cameras.find(cam => \n            cam.label.toLowerCase().includes('back') || \n            cam.label.toLowerCase().includes('rear') ||\n            cam.label.toLowerCase().includes('environment')\n          );\n          cameraId = backCamera ? backCamera.id : cameras[0].id;\n          console.log('Using camera:', cameraId);\n        }\n        \n        // Start scanning with multiple fallback options\n        const config = {\n          fps: 10,\n          qrbox: { width: 250, height: 250 },\n          aspectRatio: 1.0,\n          disableFlip: false\n        };\n        \n        let started = false;\n        \n        // Try 1: Use specific camera ID if available\n        if (cameraId && !started) {\n          try {\n            await html5QrCode.start(\n              cameraId,\n              config,\n              qrCodeSuccessCallback,\n              qrCodeErrorCallback\n            );\n            started = true;\n          } catch (err) {\n            console.warn('Failed to start with camera ID, trying fallback:', err);\n          }\n        }\n        \n        // Try 2: Use environment facing mode\n        if (!started) {\n          try {\n            await html5QrCode.start(\n              { facingMode: \"environment\" },\n              config,\n              qrCodeSuccessCallback,\n              qrCodeErrorCallback\n            );\n            started = true;\n          } catch (err) {\n            console.warn('Failed to start with environment mode, trying user mode:', err);\n          }\n        }\n        \n        // Try 3: Use user facing mode (front camera)\n        if (!started) {\n          try {\n            await html5QrCode.start(\n              { facingMode: \"user\" },\n              config,\n              qrCodeSuccessCallback,\n              qrCodeErrorCallback\n            );\n            started = true;\n          } catch (err) {\n            console.warn('Failed to start with user mode:', err);\n          }\n        }\n        \n        // Try 4: Use any available camera (first one)\n        if (!started && cameras && cameras.length > 0) {\n          try {\n            await html5QrCode.start(\n              cameras[0].id,\n              config,\n              qrCodeSuccessCallback,\n              qrCodeErrorCallback\n            );\n            started = true;\n          } catch (err) {\n            console.error('Failed to start with any camera:', err);\n          }\n        }\n        \n        if (!started) {\n          throw new Error('Unable to access camera. Please check permissions and try again.');\n        }\n        \n        isScanning.value = true;\n        qrScannerError.value = '';\n      } catch (error) {\n        console.error('QR Scanner error:', error);\n        let errorMsg = 'Failed to start camera. ';\n        \n        if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {\n          errorMsg = 'Camera permission denied. Please allow camera access in your browser settings.';\n        } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {\n          errorMsg = 'No camera found on your device.';\n        } else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {\n          errorMsg = 'Camera is being used by another application. Please close other apps and try again.';\n        } else if (error.message) {\n          errorMsg += error.message;\n        } else {\n          errorMsg += 'Please check camera permissions and try again.';\n        }\n        \n        qrScannerError.value = errorMsg;\n        isScanning.value = false;\n        // Don't close modal on error, let user see the error message\n      }\n    };\n    \n    // Stop QR Scanner\n    const stopQRScanner = async () => {\n      if (html5QrCode) {\n        try {\n          if (isScanning.value) {\n            await html5QrCode.stop();\n          }\n          await html5QrCode.clear();\n        } catch (error) {\n          // Ignore errors when stopping - scanner might already be stopped\n          console.log('Error stopping QR scanner (may already be stopped):', error);\n        } finally {\n          html5QrCode = null;\n          isScanning.value = false;\n        }\n      } else {\n        isScanning.value = false;\n      }\n    };\n    \n    // Close QR Scanner\n    const closeQRScanner = async () => {\n      await stopQRScanner();\n      showQRScanner.value = false;\n      qrScannerError.value = '';\n    };\n    \n    // Activate device\n    const activateDevice = async () => {\n      if (!isAuthenticated.value || !activationCode.value || activationCode.value.length !== 8) {\n        return;\n      }\n      \n      isActivating.value = true;\n      errorMessage.value = '';\n      successMessage.value = '';\n      \n      try {\n        // Set authorization header\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token.value}`;\n        \n        // Call activation API\n        const response = await axios.post('/users/api/device-activation/', {\n          activation_code: activationCode.value,\n          device_id: `web_${Date.now()}`, // Generate a temporary device ID\n          device_name: 'Web Activation',\n          device_type: 'web',\n          phone: user.value.phone\n        });\n        \n        if (response.data.status === 'success') {\n          successMessage.value = 'Device activated successfully! Your TV should now have access to premium content.';\n          \n          // Show success toast\n          store.dispatch('showToast', {\n            message: 'Device activated successfully!',\n            type: 'success'\n          });\n          \n          // Redirect to profile after a delay\n          setTimeout(() => {\n            router.push('/profile');\n          }, 3000);\n        } else {\n          throw new Error(response.data.message || 'Failed to activate device');\n        }\n      } catch (error) {\n        console.error('Activation error:', error);\n        errorMessage.value = error.response?.data?.message || 'Failed to activate device. Please try again.';\n        \n        // Show error toast\n        store.dispatch('showToast', {\n          message: errorMessage.value,\n          type: 'error'\n        });\n      } finally {\n        isActivating.value = false;\n      }\n    };\n    \n    // Check for code in URL parameters\n    onMounted(() => {\n      const urlParams = new URLSearchParams(window.location.search);\n      const code = urlParams.get('code');\n      if (code) {\n        activationCode.value = code;\n        formatCode();\n      }\n    });\n    \n    // Cleanup on unmount\n    onUnmounted(async () => {\n      await stopQRScanner();\n    });\n    \n    return {\n      activationCode,\n      isActivating,\n      errorMessage,\n      successMessage,\n      isAuthenticated,\n      user,\n      showQRScanner,\n      isScanning,\n      qrScannerError,\n      formatCode,\n      activateDevice,\n      openQRScanner,\n      stopQRScanner,\n      closeQRScanner\n    };\n  }\n};\n</script>\n\n<style scoped>\n/* QR Scanner Styles */\n#qr-reader {\n  min-height: 300px;\n  width: 100%;\n  position: relative;\n}\n\n#qr-reader__dashboard_section {\n  display: none !important;\n}\n\n#qr-reader__camera_selection {\n  display: none !important;\n}\n\n/* Override html5-qrcode styles for better appearance */\n#qr-reader__scan_region {\n  border: 2px solid #c30059 !important;\n  border-radius: 12px !important;\n}\n\n#qr-reader__scan_region video {\n  border-radius: 12px !important;\n  width: 100% !important;\n  height: auto !important;\n}\n\n/* Responsive adjustments */\n@media (max-width: 640px) {\n  #qr-reader {\n    min-height: 250px;\n  }\n}\n</style>\n\n<style>\n/* Global styles for QR scanner (not scoped) */\n#qr-reader {\n  width: 100% !important;\n}\n\n#qr-reader__scan_region {\n  width: 100% !important;\n}\n\n#qr-reader__scan_region video {\n  width: 100% !important;\n  height: auto !important;\n  object-fit: cover !important;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}