{"ast":null,"code":"import axios from 'axios';\nconst API_BASE_URL = 'http://192.168.0.127:8001';\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  withCredentials: true // This is important for CSRF protection\n});\n\n// Add a request interceptor\napi.interceptors.request.use(config => {\n  // Get token from localStorage\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n\n  // Add CSRF token for all requests when available\n  const csrfToken = localStorage.getItem('csrfToken');\n  if (csrfToken) {\n    config.headers['X-CSRFToken'] = csrfToken;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// Add a response interceptor\napi.interceptors.response.use(response => response, error => {\n  if (error.response?.status === 401) {\n    // Clear auth data\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    localStorage.setItem('isAuthenticated', 'false');\n\n    // Get current path for redirect\n    const currentPath = window.location.hash.slice(1); // Remove the '#' from the hash\n\n    // Only redirect if not already on login page\n    if (!window.location.href.includes('/login')) {\n      // Store current path and redirect to login\n      window.location.href = `/#/login?redirect=${encodeURIComponent(currentPath)}`;\n    }\n  }\n  return Promise.reject(error);\n});\nexport const watchlistAPI = {\n  toggle: contentId => api.post('/api/watchlist/toggle/', {\n    content_id: contentId\n  }),\n  getStatus: contentId => api.get(`/api/watchlist/status/?content_id=${contentId}`),\n  getList: () => api.get('/api/watchlist/')\n};\nexport default api;","map":{"version":3,"names":["axios","API_BASE_URL","api","create","baseURL","headers","withCredentials","interceptors","request","use","config","token","localStorage","getItem","Authorization","csrfToken","error","Promise","reject","response","status","removeItem","setItem","currentPath","window","location","hash","slice","href","includes","encodeURIComponent","watchlistAPI","toggle","contentId","post","content_id","getStatus","get","getList"],"sources":["D:/OTT/ott_frontend/src/utils/api.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_BASE_URL = 'http://192.168.0.127:8001';\n\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  withCredentials: true, // This is important for CSRF protection\n});\n\n// Add a request interceptor\napi.interceptors.request.use(\n  (config) => {\n    // Get token from localStorage\n    const token = localStorage.getItem('token');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    \n    // Add CSRF token for all requests when available\n    const csrfToken = localStorage.getItem('csrfToken');\n    if (csrfToken) {\n      config.headers['X-CSRFToken'] = csrfToken;\n    }\n    \n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Add a response interceptor\napi.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    if (error.response?.status === 401) {\n      // Clear auth data\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      localStorage.setItem('isAuthenticated', 'false');\n      \n      // Get current path for redirect\n      const currentPath = window.location.hash.slice(1); // Remove the '#' from the hash\n      \n      // Only redirect if not already on login page\n      if (!window.location.href.includes('/login')) {\n        // Store current path and redirect to login\n        window.location.href = `/#/login?redirect=${encodeURIComponent(currentPath)}`;\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\nexport const watchlistAPI = {\n  toggle: (contentId) => api.post('/api/watchlist/toggle/', { content_id: contentId }),\n  getStatus: (contentId) => api.get(`/api/watchlist/status/?content_id=${contentId}`),\n  getList: () => api.get('/api/watchlist/'),\n};\n\nexport default api;"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,YAAY,GAAG,2BAA2B;AAEhD,MAAMC,GAAG,GAAGF,KAAK,CAACG,MAAM,CAAC;EACvBC,OAAO,EAAEH,YAAY;EACrBI,OAAO,EAAE;IACP,cAAc,EAAE;EAClB,CAAC;EACDC,eAAe,EAAE,IAAI,CAAE;AACzB,CAAC,CAAC;;AAEF;AACAJ,GAAG,CAACK,YAAY,CAACC,OAAO,CAACC,GAAG,CACzBC,MAAM,IAAK;EACV;EACA,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,IAAIF,KAAK,EAAE;IACTD,MAAM,CAACL,OAAO,CAACS,aAAa,GAAG,UAAUH,KAAK,EAAE;EAClD;;EAEA;EACA,MAAMI,SAAS,GAAGH,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC;EACnD,IAAIE,SAAS,EAAE;IACbL,MAAM,CAACL,OAAO,CAAC,aAAa,CAAC,GAAGU,SAAS;EAC3C;EAEA,OAAOL,MAAM;AACf,CAAC,EACAM,KAAK,IAAK;EACT,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAC9B,CACF,CAAC;;AAED;AACAd,GAAG,CAACK,YAAY,CAACY,QAAQ,CAACV,GAAG,CAC1BU,QAAQ,IAAKA,QAAQ,EACrBH,KAAK,IAAK;EACT,IAAIA,KAAK,CAACG,QAAQ,EAAEC,MAAM,KAAK,GAAG,EAAE;IAClC;IACAR,YAAY,CAACS,UAAU,CAAC,OAAO,CAAC;IAChCT,YAAY,CAACS,UAAU,CAAC,MAAM,CAAC;IAC/BT,YAAY,CAACU,OAAO,CAAC,iBAAiB,EAAE,OAAO,CAAC;;IAEhD;IACA,MAAMC,WAAW,GAAGC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;;IAEnD;IACA,IAAI,CAACH,MAAM,CAACC,QAAQ,CAACG,IAAI,CAACC,QAAQ,CAAC,QAAQ,CAAC,EAAE;MAC5C;MACAL,MAAM,CAACC,QAAQ,CAACG,IAAI,GAAG,qBAAqBE,kBAAkB,CAACP,WAAW,CAAC,EAAE;IAC/E;EACF;EACA,OAAON,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAC9B,CACF,CAAC;AAED,OAAO,MAAMe,YAAY,GAAG;EAC1BC,MAAM,EAAGC,SAAS,IAAK/B,GAAG,CAACgC,IAAI,CAAC,wBAAwB,EAAE;IAAEC,UAAU,EAAEF;EAAU,CAAC,CAAC;EACpFG,SAAS,EAAGH,SAAS,IAAK/B,GAAG,CAACmC,GAAG,CAAC,qCAAqCJ,SAAS,EAAE,CAAC;EACnFK,OAAO,EAAEA,CAAA,KAAMpC,GAAG,CAACmC,GAAG,CAAC,iBAAiB;AAC1C,CAAC;AAED,eAAenC,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}