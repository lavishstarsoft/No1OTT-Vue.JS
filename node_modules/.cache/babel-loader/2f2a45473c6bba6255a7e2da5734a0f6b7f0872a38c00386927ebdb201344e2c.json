{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.every.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nexport default {\n  name: 'LoginPage',\n  data() {\n    return {\n      phoneNumber: '',\n      phoneError: '',\n      showPhoneError: false,\n      showCookieNotice: true,\n      showOTP: false,\n      otpDigits: ['', '', '', ''],\n      resendTimer: 0,\n      timerInterval: null,\n      termsAccepted: false,\n      showTermsError: false,\n      showTermsModal: false,\n      showPrivacyModal: false,\n      isLoading: false,\n      apiBaseUrl: 'http://192.168.0.127:8080',\n      referralCode: '',\n      otpError: '',\n      smsReceiver: null\n    };\n  },\n  methods: {\n    // Get CSRF token from cookie\n    getCSRFToken() {\n      const name = 'csrftoken';\n      let cookieValue = null;\n      if (document.cookie && document.cookie !== '') {\n        const cookies = document.cookie.split(';');\n        for (let i = 0; i < cookies.length; i++) {\n          const cookie = cookies[i].trim();\n          if (cookie.substring(0, name.length + 1) === name + '=') {\n            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n            break;\n          }\n        }\n      }\n      return cookieValue;\n    },\n    validatePhoneNumber() {\n      // Remove any non-digit characters\n      let cleanedNumber = this.phoneNumber.replace(/\\D/g, '');\n\n      // If user entered 12 digits and starts with 91, remove country code\n      if (cleanedNumber.length === 12 && cleanedNumber.startsWith('91')) {\n        cleanedNumber = cleanedNumber.substring(2);\n      }\n\n      // Update the phone number field with cleaned number\n      this.phoneNumber = cleanedNumber;\n      if (cleanedNumber.length === 0) {\n        this.phoneError = ''; // Don't show error for empty field\n        return false;\n      } else if (cleanedNumber.length !== 10) {\n        this.phoneError = cleanedNumber.length > 0 ? 'Please enter a valid 10-digit mobile number' : '';\n        return false;\n      } else if (!/^[6-9]\\d{9}$/.test(cleanedNumber)) {\n        this.phoneError = 'Please enter a valid Indian mobile number';\n        return false;\n      }\n      this.phoneError = '';\n      return true;\n    },\n    clearLoginPageData() {\n      console.log('Clearing login page data');\n\n      // Clear specific login-related items\n      const itemsToRemove = ['registrationSuccess', 'registrationMessage', 'loginSuccess', 'loginMessage', 'hasCompletedRegistration', 'app_version'];\n      itemsToRemove.forEach(item => {\n        localStorage.removeItem(item);\n        sessionStorage.removeItem(item);\n      });\n\n      // Clear any pending payment data\n      localStorage.removeItem('pending_payment');\n      sessionStorage.removeItem('pending_payment');\n      console.log('Login page data cleared');\n    },\n    // Handle input formatting as user types\n    handlePhoneInput(event) {\n      let value = event.target.value.replace(/\\D/g, '');\n\n      // If user entered 12 digits and starts with 91, remove country code\n      if (value.length === 12 && value.startsWith('91')) {\n        value = value.substring(2);\n      }\n\n      // Limit to 10 digits\n      if (value.length > 10) {\n        value = value.substring(0, 10);\n      }\n      this.phoneNumber = value;\n      this.validatePhoneNumber(); // Validate on each input\n    },\n    async handleLogin() {\n      if (!this.showOTP) {\n        // Clear any previous errors\n        this.phoneError = '';\n        this.showTermsError = false;\n\n        // Validate phone number first\n        if (!this.validatePhoneNumber()) {\n          this.showPhoneError = true;\n          const inputField = document.querySelector('input[type=\"tel\"]');\n          inputField.classList.add('shake-animation');\n          setTimeout(() => {\n            this.showPhoneError = false;\n            inputField.classList.remove('shake-animation');\n          }, 650);\n          return;\n        }\n        if (!this.termsAccepted) {\n          this.showTermsError = true;\n          const termsBox = document.querySelector('#terms-consent').parentElement.parentElement;\n          termsBox.classList.add('shake-animation');\n          setTimeout(() => {\n            termsBox.classList.remove('shake-animation');\n          }, 650);\n          return;\n        }\n\n        // Request OTP\n        try {\n          this.isLoading = true;\n          const response = await fetch(`${this.apiBaseUrl}/users/request-otp/`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json',\n              'X-CSRFToken': this.getCSRFToken()\n            },\n            credentials: 'include',\n            mode: 'cors',\n            body: JSON.stringify({\n              phone: this.phoneNumber,\n              otp_type: 'login'\n            })\n          });\n          if (!response.ok) {\n            const errorText = await response.text();\n            let errorMessage;\n            try {\n              const errorData = JSON.parse(errorText);\n              errorMessage = errorData.message || 'Failed to send OTP';\n            } catch (e) {\n              errorMessage = 'Server error. Please try again.';\n            }\n            throw new Error(errorMessage);\n          }\n          await response.json(); // Just consume the response\n          this.showOTP = true;\n          this.startOTPDetection(); // Start OTP detection\n          this.startResendTimer();\n          // Focus on first OTP input\n          this.$nextTick(() => {\n            const firstInput = this.$refs.otpInput0[0];\n            firstInput.focus();\n\n            // Try to show virtual keyboard on mobile\n            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\n              firstInput.click();\n            }\n          });\n        } catch (error) {\n          console.error('Error requesting OTP:', error);\n          this.phoneError = error.message || 'Network error. Please check your connection.';\n          this.showPhoneError = true;\n        } finally {\n          this.isLoading = false;\n        }\n      } else {\n        // Verify OTP\n        const otp = this.otpDigits.join('');\n        if (otp.length === 4) {\n          try {\n            this.isLoading = true;\n            this.otpError = ''; // Clear previous errors\n\n            const response = await fetch(`${this.apiBaseUrl}/users/users/login/`, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json',\n                'X-CSRFToken': this.getCSRFToken()\n              },\n              credentials: 'include',\n              mode: 'cors',\n              body: JSON.stringify({\n                phone: this.phoneNumber,\n                otp: otp,\n                ref: this.referralCode\n              })\n            });\n            if (!response.ok) {\n              const errorText = await response.text();\n              let errorMessage;\n              try {\n                const errorData = JSON.parse(errorText);\n                errorMessage = errorData.message || 'Invalid OTP';\n              } catch (e) {\n                errorMessage = 'Invalid OTP. Please try again.';\n              }\n              throw new Error(errorMessage);\n            }\n            const userData = await response.json();\n\n            // Store user data and tokens\n            localStorage.setItem('user', JSON.stringify(userData.user));\n            localStorage.setItem('csrfToken', userData.csrf_token);\n            localStorage.setItem('phone', this.phoneNumber);\n            localStorage.setItem('isAuthenticated', 'true');\n            localStorage.setItem('token', userData.csrf_token);\n            const user = userData.user;\n\n            // Check if user has completed basic registration\n            if (user.first_name && user.last_name && user.state && user.district) {\n              localStorage.setItem('hasCompletedRegistration', 'true');\n              const userName = user.first_name || 'User';\n              localStorage.setItem('loginSuccess', 'true');\n              localStorage.setItem('loginMessage', `Welcome back, ${userName}! ðŸ‘‹`);\n              // Redirect to home or saved redirect path\n              const redirect = this.$route.query.redirect || '/';\n              await this.$router.push(redirect);\n            } else {\n              localStorage.setItem('hasCompletedRegistration', 'false');\n              // Redirect to mini registration\n              await this.$router.push('/mini-register');\n            }\n          } catch (error) {\n            console.error('Login Error:', error);\n            this.otpError = error.message;\n\n            // Add shake animation to OTP inputs\n            const inputs = Array.from({\n              length: 4\n            }, (_, i) => this.$refs['otpInput' + i][0]);\n            inputs.forEach(input => {\n              input.classList.add('shake-animation');\n              setTimeout(() => input.classList.remove('shake-animation'), 650);\n            });\n\n            // Clear OTP fields and focus on first input\n            this.otpDigits = ['', '', '', ''];\n            this.$refs.otpInput0[0].focus();\n          } finally {\n            this.isLoading = false;\n          }\n        }\n      }\n    },\n    async resendOTP() {\n      if (this.resendTimer > 0) return;\n      try {\n        this.isLoading = true;\n        await fetch(`${this.apiBaseUrl}/users/request-otp/`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n            'X-CSRFToken': this.getCSRFToken()\n          },\n          credentials: 'include',\n          mode: 'cors',\n          body: JSON.stringify({\n            phone: this.phoneNumber,\n            otp_type: 'login'\n          })\n        });\n\n        // Start resend timer and clear OTP fields\n        this.startResendTimer();\n        this.otpDigits = ['', '', '', ''];\n        this.otpError = '';\n        this.$refs.otpInput0[0].focus();\n      } catch (error) {\n        console.error('Error resending OTP:', error);\n        this.otpError = 'Failed to resend OTP. Please try again.';\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    handleOtpInput(event, index) {\n      this.clearOtpError(); // Clear error when user starts typing\n      const value = event.target.value;\n      // Only allow numbers\n      if (!/^\\d*$/.test(value)) {\n        event.target.value = '';\n        return;\n      }\n      this.otpDigits[index] = value;\n\n      // Move to next input if value is entered\n      if (value && index < 3) {\n        this.$refs['otpInput' + (index + 1)][0].focus();\n      }\n\n      // Check if all digits are filled\n      if (this.otpDigits.every(digit => digit !== '')) {\n        // Auto verify after a short delay\n        setTimeout(() => {\n          this.handleLogin();\n        }, 300);\n      }\n    },\n    handleKeydown(event, index) {\n      // Handle backspace\n      if (event.key === 'Backspace' && !this.otpDigits[index] && index > 0) {\n        this.$refs['otpInput' + (index - 1)][0].focus();\n      }\n    },\n    handlePaste(event) {\n      event.preventDefault();\n      const pastedData = event.clipboardData.getData('text');\n      const numbers = pastedData.match(/\\d/g);\n      if (numbers) {\n        // Clear existing OTP digits\n        this.otpDigits = ['', '', '', ''];\n\n        // Fill in the pasted numbers\n        numbers.slice(0, 4).forEach((num, index) => {\n          if (index < 4) {\n            this.otpDigits[index] = num;\n            if (this.$refs['otpInput' + index]) {\n              this.$refs['otpInput' + index][0].value = num;\n            }\n          }\n        });\n\n        // Focus on the next empty input or the last input if all filled\n        const emptyIndex = this.otpDigits.findIndex(digit => !digit);\n        const focusIndex = emptyIndex === -1 ? 3 : emptyIndex;\n        this.$refs['otpInput' + focusIndex][0].focus();\n\n        // If all digits are filled, trigger verification\n        if (this.otpDigits.every(digit => digit !== '')) {\n          setTimeout(() => {\n            this.handleLogin();\n          }, 300);\n        }\n      }\n    },\n    setupSMSRetrieval() {\n      try {\n        if (!this.smsReceiver && 'OTPCredential' in window) {\n          const ac = new AbortController();\n          navigator.credentials.get({\n            otp: {\n              transport: ['sms']\n            },\n            signal: ac.signal\n          }).then(otp => {\n            if (otp && otp.code) {\n              const otpValue = otp.code;\n              // Fill in OTP digits\n              for (let i = 0; i < Math.min(otpValue.length, 4); i++) {\n                this.otpDigits[i] = otpValue[i];\n                if (this.$refs['otpInput' + i]) {\n                  this.$refs['otpInput' + i][0].value = otpValue[i];\n                }\n              }\n              // Auto verify if complete\n              if (this.otpDigits.every(digit => digit !== '')) {\n                setTimeout(() => this.handleLogin(), 300);\n              }\n            }\n          }).catch(err => {\n            console.log('SMS Retrieval Error:', err);\n          });\n          this.smsReceiver = ac;\n        }\n      } catch (error) {\n        console.log('SMS Setup Error:', error);\n      }\n    },\n    startOTPDetection() {\n      // Clean up any existing receiver\n      if (this.smsReceiver) {\n        this.smsReceiver.abort();\n        this.smsReceiver = null;\n      }\n\n      // Setup new SMS retrieval\n      this.setupSMSRetrieval();\n\n      // Add format hint for browsers\n      const input = document.getElementById('otp-input');\n      if (input) {\n        input.addEventListener('focus', () => {\n          if ('OTPCredential' in window) {\n            navigator.credentials.get({\n              otp: {\n                transport: ['sms']\n              },\n              signal: this.smsReceiver?.signal\n            }).catch(() => {});\n          }\n        });\n      }\n    },\n    startResendTimer() {\n      this.resendTimer = 30;\n      this.timerInterval = setInterval(() => {\n        if (this.resendTimer > 0) {\n          this.resendTimer--;\n        } else {\n          clearInterval(this.timerInterval);\n        }\n      }, 1000);\n    },\n    closeCookieNotice() {\n      this.showCookieNotice = false;\n    },\n    handleBack() {\n      // Clear OTP related data\n      this.showOTP = false;\n      this.otpDigits = ['', '', '', ''];\n      if (this.timerInterval) {\n        clearInterval(this.timerInterval);\n        this.resendTimer = 0;\n      }\n    },\n    beforeDestroy() {\n      // Clean up SMS receiver\n      if (this.smsReceiver) {\n        this.smsReceiver.abort();\n        this.smsReceiver = null;\n      }\n\n      // Clean up timer\n      if (this.timerInterval) {\n        clearInterval(this.timerInterval);\n      }\n    },\n    // Add method to clear OTP error\n    clearOtpError() {\n      this.otpError = '';\n    }\n  },\n  beforeUnmount() {\n    if (this.timerInterval) {\n      clearInterval(this.timerInterval);\n    }\n  },\n  async created() {\n    console.log('Component created - Starting initialization');\n\n    // Clear any existing data on login page load\n    this.clearLoginPageData();\n    try {\n      // Get phone number and token from query params or localStorage\n      this.phoneNumber = this.$route.query.phone || localStorage.getItem('phone') || '';\n\n      // Get referral code from URL if present - check both query params and hash params\n      const urlParams = new URLSearchParams(window.location.search);\n      let referralFromUrl = urlParams.get('ref');\n\n      // If not found, check hash params (after #)\n      if (!referralFromUrl && window.location.hash) {\n        const hashParts = window.location.hash.split('?');\n        if (hashParts.length > 1) {\n          const hashParams = new URLSearchParams(hashParts[1]);\n          referralFromUrl = hashParams.get('ref');\n        }\n      }\n      this.referralCode = referralFromUrl || '';\n\n      // Store referral code in localStorage if present\n      if (this.referralCode) {\n        localStorage.setItem('referralCode', this.referralCode);\n      }\n\n      // Try to get token from multiple sources\n      const token = this.$route.query.token || localStorage.getItem('token') || localStorage.getItem('csrfToken') || localStorage.getItem('user') && JSON.parse(localStorage.getItem('user')).token;\n      console.log('Initial token:', token);\n\n      // Only show error if we have both phone and token but they're invalid\n      if (this.$route.query.phone && !this.phoneNumber) {\n        console.error('Invalid phone number');\n        this.phoneError = 'Invalid phone number. Please try again.';\n      }\n      if (this.$route.query.token && !token) {\n        console.error('Invalid token');\n        this.phoneError = 'Authentication failed. Please try again.';\n      }\n\n      // Store token if not already stored\n      if (token) {\n        localStorage.setItem('token', token);\n      }\n\n      // Get referral code from URL if present - check both query params and hash params\n      let refCode = null;\n\n      // First check normal query params\n      const queryParams = new URLSearchParams(window.location.search);\n      refCode = queryParams.get('ref');\n\n      // If not found, check hash params (after #)\n      if (!refCode && window.location.hash) {\n        const hashParts = window.location.hash.split('?');\n        if (hashParts.length > 1) {\n          const hashParams = new URLSearchParams(hashParts[1]);\n          refCode = hashParams.get('ref');\n        }\n      }\n      this.referralCode = refCode || '';\n\n      // Store referral code in localStorage if present\n      if (this.referralCode) {\n        localStorage.setItem('referralCode', this.referralCode);\n      }\n\n      // Validate phone number if it exists\n      if (this.phoneNumber) {\n        this.validatePhoneNumber();\n      }\n    } catch (error) {\n      console.error('Error in component creation:', error);\n      // Don't show error message for normal initialization\n      if (error.message !== 'Failed to fetch') {\n        console.error('Unexpected error:', error);\n      }\n    }\n  },\n  watch: {\n    // Add watcher for phone number to validate in real-time\n    phoneNumber: {\n      handler(newValue) {\n        if (newValue) {\n          this.validatePhoneNumber();\n        } else {\n          this.phoneError = '';\n        }\n      },\n      immediate: true\n    }\n  },\n  computed: {\n    // Add computed property for input styling\n    phoneInputStyle() {\n      if (this.phoneNumber.length === 10 && !this.phoneError) {\n        return 'border-[#4CAF50] text-[#4CAF50]';\n      } else if (this.phoneError) {\n        return 'border-[#ff4d4d]';\n      }\n      return 'border-white/10';\n    }\n  }\n};","map":{"version":3,"names":["name","data","phoneNumber","phoneError","showPhoneError","showCookieNotice","showOTP","otpDigits","resendTimer","timerInterval","termsAccepted","showTermsError","showTermsModal","showPrivacyModal","isLoading","apiBaseUrl","referralCode","otpError","smsReceiver","methods","getCSRFToken","cookieValue","document","cookie","cookies","split","i","length","trim","substring","decodeURIComponent","validatePhoneNumber","cleanedNumber","replace","startsWith","test","clearLoginPageData","console","log","itemsToRemove","forEach","item","localStorage","removeItem","sessionStorage","handlePhoneInput","event","value","target","handleLogin","inputField","querySelector","classList","add","setTimeout","remove","termsBox","parentElement","response","fetch","method","headers","credentials","mode","body","JSON","stringify","phone","otp_type","ok","errorText","text","errorMessage","errorData","parse","message","e","Error","json","startOTPDetection","startResendTimer","$nextTick","firstInput","$refs","otpInput0","focus","navigator","userAgent","click","error","otp","join","ref","userData","setItem","user","csrf_token","first_name","last_name","state","district","userName","redirect","$route","query","$router","push","inputs","Array","from","_","input","resendOTP","handleOtpInput","index","clearOtpError","every","digit","handleKeydown","key","handlePaste","preventDefault","pastedData","clipboardData","getData","numbers","match","slice","num","emptyIndex","findIndex","focusIndex","setupSMSRetrieval","window","ac","AbortController","get","transport","signal","then","code","otpValue","Math","min","catch","err","abort","getElementById","addEventListener","setInterval","clearInterval","closeCookieNotice","handleBack","beforeDestroy","beforeUnmount","created","getItem","urlParams","URLSearchParams","location","search","referralFromUrl","hash","hashParts","hashParams","token","refCode","queryParams","watch","handler","newValue","immediate","computed","phoneInputStyle"],"sources":["F:\\ott_tv\\ott_frontend\\src\\components\\LoginPage.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-[#121212] flex items-center justify-center px-4\">\n    <!-- Back Button -->\n    <router-link \n      v-if=\"!showOTP\" \n      to=\"/\" \n      class=\"absolute top-6 left-6 text-white/70 hover:text-white\"\n    >\n      <i class=\"fas fa-arrow-left text-xl\"></i>\n    </router-link>\n    <button \n      v-else \n      @click=\"handleBack\" \n      class=\"absolute top-6 left-6 text-white/70 hover:text-white\"\n    >\n      <i class=\"fas fa-arrow-left text-xl\"></i>\n    </button>\n\n    <!-- Main Content -->\n    <div class=\"w-full max-w-md\">\n      <!-- Logo -->\n      <div class=\"text-center mb-12\">\n        <img src=\"@/assets/ott.jpg\" alt=\"Logo\" class=\"h-12 mx-auto mb-8\">\n        <h1 class=\"text-[2.5rem] font-bold text-white leading-tight\">\n          LET'S GET STARTED<span class=\"text-[#c30059]\">.</span>\n        </h1>\n      </div>\n\n      <!-- Login Form -->\n      <div class=\"space-y-6\">\n        <!-- Mobile Number Input -->\n        <div v-if=\"!showOTP\">\n          <label class=\"block text-white/90 text-sm mb-2\">Mobile Number</label>\n          <div class=\"flex items-center bg-[#1d1d1d] rounded-lg overflow-hidden\"\n               :class=\"phoneInputStyle\">\n            <div class=\"flex items-center px-3 border-r border-white/10 h-14\">\n              <img src=\"@/assets/posters/india-flag.png\" alt=\"India\" class=\"w-6 h-4\">\n              <span class=\"text-white ml-2\">+91</span>\n            </div>\n            <input \n              type=\"tel\"\n              v-model=\"phoneNumber\"\n              class=\"flex-1 bg-transparent text-white h-14 px-4 focus:outline-none\"\n              :class=\"{\n                'shake-animation': showPhoneError,\n                'text-[#4CAF50]': phoneNumber.length === 10 && !phoneError\n              }\"\n              placeholder=\"Enter your mobile number\"\n              maxlength=\"10\"\n              @input=\"handlePhoneInput\"\n            />\n            <!-- Success Icon -->\n            <div v-if=\"phoneNumber.length === 10 && !phoneError\" \n                 class=\"pr-4 text-[#4CAF50]\">\n              <i class=\"fas fa-check-circle\"></i>\n            </div>\n          </div>\n          <!-- Phone Error Message -->\n          <transition name=\"fade\">\n            <p v-if=\"phoneError\" class=\"mt-2 text-[#ff4d4d] text-sm flex items-center\">\n              <i class=\"fas fa-exclamation-circle mr-2\"></i>\n              {{ phoneError }}\n            </p>\n          </transition>\n        </div>\n\n        <!-- OTP Input Section -->\n        <div v-if=\"showOTP\" class=\"space-y-4\">\n          <div class=\"text-center\">\n            <h2 class=\"text-white text-xl font-medium mb-2\">Enter Verification Code</h2>\n            <p class=\"text-white/60 text-sm\">\n              We've sent a 4-digit code to +91 {{ phoneNumber }}\n              <button @click=\"showOTP = false\" class=\"text-[#c30059] ml-2 hover:text-[#ff4d4d]\">\n                Change\n              </button>\n            </p>\n          </div>\n          \n          <div class=\"flex flex-col items-center\">\n            <div class=\"flex justify-center space-x-4 my-8\">\n              <template v-for=\"(digit, index) in 4\" :key=\"index\">\n                <input\n                  type=\"text\"\n                  v-model=\"otpDigits[index]\"\n                  @input=\"handleOtpInput($event, index)\"\n                  @keydown=\"handleKeydown($event, index)\"\n                  @paste=\"handlePaste\"\n                  maxlength=\"1\"\n                  inputmode=\"numeric\"\n                  autocomplete=\"one-time-code\"\n                  :id=\"index === 0 ? 'otp-input' : ''\"\n                  :class=\"[\n                    'w-14 h-14 bg-[#1d1d1d] border rounded-lg text-center text-white text-2xl font-medium focus:outline-none transition-all',\n                    otpError ? 'border-[#ff4d4d] shake-animation' : 'border-white/10 focus:border-[#c30059]'\n                  ]\"\n                  :ref=\"'otpInput' + index\"\n                />\n              </template>\n            </div>\n            \n            <!-- OTP Error Message -->\n            <transition name=\"fade\">\n              <p v-if=\"otpError\" class=\"mt-2 text-[#ff4d4d] text-sm flex items-center\">\n                <i class=\"fas fa-exclamation-circle mr-2\"></i>\n                {{ otpError }}\n              </p>\n            </transition>\n          </div>\n\n          <div class=\"text-center\">\n            <p class=\"text-white/60 text-sm\">\n              Didn't receive the code?\n              <button \n                @click=\"resendOTP\" \n                :disabled=\"resendTimer > 0\"\n                class=\"text-[#c30059] ml-1 hover:text-[#ff4d4d] disabled:opacity-50\"\n              >\n                {{ resendTimer > 0 ? `Resend in ${resendTimer}s` : 'Resend' }}\n              </button>\n            </p>\n          </div>\n        </div>\n\n        <!-- Proceed/Verify Button -->\n        <button \n          @click=\"handleLogin\"\n          :disabled=\"isLoading\"\n          class=\"w-full bg-gradient-to-r from-[#c30059] to-[#ff4d4d] text-white py-4 rounded-lg font-medium text-lg hover:opacity-90 transition-opacity disabled:opacity-50 relative\"\n        >\n          <span v-if=\"!isLoading\">{{ showOTP ? 'Verify' : 'Proceed' }}</span>\n          <span v-else class=\"flex items-center justify-center\">\n            <svg class=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n              <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n              <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n            </svg>\n            Verifying...\n          </span>\n        </button>\n\n        <!-- Terms & Privacy Section -->\n        <div class=\"mt-6\" v-if=\"!showOTP\">\n          <div class=\"flex items-start space-x-3 bg-[#1d1d1d] p-4 rounded-lg border border-white/10\">\n            <div class=\"flex-shrink-0 mt-1\">\n              <input \n                type=\"checkbox\" \n                id=\"terms-consent\"\n                v-model=\"termsAccepted\"\n                class=\"w-4 h-4 rounded border-white/30 bg-transparent checked:bg-[#c30059] checked:border-[#c30059] focus:ring-[#c30059] focus:ring-offset-0 focus:ring-offset-transparent transition-all cursor-pointer\"\n              >\n            </div>\n            <div class=\"flex-grow\">\n              <label for=\"terms-consent\" class=\"block text-white/80 text-sm leading-relaxed cursor-pointer\">\n                I agree to the \n                <a \n                  @click.prevent=\"showTermsModal = true\" \n                  href=\"#\" \n                  class=\"text-[#c30059] hover:text-[#ff4d4d] underline decoration-dotted underline-offset-2 font-medium transition-colors\"\n                >\n                  Terms & Conditions\n                </a> \n                and \n                <a \n                  @click.prevent=\"showPrivacyModal = true\" \n                  href=\"#\" \n                  class=\"text-[#c30059] hover:text-[#ff4d4d] underline decoration-dotted underline-offset-2 font-medium transition-colors\"\n                >\n                  Privacy Policy\n                </a>\n              </label>\n              <p class=\"mt-1 text-white/50 text-xs\">\n                Your privacy matters to us. Read how we handle your data.\n              </p>\n            </div>\n          </div>\n          <!-- Error message -->\n          <p v-if=\"showTermsError\" class=\"mt-2 text-[#ff4d4d] text-sm flex items-center\">\n            <i class=\"fas fa-exclamation-circle mr-2\"></i>\n            Please accept the terms to continue\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <!-- Cookie Notice -->\n    \n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'LoginPage',\n  data() {\n    return {\n      phoneNumber: '',\n      phoneError: '',\n      showPhoneError: false,\n      showCookieNotice: true,\n      showOTP: false,\n      otpDigits: ['', '', '', ''],\n      resendTimer: 0,\n      timerInterval: null,\n      termsAccepted: false,\n      showTermsError: false,\n      showTermsModal: false,\n      showPrivacyModal: false,\n      isLoading: false,\n      apiBaseUrl: 'http://192.168.0.127:8080',\n      referralCode: '',\n      otpError: '',\n      smsReceiver: null\n    }\n  },\n  methods: {\n    // Get CSRF token from cookie\n    getCSRFToken() {\n      const name = 'csrftoken';\n      let cookieValue = null;\n      if (document.cookie && document.cookie !== '') {\n        const cookies = document.cookie.split(';');\n        for (let i = 0; i < cookies.length; i++) {\n          const cookie = cookies[i].trim();\n          if (cookie.substring(0, name.length + 1) === (name + '=')) {\n            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n            break;\n          }\n        }\n      }\n      return cookieValue;\n    },\n\n    validatePhoneNumber() {\n      // Remove any non-digit characters\n      let cleanedNumber = this.phoneNumber.replace(/\\D/g, '');\n      \n      // If user entered 12 digits and starts with 91, remove country code\n      if (cleanedNumber.length === 12 && cleanedNumber.startsWith('91')) {\n        cleanedNumber = cleanedNumber.substring(2);\n      }\n      \n      // Update the phone number field with cleaned number\n      this.phoneNumber = cleanedNumber;\n      \n      if (cleanedNumber.length === 0) {\n        this.phoneError = '';  // Don't show error for empty field\n        return false;\n      } else if (cleanedNumber.length !== 10) {\n        this.phoneError = cleanedNumber.length > 0 ? 'Please enter a valid 10-digit mobile number' : '';\n        return false;\n      } else if (!/^[6-9]\\d{9}$/.test(cleanedNumber)) {\n        this.phoneError = 'Please enter a valid Indian mobile number';\n        return false;\n      }\n      \n      this.phoneError = '';\n      return true;\n    },\n    clearLoginPageData() {\n      console.log('Clearing login page data');\n      \n      // Clear specific login-related items\n      const itemsToRemove = [\n        'registrationSuccess', 'registrationMessage',\n        'loginSuccess', 'loginMessage',\n        'hasCompletedRegistration', 'app_version'\n      ];\n      \n      itemsToRemove.forEach(item => {\n        localStorage.removeItem(item);\n        sessionStorage.removeItem(item);\n      });\n      \n      // Clear any pending payment data\n      localStorage.removeItem('pending_payment');\n      sessionStorage.removeItem('pending_payment');\n      \n      console.log('Login page data cleared');\n    },\n\n    // Handle input formatting as user types\n    handlePhoneInput(event) {\n      let value = event.target.value.replace(/\\D/g, '');\n      \n      // If user entered 12 digits and starts with 91, remove country code\n      if (value.length === 12 && value.startsWith('91')) {\n        value = value.substring(2);\n      }\n      \n      // Limit to 10 digits\n      if (value.length > 10) {\n        value = value.substring(0, 10);\n      }\n      \n      this.phoneNumber = value;\n      this.validatePhoneNumber();  // Validate on each input\n    },\n\n    async handleLogin() {\n      if (!this.showOTP) {\n        // Clear any previous errors\n        this.phoneError = '';\n        this.showTermsError = false;\n\n        // Validate phone number first\n        if (!this.validatePhoneNumber()) {\n          this.showPhoneError = true;\n          const inputField = document.querySelector('input[type=\"tel\"]');\n          inputField.classList.add('shake-animation');\n          setTimeout(() => {\n            this.showPhoneError = false;\n            inputField.classList.remove('shake-animation');\n          }, 650);\n          return;\n        }\n\n        if (!this.termsAccepted) {\n          this.showTermsError = true;\n          const termsBox = document.querySelector('#terms-consent').parentElement.parentElement;\n          termsBox.classList.add('shake-animation');\n          setTimeout(() => {\n            termsBox.classList.remove('shake-animation');\n          }, 650);\n          return;\n        }\n\n        // Request OTP\n        try {\n          this.isLoading = true;\n          const response = await fetch(`${this.apiBaseUrl}/users/request-otp/`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json',\n              'X-CSRFToken': this.getCSRFToken()\n            },\n            credentials: 'include',\n            mode: 'cors',\n            body: JSON.stringify({\n              phone: this.phoneNumber,\n              otp_type: 'login'\n            })\n          });\n\n          if (!response.ok) {\n            const errorText = await response.text();\n            let errorMessage;\n            try {\n              const errorData = JSON.parse(errorText);\n              errorMessage = errorData.message || 'Failed to send OTP';\n            } catch (e) {\n              errorMessage = 'Server error. Please try again.';\n            }\n            throw new Error(errorMessage);\n          }\n\n          await response.json(); // Just consume the response\n          this.showOTP = true;\n          this.startOTPDetection(); // Start OTP detection\n          this.startResendTimer();\n          // Focus on first OTP input\n          this.$nextTick(() => {\n            const firstInput = this.$refs.otpInput0[0];\n            firstInput.focus();\n            \n            // Try to show virtual keyboard on mobile\n            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\n              firstInput.click();\n            }\n          });\n        } catch (error) {\n          console.error('Error requesting OTP:', error);\n          this.phoneError = error.message || 'Network error. Please check your connection.';\n          this.showPhoneError = true;\n        } finally {\n          this.isLoading = false;\n        }\n      } else {\n        // Verify OTP\n        const otp = this.otpDigits.join('');\n        if (otp.length === 4) {\n          try {\n            this.isLoading = true;\n            this.otpError = ''; // Clear previous errors\n            \n            const response = await fetch(`${this.apiBaseUrl}/users/users/login/`, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json',\n                'X-CSRFToken': this.getCSRFToken()\n              },\n              credentials: 'include',\n              mode: 'cors',\n              body: JSON.stringify({\n                phone: this.phoneNumber,\n                otp: otp,\n                ref: this.referralCode\n              })\n            });\n\n            if (!response.ok) {\n              const errorText = await response.text();\n              let errorMessage;\n              try {\n                const errorData = JSON.parse(errorText);\n                errorMessage = errorData.message || 'Invalid OTP';\n              } catch (e) {\n                errorMessage = 'Invalid OTP. Please try again.';\n              }\n              throw new Error(errorMessage);\n            }\n\n            const userData = await response.json();\n            \n            // Store user data and tokens\n            localStorage.setItem('user', JSON.stringify(userData.user));\n            localStorage.setItem('csrfToken', userData.csrf_token);\n            localStorage.setItem('phone', this.phoneNumber);\n            localStorage.setItem('isAuthenticated', 'true');\n            localStorage.setItem('token', userData.csrf_token);\n            \n            const user = userData.user;\n            \n            // Check if user has completed basic registration\n            if (user.first_name && user.last_name && user.state && user.district) {\n              localStorage.setItem('hasCompletedRegistration', 'true');\n              const userName = user.first_name || 'User';\n              localStorage.setItem('loginSuccess', 'true');\n              localStorage.setItem('loginMessage', `Welcome back, ${userName}! ðŸ‘‹`);\n              // Redirect to home or saved redirect path\n              const redirect = this.$route.query.redirect || '/';\n              await this.$router.push(redirect);\n            } else {\n              localStorage.setItem('hasCompletedRegistration', 'false');\n              // Redirect to mini registration\n              await this.$router.push('/mini-register');\n            }\n          } catch (error) {\n            console.error('Login Error:', error);\n            this.otpError = error.message;\n            \n            // Add shake animation to OTP inputs\n            const inputs = Array.from({ length: 4 }, (_, i) => this.$refs['otpInput' + i][0]);\n            inputs.forEach(input => {\n              input.classList.add('shake-animation');\n              setTimeout(() => input.classList.remove('shake-animation'), 650);\n            });\n            \n            // Clear OTP fields and focus on first input\n            this.otpDigits = ['', '', '', ''];\n            this.$refs.otpInput0[0].focus();\n          } finally {\n            this.isLoading = false;\n          }\n        }\n      }\n    },\n\n    async resendOTP() {\n      if (this.resendTimer > 0) return;\n\n      try {\n        this.isLoading = true;\n        await fetch(`${this.apiBaseUrl}/users/request-otp/`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n            'X-CSRFToken': this.getCSRFToken()\n          },\n          credentials: 'include',\n          mode: 'cors',\n          body: JSON.stringify({\n            phone: this.phoneNumber,\n            otp_type: 'login'\n          })\n        });\n\n        // Start resend timer and clear OTP fields\n        this.startResendTimer();\n        this.otpDigits = ['', '', '', ''];\n        this.otpError = '';\n        this.$refs.otpInput0[0].focus();\n      } catch (error) {\n        console.error('Error resending OTP:', error);\n        this.otpError = 'Failed to resend OTP. Please try again.';\n      } finally {\n        this.isLoading = false;\n      }\n    },\n\n    handleOtpInput(event, index) {\n      this.clearOtpError(); // Clear error when user starts typing\n      const value = event.target.value;\n      // Only allow numbers\n      if (!/^\\d*$/.test(value)) {\n        event.target.value = '';\n        return;\n      }\n      \n      this.otpDigits[index] = value;\n      \n      // Move to next input if value is entered\n      if (value && index < 3) {\n        this.$refs['otpInput' + (index + 1)][0].focus();\n      }\n\n      // Check if all digits are filled\n      if (this.otpDigits.every(digit => digit !== '')) {\n        // Auto verify after a short delay\n        setTimeout(() => {\n          this.handleLogin();\n        }, 300);\n      }\n    },\n\n    handleKeydown(event, index) {\n      // Handle backspace\n      if (event.key === 'Backspace' && !this.otpDigits[index] && index > 0) {\n        this.$refs['otpInput' + (index - 1)][0].focus();\n      }\n    },\n\n    handlePaste(event) {\n      event.preventDefault();\n      const pastedData = event.clipboardData.getData('text');\n      const numbers = pastedData.match(/\\d/g);\n      \n      if (numbers) {\n        // Clear existing OTP digits\n        this.otpDigits = ['', '', '', ''];\n        \n        // Fill in the pasted numbers\n        numbers.slice(0, 4).forEach((num, index) => {\n          if (index < 4) {\n            this.otpDigits[index] = num;\n            if (this.$refs['otpInput' + index]) {\n              this.$refs['otpInput' + index][0].value = num;\n            }\n          }\n        });\n\n        // Focus on the next empty input or the last input if all filled\n        const emptyIndex = this.otpDigits.findIndex(digit => !digit);\n        const focusIndex = emptyIndex === -1 ? 3 : emptyIndex;\n        this.$refs['otpInput' + focusIndex][0].focus();\n\n        // If all digits are filled, trigger verification\n        if (this.otpDigits.every(digit => digit !== '')) {\n          setTimeout(() => {\n            this.handleLogin();\n          }, 300);\n        }\n      }\n    },\n\n    setupSMSRetrieval() {\n      try {\n        if (!this.smsReceiver && 'OTPCredential' in window) {\n          const ac = new AbortController();\n          navigator.credentials.get({\n            otp: { transport:['sms'] },\n            signal: ac.signal\n          }).then(otp => {\n            if (otp && otp.code) {\n              const otpValue = otp.code;\n              // Fill in OTP digits\n              for (let i = 0; i < Math.min(otpValue.length, 4); i++) {\n                this.otpDigits[i] = otpValue[i];\n                if (this.$refs['otpInput' + i]) {\n                  this.$refs['otpInput' + i][0].value = otpValue[i];\n                }\n              }\n              // Auto verify if complete\n              if (this.otpDigits.every(digit => digit !== '')) {\n                setTimeout(() => this.handleLogin(), 300);\n              }\n            }\n          }).catch(err => {\n            console.log('SMS Retrieval Error:', err);\n          });\n\n          this.smsReceiver = ac;\n        }\n      } catch (error) {\n        console.log('SMS Setup Error:', error);\n      }\n    },\n\n    startOTPDetection() {\n      // Clean up any existing receiver\n      if (this.smsReceiver) {\n        this.smsReceiver.abort();\n        this.smsReceiver = null;\n      }\n\n      // Setup new SMS retrieval\n      this.setupSMSRetrieval();\n\n      // Add format hint for browsers\n      const input = document.getElementById('otp-input');\n      if (input) {\n        input.addEventListener('focus', () => {\n          if ('OTPCredential' in window) {\n            navigator.credentials.get({\n              otp: { transport:['sms'] },\n              signal: this.smsReceiver?.signal\n            }).catch(() => {});\n          }\n        });\n      }\n    },\n\n    startResendTimer() {\n      this.resendTimer = 30;\n      this.timerInterval = setInterval(() => {\n        if (this.resendTimer > 0) {\n          this.resendTimer--;\n        } else {\n          clearInterval(this.timerInterval);\n        }\n      }, 1000);\n    },\n\n    closeCookieNotice() {\n      this.showCookieNotice = false;\n    },\n\n    handleBack() {\n      // Clear OTP related data\n      this.showOTP = false;\n      this.otpDigits = ['', '', '', ''];\n      if (this.timerInterval) {\n        clearInterval(this.timerInterval);\n        this.resendTimer = 0;\n      }\n    },\n\n    beforeDestroy() {\n      // Clean up SMS receiver\n      if (this.smsReceiver) {\n        this.smsReceiver.abort();\n        this.smsReceiver = null;\n      }\n      \n      // Clean up timer\n      if (this.timerInterval) {\n        clearInterval(this.timerInterval);\n      }\n    },\n\n    // Add method to clear OTP error\n    clearOtpError() {\n      this.otpError = '';\n    }\n  },\n  beforeUnmount() {\n    if (this.timerInterval) {\n      clearInterval(this.timerInterval);\n    }\n  },\n  async created() {\n    console.log('Component created - Starting initialization');\n    \n    // Clear any existing data on login page load\n    this.clearLoginPageData();\n    \n    try {\n        // Get phone number and token from query params or localStorage\n        this.phoneNumber = this.$route.query.phone || localStorage.getItem('phone') || '';\n        \n        // Get referral code from URL if present - check both query params and hash params\n          const urlParams = new URLSearchParams(window.location.search);\n          let referralFromUrl = urlParams.get('ref');\n          \n          // If not found, check hash params (after #)\n          if (!referralFromUrl && window.location.hash) {\n            const hashParts = window.location.hash.split('?');\n            if (hashParts.length > 1) {\n              const hashParams = new URLSearchParams(hashParts[1]);\n              referralFromUrl = hashParams.get('ref');\n            }\n          }\n          \n          this.referralCode = referralFromUrl || '';\n          \n          // Store referral code in localStorage if present\n          if (this.referralCode) {\n            localStorage.setItem('referralCode', this.referralCode);\n          }\n        \n        // Try to get token from multiple sources\n        const token = this.$route.query.token || \n                    localStorage.getItem('token') || \n                    localStorage.getItem('csrfToken') ||\n                    (localStorage.getItem('user') && JSON.parse(localStorage.getItem('user')).token);\n        \n        console.log('Initial token:', token);\n\n        // Only show error if we have both phone and token but they're invalid\n        if (this.$route.query.phone && !this.phoneNumber) {\n            console.error('Invalid phone number');\n            this.phoneError = 'Invalid phone number. Please try again.';\n        }\n\n        if (this.$route.query.token && !token) {\n            console.error('Invalid token');\n            this.phoneError = 'Authentication failed. Please try again.';\n        }\n\n        // Store token if not already stored\n        if (token) {\n            localStorage.setItem('token', token);\n        }\n\n        // Get referral code from URL if present - check both query params and hash params\n        let refCode = null;\n        \n        // First check normal query params\n        const queryParams = new URLSearchParams(window.location.search);\n        refCode = queryParams.get('ref');\n        \n        // If not found, check hash params (after #)\n        if (!refCode && window.location.hash) {\n          const hashParts = window.location.hash.split('?');\n          if (hashParts.length > 1) {\n            const hashParams = new URLSearchParams(hashParts[1]);\n            refCode = hashParams.get('ref');\n          }\n        }\n        \n        this.referralCode = refCode || '';\n        \n        // Store referral code in localStorage if present\n        if (this.referralCode) {\n          localStorage.setItem('referralCode', this.referralCode);\n        }\n\n        // Validate phone number if it exists\n        if (this.phoneNumber) {\n            this.validatePhoneNumber();\n        }\n    } catch (error) {\n        console.error('Error in component creation:', error);\n        // Don't show error message for normal initialization\n        if (error.message !== 'Failed to fetch') {\n            console.error('Unexpected error:', error);\n        }\n    }\n  },\n  watch: {\n    // Add watcher for phone number to validate in real-time\n    phoneNumber: {\n      handler(newValue) {\n        if (newValue) {\n          this.validatePhoneNumber();\n        } else {\n          this.phoneError = '';\n        }\n      },\n      immediate: true\n    }\n  },\n  computed: {\n    // Add computed property for input styling\n    phoneInputStyle() {\n      if (this.phoneNumber.length === 10 && !this.phoneError) {\n        return 'border-[#4CAF50] text-[#4CAF50]';\n      } else if (this.phoneError) {\n        return 'border-[#ff4d4d]';\n      }\n      return 'border-white/10';\n    }\n  }\n}\n</script>\n\n<style scoped>\n/* Custom styles */\ninput::-webkit-outer-spin-button,\ninput::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\n/* Firefox */\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n/* Placeholder color */\n::placeholder {\n  color: rgba(255, 255, 255, 0.4);\n}\n\n/* Focus styles */\ninput:focus {\n  outline: none;\n  box-shadow: 0 0 0 2px rgba(195, 0, 89, 0.2);\n}\n\n/* OTP input animations */\ninput {\n  transition: all 0.3s ease;\n}\n\ninput:focus {\n  transform: scale(1.05);\n}\n\n/* Checkbox custom styles */\ninput[type=\"checkbox\"] {\n  @apply rounded border-white/30 bg-transparent;\n}\n\ninput[type=\"checkbox\"]:checked {\n  background-image: url(\"data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e\");\n}\n\n/* Shake animation for terms error */\n@keyframes shake {\n  0%, 100% { transform: translateX(0); }\n  10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }\n  20%, 40%, 60%, 80% { transform: translateX(2px); }\n}\n\n.shake-animation {\n  animation: shake 0.65s cubic-bezier(.36,.07,.19,.97) both;\n}\n\n/* Terms box hover effect */\n.bg-[#1d1d1d]:hover {\n  @apply border-white/20 transition-all duration-300;\n}\n\n/* Fade transition for error messages */\n.fade-enter-active, .fade-leave-active {\n  transition: opacity 0.3s ease;\n}\n.fade-enter-from, .fade-leave-to {\n  opacity: 0;\n}\n\n/* Input error state */\ninput.shake-animation {\n  animation: shake 0.65s cubic-bezier(.36,.07,.19,.97) both;\n}\n\n/* Loading spinner styles */\n.loading-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.7);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n}\n\n.spinner {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(255, 255, 255, 0.3);\n  border-radius: 50%;\n  border-top-color: #c30059;\n  animation: spin 1s ease-in-out infinite;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}