{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport axios from 'axios';\nexport default {\n  name: 'ProfileUpdate',\n  data() {\n    return {\n      formData: {\n        first_name: '',\n        last_name: '',\n        email: '',\n        phone: '',\n        gender: '',\n        date_of_birth: '',\n        profile_picture: null,\n        address: '',\n        state: '',\n        district: '',\n        constituency: '',\n        mandal: '',\n        village: '',\n        pincode: '',\n        referral_code: ''\n      },\n      baseUrl: 'http://192.168.0.128:8001/',\n      loading: false,\n      success: false,\n      error: null,\n      isValidatingReferral: false,\n      referralError: null,\n      referralSuccess: false,\n      hasReferralCode: false,\n      states: [],\n      districts: [],\n      constituencies: [],\n      mandals: [],\n      villages: [],\n      isLoadingStates: false,\n      isLoadingDistricts: false,\n      isLoadingConstituencies: false,\n      years: Array.from({\n        length: new Date().getFullYear() - 1940 + 1\n      }, (_, i) => new Date().getFullYear() - i)\n    };\n  },\n  computed: {\n    getInitials() {\n      const firstName = this.formData.first_name || '';\n      const lastName = this.formData.last_name || '';\n      return `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase();\n    }\n  },\n  methods: {\n    handleFileUpload(event) {\n      const file = event.target.files[0];\n      if (file) {\n        this.formData.profile_picture = file;\n      }\n    },\n    handleReferralInput() {\n      // Convert to uppercase\n      this.formData.referral_code = this.formData.referral_code.toUpperCase();\n      // Clear messages\n      this.referralError = null;\n      this.referralSuccess = false;\n    },\n    async verifyReferralCode() {\n      if (!this.formData.referral_code) return;\n      this.isValidatingReferral = true;\n      this.referralError = null;\n      this.referralSuccess = false;\n      try {\n        const response = await axios.get(`${this.baseUrl}/users/verify-referral/`, {\n          params: {\n            code: this.formData.referral_code\n          },\n          headers: {\n            'Accept': 'application/json'\n          }\n        });\n        if (response.data.status === 'success') {\n          this.referralSuccess = true;\n          this.referralError = null;\n        } else {\n          this.referralError = 'Invalid referral code';\n          this.referralSuccess = false;\n        }\n      } catch (error) {\n        console.error('Error verifying referral code:', error);\n        this.referralError = 'Error verifying referral code';\n        this.referralSuccess = false;\n      } finally {\n        this.isValidatingReferral = false;\n      }\n    },\n    async updateProfile() {\n      // Referral code verification logic updated\n      if (this.formData.referral_code && !this.referralSuccess && !this.hasReferralCode) {\n        this.error = 'Please verify the referral code first';\n        return;\n      }\n      this.loading = true;\n      this.success = false;\n      this.error = null;\n      try {\n        // Get phone from localStorage\n        const phone = localStorage.getItem('phone');\n        if (!phone) {\n          throw new Error('Please login again');\n        }\n\n        // Validate email format only if email is provided\n        if (this.formData.email) {\n          const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n          if (!emailRegex.test(this.formData.email)) {\n            throw new Error('Please enter a valid email address');\n          }\n        }\n\n        // Create FormData object\n        const formData = new FormData();\n\n        // Add phone number\n        formData.append('phone', phone);\n\n        // Append all form fields to FormData\n        Object.keys(this.formData).forEach(key => {\n          let value = this.formData[key];\n          if (key === 'referral_code' && this.hasReferralCode) {\n            // already referred, don't send referral_code\n            return;\n          }\n          if (key === 'date_of_birth' && value && value.toString().length === 4) {\n            // Convert year to YYYY-01-01 for backend\n            value = `${value}-01-01`;\n          }\n          // profile_picture: append only if it's a File object\n          if (key === 'profile_picture') {\n            if (value && typeof value !== 'string') {\n              formData.append(key, value);\n            }\n            return;\n          }\n          // Skip phone as it's already added\n          if (key !== 'phone' && value !== null && value !== '') {\n            formData.append(key, value);\n          }\n        });\n\n        // Make the API call\n        const response = await axios.post(`${this.baseUrl}/users/update-profile/`, formData, {\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        if (response.data.status === 'success') {\n          this.success = true;\n          // Show success message\n          this.error = null;\n\n          // Wait for 2 seconds before redirecting\n          setTimeout(() => {\n            this.$router.push('/profile');\n          }, 2000);\n        } else {\n          throw new Error(response.data.message || 'Failed to update profile');\n        }\n      } catch (error) {\n        console.error('Error updating profile:', error);\n        this.error = error.response?.data?.message || error.message || 'Failed to update profile. Please try again.';\n        if (error.response?.status === 403) {\n          setTimeout(() => {\n            localStorage.removeItem('phone');\n            this.$router.push('/login');\n          }, 2000);\n        }\n      } finally {\n        this.loading = false;\n      }\n    },\n    async loadUserProfile() {\n      try {\n        const phone = localStorage.getItem('phone');\n        if (!phone) {\n          this.$router.push('/login');\n          return;\n        }\n\n        // Get profile data\n        const response = await axios.get(`${this.baseUrl}/users/profile/`, {\n          params: {\n            phone\n          },\n          headers: {\n            'Accept': 'application/json'\n          }\n        });\n        console.log('Profile Response:', response.data); // Debug log\n\n        if (response.data && response.data.status === 'success' && response.data.user) {\n          const userData = response.data.user;\n          // Update form data with user profile\n          this.formData = {\n            first_name: userData.first_name || '',\n            last_name: userData.last_name || '',\n            email: userData.email || '',\n            phone: phone,\n            gender: userData.gender || '',\n            date_of_birth: userData.date_of_birth ? userData.date_of_birth.substring(0, 4) : '',\n            profile_picture: userData.profile_picture || null,\n            address: userData.address || '',\n            state: userData.state || '',\n            district: userData.district || '',\n            constituency: userData.constituency || '',\n            mandal: userData.mandal || '',\n            village: userData.village || '',\n            pincode: userData.pincode || '',\n            referral_code: userData.referral_code || ''\n          };\n\n          // Check for referral code\n          if (response.data.referral_relationships && response.data.referral_relationships.referred_by && response.data.referral_relationships.referred_by.length > 0) {\n            const referredBy = response.data.referral_relationships.referred_by[0];\n            this.formData.referral_code = referredBy.referral_code_used || '';\n            this.hasReferralCode = true;\n          }\n\n          // Load location data if available\n          if (this.formData.state) {\n            await this.fetchDistricts(this.formData.state);\n          }\n          if (this.formData.district) {\n            await this.fetchConstituencies(this.formData.district);\n          }\n          if (this.formData.constituency) {\n            await this.fetchMandals(this.formData.constituency);\n          }\n        }\n      } catch (error) {\n        console.error('Error loading profile:', error);\n        if (error.response?.status === 403) {\n          this.error = 'Session expired. Please login again.';\n          setTimeout(() => {\n            localStorage.removeItem('phone');\n            this.$router.push('/login');\n          }, 2000);\n        } else {\n          this.error = error.response?.data?.message || 'Failed to load profile data. Please try again.';\n        }\n      }\n    },\n    async fetchStates() {\n      this.isLoadingStates = true;\n      try {\n        const response = await axios.get(`${this.baseUrl}/api/states/`);\n        this.states = response.data.map(state => ({\n          value: state.id,\n          label: state.name\n        }));\n      } catch (error) {\n        this.error = 'Failed to load states. Please try again.';\n      } finally {\n        this.isLoadingStates = false;\n      }\n    },\n    async fetchDistricts(stateId) {\n      this.isLoadingDistricts = true;\n      if (!stateId) {\n        this.districts = [];\n        this.formData.district = '';\n        this.isLoadingDistricts = false;\n        return;\n      }\n      try {\n        const response = await axios.get(`${this.baseUrl}/api/frontend/districts/?state_id=${stateId}`);\n        if (response.data.status === 'success') {\n          this.districts = response.data.data.map(district => ({\n            value: district.id,\n            label: district.name\n          }));\n        } else {\n          this.districts = [];\n          this.error = 'Failed to load districts. Please try again.';\n        }\n      } catch (error) {\n        this.error = 'Failed to load districts. Please try again.';\n      } finally {\n        this.isLoadingDistricts = false;\n      }\n    },\n    async fetchConstituencies(districtId) {\n      this.isLoadingConstituencies = true;\n      if (!districtId) {\n        this.constituencies = [];\n        this.formData.constituency = '';\n        this.isLoadingConstituencies = false;\n        return;\n      }\n      try {\n        const response = await axios.get(`${this.baseUrl}/api/frontend/constituencies/?district_id=${districtId}`);\n        if (response.data.status === 'success') {\n          this.constituencies = response.data.data.map(constituency => ({\n            value: constituency.id,\n            label: constituency.name\n          }));\n        } else {\n          this.constituencies = [];\n          this.error = 'Failed to load constituencies. Please try again.';\n        }\n      } catch (error) {\n        this.error = 'Failed to load constituencies. Please try again.';\n      } finally {\n        this.isLoadingConstituencies = false;\n      }\n    },\n    async fetchMandals(constituencyId) {\n      if (!constituencyId) {\n        this.mandals = [];\n        this.formData.mandal = '';\n        return;\n      }\n      try {\n        const response = await axios.get(`${this.baseUrl}/api/mandals/?constituency=${constituencyId}`);\n        this.mandals = response.data.map(mandal => ({\n          value: mandal.id,\n          label: mandal.name\n        }));\n        // Removed self-assignment\n      } catch (error) {\n        console.error('Error fetching mandals:', error);\n        this.error = 'Failed to load mandals. Please try again.';\n      }\n    },\n    handleStateChange() {\n      this.formData.district = '';\n      this.formData.constituency = '';\n      this.formData.mandal = '';\n      this.formData.village = '';\n      this.fetchDistricts(this.formData.state);\n    },\n    handleDistrictChange() {\n      this.formData.constituency = '';\n      this.formData.mandal = '';\n      this.formData.village = '';\n      this.fetchConstituencies(this.formData.district);\n    },\n    handleConstituencyChange() {\n      this.formData.mandal = '';\n      this.formData.village = '';\n      this.fetchMandals(this.formData.constituency);\n    },\n    handleMandalChange() {\n      // No specific action needed here, just update the mandal\n    },\n    handleVillageChange() {\n      // No specific action needed here, just update the village\n    }\n  },\n  async created() {\n    await this.loadUserProfile();\n    await this.fetchStates();\n    if (this.formData.state) {\n      await this.fetchDistricts(this.formData.state);\n    }\n    if (this.formData.district) {\n      await this.fetchConstituencies(this.formData.district);\n    }\n    if (this.formData.constituency) {\n      await this.fetchMandals(this.formData.constituency);\n    }\n    if (this.formData.mandal) {\n      // Removed fetchVillages\n    }\n  }\n};","map":{"version":3,"names":["axios","name","data","formData","first_name","last_name","email","phone","gender","date_of_birth","profile_picture","address","state","district","constituency","mandal","village","pincode","referral_code","baseUrl","loading","success","error","isValidatingReferral","referralError","referralSuccess","hasReferralCode","states","districts","constituencies","mandals","villages","isLoadingStates","isLoadingDistricts","isLoadingConstituencies","years","Array","from","length","Date","getFullYear","_","i","computed","getInitials","firstName","lastName","charAt","toUpperCase","methods","handleFileUpload","event","file","target","files","handleReferralInput","verifyReferralCode","response","get","params","code","headers","status","console","updateProfile","localStorage","getItem","Error","emailRegex","test","FormData","append","Object","keys","forEach","key","value","toString","post","setTimeout","$router","push","message","removeItem","loadUserProfile","log","user","userData","substring","referral_relationships","referred_by","referredBy","referral_code_used","fetchDistricts","fetchConstituencies","fetchMandals","fetchStates","map","id","label","stateId","districtId","constituencyId","handleStateChange","handleDistrictChange","handleConstituencyChange","handleMandalChange","handleVillageChange","created"],"sources":["D:\\OTT\\ott_frontend\\src\\components\\ProfileUpdate.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-[#121212] text-white relative\">\n    <!-- Back Button -->\n    <button \n      @click=\"$router.push('/profile')\"\n      class=\"fixed top-4 left-4 z-10 text-white/70 hover:text-white bg-[#1a1a1a] p-2 rounded-full shadow-lg\"\n    >\n      <i class=\"fas fa-arrow-left text-xl\"></i>\n    </button>\n\n    <div class=\"max-w-4xl mx-auto p-4 md:p-6 pb-32 md:pb-12 mb-safe\">\n      <!-- Header Section -->\n      <div class=\"flex flex-col md:flex-row md:items-center justify-between mb-8 pt-16 md:pt-8\">\n        <div class=\"text-center md:text-left mb-6 md:mb-0\">\n          <h2 class=\"text-2xl md:text-3xl font-bold bg-gradient-to-r from-[#c30059] to-[#ff4d4d] bg-clip-text text-transparent\">\n            Profile Settings\n          </h2>\n          <p class=\"text-gray-400 mt-2 text-sm md:text-base\">Manage your account information</p>\n        </div>\n        <div class=\"relative mx-auto md:mx-0\">\n          <div class=\"w-28 h-28 md:w-24 md:h-24 rounded-full overflow-hidden border-4 border-[#c30059] shadow-lg\">\n            <img \n              v-if=\"formData.profile_picture\"\n              :src=\"formData.profile_picture\" \n              alt=\"Profile Picture\"\n              class=\"w-full h-full object-cover\"\n            />\n            <div \n              v-else \n              class=\"w-full h-full flex items-center justify-center bg-gradient-to-br from-[#c30059] to-[#ff4d4d] text-white text-4xl md:text-3xl font-bold\"\n            >\n              {{ getInitials }}\n            </div>\n          </div>\n          <label class=\"absolute bottom-0 right-0 bg-[#c30059] p-3 rounded-full cursor-pointer hover:bg-[#ff4d4d] transition-colors shadow-lg\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n              <path d=\"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z\" />\n            </svg>\n            <input type=\"file\" @change=\"handleFileUpload\" accept=\"image/*\" class=\"hidden\" />\n          </label>\n        </div>\n      </div>\n\n      <!-- Main Content -->\n      <div class=\"bg-[#1a1a1a] rounded-xl shadow-2xl p-4 md:p-6 backdrop-blur-lg bg-opacity-50\">\n        <form @submit.prevent=\"updateProfile\" class=\"space-y-6 md:space-y-8\">\n          <!-- Personal Information Section -->\n          <div class=\"space-y-4 md:space-y-6\">\n            <h3 class=\"text-lg md:text-xl font-semibold text-[#c30059] border-b border-[#c30059] pb-2\">\n              Personal Information\n            </h3>\n            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6\">\n              <div class=\"space-y-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">First Name</label>\n                <input\n                  v-model=\"formData.first_name\"\n                  type=\"text\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  placeholder=\"Enter your first name\"\n                  required\n                />\n              </div>\n              \n              <div class=\"space-y-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">Last Name</label>\n                <input\n                  v-model=\"formData.last_name\"\n                  type=\"text\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  placeholder=\"Enter your last name\"\n                  required\n                />\n              </div>\n              \n              <div class=\"space-y-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">Email <span class=\"text-gray-500\">(Optional)</span></label>\n                <input\n                  v-model=\"formData.email\"\n                  type=\"email\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  placeholder=\"Enter your email (optional)\"\n                />\n              </div>\n              \n              <div class=\"space-y-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">Phone</label>\n                <input\n                  v-model=\"formData.phone\"\n                  type=\"tel\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  placeholder=\"Enter your phone number\"\n                  required\n                  readonly\n                />\n              </div>\n\n              <div class=\"space-y-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">Gender</label>\n                <select\n                  v-model=\"formData.gender\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                >\n                  <option value=\"\" class=\"bg-[#2a2a2a]\">Select Gender</option>\n                  <option value=\"M\" class=\"bg-[#2a2a2a]\">Male</option>\n                  <option value=\"F\" class=\"bg-[#2a2a2a]\">Female</option>\n                  <option value=\"O\" class=\"bg-[#2a2a2a]\">Other</option>\n                </select>\n              </div>\n              \n              <div class=\"space-y-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">Year of Birth</label>\n                <select\n                  v-model=\"formData.date_of_birth\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                >\n                  <option value=\"\">Select Year</option>\n                  <option v-for=\"y in years\" :key=\"y\" :value=\"y\">{{ y }}</option>\n                </select>\n              </div>\n\n              <!-- Referral Code Section - Always show -->\n              <div class=\"space-y-2 md:col-span-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">\n                  Referral Phone Number <span class=\"text-gray-500\">(Optional)</span>\n                </label>\n                <div class=\"flex gap-4\">\n                  <div class=\"relative flex-1\">\n                    <input\n                      v-model=\"formData.referral_code\"\n                      type=\"text\"\n                      class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white uppercase\"\n                      placeholder=\"Enter referral Phone Number\"\n                      @input=\"handleReferralInput\"\n                      :readonly=\"hasReferralCode\"\n                      :disabled=\"hasReferralCode\"\n                    />\n                    <div v-if=\"isValidatingReferral\" class=\"absolute right-3 top-1/2 -translate-y-1/2\">\n                      <div class=\"animate-spin rounded-full h-5 w-5 border-2 border-white/20 border-t-[#c30059]\"></div>\n                    </div>\n                  </div>\n                  <button\n                    v-if=\"!hasReferralCode\"\n                    type=\"button\"\n                    @click=\"verifyReferralCode\"\n                    :disabled=\"!formData.referral_code || isValidatingReferral\"\n                    class=\"px-6 py-2 rounded-lg bg-[#c30059] text-white hover:bg-[#ff4d4d] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n                  >\n                    <span>Verify</span>\n                  </button>\n                </div>\n                <p v-if=\"referralError\" class=\"text-[#ff4d4d] text-sm mt-1\">{{ referralError }}</p>\n                <p v-if=\"referralSuccess\" class=\"text-green-500 text-sm mt-1 flex items-center gap-2\">\n                  <i class=\"fas fa-check-circle\"></i>\n                  Valid referral code\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <!-- Location Details Section -->\n          <div class=\"space-y-4 md:space-y-6\">\n            <h3 class=\"text-lg md:text-xl font-semibold text-[#c30059] border-b border-[#c30059] pb-2\">\n              Location Details\n            </h3>\n            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6\">\n\n              <div class=\"space-y-2 relative\">\n                <label class=\"block text-sm font-medium text-gray-300\">State</label>\n                <select\n                  v-model=\"formData.state\"\n                  @change=\"handleStateChange\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  :disabled=\"isLoadingStates\"\n                  required\n                >\n                  <option value=\"\">{{ isLoadingStates ? 'Loading states...' : 'Select State' }}</option>\n                  <option v-for=\"state in states\" :key=\"state.value\" :value=\"state.value\">\n                    {{ state.label }}\n                  </option>\n                </select>\n                <div v-if=\"isLoadingStates\" class=\"absolute right-4 top-1/2 -translate-y-1/2\">\n                  <div class=\"animate-spin rounded-full h-5 w-5 border-2 border-white/20 border-t-[#c30059]\"></div>\n                </div>\n              </div>\n\n              <div class=\"space-y-2 relative\">\n                <label class=\"block text-sm font-medium text-gray-300\">District</label>\n                <select\n                  v-model=\"formData.district\"\n                  @change=\"handleDistrictChange\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  :disabled=\"!formData.state || isLoadingDistricts\"\n                  required\n                >\n                  <option value=\"\">{{ isLoadingDistricts ? 'Loading districts...' : 'Select District' }}</option>\n                  <option v-for=\"district in districts\" :key=\"district.value\" :value=\"district.value\">\n                    {{ district.label }}\n                  </option>\n                </select>\n                <div v-if=\"isLoadingDistricts\" class=\"absolute right-4 top-1/2 -translate-y-1/2\">\n                  <div class=\"animate-spin rounded-full h-5 w-5 border-2 border-white/20 border-t-[#c30059]\"></div>\n                </div>\n              </div>\n\n              <div class=\"space-y-2 relative\">\n                <label class=\"block text-sm font-medium text-gray-300\">Constituency</label>\n                <select\n                  v-model=\"formData.constituency\"\n                  @change=\"handleConstituencyChange\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  :disabled=\"!formData.district || isLoadingConstituencies\"\n                  required\n                >\n                  <option value=\"\">{{ isLoadingConstituencies ? 'Loading constituencies...' : 'Select Constituency' }}</option>\n                  <option v-for=\"constituency in constituencies\" :key=\"constituency.value\" :value=\"constituency.value\">\n                    {{ constituency.label }}\n                  </option>\n                </select>\n                <div v-if=\"isLoadingConstituencies\" class=\"absolute right-4 top-1/2 -translate-y-1/2\">\n                  <div class=\"animate-spin rounded-full h-5 w-5 border-2 border-white/20 border-t-[#c30059]\"></div>\n                </div>\n              </div>\n\n              <div class=\"space-y-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">Mandal</label>\n                <input\n                  v-model=\"formData.mandal\"\n                  type=\"text\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  placeholder=\"Enter your mandal (optional)\"\n                />\n              </div>\n\n              <div class=\"space-y-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">Village</label>\n                <input\n                  v-model=\"formData.village\"\n                  type=\"text\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  placeholder=\"Enter your village (optional)\"\n                />\n              </div>\n\n              <div class=\"space-y-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">Pincode</label>\n                <input\n                  v-model=\"formData.pincode\"\n                  type=\"text\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  placeholder=\"Enter your pincode (optional)\"\n                  maxlength=\"6\"\n                />\n              </div>\n\n              <div class=\"space-y-2 md:col-span-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">Complete Address</label>\n                <textarea\n                  v-model=\"formData.address\"\n                  class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white\"\n                  placeholder=\"Enter your complete address\"\n                  rows=\"2\"\n                ></textarea>\n              </div>\n              \n            </div>\n          </div>\n\n          <!-- Add extra padding at bottom for mobile -->\n          <div class=\"h-3 md:h-0\"></div>\n\n          <!-- Action Buttons -->\n          <div class=\"fixed bottom-0 left-0 right-0 p-4 bg-[#121212]/95 backdrop-blur-md border-t border-white/10 flex justify-end space-x-4 md:relative md:bg-transparent md:border-0 md:p-0 md:mt-6 z-50\">\n            <button\n              type=\"button\"\n              @click=\"$router.push('/profile')\"\n              class=\"flex-1 md:flex-none px-6 py-3 md:py-2 rounded-lg bg-[#2a2a2a] text-white hover:bg-[#3a3a3a] transition-colors text-sm md:text-base\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              class=\"flex-1 md:flex-none px-6 py-3 md:py-2 rounded-lg bg-gradient-to-r from-[#c30059] to-[#ff4d4d] text-white hover:from-[#d40063] hover:to-[#ff5c5c] transition-colors flex items-center justify-center space-x-2 text-sm md:text-base\"\n              :disabled=\"loading\"\n            >\n              <span>{{ loading ? 'Updating...' : 'Submit' }}</span>\n              <svg v-if=\"!loading\" xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 md:h-5 md:w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" />\n              </svg>\n            </button>\n          </div>\n        </form>\n      </div>\n\n      <!-- Success Message -->\n      <div v-if=\"success\" class=\"fixed bottom-[88px] md:bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-md bg-[#c30059] text-white px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 ease-in-out\">\n        <div class=\"flex items-center space-x-2\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 md:h-6 md:w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n          </svg>\n          <span class=\"text-sm md:text-base\">Profile updated successfully!</span>\n        </div>\n      </div>\n\n      <!-- Error Message -->\n      <div v-if=\"error\" class=\"fixed bottom-[88px] md:bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-md bg-[#ff4d4d] text-white px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 ease-in-out\">\n        <div class=\"flex items-center space-x-2\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 md:h-6 md:w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n          </svg>\n          <span class=\"text-sm md:text-base\">{{ error }}</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\n\nexport default {\n  name: 'ProfileUpdate',\n  data() {\n    return {\n      formData: {\n        first_name: '',\n        last_name: '',\n        email: '',\n        phone: '',\n        gender: '',\n        date_of_birth: '',\n        profile_picture: null,\n        address: '',\n        state: '',\n        district: '',\n        constituency: '',\n        mandal: '',\n        village: '',\n        pincode: '',\n        referral_code: ''\n      },\n      baseUrl: 'http://192.168.0.128:8001/',\n      loading: false,\n      success: false,\n      error: null,\n      isValidatingReferral: false,\n      referralError: null,\n      referralSuccess: false,\n      hasReferralCode: false,\n      states: [],\n      districts: [],\n      constituencies: [],\n      mandals: [],\n      villages: [],\n      isLoadingStates: false,\n      isLoadingDistricts: false,\n      isLoadingConstituencies: false,\n      years: Array.from({length: (new Date().getFullYear() - 1940 + 1)}, (_, i) => new Date().getFullYear() - i),\n    };\n  },\n  computed: {\n    getInitials() {\n      const firstName = this.formData.first_name || '';\n      const lastName = this.formData.last_name || '';\n      return `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase();\n    }\n  },\n  methods: {\n    handleFileUpload(event) {\n      const file = event.target.files[0];\n      if (file) {\n        this.formData.profile_picture = file;\n      }\n    },\n    handleReferralInput() {\n      // Convert to uppercase\n      this.formData.referral_code = this.formData.referral_code.toUpperCase();\n      // Clear messages\n      this.referralError = null;\n      this.referralSuccess = false;\n    },\n    async verifyReferralCode() {\n      if (!this.formData.referral_code) return;\n      \n      this.isValidatingReferral = true;\n      this.referralError = null;\n      this.referralSuccess = false;\n\n      try {\n        const response = await axios.get(`${this.baseUrl}/users/verify-referral/`, {\n          params: {\n            code: this.formData.referral_code\n          },\n          headers: {\n            'Accept': 'application/json'\n          }\n        });\n        \n        if (response.data.status === 'success') {\n          this.referralSuccess = true;\n          this.referralError = null;\n        } else {\n          this.referralError = 'Invalid referral code';\n          this.referralSuccess = false;\n        }\n      } catch (error) {\n        console.error('Error verifying referral code:', error);\n        this.referralError = 'Error verifying referral code';\n        this.referralSuccess = false;\n      } finally {\n        this.isValidatingReferral = false;\n      }\n    },\n    async updateProfile() {\n      // Referral code verification logic updated\n      if (this.formData.referral_code && !this.referralSuccess && !this.hasReferralCode) {\n        this.error = 'Please verify the referral code first';\n        return;\n      }\n\n      this.loading = true;\n      this.success = false;\n      this.error = null;\n\n      try {\n        // Get phone from localStorage\n        const phone = localStorage.getItem('phone');\n        if (!phone) {\n          throw new Error('Please login again');\n        }\n\n        // Validate email format only if email is provided\n        if (this.formData.email) {\n          const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n          if (!emailRegex.test(this.formData.email)) {\n            throw new Error('Please enter a valid email address');\n          }\n        }\n\n        // Create FormData object\n        const formData = new FormData();\n        \n        // Add phone number\n        formData.append('phone', phone);\n        \n        // Append all form fields to FormData\n        Object.keys(this.formData).forEach(key => {\n          let value = this.formData[key];\n          if (key === 'referral_code' && this.hasReferralCode) {\n            // already referred, don't send referral_code\n            return;\n          }\n          if (key === 'date_of_birth' && value && value.toString().length === 4) {\n            // Convert year to YYYY-01-01 for backend\n            value = `${value}-01-01`;\n          }\n          // profile_picture: append only if it's a File object\n          if (key === 'profile_picture') {\n            if (value && typeof value !== 'string') {\n              formData.append(key, value);\n            }\n            return;\n          }\n          // Skip phone as it's already added\n          if (key !== 'phone' && value !== null && value !== '') {\n            formData.append(key, value);\n          }\n        });\n\n        // Make the API call\n        const response = await axios.post(\n          `${this.baseUrl}/users/update-profile/`,\n          formData,\n          {\n            headers: {\n              'Accept': 'application/json',\n              'Content-Type': 'multipart/form-data'\n            }\n          }\n        );\n\n        if (response.data.status === 'success') {\n          this.success = true;\n          // Show success message\n          this.error = null;\n          \n          // Wait for 2 seconds before redirecting\n          setTimeout(() => {\n            this.$router.push('/profile');\n          }, 2000);\n        } else {\n          throw new Error(response.data.message || 'Failed to update profile');\n        }\n      } catch (error) {\n        console.error('Error updating profile:', error);\n        this.error = error.response?.data?.message || error.message || 'Failed to update profile. Please try again.';\n        \n        if (error.response?.status === 403) {\n          setTimeout(() => {\n            localStorage.removeItem('phone');\n            this.$router.push('/login');\n          }, 2000);\n        }\n      } finally {\n        this.loading = false;\n      }\n    },\n    async loadUserProfile() {\n      try {\n        const phone = localStorage.getItem('phone');\n        if (!phone) {\n          this.$router.push('/login');\n          return;\n        }\n\n        // Get profile data\n        const response = await axios.get(`${this.baseUrl}/users/profile/`, {\n          params: { phone },\n          headers: {\n            'Accept': 'application/json'\n          }\n        });\n\n        console.log('Profile Response:', response.data); // Debug log\n        \n        if (response.data && response.data.status === 'success' && response.data.user) {\n          const userData = response.data.user;\n          // Update form data with user profile\n          this.formData = {\n            first_name: userData.first_name || '',\n            last_name: userData.last_name || '',\n            email: userData.email || '',\n            phone: phone,\n            gender: userData.gender || '',\n            date_of_birth: userData.date_of_birth ? userData.date_of_birth.substring(0, 4) : '',\n            profile_picture: userData.profile_picture || null,\n            address: userData.address || '',\n            state: userData.state || '',\n            district: userData.district || '',\n            constituency: userData.constituency || '',\n            mandal: userData.mandal || '',\n            village: userData.village || '',\n            pincode: userData.pincode || '',\n            referral_code: userData.referral_code || ''\n          };\n\n          // Check for referral code\n          if (response.data.referral_relationships && \n              response.data.referral_relationships.referred_by && \n              response.data.referral_relationships.referred_by.length > 0) {\n            const referredBy = response.data.referral_relationships.referred_by[0];\n            this.formData.referral_code = referredBy.referral_code_used || '';\n            this.hasReferralCode = true;\n          }\n\n          // Load location data if available\n          if (this.formData.state) {\n            await this.fetchDistricts(this.formData.state);\n          }\n          if (this.formData.district) {\n            await this.fetchConstituencies(this.formData.district);\n          }\n          if (this.formData.constituency) {\n            await this.fetchMandals(this.formData.constituency);\n          }\n        }\n      } catch (error) {\n        console.error('Error loading profile:', error);\n        if (error.response?.status === 403) {\n          this.error = 'Session expired. Please login again.';\n          setTimeout(() => {\n            localStorage.removeItem('phone');\n            this.$router.push('/login');\n          }, 2000);\n        } else {\n          this.error = error.response?.data?.message || 'Failed to load profile data. Please try again.';\n        }\n      }\n    },\n    async fetchStates() {\n      this.isLoadingStates = true;\n      try {\n        const response = await axios.get(`${this.baseUrl}/api/states/`);\n        this.states = response.data.map(state => ({ value: state.id, label: state.name }));\n      } catch (error) {\n        this.error = 'Failed to load states. Please try again.';\n      } finally {\n        this.isLoadingStates = false;\n      }\n    },\n    async fetchDistricts(stateId) {\n      this.isLoadingDistricts = true;\n      if (!stateId) {\n        this.districts = [];\n        this.formData.district = '';\n        this.isLoadingDistricts = false;\n        return;\n      }\n      try {\n        const response = await axios.get(`${this.baseUrl}/api/frontend/districts/?state_id=${stateId}`);\n        if (response.data.status === 'success') {\n          this.districts = response.data.data.map(district => ({\n            value: district.id,\n            label: district.name\n          }));\n        } else {\n          this.districts = [];\n          this.error = 'Failed to load districts. Please try again.';\n        }\n      } catch (error) {\n        this.error = 'Failed to load districts. Please try again.';\n      } finally {\n        this.isLoadingDistricts = false;\n      }\n    },\n    async fetchConstituencies(districtId) {\n      this.isLoadingConstituencies = true;\n      if (!districtId) {\n        this.constituencies = [];\n        this.formData.constituency = '';\n        this.isLoadingConstituencies = false;\n        return;\n      }\n      try {\n        const response = await axios.get(`${this.baseUrl}/api/frontend/constituencies/?district_id=${districtId}`);\n        if (response.data.status === 'success') {\n          this.constituencies = response.data.data.map(constituency => ({\n            value: constituency.id,\n            label: constituency.name\n          }));\n        } else {\n          this.constituencies = [];\n          this.error = 'Failed to load constituencies. Please try again.';\n        }\n      } catch (error) {\n        this.error = 'Failed to load constituencies. Please try again.';\n      } finally {\n        this.isLoadingConstituencies = false;\n      }\n    },\n    async fetchMandals(constituencyId) {\n      if (!constituencyId) {\n        this.mandals = [];\n        this.formData.mandal = '';\n        return;\n      }\n      try {\n        const response = await axios.get(`${this.baseUrl}/api/mandals/?constituency=${constituencyId}`);\n        this.mandals = response.data.map(mandal => ({ value: mandal.id, label: mandal.name }));\n        // Removed self-assignment\n      } catch (error) {\n        console.error('Error fetching mandals:', error);\n        this.error = 'Failed to load mandals. Please try again.';\n      }\n    },\n    handleStateChange() {\n      this.formData.district = '';\n      this.formData.constituency = '';\n      this.formData.mandal = '';\n      this.formData.village = '';\n      this.fetchDistricts(this.formData.state);\n    },\n    handleDistrictChange() {\n      this.formData.constituency = '';\n      this.formData.mandal = '';\n      this.formData.village = '';\n      this.fetchConstituencies(this.formData.district);\n    },\n    handleConstituencyChange() {\n      this.formData.mandal = '';\n      this.formData.village = '';\n      this.fetchMandals(this.formData.constituency);\n    },\n    handleMandalChange() {\n      // No specific action needed here, just update the mandal\n    },\n    handleVillageChange() {\n      // No specific action needed here, just update the village\n    }\n  },\n  async created() {\n    await this.loadUserProfile();\n    await this.fetchStates();\n    if (this.formData.state) {\n      await this.fetchDistricts(this.formData.state);\n    }\n    if (this.formData.district) {\n      await this.fetchConstituencies(this.formData.district);\n    }\n    if (this.formData.constituency) {\n      await this.fetchMandals(this.formData.constituency);\n    }\n    if (this.formData.mandal) {\n      // Removed fetchVillages\n    }\n  }\n};\n</script>\n\n<style scoped>\n/* Add smooth transitions */\n.transition-all {\n  transition-property: all;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 150ms;\n}\n\n/* Custom scrollbar */\n::-webkit-scrollbar {\n  width: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: #1a1a1a;\n}\n\n::-webkit-scrollbar-thumb {\n  background: #c30059;\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: #ff4d4d;\n}\n\n/* Input focus styles */\ninput:focus, select:focus, textarea:focus {\n  outline: none;\n  box-shadow: 0 0 0 3px rgba(195, 0, 89, 0.3);\n}\n\n/* Button hover effects */\nbutton {\n  transition: transform 0.2s;\n}\n\nbutton:hover {\n  transform: translateY(-1px);\n}\n\nbutton:active {\n  transform: translateY(0);\n}\n\n/* Add safe area margin for mobile devices */\n.mb-safe {\n  margin-bottom: env(safe-area-inset-bottom, 0px);\n}\n\n/* Adjust bottom padding for mobile */\n@media (max-width: 768px) {\n  input, select, textarea {\n    font-size: 16px; /* Prevent zoom on iOS */\n  }\n\n  .pb-32 {\n    padding-bottom: calc(6rem + env(safe-area-inset-bottom, 0px));\n  }\n\n  /* Improve touch targets */\n  button {\n    min-height: 44px;\n  }\n\n  /* Add smooth bottom padding for fixed elements */\n  .mb-safe {\n    margin-bottom: calc(env(safe-area-inset-bottom, 0px) + 60px);\n  }\n\n  /* Improve form field spacing */\n  .space-y-4 > * {\n    margin-top: 0.75rem;\n    margin-bottom: 0.75rem;\n  }\n\n  /* Make inputs more touch-friendly */\n  input, select, textarea {\n    padding: 0.75rem 1rem;\n  }\n\n  /* Ensure content doesn't get hidden behind fixed buttons */\n  .space-y-6 {\n    margin-bottom: 60px;\n  }\n\n  /* Adjust textarea height */\n  textarea {\n    max-height: 60px;\n    resize: none;\n  }\n\n  /* Ensure fixed elements stay on top */\n  .fixed {\n    z-index: 50;\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}