{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport { useStore } from 'vuex';\nimport { ref, computed, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nexport default {\n  name: 'SubscriptionPlans',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const showCodeInput = ref(false);\n    const subscriptionCode = ref('');\n    const codeError = ref('');\n    const isValidCode = ref(false);\n    const isProcessingPayment = ref(false);\n    const plans = ref([]);\n    const selectedPlan = ref(null);\n    const isLoadingPlans = ref(true);\n\n    // Use computed properties from store\n    const isAuthenticated = computed(() => store.getters.isAuthenticated);\n    const user = computed(() => store.getters.currentUser);\n    const token = computed(() => store.getters.token);\n\n    // Function to select a plan\n    const selectPlan = plan => {\n      // If there is a cached order for a different plan, clear it\n      try {\n        const cached = localStorage.getItem('payment_order');\n        if (cached) {\n          const orderData = JSON.parse(cached);\n          if (orderData.plan_id && orderData.plan_id !== plan.id) {\n            localStorage.removeItem('payment_order');\n          }\n        }\n      } catch (e) {\n        localStorage.removeItem('payment_order');\n      }\n      selectedPlan.value = plan;\n    };\n\n    // Function to handle plan subscription\n    const handlePlanSubscription = plan => {\n      selectedPlan.value = plan;\n      handlePaymentGateway();\n    };\n\n    // Note: code redemption is now opened from the top callout\n\n    // Fetch plans from backend on mount\n    onMounted(async () => {\n      await fetchPlans();\n      store.dispatch('initializeStore');\n\n      // Check for plan in URL\n      const urlParams = new URLSearchParams(window.location.search);\n      const planType = urlParams.get('plan');\n      if (planType && plans.value.length > 0) {\n        const plan = plans.value.find(p => p.id === planType);\n        if (plan) {\n          selectedPlan.value = plan;\n        }\n      }\n\n      // Check and clean expired orders on page load\n      checkAndCleanExpiredOrders();\n    });\n\n    // Check for expired orders and clean up\n    const checkAndCleanExpiredOrders = (expectedPlanId = null) => {\n      const paymentOrder = localStorage.getItem('payment_order');\n      if (paymentOrder) {\n        try {\n          const orderData = JSON.parse(paymentOrder);\n          // If the cached order is for a different plan than currently selected, remove it\n          if (expectedPlanId && orderData.plan_id && orderData.plan_id !== expectedPlanId) {\n            localStorage.removeItem('payment_order');\n            return false;\n          }\n          const orderTime = orderData.created_at;\n          const currentTime = Date.now();\n          const timeDiff = currentTime - orderTime;\n\n          // If order is older than 30 minutes, remove it\n          if (timeDiff > 30 * 60 * 1000) {\n            // 30 minutes\n            localStorage.removeItem('payment_order');\n            console.log('Expired payment order removed');\n            return false;\n          }\n          return true;\n        } catch (error) {\n          localStorage.removeItem('payment_order');\n          return false;\n        }\n      }\n      return false;\n    };\n\n    // Create new order function\n    const createNewOrder = async () => {\n      try {\n        const orderResponse = await axios.post('/api/payment/create-order/', {\n          amount: selectedPlan.value.price,\n          currency: 'INR',\n          plan_id: selectedPlan.value.id,\n          phone: user.value.phone\n        });\n        console.log('New order created:', orderResponse.data);\n        if (!orderResponse.data || !orderResponse.data.key_id) {\n          throw new Error('Invalid order response from server');\n        }\n\n        // Store new order in localStorage with timestamp\n        const orderData = {\n          ...orderResponse.data,\n          created_at: Date.now(),\n          plan_id: selectedPlan.value.id,\n          phone: user.value.phone\n        };\n        localStorage.setItem('payment_order', JSON.stringify(orderData));\n        return orderData;\n      } catch (error) {\n        console.error('Error creating new order:', error);\n        throw error;\n      }\n    };\n\n    // Use existing order function\n    const useExistingOrder = orderData => {\n      console.log('Using existing order:', orderData.order_id);\n      return orderData;\n    };\n\n    // Payment status polling function\n    const startPaymentStatusPolling = async (orderId, storedPaymentData) => {\n      console.log('Starting payment status polling for order:', orderId);\n      console.log('Stored payment data:', storedPaymentData);\n      let attempts = 0;\n      const maxAttempts = 10; // Check for 5 minutes (30 seconds * 10)\n\n      const pollInterval = setInterval(async () => {\n        try {\n          attempts++;\n          console.log(`Payment status check attempt ${attempts}/${maxAttempts}`);\n\n          // Check payment status with backend\n          const statusResponse = await axios.get(`/users/payment/check-status/${orderId}/`);\n          if (statusResponse.data.status === 'completed') {\n            console.log('Payment completed successfully!');\n            clearInterval(pollInterval);\n\n            // Clear pending payment\n            localStorage.removeItem('pending_payment');\n\n            // Update store\n            store.commit('setLoading', false);\n            store.dispatch('showToast', {\n              message: 'Payment successful! Your subscription is now active.',\n              type: 'success'\n            });\n\n            // Redirect to profile\n            router.push('/profile');\n            return;\n          }\n          if (attempts >= maxAttempts) {\n            console.log('Max polling attempts reached');\n            clearInterval(pollInterval);\n\n            // Keep payment data for App.vue to handle\n            console.log('Keeping payment data for later verification');\n            store.dispatch('showToast', {\n              message: 'Payment verification is taking longer than expected. We will notify you once confirmed.',\n              type: 'warning'\n            });\n          }\n        } catch (error) {\n          console.error('Payment status check failed:', error);\n          if (attempts >= maxAttempts) {\n            clearInterval(pollInterval);\n          }\n        }\n      }, 30000); // Check every 30 seconds\n    };\n    const handlePaymentGateway = async () => {\n      isProcessingPayment.value = true;\n      try {\n        console.log('Payment gateway initiated');\n        console.log('Auth status:', isAuthenticated.value);\n        console.log('User:', user.value);\n        console.log('Token:', token.value);\n\n        // Check authentication and token\n        if (!isAuthenticated.value || !user.value || !token.value) {\n          console.log('User not authenticated or missing token, redirecting to login');\n          router.push({\n            path: '/login',\n            query: {\n              redirect: '/plans',\n              plan: selectedPlan.value.id\n            }\n          });\n          isProcessingPayment.value = false;\n          return;\n        }\n\n        // Check if registration and location details are complete\n        const hasCompletedRegistration = user.value.first_name && user.value.last_name && user.value.address && user.value.state && user.value.district && user.value.constituency;\n        if (!hasCompletedRegistration) {\n          console.log('Registration or location details incomplete, redirecting to profile update');\n          store.dispatch('showToast', {\n            message: 'Please complete your profile with all location details',\n            type: 'warning',\n            duration: 5000\n          });\n          router.push({\n            path: '/profile/update',\n            query: {\n              redirect: '/plans',\n              plan: selectedPlan.value.id\n            }\n          });\n          isProcessingPayment.value = false;\n          return;\n        }\n\n        // Set authorization header\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token.value}`;\n\n        // Show loading state\n        store.commit('setLoading', true);\n        console.log('Creating order for plan:', selectedPlan.value);\n\n        // Check for existing valid order\n        const hasValidOrder = checkAndCleanExpiredOrders(selectedPlan.value.id);\n        let orderData;\n        if (hasValidOrder) {\n          // Use existing order\n          const existingOrder = JSON.parse(localStorage.getItem('payment_order'));\n          orderData = useExistingOrder(existingOrder);\n        } else {\n          // Create new order\n          orderData = await createNewOrder();\n        }\n        console.log('Order data:', orderData);\n\n        // Hide loading state\n        store.commit('setLoading', false);\n        if (!orderData || !orderData.key_id) {\n          throw new Error('Invalid order response from server');\n        }\n        try {\n          // Initialize Razorpay\n          const options = {\n            key: orderData.key_id,\n            amount: orderData.amount,\n            currency: orderData.currency,\n            name: 'No1 OTT',\n            description: `${selectedPlan.value.name} Subscription`,\n            order_id: orderData.order_id,\n            prefill: {\n              name: user.value?.first_name || '',\n              email: user.value?.email || '',\n              contact: user.value?.phone || ''\n            },\n            theme: {\n              color: '#c30059'\n            },\n            // Better UPI configuration to prevent app closing\n            config: {\n              display: {\n                blocks: {\n                  upi: {\n                    name: 'Pay using UPI',\n                    instruments: [{\n                      method: 'upi'\n                    }]\n                  },\n                  card: {\n                    name: 'Credit/Debit Cards',\n                    instruments: [{\n                      method: 'card'\n                    }]\n                  },\n                  netbanking: {\n                    name: 'Net Banking',\n                    instruments: [{\n                      method: 'netbanking'\n                    }]\n                  }\n                },\n                sequence: ['upi', 'card', 'netbanking'],\n                preferences: {\n                  show_default_blocks: true\n                }\n              }\n            },\n            // Enhanced retry configuration\n            retry: {\n              enabled: true,\n              max_count: 3\n            },\n            // Better timeout handling\n            timeout: 300,\n            // 5 minutes\n            // Handle modal close (when user cancels or app redirects)\n            modal: {\n              ondismiss: async function () {\n                console.log('Razorpay modal dismissed, starting payment status check');\n                // Start background checking for payment status\n                setTimeout(async () => {\n                  // Try to get payment data from localStorage if available\n                  const storedPayment = localStorage.getItem('pending_payment');\n                  if (storedPayment) {\n                    const paymentInfo = JSON.parse(storedPayment);\n                    await startPaymentStatusPolling(orderData.order_id, paymentInfo);\n                  } else {\n                    await startPaymentStatusPolling(orderData.order_id, null);\n                  }\n                }, 2000); // Wait 2 seconds before starting checks\n              },\n              // Handle escape and back button\n              escape: true,\n              backdropclose: false\n            },\n            // Handle different payment methods\n            method: {\n              upi: {\n                // Handle UPI flow completion\n                flow: 'intent' // Use intent-based flow for better UPI handling\n              }\n            },\n            handler: async response => {\n              // Now handle the payment success\n              try {\n                store.commit('setLoading', true);\n                console.log('=== PAYMENT SUCCESSFUL ===');\n                console.log('Payment response:', response);\n\n                // Store payment details in localStorage for backup verification\n                const paymentData = {\n                  payment_id: response.razorpay_payment_id,\n                  order_id: response.razorpay_order_id,\n                  signature: response.razorpay_signature,\n                  plan_id: selectedPlan.value.id,\n                  phone: user.value.phone,\n                  timestamp: Date.now(),\n                  retry_count: 0,\n                  amount: selectedPlan.value.price,\n                  plan_name: selectedPlan.value.name\n                };\n                console.log('Storing payment data in localStorage:', paymentData);\n                localStorage.setItem('pending_payment', JSON.stringify(paymentData));\n\n                // Try immediate verification\n                console.log('Attempting immediate payment verification...');\n                const verifyResponse = await axios.post('/users/verify-payment/', {\n                  razorpay_payment_id: response.razorpay_payment_id,\n                  razorpay_order_id: response.razorpay_order_id,\n                  razorpay_signature: response.razorpay_signature,\n                  plan_id: selectedPlan.value.id,\n                  phone: user.value.phone\n                });\n                console.log('Verification response:', verifyResponse.data);\n                if (verifyResponse.data.status === 'success') {\n                  // Clear pending payment from localStorage\n                  localStorage.removeItem('pending_payment');\n\n                  // Update user subscription in store\n                  store.commit('setSubscription', verifyResponse.data.subscription);\n                  store.dispatch('showToast', {\n                    message: 'Payment successful! Your subscription is now active.',\n                    type: 'success'\n                  });\n                  console.log('Payment verified successfully, redirecting to profile');\n                  router.push('/profile');\n                } else {\n                  throw new Error(verifyResponse.data.message || 'Payment verification failed');\n                }\n              } catch (error) {\n                console.error('=== PAYMENT VERIFICATION FAILED ===');\n                console.error('Error details:', error);\n                console.error('Error response:', error.response?.data);\n\n                // Don't remove pending_payment from localStorage - let App.vue handle it\n                store.dispatch('showToast', {\n                  message: 'Payment successful! Please wait a moment for verification. You will be notified once your subscription is active.',\n                  type: 'warning'\n                });\n                console.log('Redirecting to profile, payment data stored for retry');\n                router.push('/profile');\n              } finally {\n                store.commit('setLoading', false);\n              }\n            },\n            webview_intent: true\n          };\n\n          // Create and open Razorpay\n          console.log('Opening Razorpay with options:', options);\n          const rzp = new window.Razorpay(options);\n          rzp.on('payment.failed', function (response) {\n            isProcessingPayment.value = false;\n            store.commit('setLoading', false);\n            alert(`Payment failed: ${response.error.description}`);\n          });\n          rzp.open();\n          // Hide loader after a short delay to ensure Razorpay UI is visible\n          setTimeout(() => {\n            isProcessingPayment.value = false;\n          }, 1000);\n        } catch (error) {\n          console.error('Order creation failed:', error);\n          store.commit('setLoading', false);\n          if (error.response) {\n            if (error.response.status === 401) {\n              // Clear invalid session and redirect to login\n              store.dispatch('logout');\n              router.push({\n                path: '/login',\n                query: {\n                  redirect: '/plans',\n                  plan: selectedPlan.value.id\n                }\n              });\n            } else {\n              alert(`Server error: ${error.response.data.message || 'Please try again later'}`);\n            }\n          } else if (error.request) {\n            alert('Network error. Please check your internet connection.');\n          } else {\n            alert('Unable to create order. Please try again.');\n          }\n        }\n      } catch (error) {\n        console.error('Payment gateway error:', error);\n        store.commit('setLoading', false);\n        alert('Something went wrong. Please try again.');\n      }\n    };\n    const validateCode = async () => {\n      try {\n        // Show loading state\n        store.commit('setLoading', true);\n\n        // Basic validation\n        if (!subscriptionCode.value) {\n          codeError.value = 'Please enter a subscription code';\n          isValidCode.value = false;\n          return;\n        }\n\n        // Get user phone from store\n        const phone = store.getters.currentUser?.phone;\n        if (!phone) {\n          store.dispatch('showToast', {\n            message: 'Please login to continue',\n            type: 'error'\n          });\n          router.push({\n            name: 'login',\n            query: {\n              redirect: router.currentRoute.value.fullPath\n            }\n          });\n          return;\n        }\n\n        // Call API to validate code\n        const response = await axios.post('/users/validate-coupon/', {\n          code: subscriptionCode.value,\n          phone: phone,\n          amount: selectedPlan.value.price,\n          plan_id: selectedPlan.value.id\n        });\n        if (response.data.status === 'success') {\n          isValidCode.value = true;\n          codeError.value = '';\n          store.dispatch('showToast', {\n            message: 'Code is valid! Click Activate to use it',\n            type: 'success'\n          });\n        } else {\n          isValidCode.value = false;\n          codeError.value = response.data.message || 'Invalid code';\n          store.dispatch('showToast', {\n            message: codeError.value,\n            type: 'error'\n          });\n        }\n      } catch (error) {\n        console.error('Code validation error:', error);\n        isValidCode.value = false;\n        codeError.value = error.response?.data?.message || 'Error validating code. Please try again.';\n        store.dispatch('showToast', {\n          message: codeError.value,\n          type: 'error'\n        });\n      } finally {\n        store.commit('setLoading', false);\n      }\n    };\n    const handleCodeSubmit = async () => {\n      if (!isValidCode.value) return;\n      try {\n        // Show loading state\n        store.commit('setLoading', true);\n\n        // Get user from Vuex store\n        const user = store.getters.currentUser;\n        const phone = user?.phone || localStorage.getItem('phone');\n        if (!phone) {\n          store.dispatch('showToast', {\n            message: 'Please login to continue',\n            type: 'error'\n          });\n          router.push({\n            name: 'login',\n            query: {\n              redirect: router.currentRoute.value.fullPath\n            }\n          });\n          store.commit('setLoading', false);\n          return;\n        }\n\n        // Check if registration and location details are complete (same as Pay Online)\n        const hasCompletedRegistration = user && user.first_name && user.last_name && user.address && user.state && user.district && user.constituency;\n        if (!hasCompletedRegistration) {\n          store.dispatch('showToast', {\n            message: 'Please complete your profile with all location details',\n            type: 'warning',\n            duration: 5000\n          });\n          router.push({\n            path: '/profile/update',\n            query: {\n              redirect: router.currentRoute.value.fullPath,\n              code: subscriptionCode.value\n            }\n          });\n          store.commit('setLoading', false);\n          return;\n        }\n\n        // Call API to activate subscription\n        const response = await axios.post('/users/apply-coupon/', {\n          code: subscriptionCode.value,\n          phone: phone,\n          plan_id: selectedPlan.value.id\n        });\n        if (response.data.status === 'success') {\n          // Update user subscription in store\n          store.commit('setSubscription', response.data.subscription);\n\n          // Show success message\n          store.dispatch('showToast', {\n            message: 'Subscription activated successfully!',\n            type: 'success'\n          });\n\n          // Close code input dialog\n          showCodeInput.value = false;\n\n          // Redirect to profile page\n          router.push('/profile');\n        } else {\n          throw new Error(response.data.message || 'Failed to activate subscription');\n        }\n      } catch (error) {\n        console.error('Code activation error:', error);\n\n        // Show error message\n        store.dispatch('showToast', {\n          message: error.response?.data?.message || 'Error activating subscription. Please try again.',\n          type: 'error'\n        });\n        if (error.response?.status === 404) {\n          // User not found - redirect to login (same as Pay Online)\n          router.push({\n            path: '/login',\n            query: {\n              redirect: router.currentRoute.value.fullPath,\n              phone: localStorage.getItem('phone')\n            }\n          });\n        } else if (!localStorage.getItem('phone')) {\n          // Not logged in - redirect to login\n          router.push({\n            name: 'login',\n            query: {\n              redirect: router.currentRoute.value.fullPath\n            }\n          });\n        }\n      } finally {\n        store.commit('setLoading', false);\n      }\n    };\n    const fetchPlans = async () => {\n      isLoadingPlans.value = true;\n      try {\n        const response = await axios.get('/users/api/subscription-plans/');\n        plans.value = response.data.plans || [];\n        if (plans.value.length > 0) {\n          const popularPlan = plans.value.find(p => p.popular) || plans.value[0];\n          selectedPlan.value = popularPlan;\n        }\n      } catch (error) {\n        console.error('Failed to fetch plans:', error);\n        plans.value = [];\n        store.dispatch('showToast', {\n          message: 'Failed to refresh plans. Please try again later.',\n          type: 'error'\n        });\n      } finally {\n        isLoadingPlans.value = false;\n      }\n    };\n    const formatNumber = num => {\n      if (!isFinite(num)) return '0';\n      const rounded = Math.round((num + Number.EPSILON) * 100) / 100;\n      return Number.isInteger(rounded) ? String(rounded) : rounded.toFixed(2);\n    };\n    const getPerDay = plan => {\n      if (plan && plan.per_day_text) return plan.per_day_text.replace(/^\\s*₹?\\s*/, '');\n      if (!plan || !plan.price || !plan.duration) return '0';\n      const perDay = Number(plan.price) / Number(plan.duration);\n      return formatNumber(perDay);\n    };\n    return {\n      plans,\n      selectedPlan,\n      showCodeInput,\n      subscriptionCode,\n      codeError,\n      isValidCode,\n      isProcessingPayment,\n      handlePaymentGateway,\n      validateCode,\n      handleCodeSubmit,\n      selectPlan,\n      handlePlanSubscription,\n      checkAndCleanExpiredOrders,\n      // Expose order cleanup method\n      fetchPlans,\n      // Expose fetchPlans function\n      isLoadingPlans,\n      getPerDay\n    };\n  }\n};","map":{"version":3,"names":["useStore","ref","computed","onMounted","useRouter","axios","name","setup","store","router","showCodeInput","subscriptionCode","codeError","isValidCode","isProcessingPayment","plans","selectedPlan","isLoadingPlans","isAuthenticated","getters","user","currentUser","token","selectPlan","plan","cached","localStorage","getItem","orderData","JSON","parse","plan_id","id","removeItem","e","value","handlePlanSubscription","handlePaymentGateway","fetchPlans","dispatch","urlParams","URLSearchParams","window","location","search","planType","get","length","find","p","checkAndCleanExpiredOrders","expectedPlanId","paymentOrder","orderTime","created_at","currentTime","Date","now","timeDiff","console","log","error","createNewOrder","orderResponse","post","amount","price","currency","phone","data","key_id","Error","setItem","stringify","useExistingOrder","order_id","startPaymentStatusPolling","orderId","storedPaymentData","attempts","maxAttempts","pollInterval","setInterval","statusResponse","status","clearInterval","commit","message","type","push","path","query","redirect","hasCompletedRegistration","first_name","last_name","address","state","district","constituency","duration","defaults","headers","common","hasValidOrder","existingOrder","options","key","description","prefill","email","contact","theme","color","config","display","blocks","upi","instruments","method","card","netbanking","sequence","preferences","show_default_blocks","retry","enabled","max_count","timeout","modal","ondismiss","setTimeout","storedPayment","paymentInfo","escape","backdropclose","flow","handler","response","paymentData","payment_id","razorpay_payment_id","razorpay_order_id","signature","razorpay_signature","timestamp","retry_count","plan_name","verifyResponse","subscription","webview_intent","rzp","Razorpay","on","alert","open","request","validateCode","currentRoute","fullPath","code","handleCodeSubmit","popularPlan","popular","formatNumber","num","isFinite","rounded","Math","round","Number","EPSILON","isInteger","String","toFixed","getPerDay","per_day_text","replace","perDay"],"sources":["F:\\ott_tv\\ott_frontend\\src\\views\\SubscriptionPlans.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-gradient-to-br from-[#0a0a0a] via-[#1a1a1a] to-[#0f0f0f] text-white\">\n    <!-- Fullscreen Spinner Overlay -->\n    <div v-if=\"isProcessingPayment\" class=\"fixed inset-0 z-50 flex flex-col items-center justify-center bg-black/80 backdrop-blur-sm\">\n      <div class=\"relative\">\n        <div class=\"w-16 h-16 border-4 border-[#c30059]/30 border-t-[#c30059] rounded-full animate-spin\"></div>\n        <div class=\"absolute inset-0 flex items-center justify-center\">\n          <i class=\"fas fa-play text-[#c30059] text-xl\"></i>\n        </div>\n      </div>\n      <div class=\"mt-6 text-center\">\n        <div class=\"text-xl font-bold text-white mb-2\">Processing Payment...</div>\n        <div class=\"w-64 h-1 bg-gray-700 rounded-full overflow-hidden\">\n          <div class=\"h-full bg-gradient-to-r from-[#c30059] to-[#ff6b9d] animate-pulse\"></div>\n        </div>\n        <div class=\"mt-4 p-4 bg-amber-500/10 border border-amber-500/30 rounded-lg max-w-md\">\n          <div class=\"flex items-center justify-center gap-2 mb-2\">\n            <i class=\"fas fa-shield-alt text-amber-400\"></i>\n            <span class=\"font-semibold text-amber-400\">Secure Payment</span>\n          </div>\n          <p class=\"text-sm text-amber-300\">\n            Please wait while we process your payment securely. Do not close this window.\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <!-- Hero Section -->\n    <div class=\"relative overflow-hidden\">\n      <!-- Background Pattern -->\n      <div class=\"absolute inset-0 opacity-10\">\n        <div class=\"absolute inset-0 bg-gradient-to-br from-[#c30059]/10 via-transparent to-[#ff6b9d]/10\"></div>\n        <div class=\"absolute inset-0\" style=\"background-image: radial-gradient(circle at 25% 25%, rgba(195, 0, 89, 0.1) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(255, 107, 157, 0.1) 0%, transparent 50%);\"></div>\n      </div>\n      \n      <!-- Header -->\n      <div class=\"relative z-10 px-4 py-8\">\n        <div class=\"max-w-7xl mx-auto\">\n          <div class=\"flex items-center justify-between mb-8\">\n            <router-link to=\"/\" class=\"flex items-center gap-3 text-white/80 hover:text-white transition-colors group\">\n              <div class=\"w-10 h-10 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-lg flex items-center justify-center group-hover:scale-105 transition-transform\">\n                <i class=\"fas fa-arrow-left text-lg\"></i>\n              </div>\n              <span class=\"font-medium\">Back to Home</span>\n            </router-link>\n            \n            <div class=\"flex items-center gap-2 text-sm text-white/60\">\n              <i class=\"fas fa-shield-check text-green-400\"></i>\n              <span>Secure Payment</span>\n            </div>\n          </div>\n          \n          <!-- Hero Content -->\n          <div class=\"text-center max-w-4xl mx-auto\">\n            <div class=\"inline-flex items-center gap-2 px-4 py-2 bg-[#c30059]/10 border border-[#c30059]/20 rounded-full text-[#c30059] text-sm font-medium mb-6\">\n              <i class=\"fas fa-crown\"></i>\n              <span>Premium Plans Available</span>\n            </div>\n            \n            <h1 class=\"text-4xl md:text-6xl font-bold mb-1\">\n              Choose Your\n              <span class=\"bg-gradient-to-r from-[#c30059] to-[#ff6b9d] bg-clip-text text-transparent\">\n                Entertainment\n              </span>\n              <br>Plan\n            </h1>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- Plans Section -->\n    <div class=\"relative px-4 py-1\">\n      <div class=\"max-w-7xl mx-auto\">\n        \n       \n        \n        <!-- Plans Grid -->\n        <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 mb-16 max-w-6xl mx-auto place-items-center\">\n          <!-- Loading State -->\n          <div v-if=\"isLoadingPlans\" class=\"col-span-full w-full flex flex-col items-center py-16\">\n            <div class=\"w-12 h-12 border-4 border-[#c30059]/30 border-t-[#c30059] rounded-full animate-spin\"></div>\n            <p class=\"mt-4 text-white/70 text-sm\">Loading plans...</p>\n          </div>\n          \n          <!-- No Plans Message -->\n          <div v-else-if=\"plans.length === 0\" class=\"col-span-full text-center py-16\">\n            <div class=\"bg-gradient-to-r from-[#1a1a1a] to-[#2a2a2a] rounded-2xl border border-white/10 p-8\">\n              <div class=\"w-20 h-20 mx-auto mb-6 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-2xl flex items-center justify-center\">\n                <i class=\"fas fa-exclamation-triangle text-white text-3xl\"></i>\n              </div>\n              <h3 class=\"text-2xl font-bold text-white mb-3\">No Plans Available</h3>\n              <p class=\"text-white/60 mb-4\">Subscription plans are currently not available. Please try again later.</p>\n              <button @click=\"fetchPlans\" class=\"px-6 py-3 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] text-white font-semibold rounded-xl hover:shadow-lg hover:shadow-[#c30059]/25 transition-all\">\n                <i class=\"fas fa-refresh mr-2\"></i>\n                Refresh Plans\n              </button>\n            </div>\n          </div>\n          \n          <!-- Plan Cards -->\n          <div \n            v-for=\"plan in plans\" \n            :key=\"plan.id\"\n            @click=\"selectPlan(plan)\"\n            :class=\"[\n              'relative group cursor-pointer transition-all duration-300 transform hover:scale-105',\n              (selectedPlan && selectedPlan.id) === plan.id ? 'scale-105' : ''\n            ]\"\n          >\n            <!-- Plan Card -->\n            <div :class=\"[\n              'relative bg-gradient-to-br from-[#2a2a2a] to-[#1a1a1a] rounded-2xl overflow-hidden border-2 transition-all duration-300 h-full',\n              (selectedPlan && selectedPlan.id) === plan.id \n                ? 'border-[#c30059] shadow-2xl shadow-[#c30059]/20' \n                : 'border-white/10 hover:border-[#c30059]/50 group-hover:shadow-xl'\n            ]\">\n              <!-- Badge Section -->\n              <div class=\"p-4 pb-2\">\n                <div v-if=\"plan.popular\" class=\"inline-block\">\n                  <div class=\"bg-[#c30059] text-white text-xs font-bold px-3 py-1 rounded-full\">\n                    {{ plan.badge || 'RECOMMENDED' }}\n                  </div>\n                </div>\n                <div v-else-if=\"plan.badge\" class=\"inline-block\">\n                  <div class=\"bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full\">\n                    {{ plan.badge }}\n                  </div>\n                </div>\n              </div>\n              \n              <!-- Selected Badge -->\n              <div v-if=\"(selectedPlan && selectedPlan.id) === plan.id\" class=\"absolute top-4 right-4 z-10\">\n                <div class=\"w-8 h-8 bg-[#c30059] rounded-full flex items-center justify-center\">\n                  <i class=\"fas fa-check text-white text-sm\"></i>\n                </div>\n              </div>\n              \n              <!-- Card Content -->\n              <div class=\"p-6 pt-2 flex flex-col h-full\">\n                <!-- Logo/Brand Section -->\n                <div class=\"text-center mb-4\">\n                  <div class=\"inline-flex items-center gap-2 mb-3\">\n                    <div class=\"w-8 h-8 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-lg flex items-center justify-center\">\n                      <i class=\"fas fa-play text-white text-sm\"></i>\n                    </div>\n                    <span class=\"text-[#c30059] font-bold text-lg\">OTT</span>\n                    <span class=\"bg-gradient-to-r from-[#ffd700] to-[#ffed4e] bg-clip-text text-transparent font-bold text-lg\">{{ plan.brand_text || 'GOLD' }}</span>\n                  </div>\n                </div>\n                \n                <!-- Plan Features -->\n                <div class=\"text-center mb-6\">\n                  <div class=\"text-white font-semibold text-sm mb-2\">\n                    {{ plan.features.join(' • ') }}\n                  </div>\n                  <div class=\"text-white/70 text-xs\">\n                    {{ plan.description }}\n                  </div>\n                </div>\n                \n                <!-- Divider -->\n                <div class=\"border-t border-white/10 my-4\"></div>\n                \n                <!-- Pricing Section -->\n                <div class=\"text-center mb-6 flex-grow\">\n                  <div class=\"flex items-baseline justify-center gap-2 mb-2\">\n                    <span class=\"text-2xl font-bold text-white\">₹{{ plan.price }}</span>\n                    <span class=\"text-white/60 text-sm\">/{{ plan.duration_text || 'month' }}</span>\n                  </div>\n                  <!-- Per-day dynamic text -->\n                  <div class=\"text-white/70 text-xs\">\n                    Just ₹{{ getPerDay(plan) }} per day\n                  </div>\n                </div>\n                \n                <!-- Subscribe Button -->\n                <div class=\"mt-auto\">\n                  <!-- Pay Online Button -->\n                  <button \n                    @click.stop=\"handlePlanSubscription(plan)\"\n                    :disabled=\"isProcessingPayment\"\n                    :class=\"[\n                      'w-full py-3 px-4 rounded-xl font-bold text-sm transition-all duration-300 flex items-center justify-center gap-2',\n                      'bg-gradient-to-r from-[#c30059] to-[#ff6b9d] text-white hover:shadow-lg hover:shadow-[#c30059]/25 disabled:opacity-50'\n                    ]\"\n                  >\n                    <i class=\"fas fa-credit-card\" v-if=\"!isProcessingPayment\"></i>\n                    <i class=\"fas fa-spinner fa-spin\" v-else></i>\n                    <span v-if=\"isProcessingPayment\">Processing...</span>\n                    <span v-else>Pay Online</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n       <!-- Subscription Code Callout (outside cards) -->\n        <div class=\"mb-6\">\n          <div class=\"flex flex-col md:flex-row items-center justify-between gap-3 bg-gradient-to-r from-[#1a1a1a] to-[#2a2a2a] border border-white/10 rounded-2xl p-4 max-w-4xl mx-auto\">\n            <div class=\"flex items-center gap-3 text-white/80\">\n              <div class=\"w-10 h-10 rounded-xl bg-gradient-to-r from-[#c30059] to-[#ff6b9d] flex items-center justify-center\">\n                <i class=\"fas fa-ticket-alt text-white\"></i>\n              </div>\n              <div>\n                <div class=\"font-semibold text-white\">Have a subscription code?</div>\n                <div class=\"text-sm text-white/60\">Redeem it to activate your plan instantly</div>\n              </div>\n            </div>\n            <button \n              @click=\"showCodeInput = true\"\n              class=\"w-full md:w-auto px-5 py-2.5 rounded-xl font-semibold text-sm bg-gradient-to-r from-[#c30059] to-[#ff6b9d] text-white hover:shadow-lg hover:shadow-[#c30059]/25 transition-all\"\n            >\n              Redeem Code\n            </button>\n          </div>\n        </div>\n        \n      <!-- Code Input Dialog -->\n      <div v-if=\"showCodeInput\" class=\"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50\">\n        <div class=\"bg-gradient-to-br from-[#1a1a1a] to-[#2a2a2a] rounded-3xl w-full max-w-md border border-white/10 overflow-hidden\">\n          <!-- Header -->\n          <div class=\"bg-gradient-to-r from-[#c30059] to-[#ff6b9d] p-6\">\n            <div class=\"flex justify-between items-center\">\n              <div>\n                <h3 class=\"text-xl font-bold text-white\">Subscription Code</h3>\n                <p class=\"text-white/80 text-sm\">Enter your redemption code</p>\n              </div>\n              <button @click=\"showCodeInput = false\" class=\"w-8 h-8 bg-white/10 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-colors\">\n                <i class=\"fas fa-times\"></i>\n              </button>\n            </div>\n          </div>\n          \n          <!-- Content -->\n          <div class=\"p-6 space-y-6\">\n            <div>\n              <label class=\"block text-sm font-medium text-white/80 mb-3\">Redemption Code</label>\n              <input \n                v-model=\"subscriptionCode\"\n                type=\"text\"\n                class=\"w-full bg-[#0a0a0a] border border-white/10 rounded-xl h-14 px-4 text-white text-lg font-mono tracking-wider focus:border-[#c30059] focus:outline-none focus:ring-2 focus:ring-[#c30059]/20 transition-all uppercase placeholder-white/40\"\n                placeholder=\"ENTER-CODE-HERE\"\n                @input=\"validateCode\"\n              />\n              <p v-if=\"codeError\" class=\"mt-3 text-sm text-red-400 flex items-center gap-2\">\n                <i class=\"fas fa-exclamation-circle\"></i>\n                {{ codeError }}\n              </p>\n            </div>\n            \n            <button \n              @click=\"handleCodeSubmit\"\n              :disabled=\"!isValidCode\"\n              class=\"w-full py-4 px-6 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] text-white font-bold rounded-xl hover:shadow-lg hover:shadow-[#c30059]/25 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-none\"\n            >\n              <span v-if=\"isValidCode\">Activate Subscription</span>\n              <span v-else>Enter Valid Code</span>\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- Why Choose Us Section -->\n    <div class=\"bg-[#0a0a0a] py-16\">\n      <div class=\"max-w-7xl mx-auto px-4\">\n        <div class=\"text-center mb-12\">\n          <h2 class=\"text-3xl md:text-4xl font-bold mb-4\">Why Choose Our Platform?</h2>\n          <p class=\"text-lg text-white/70\">Experience entertainment like never before</p>\n        </div>\n        \n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n          <div class=\"text-center group\">\n            <div class=\"w-20 h-20 mx-auto mb-6 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n              <i class=\"fas fa-video text-3xl text-white\"></i>\n            </div>\n            <h3 class=\"text-xl font-bold mb-3\">Premium Content</h3>\n            <p class=\"text-white/60\">Access thousands of movies, TV shows, and exclusive originals in HD quality</p>\n          </div>\n          \n          <div class=\"text-center group\">\n            <div class=\"w-20 h-20 mx-auto mb-6 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n              <i class=\"fas fa-mobile-alt text-3xl text-white\"></i>\n            </div>\n            <h3 class=\"text-xl font-bold mb-3\">Multi-Device Support</h3>\n            <p class=\"text-white/60\">Watch on TV, laptop, tablet, or smartphone. Stream on up to 2 devices simultaneously</p>\n          </div>\n          \n          <div class=\"text-center group\">\n            <div class=\"w-20 h-20 mx-auto mb-6 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n              <i class=\"fas fa-download text-3xl text-white\"></i>\n            </div>\n            <h3 class=\"text-xl font-bold mb-3\">Offline Viewing</h3>\n            <p class=\"text-white/60\">Download content and watch offline anywhere, anytime without internet connection</p>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- FAQ Section -->\n    <div class=\"py-16\">\n      <div class=\"max-w-4xl mx-auto px-4\">\n        <div class=\"text-center mb-12\">\n          <h2 class=\"text-3xl md:text-4xl font-bold mb-4\">Frequently Asked Questions</h2>\n          <p class=\"text-lg text-white/70\">Everything you need to know about our subscription plans</p>\n        </div>\n        \n        <div class=\"space-y-4\">\n          <div class=\"bg-gradient-to-r from-[#1a1a1a] to-[#2a2a2a] rounded-2xl border border-white/10 overflow-hidden\">\n            <button class=\"w-full p-6 text-left flex items-center justify-between hover:bg-white/5 transition-colors\">\n              <div>\n                <h3 class=\"font-semibold text-lg mb-1\">What payment methods do you accept?</h3>\n                <p class=\"text-white/60 text-sm\">Learn about our secure payment options</p>\n              </div>\n              <i class=\"fas fa-chevron-down text-[#c30059] text-lg\"></i>\n            </button>\n          </div>\n          \n          <div class=\"bg-gradient-to-r from-[#1a1a1a] to-[#2a2a2a] rounded-2xl border border-white/10 overflow-hidden\">\n            <button class=\"w-full p-6 text-left flex items-center justify-between hover:bg-white/5 transition-colors\">\n              <div>\n                <h3 class=\"font-semibold text-lg mb-1\">Can I cancel my subscription anytime?</h3>\n                <p class=\"text-white/60 text-sm\">Understand our flexible cancellation policy</p>\n              </div>\n              <i class=\"fas fa-chevron-down text-[#c30059] text-lg\"></i>\n            </button>\n          </div>\n          \n          <div class=\"bg-gradient-to-r from-[#1a1a1a] to-[#2a2a2a] rounded-2xl border border-white/10 overflow-hidden\">\n            <button class=\"w-full p-6 text-left flex items-center justify-between hover:bg-white/5 transition-colors\">\n              <div>\n                <h3 class=\"font-semibold text-lg mb-1\">How many devices can I watch on simultaneously?</h3>\n                <p class=\"text-white/60 text-sm\">Details about multi-device streaming</p>\n              </div>\n              <i class=\"fas fa-chevron-down text-[#c30059] text-lg\"></i>\n            </button>\n          </div>\n          \n          <div class=\"bg-gradient-to-r from-[#1a1a1a] to-[#2a2a2a] rounded-2xl border border-white/10 overflow-hidden\">\n            <button class=\"w-full p-6 text-left flex items-center justify-between hover:bg-white/5 transition-colors\">\n              <div>\n                <h3 class=\"font-semibold text-lg mb-1\">Is there a free trial available?</h3>\n                <p class=\"text-white/60 text-sm\">Information about trial periods and offers</p>\n              </div>\n              <i class=\"fas fa-chevron-down text-[#c30059] text-lg\"></i>\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport { useStore } from 'vuex';\nimport { ref, computed, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\n\nexport default {\n  name: 'SubscriptionPlans',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const showCodeInput = ref(false);\n    const subscriptionCode = ref('');\n    const codeError = ref('');\n    const isValidCode = ref(false);\n    const isProcessingPayment = ref(false);\n\n    const plans = ref([]);\n    const selectedPlan = ref(null);\n    const isLoadingPlans = ref(true);\n\n    // Use computed properties from store\n    const isAuthenticated = computed(() => store.getters.isAuthenticated);\n    const user = computed(() => store.getters.currentUser);\n    const token = computed(() => store.getters.token);\n\n    // Function to select a plan\n    const selectPlan = (plan) => {\n      // If there is a cached order for a different plan, clear it\n      try {\n        const cached = localStorage.getItem('payment_order');\n        if (cached) {\n          const orderData = JSON.parse(cached);\n          if (orderData.plan_id && orderData.plan_id !== plan.id) {\n            localStorage.removeItem('payment_order');\n          }\n        }\n      } catch (e) {\n        localStorage.removeItem('payment_order');\n      }\n      selectedPlan.value = plan;\n    };\n\n    // Function to handle plan subscription\n    const handlePlanSubscription = (plan) => {\n      selectedPlan.value = plan;\n      handlePaymentGateway();\n    };\n\n    // Note: code redemption is now opened from the top callout\n\n    // Fetch plans from backend on mount\n    onMounted(async () => {\n      await fetchPlans();\n      store.dispatch('initializeStore');\n      \n      // Check for plan in URL\n      const urlParams = new URLSearchParams(window.location.search);\n      const planType = urlParams.get('plan');\n      if (planType && plans.value.length > 0) {\n        const plan = plans.value.find(p => p.id === planType);\n        if (plan) {\n          selectedPlan.value = plan;\n        }\n      }\n      \n      // Check and clean expired orders on page load\n      checkAndCleanExpiredOrders();\n    });\n\n    // Check for expired orders and clean up\n    const checkAndCleanExpiredOrders = (expectedPlanId = null) => {\n      const paymentOrder = localStorage.getItem('payment_order');\n      if (paymentOrder) {\n        try {\n          const orderData = JSON.parse(paymentOrder);\n          // If the cached order is for a different plan than currently selected, remove it\n          if (expectedPlanId && orderData.plan_id && orderData.plan_id !== expectedPlanId) {\n            localStorage.removeItem('payment_order');\n            return false;\n          }\n          const orderTime = orderData.created_at;\n          const currentTime = Date.now();\n          const timeDiff = currentTime - orderTime;\n          \n          // If order is older than 30 minutes, remove it\n          if (timeDiff > 30 * 60 * 1000) { // 30 minutes\n            localStorage.removeItem('payment_order');\n            console.log('Expired payment order removed');\n            return false;\n          }\n          return true;\n        } catch (error) {\n          localStorage.removeItem('payment_order');\n          return false;\n        }\n      }\n      return false;\n    };\n\n    // Create new order function\n    const createNewOrder = async () => {\n      try {\n        const orderResponse = await axios.post('/api/payment/create-order/', {\n          amount: selectedPlan.value.price,\n          currency: 'INR',\n          plan_id: selectedPlan.value.id,\n          phone: user.value.phone\n        });\n\n        console.log('New order created:', orderResponse.data);\n\n        if (!orderResponse.data || !orderResponse.data.key_id) {\n          throw new Error('Invalid order response from server');\n        }\n\n        // Store new order in localStorage with timestamp\n        const orderData = {\n          ...orderResponse.data,\n          created_at: Date.now(),\n          plan_id: selectedPlan.value.id,\n          phone: user.value.phone\n        };\n        localStorage.setItem('payment_order', JSON.stringify(orderData));\n\n        return orderData;\n      } catch (error) {\n        console.error('Error creating new order:', error);\n        throw error;\n      }\n    };\n\n    // Use existing order function\n    const useExistingOrder = (orderData) => {\n      console.log('Using existing order:', orderData.order_id);\n      return orderData;\n    };\n\n    // Payment status polling function\n    const startPaymentStatusPolling = async (orderId, storedPaymentData) => {\n      console.log('Starting payment status polling for order:', orderId);\n      console.log('Stored payment data:', storedPaymentData);\n      let attempts = 0;\n      const maxAttempts = 10; // Check for 5 minutes (30 seconds * 10)\n      \n      const pollInterval = setInterval(async () => {\n        try {\n          attempts++;\n          console.log(`Payment status check attempt ${attempts}/${maxAttempts}`);\n          \n          // Check payment status with backend\n          const statusResponse = await axios.get(`/users/payment/check-status/${orderId}/`);\n          \n          if (statusResponse.data.status === 'completed') {\n            console.log('Payment completed successfully!');\n            clearInterval(pollInterval);\n            \n            // Clear pending payment\n            localStorage.removeItem('pending_payment');\n            \n            // Update store\n            store.commit('setLoading', false);\n            store.dispatch('showToast', {\n              message: 'Payment successful! Your subscription is now active.',\n              type: 'success'\n            });\n            \n            // Redirect to profile\n            router.push('/profile');\n            return;\n          }\n          \n          if (attempts >= maxAttempts) {\n            console.log('Max polling attempts reached');\n            clearInterval(pollInterval);\n            \n            // Keep payment data for App.vue to handle\n            console.log('Keeping payment data for later verification');\n            \n            store.dispatch('showToast', {\n              message: 'Payment verification is taking longer than expected. We will notify you once confirmed.',\n              type: 'warning'\n            });\n          }\n        } catch (error) {\n          console.error('Payment status check failed:', error);\n          \n          if (attempts >= maxAttempts) {\n            clearInterval(pollInterval);\n          }\n        }\n      }, 30000); // Check every 30 seconds\n    };\n\n    const handlePaymentGateway = async () => {\n      isProcessingPayment.value = true;\n      try {\n        console.log('Payment gateway initiated');\n        console.log('Auth status:', isAuthenticated.value);\n        console.log('User:', user.value);\n        console.log('Token:', token.value);\n\n        // Check authentication and token\n        if (!isAuthenticated.value || !user.value || !token.value) {\n          console.log('User not authenticated or missing token, redirecting to login');\n          router.push({\n            path: '/login',\n            query: { \n              redirect: '/plans',\n              plan: selectedPlan.value.id\n            }\n          });\n          isProcessingPayment.value = false;\n          return;\n        }\n\n        // Check if registration and location details are complete\n        const hasCompletedRegistration = user.value.first_name && \n                                       user.value.last_name && \n                                       user.value.address &&\n                                       user.value.state &&\n                                       user.value.district &&\n                                       user.value.constituency;\n\n        if (!hasCompletedRegistration) {\n          console.log('Registration or location details incomplete, redirecting to profile update');\n          store.dispatch('showToast', {\n            message: 'Please complete your profile with all location details',\n            type: 'warning',\n            duration: 5000\n          });\n          router.push({\n            path: '/profile/update',\n            query: { \n              redirect: '/plans',\n              plan: selectedPlan.value.id\n            }\n          });\n          isProcessingPayment.value = false;\n          return;\n        }\n\n        // Set authorization header\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token.value}`;\n\n        // Show loading state\n        store.commit('setLoading', true);\n        \n        console.log('Creating order for plan:', selectedPlan.value);\n        \n        // Check for existing valid order\n        const hasValidOrder = checkAndCleanExpiredOrders(selectedPlan.value.id);\n        let orderData;\n        \n        if (hasValidOrder) {\n          // Use existing order\n          const existingOrder = JSON.parse(localStorage.getItem('payment_order'));\n          orderData = useExistingOrder(existingOrder);\n        } else {\n          // Create new order\n          orderData = await createNewOrder();\n        }\n\n        console.log('Order data:', orderData);\n\n        // Hide loading state\n        store.commit('setLoading', false);\n\n        if (!orderData || !orderData.key_id) {\n          throw new Error('Invalid order response from server');\n        }\n\n        try {\n          // Initialize Razorpay\n          const options = {\n            key: orderData.key_id,\n            amount: orderData.amount,\n            currency: orderData.currency,\n            name: 'No1 OTT',\n            description: `${selectedPlan.value.name} Subscription`,\n            order_id: orderData.order_id,\n            prefill: {\n              name: user.value?.first_name || '',\n              email: user.value?.email || '',\n              contact: user.value?.phone || ''\n            },\n            theme: {\n              color: '#c30059'\n            },\n            // Better UPI configuration to prevent app closing\n            config: {\n              display: {\n                blocks: {\n                  upi: {\n                    name: 'Pay using UPI',\n                    instruments: [\n                      { method: 'upi' }\n                    ]\n                  },\n                  card: {\n                    name: 'Credit/Debit Cards',\n                    instruments: [\n                      { method: 'card' }\n                    ]\n                  },\n                  netbanking: {\n                    name: 'Net Banking',\n                    instruments: [\n                      { method: 'netbanking' }\n                    ]\n                  }\n                },\n                sequence: ['upi', 'card', 'netbanking'],\n                preferences: {\n                  show_default_blocks: true\n                }\n              }\n            },\n            // Enhanced retry configuration\n            retry: {\n              enabled: true,\n              max_count: 3\n            },\n            // Better timeout handling\n            timeout: 300, // 5 minutes\n            // Handle modal close (when user cancels or app redirects)\n            modal: {\n              ondismiss: async function() {\n                console.log('Razorpay modal dismissed, starting payment status check');\n                // Start background checking for payment status\n                setTimeout(async () => {\n                  // Try to get payment data from localStorage if available\n                  const storedPayment = localStorage.getItem('pending_payment');\n                  if (storedPayment) {\n                    const paymentInfo = JSON.parse(storedPayment);\n                    await startPaymentStatusPolling(orderData.order_id, paymentInfo);\n                  } else {\n                    await startPaymentStatusPolling(orderData.order_id, null);\n                  }\n                }, 2000); // Wait 2 seconds before starting checks\n              },\n              // Handle escape and back button\n              escape: true,\n              backdropclose: false\n            },\n            // Handle different payment methods\n            method: {\n              upi: {\n                // Handle UPI flow completion\n                flow: 'intent' // Use intent-based flow for better UPI handling\n              }\n            },\n            handler: async (response) => {\n              // Now handle the payment success\n              try {\n                store.commit('setLoading', true);\n                console.log('=== PAYMENT SUCCESSFUL ===');\n                console.log('Payment response:', response);\n                \n                // Store payment details in localStorage for backup verification\n                const paymentData = {\n                  payment_id: response.razorpay_payment_id,\n                  order_id: response.razorpay_order_id,\n                  signature: response.razorpay_signature,\n                  plan_id: selectedPlan.value.id,\n                  phone: user.value.phone,\n                  timestamp: Date.now(),\n                  retry_count: 0,\n                  amount: selectedPlan.value.price,\n                  plan_name: selectedPlan.value.name\n                };\n                \n                console.log('Storing payment data in localStorage:', paymentData);\n                localStorage.setItem('pending_payment', JSON.stringify(paymentData));\n\n                // Try immediate verification\n                console.log('Attempting immediate payment verification...');\n                const verifyResponse = await axios.post('/users/verify-payment/', {\n                  razorpay_payment_id: response.razorpay_payment_id,\n                  razorpay_order_id: response.razorpay_order_id,\n                  razorpay_signature: response.razorpay_signature,\n                  plan_id: selectedPlan.value.id,\n                  phone: user.value.phone\n                });\n\n                console.log('Verification response:', verifyResponse.data);\n\n                if (verifyResponse.data.status === 'success') {\n                  // Clear pending payment from localStorage\n                  localStorage.removeItem('pending_payment');\n                  \n                  // Update user subscription in store\n                  store.commit('setSubscription', verifyResponse.data.subscription);\n                  store.dispatch('showToast', {\n                    message: 'Payment successful! Your subscription is now active.',\n                    type: 'success'\n                  });\n                  console.log('Payment verified successfully, redirecting to profile');\n                  router.push('/profile');\n                } else {\n                  throw new Error(verifyResponse.data.message || 'Payment verification failed');\n                }\n              } catch (error) {\n                console.error('=== PAYMENT VERIFICATION FAILED ===');\n                console.error('Error details:', error);\n                console.error('Error response:', error.response?.data);\n                \n                // Don't remove pending_payment from localStorage - let App.vue handle it\n                store.dispatch('showToast', {\n                  message: 'Payment successful! Please wait a moment for verification. You will be notified once your subscription is active.',\n                  type: 'warning'\n                });\n                console.log('Redirecting to profile, payment data stored for retry');\n                router.push('/profile');\n              } finally {\n                store.commit('setLoading', false);\n              }\n            },\n            webview_intent: true\n          };\n\n          // Create and open Razorpay\n          console.log('Opening Razorpay with options:', options);\n          const rzp = new window.Razorpay(options);\n          rzp.on('payment.failed', function (response) {\n            isProcessingPayment.value = false;\n            store.commit('setLoading', false);\n            alert(`Payment failed: ${response.error.description}`);\n          });\n          \n          rzp.open();\n          // Hide loader after a short delay to ensure Razorpay UI is visible\n          setTimeout(() => { isProcessingPayment.value = false; }, 1000);\n        } catch (error) {\n          console.error('Order creation failed:', error);\n          store.commit('setLoading', false);\n          \n          if (error.response) {\n            if (error.response.status === 401) {\n              // Clear invalid session and redirect to login\n              store.dispatch('logout');\n              router.push({\n                path: '/login',\n                query: { \n                  redirect: '/plans',\n                  plan: selectedPlan.value.id\n                }\n              });\n            } else {\n              alert(`Server error: ${error.response.data.message || 'Please try again later'}`);\n            }\n          } else if (error.request) {\n            alert('Network error. Please check your internet connection.');\n          } else {\n            alert('Unable to create order. Please try again.');\n          }\n        }\n      } catch (error) {\n        console.error('Payment gateway error:', error);\n        store.commit('setLoading', false);\n        alert('Something went wrong. Please try again.');\n      }\n    };\n\n    const validateCode = async () => {\n      try {\n        // Show loading state\n        store.commit('setLoading', true);\n        \n        // Basic validation\n        if (!subscriptionCode.value) {\n          codeError.value = 'Please enter a subscription code';\n          isValidCode.value = false;\n          return;\n        }\n\n        // Get user phone from store\n        const phone = store.getters.currentUser?.phone;\n        \n        if (!phone) {\n          store.dispatch('showToast', {\n            message: 'Please login to continue',\n            type: 'error'\n          });\n          router.push({\n            name: 'login',\n            query: { redirect: router.currentRoute.value.fullPath }\n          });\n          return;\n        }\n\n        // Call API to validate code\n        const response = await axios.post('/users/validate-coupon/', {\n          code: subscriptionCode.value,\n          phone: phone,\n          amount: selectedPlan.value.price,\n          plan_id: selectedPlan.value.id\n        });\n\n        if (response.data.status === 'success') {\n          isValidCode.value = true;\n          codeError.value = '';\n          store.dispatch('showToast', {\n            message: 'Code is valid! Click Activate to use it',\n            type: 'success'\n          });\n        } else {\n          isValidCode.value = false;\n          codeError.value = response.data.message || 'Invalid code';\n          store.dispatch('showToast', {\n            message: codeError.value,\n            type: 'error'\n          });\n        }\n      } catch (error) {\n        console.error('Code validation error:', error);\n        isValidCode.value = false;\n        codeError.value = error.response?.data?.message || 'Error validating code. Please try again.';\n        store.dispatch('showToast', {\n          message: codeError.value,\n          type: 'error'\n        });\n      } finally {\n        store.commit('setLoading', false);\n      }\n    };\n\n    const handleCodeSubmit = async () => {\n      if (!isValidCode.value) return;\n\n      try {\n        // Show loading state\n        store.commit('setLoading', true);\n        \n        // Get user from Vuex store\n        const user = store.getters.currentUser;\n        const phone = user?.phone || localStorage.getItem('phone');\n        \n        if (!phone) {\n          store.dispatch('showToast', {\n            message: 'Please login to continue',\n            type: 'error'\n          });\n          router.push({\n            name: 'login',\n            query: { redirect: router.currentRoute.value.fullPath }\n          });\n          store.commit('setLoading', false);\n          return;\n        }\n\n        // Check if registration and location details are complete (same as Pay Online)\n        const hasCompletedRegistration = user && user.first_name && \n                                         user.last_name && \n                                         user.address &&\n                                         user.state &&\n                                         user.district &&\n                                         user.constituency;\n\n        if (!hasCompletedRegistration) {\n          store.dispatch('showToast', {\n            message: 'Please complete your profile with all location details',\n            type: 'warning',\n            duration: 5000\n          });\n          router.push({\n            path: '/profile/update',\n            query: { \n              redirect: router.currentRoute.value.fullPath,\n              code: subscriptionCode.value\n            }\n          });\n          store.commit('setLoading', false);\n          return;\n        }\n        \n        // Call API to activate subscription\n        const response = await axios.post('/users/apply-coupon/', {\n          code: subscriptionCode.value,\n          phone: phone,\n          plan_id: selectedPlan.value.id\n        });\n\n        if (response.data.status === 'success') {\n          // Update user subscription in store\n          store.commit('setSubscription', response.data.subscription);\n          \n          // Show success message\n          store.dispatch('showToast', {\n            message: 'Subscription activated successfully!',\n            type: 'success'\n          });\n          \n          // Close code input dialog\n          showCodeInput.value = false;\n          \n          // Redirect to profile page\n          router.push('/profile');\n        } else {\n          throw new Error(response.data.message || 'Failed to activate subscription');\n        }\n      } catch (error) {\n        console.error('Code activation error:', error);\n        \n        // Show error message\n        store.dispatch('showToast', {\n          message: error.response?.data?.message || 'Error activating subscription. Please try again.',\n          type: 'error'\n        });\n\n        if (error.response?.status === 404) {\n          // User not found - redirect to login (same as Pay Online)\n          router.push({\n            path: '/login',\n            query: { \n              redirect: router.currentRoute.value.fullPath,\n              phone: localStorage.getItem('phone')\n            }\n          });\n        } else if (!localStorage.getItem('phone')) {\n          // Not logged in - redirect to login\n          router.push({\n            name: 'login',\n            query: { redirect: router.currentRoute.value.fullPath }\n          });\n        }\n      } finally {\n        store.commit('setLoading', false);\n      }\n    };\n\n    const fetchPlans = async () => {\n      isLoadingPlans.value = true;\n      try {\n        const response = await axios.get('/users/api/subscription-plans/');\n        plans.value = response.data.plans || [];\n        if (plans.value.length > 0) {\n          const popularPlan = plans.value.find(p => p.popular) || plans.value[0];\n          selectedPlan.value = popularPlan;\n        }\n      } catch (error) {\n        console.error('Failed to fetch plans:', error);\n        plans.value = [];\n        store.dispatch('showToast', {\n          message: 'Failed to refresh plans. Please try again later.',\n          type: 'error'\n        });\n      } finally {\n        isLoadingPlans.value = false;\n      }\n    };\n\n    const formatNumber = (num) => {\n      if (!isFinite(num)) return '0';\n      const rounded = Math.round((num + Number.EPSILON) * 100) / 100;\n      return Number.isInteger(rounded) ? String(rounded) : rounded.toFixed(2);\n    };\n\n    const getPerDay = (plan) => {\n      if (plan && plan.per_day_text) return plan.per_day_text.replace(/^\\s*₹?\\s*/, '');\n      if (!plan || !plan.price || !plan.duration) return '0';\n      const perDay = Number(plan.price) / Number(plan.duration);\n      return formatNumber(perDay);\n    };\n\n\n    return {\n      plans,\n      selectedPlan,\n      showCodeInput,\n      subscriptionCode,\n      codeError,\n      isValidCode,\n      isProcessingPayment,\n      handlePaymentGateway,\n      validateCode,\n      handleCodeSubmit,\n      selectPlan,\n      handlePlanSubscription,\n      checkAndCleanExpiredOrders, // Expose order cleanup method\n      fetchPlans, // Expose fetchPlans function\n      isLoadingPlans,\n      getPerDay\n    };\n  }\n}\n</script>\n\n<style scoped>\n.gradient-text {\n  background: linear-gradient(90deg, #c30059 0%, #7c1d44 100%);\n  -webkit-background-clip: text;\n  background-clip: text;\n  -webkit-text-fill-color: transparent;\n}\n\n/* Add these responsive styles */\n@media screen and (max-width: 1200px) {\n  .lg\\:grid-cols-4 {\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n  }\n}\n\n@media screen and (max-width: 1024px) {\n  .max-w-7xl {\n    max-width: 100%;\n  }\n  \n  .lg\\:grid-cols-4 {\n    grid-template-columns: repeat(2, minmax(0, 1fr));\n  }\n}\n\n@media screen and (max-width: 768px) {\n  .grid {\n    gap: 1rem;\n  }\n  \n  .px-4 {\n    padding-left: 1rem;\n    padding-right: 1rem;\n  }\n\n  /* Force single column on mobile */\n  .md\\:grid-cols-2,\n  .lg\\:grid-cols-4 {\n    grid-template-columns: 1fr;\n  }\n\n  /* Add padding for mobile nav */\n  .pb-32 {\n    padding-bottom: 8rem;\n  }\n}\n\n@media screen and (max-width: 640px) {\n  .grid {\n    grid-template-columns: 1fr;\n  }\n  \n  .overflow-x-auto {\n    -webkit-overflow-scrolling: touch;\n  }\n  \n  .text-2xl {\n    font-size: 1.5rem;\n  }\n  \n  .py-4 {\n    padding-top: 0.75rem;\n    padding-bottom: 0.75rem;\n  }\n  \n  .px-6 {\n    padding-left: 1rem;\n    padding-right: 1rem;\n  }\n\n  /* Add bottom padding to account for fixed button */\n  .pb-24 {\n    padding-bottom: 6rem;\n  }\n  \n  /* Scale down cards on mobile */\n  .scale-105 {\n    transform: scale(1.02);\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}