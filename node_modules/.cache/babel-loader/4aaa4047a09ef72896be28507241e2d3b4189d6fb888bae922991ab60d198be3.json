{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport { useStore } from 'vuex';\nimport { ref, computed, onMounted, watch } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nexport default {\n  name: 'SubscriptionPlans',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const showCodeInput = ref(false);\n    const subscriptionCode = ref('');\n    const codeError = ref('');\n    const isValidCode = ref(false);\n    const isProcessingPayment = ref(false);\n    const plans = ref([]);\n    const selectedPlan = ref(null);\n    const selectedPlanId = ref(null);\n\n    // Use computed properties from store\n    const isAuthenticated = computed(() => store.getters.isAuthenticated);\n    const user = computed(() => store.getters.currentUser);\n    const token = computed(() => store.getters.token);\n\n    // Fetch plans from backend on mount\n    onMounted(async () => {\n      try {\n        const response = await axios.get('/users/subscription-plans/');\n        plans.value = response.data.plans;\n        if (plans.value.length > 0) {\n          selectedPlan.value = plans.value[0];\n          selectedPlanId.value = plans.value[0].id;\n        }\n      } catch (error) {\n        console.error('Failed to fetch plans:', error);\n      }\n      store.dispatch('initializeStore');\n\n      // Check for plan in URL\n      const urlParams = new URLSearchParams(window.location.search);\n      const planType = urlParams.get('plan');\n      if (planType && plans.value.length > 0) {\n        const plan = plans.value.find(p => p.id === planType);\n        if (plan) {\n          selectedPlan.value = plan;\n          selectedPlanId.value = plan.id;\n        }\n      }\n\n      // Check and clean expired orders on page load\n      checkAndCleanExpiredOrders();\n    });\n\n    // Watch for plan selector change\n    const onPlanChange = () => {\n      const plan = plans.value.find(p => p.id === selectedPlanId.value);\n      if (plan) {\n        selectedPlan.value = plan;\n      }\n    };\n    watch(selectedPlanId, onPlanChange);\n\n    // Check for expired orders and clean up\n    const checkAndCleanExpiredOrders = () => {\n      const paymentOrder = localStorage.getItem('payment_order');\n      if (paymentOrder) {\n        try {\n          const orderData = JSON.parse(paymentOrder);\n          const orderTime = orderData.created_at;\n          const currentTime = Date.now();\n          const timeDiff = currentTime - orderTime;\n\n          // If order is older than 30 minutes, remove it\n          if (timeDiff > 30 * 60 * 1000) {\n            // 30 minutes\n            localStorage.removeItem('payment_order');\n            console.log('Expired payment order removed');\n            return false;\n          }\n          return true;\n        } catch (error) {\n          localStorage.removeItem('payment_order');\n          return false;\n        }\n      }\n      return false;\n    };\n\n    // Create new order function\n    const createNewOrder = async () => {\n      try {\n        const orderResponse = await axios.post('/api/payment/create-order/', {\n          amount: selectedPlan.value.price,\n          currency: 'INR',\n          plan_id: selectedPlan.value.id,\n          phone: user.value.phone\n        });\n        console.log('New order created:', orderResponse.data);\n        if (!orderResponse.data || !orderResponse.data.key_id) {\n          throw new Error('Invalid order response from server');\n        }\n\n        // Store new order in localStorage with timestamp\n        const orderData = {\n          ...orderResponse.data,\n          created_at: Date.now(),\n          plan_id: selectedPlan.value.id,\n          phone: user.value.phone\n        };\n        localStorage.setItem('payment_order', JSON.stringify(orderData));\n        return orderData;\n      } catch (error) {\n        console.error('Error creating new order:', error);\n        throw error;\n      }\n    };\n\n    // Use existing order function\n    const useExistingOrder = orderData => {\n      console.log('Using existing order:', orderData.order_id);\n      return orderData;\n    };\n    const handlePaymentGateway = async () => {\n      isProcessingPayment.value = true;\n      try {\n        console.log('Payment gateway initiated');\n        console.log('Auth status:', isAuthenticated.value);\n        console.log('User:', user.value);\n        console.log('Token:', token.value);\n\n        // Check authentication and token\n        if (!isAuthenticated.value || !user.value || !token.value) {\n          console.log('User not authenticated or missing token, redirecting to login');\n          router.push({\n            path: '/login',\n            query: {\n              redirect: '/plans',\n              plan: selectedPlan.value.id\n            }\n          });\n          isProcessingPayment.value = false;\n          return;\n        }\n\n        // Check if registration and location details are complete\n        const hasCompletedRegistration = user.value.first_name && user.value.last_name && user.value.address && user.value.state && user.value.district && user.value.constituency;\n        if (!hasCompletedRegistration) {\n          console.log('Registration or location details incomplete, redirecting to profile update');\n          store.dispatch('showToast', {\n            message: 'Please complete your profile with all location details',\n            type: 'warning',\n            duration: 5000\n          });\n          router.push({\n            path: '/profile/update',\n            query: {\n              redirect: '/plans',\n              plan: selectedPlan.value.id\n            }\n          });\n          isProcessingPayment.value = false;\n          return;\n        }\n\n        // Set authorization header\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token.value}`;\n\n        // Show loading state\n        store.commit('setLoading', true);\n        console.log('Creating order for plan:', selectedPlan.value);\n\n        // Check for existing valid order\n        const hasValidOrder = checkAndCleanExpiredOrders();\n        let orderData;\n        if (hasValidOrder) {\n          // Use existing order\n          const existingOrder = JSON.parse(localStorage.getItem('payment_order'));\n          orderData = useExistingOrder(existingOrder);\n        } else {\n          // Create new order\n          orderData = await createNewOrder();\n        }\n        console.log('Order data:', orderData);\n\n        // Hide loading state\n        store.commit('setLoading', false);\n        if (!orderData || !orderData.key_id) {\n          throw new Error('Invalid order response from server');\n        }\n        try {\n          // Initialize Razorpay\n          const options = {\n            key: orderData.key_id,\n            amount: orderData.amount,\n            currency: orderData.currency,\n            name: 'No1 OTT',\n            description: `${selectedPlan.value.name} Subscription`,\n            order_id: orderData.order_id,\n            prefill: {\n              name: user.value?.first_name || '',\n              email: user.value?.email || '',\n              contact: user.value?.phone || ''\n            },\n            theme: {\n              color: '#c30059'\n            },\n            handler: async response => {\n              try {\n                store.commit('setLoading', true);\n                console.log('=== PAYMENT SUCCESSFUL ===');\n                console.log('Payment response:', response);\n\n                // Store payment details in localStorage for backup verification\n                const paymentData = {\n                  payment_id: response.razorpay_payment_id,\n                  order_id: response.razorpay_order_id,\n                  signature: response.razorpay_signature,\n                  plan_id: selectedPlan.value.id,\n                  phone: user.value.phone,\n                  timestamp: Date.now(),\n                  retry_count: 0,\n                  amount: selectedPlan.value.price,\n                  plan_name: selectedPlan.value.name\n                };\n                console.log('Storing payment data in localStorage:', paymentData);\n                localStorage.setItem('pending_payment', JSON.stringify(paymentData));\n\n                // Try immediate verification\n                console.log('Attempting immediate payment verification...');\n                const verifyResponse = await axios.post('/users/verify-payment/', {\n                  razorpay_payment_id: response.razorpay_payment_id,\n                  razorpay_order_id: response.razorpay_order_id,\n                  razorpay_signature: response.razorpay_signature,\n                  plan_id: selectedPlan.value.id,\n                  phone: user.value.phone\n                });\n                console.log('Verification response:', verifyResponse.data);\n                if (verifyResponse.data.status === 'success') {\n                  // Clear pending payment from localStorage\n                  localStorage.removeItem('pending_payment');\n\n                  // Update user subscription in store\n                  store.commit('setSubscription', verifyResponse.data.subscription);\n                  store.dispatch('showToast', {\n                    message: 'Payment successful! Your subscription is now active.',\n                    type: 'success'\n                  });\n                  console.log('Payment verified successfully, redirecting to profile');\n                  router.push('/profile');\n                } else {\n                  throw new Error(verifyResponse.data.message || 'Payment verification failed');\n                }\n              } catch (error) {\n                console.error('=== PAYMENT VERIFICATION FAILED ===');\n                console.error('Error details:', error);\n                console.error('Error response:', error.response?.data);\n\n                // Don't remove pending_payment from localStorage - let App.vue handle it\n                store.dispatch('showToast', {\n                  message: 'Payment successful! Please wait a moment for verification. You will be notified once your subscription is active.',\n                  type: 'warning'\n                });\n                console.log('Redirecting to profile, payment data stored for retry');\n                router.push('/profile');\n              } finally {\n                store.commit('setLoading', false);\n              }\n            },\n            webview_intent: true\n          };\n\n          // Create and open Razorpay\n          console.log('Opening Razorpay with options:', options);\n          const rzp = new window.Razorpay(options);\n          rzp.on('payment.failed', function (response) {\n            isProcessingPayment.value = false;\n            store.commit('setLoading', false);\n            alert(`Payment failed: ${response.error.description}`);\n          });\n          rzp.open();\n          // Hide loader after a short delay to ensure Razorpay UI is visible\n          setTimeout(() => {\n            isProcessingPayment.value = false;\n          }, 1000);\n        } catch (error) {\n          console.error('Order creation failed:', error);\n          store.commit('setLoading', false);\n          if (error.response) {\n            if (error.response.status === 401) {\n              // Clear invalid session and redirect to login\n              store.dispatch('logout');\n              router.push({\n                path: '/login',\n                query: {\n                  redirect: '/plans',\n                  plan: selectedPlan.value.id\n                }\n              });\n            } else {\n              alert(`Server error: ${error.response.data.message || 'Please try again later'}`);\n            }\n          } else if (error.request) {\n            alert('Network error. Please check your internet connection.');\n          } else {\n            alert('Unable to create order. Please try again.');\n          }\n        }\n      } catch (error) {\n        console.error('Payment gateway error:', error);\n        store.commit('setLoading', false);\n        alert('Something went wrong. Please try again.');\n      }\n    };\n    const validateCode = async () => {\n      try {\n        // Show loading state\n        store.commit('setLoading', true);\n\n        // Basic validation\n        if (!subscriptionCode.value) {\n          codeError.value = 'Please enter a subscription code';\n          isValidCode.value = false;\n          return;\n        }\n\n        // Get user phone from store\n        const phone = store.getters.currentUser?.phone;\n        if (!phone) {\n          store.dispatch('showToast', {\n            message: 'Please login to continue',\n            type: 'error'\n          });\n          router.push({\n            name: 'login',\n            query: {\n              redirect: router.currentRoute.value.fullPath\n            }\n          });\n          return;\n        }\n\n        // Call API to validate code\n        const response = await axios.post('/users/validate-coupon/', {\n          code: subscriptionCode.value,\n          phone: phone,\n          amount: selectedPlan.value.price,\n          plan_id: selectedPlan.value.id\n        });\n        if (response.data.status === 'success') {\n          isValidCode.value = true;\n          codeError.value = '';\n          store.dispatch('showToast', {\n            message: 'Code is valid! Click Activate to use it',\n            type: 'success'\n          });\n        } else {\n          isValidCode.value = false;\n          codeError.value = response.data.message || 'Invalid code';\n          store.dispatch('showToast', {\n            message: codeError.value,\n            type: 'error'\n          });\n        }\n      } catch (error) {\n        console.error('Code validation error:', error);\n        isValidCode.value = false;\n        codeError.value = error.response?.data?.message || 'Error validating code. Please try again.';\n        store.dispatch('showToast', {\n          message: codeError.value,\n          type: 'error'\n        });\n      } finally {\n        store.commit('setLoading', false);\n      }\n    };\n    const handleCodeSubmit = async () => {\n      if (!isValidCode.value) return;\n      try {\n        // Show loading state\n        store.commit('setLoading', true);\n\n        // Get user from Vuex store\n        const user = store.getters.currentUser;\n        const phone = user?.phone || localStorage.getItem('phone');\n        if (!phone) {\n          store.dispatch('showToast', {\n            message: 'Please login to continue',\n            type: 'error'\n          });\n          router.push({\n            name: 'login',\n            query: {\n              redirect: router.currentRoute.value.fullPath\n            }\n          });\n          store.commit('setLoading', false);\n          return;\n        }\n\n        // Check if registration and location details are complete (same as Pay Online)\n        const hasCompletedRegistration = user && user.first_name && user.last_name && user.address && user.state && user.district && user.constituency;\n        if (!hasCompletedRegistration) {\n          store.dispatch('showToast', {\n            message: 'Please complete your profile with all location details',\n            type: 'warning',\n            duration: 5000\n          });\n          router.push({\n            path: '/profile/update',\n            query: {\n              redirect: router.currentRoute.value.fullPath,\n              code: subscriptionCode.value\n            }\n          });\n          store.commit('setLoading', false);\n          return;\n        }\n\n        // Call API to activate subscription\n        const response = await axios.post('/users/apply-coupon-subscription/', {\n          code: subscriptionCode.value,\n          phone: phone,\n          plan_id: selectedPlan.value.id\n        });\n        if (response.data.status === 'success') {\n          // Update user subscription in store\n          store.commit('setSubscription', response.data.subscription);\n\n          // Show success message\n          store.dispatch('showToast', {\n            message: 'Subscription activated successfully!',\n            type: 'success'\n          });\n\n          // Close code input dialog\n          showCodeInput.value = false;\n\n          // Redirect to profile page\n          router.push('/profile');\n        } else {\n          throw new Error(response.data.message || 'Failed to activate subscription');\n        }\n      } catch (error) {\n        console.error('Code activation error:', error);\n\n        // Show error message\n        store.dispatch('showToast', {\n          message: error.response?.data?.message || 'Error activating subscription. Please try again.',\n          type: 'error'\n        });\n        if (error.response?.status === 404) {\n          // User not found - redirect to login (same as Pay Online)\n          router.push({\n            path: '/login',\n            query: {\n              redirect: router.currentRoute.value.fullPath,\n              phone: localStorage.getItem('phone')\n            }\n          });\n        } else if (!localStorage.getItem('phone')) {\n          // Not logged in - redirect to login\n          router.push({\n            name: 'login',\n            query: {\n              redirect: router.currentRoute.value.fullPath\n            }\n          });\n        }\n      } finally {\n        store.commit('setLoading', false);\n      }\n    };\n    return {\n      plans,\n      selectedPlan,\n      selectedPlanId,\n      showCodeInput,\n      subscriptionCode,\n      codeError,\n      isValidCode,\n      isProcessingPayment,\n      handlePaymentGateway,\n      validateCode,\n      handleCodeSubmit,\n      onPlanChange,\n      checkAndCleanExpiredOrders // Expose order cleanup method\n    };\n  }\n};","map":{"version":3,"names":["useStore","ref","computed","onMounted","watch","useRouter","axios","name","setup","store","router","showCodeInput","subscriptionCode","codeError","isValidCode","isProcessingPayment","plans","selectedPlan","selectedPlanId","isAuthenticated","getters","user","currentUser","token","response","get","value","data","length","id","error","console","dispatch","urlParams","URLSearchParams","window","location","search","planType","plan","find","p","checkAndCleanExpiredOrders","onPlanChange","paymentOrder","localStorage","getItem","orderData","JSON","parse","orderTime","created_at","currentTime","Date","now","timeDiff","removeItem","log","createNewOrder","orderResponse","post","amount","price","currency","plan_id","phone","key_id","Error","setItem","stringify","useExistingOrder","order_id","handlePaymentGateway","push","path","query","redirect","hasCompletedRegistration","first_name","last_name","address","state","district","constituency","message","type","duration","defaults","headers","common","commit","hasValidOrder","existingOrder","options","key","description","prefill","email","contact","theme","color","handler","paymentData","payment_id","razorpay_payment_id","razorpay_order_id","signature","razorpay_signature","timestamp","retry_count","plan_name","verifyResponse","status","subscription","webview_intent","rzp","Razorpay","on","alert","open","setTimeout","request","validateCode","currentRoute","fullPath","code","handleCodeSubmit"],"sources":["D:\\OTT\\ott_frontend\\src\\views\\SubscriptionPlans.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-[#121212] text-white\">\n    <!-- Fullscreen Spinner Overlay -->\n    <div v-if=\"isProcessingPayment\" class=\"fixed inset-0 z-50 flex flex-col items-center justify-center bg-black/70\">\n      <i class=\"fas fa-spinner fa-spin text-5xl text-[#c30059] mb-4\"></i>\n      <div class=\"text-lg font-semibold text-white\">Processing Payment...</div>\n      <!-- Payment Warning Message -->\n      <div class=\"mt-6 p-4 bg-yellow-500/20 border border-yellow-500/40 rounded-lg max-w-md text-center\">\n        <div class=\"flex items-center justify-center gap-2 mb-2\">\n          <i class=\"fas fa-exclamation-triangle text-yellow-400\"></i>\n          <span class=\"font-semibold text-yellow-400\">Important!</span>\n        </div>\n        <p class=\"text-sm text-yellow-300\">\n          <strong>Don't close this website</strong> while payment is being processed. \n          Your subscription will be activated automatically once payment is complete.\n        </p>\n      </div>\n    </div>\n\n\n\n    <!-- Back Navigation -->\n    <div class=\"px-4 py-6 flex justify-between items-center\">\n      <router-link to=\"/\" class=\"flex items-center gap-2 text-white/80 hover:text-white\">\n        <i class=\"fas fa-arrow-left\"></i>\n        <span>Choose a Plan</span>\n      </router-link>\n    </div>\n\n    <!-- Plan Selector (if multiple plans) -->\n    <div v-if=\"plans.length > 1\" class=\"flex justify-center mb-8\">\n      <select v-model=\"selectedPlanId\" @change=\"onPlanChange\" class=\"bg-[#1d1d1d] border border-[#c30059]/40 text-white rounded-lg px-4 py-2\">\n        <option v-for=\"plan in plans\" :key=\"plan.id\" :value=\"plan.id\">{{ plan.name }}</option>\n      </select>\n    </div>\n\n    <!-- Single Centered Plan Card -->\n    <div class=\"max-w-md mx-auto mb-24 sm:mb-0\">\n      <div class=\"bg-[#1d1d1d] rounded-2xl overflow-hidden border border-[#c30059]/20 hover:border-[#c30059]/40 transition-all\">\n        <div class=\"p-6\">\n          <div class=\"flex items-center gap-3 mb-4\">\n            <div class=\"w-12 h-12 rounded-full bg-gradient-to-r from-[#c30059] to-[#7c1d44] flex items-center justify-center\">\n              <i class=\"fas fa-calendar-check text-2xl text-white\"></i>\n            </div>\n            <div>\n              <h3 class=\"text-2xl font-bold\">{{ selectedPlan?.name }}</h3>\n              <p class=\"text-sm text-white/60\">{{ selectedPlan?.description }}</p>\n            </div>\n          </div>\n          <!-- Price Section with Special Highlight -->\n          <div class=\"bg-[#c30059]/10 rounded-lg p-4 mb-6\">\n            <div class=\"flex items-baseline gap-2\">\n              <span class=\"text-3xl font-bold text-[#c30059]\">₹{{ selectedPlan?.price }}</span>\n              <span class=\"text-sm text-[#c30059]\">/{{ selectedPlan?.duration }} days</span>\n            </div>\n            <p class=\"text-sm text-white/60 mt-1\">Just ₹{{ selectedPlan ? (selectedPlan.price / selectedPlan.duration).toFixed(2) : '0.00' }} per day</p>\n          </div>\n          <!-- Features List -->\n          <div class=\"space-y-4 mb-6\">\n            <div class=\"flex items-start gap-3\">\n              <i class=\"fas fa-tv text-[#c30059] mt-1\"></i>\n              <div>\n                <p class=\"font-medium\">Watch on 2 Devices</p>\n                <p class=\"text-sm text-white/60\">Stream on TV & Mobile</p>\n              </div>\n            </div>\n            <div class=\"flex items-start gap-3\">\n              <i class=\"fas fa-fire text-[#c30059] mt-1\"></i>\n              <div>\n                <p class=\"font-medium\">Trending Videos</p>\n                <p class=\"text-sm text-white/60\">Latest & Popular Content</p>\n              </div>\n            </div>\n            <div class=\"flex items-start gap-3\">\n              <i class=\"fas fa-star text-[#c30059] mt-1\"></i>\n              <div>\n                <p class=\"font-medium\">Popular Shows</p>\n                <p class=\"text-sm text-white/60\">Binge-worthy Series</p>\n              </div>\n            </div>\n            <div class=\"flex items-start gap-3\">\n              <i class=\"fas fa-film text-[#c30059] mt-1\"></i>\n              <div>\n                <p class=\"font-medium\">No.1 Originals</p>\n                <p class=\"text-sm text-white/60\">Exclusive Content</p>\n              </div>\n            </div>\n          </div>\n          <!-- Payment Options Section -->\n          <div class=\"mt-6 border-t border-white/10 pt-6\">\n            <h4 class=\"text-lg font-semibold mb-4\">Select Payment Method</h4>\n            <div class=\"grid grid-cols-1 gap-4\">\n              <button \n                @click=\"handlePaymentGateway\"\n                :disabled=\"isProcessingPayment\"\n                class=\"bg-[#1a1a1a] p-4 rounded-lg border border-white/10 hover:border-[#c30059] transition-colors flex items-center justify-between group\"\n              >\n                <div class=\"flex items-center gap-3\">\n                  <div class=\"w-10 h-10 rounded-full bg-[#c30059]/10 flex items-center justify-center group-hover:bg-[#c30059]/20\">\n                    <i class=\"fas fa-credit-card text-[#c30059]\" v-if=\"!isProcessingPayment\"></i>\n                    <i class=\"fas fa-spinner fa-spin text-[#c30059]\" v-else></i>\n                  </div>\n                  <div class=\"text-left\">\n                    <p class=\"font-medium\">\n                      <span v-if=\"isProcessingPayment\">Processing...</span>\n                      <span v-else>Pay Online</span>\n                    </p>\n                    <p class=\"text-sm text-white/60\">Credit/Debit Card, UPI, Net Banking</p>\n                  </div>\n                </div>\n                <i class=\"fas fa-chevron-right text-white/40 group-hover:text-[#c30059]\" v-if=\"!isProcessingPayment\"></i>\n              </button>\n              <button \n                @click=\"showCodeInput = true\"\n                class=\"bg-[#1a1a1a] p-4 rounded-lg border border-white/10 hover:border-[#c30059] transition-colors flex items-center justify-between group\"\n              >\n                <div class=\"flex items-center gap-3\">\n                  <div class=\"w-10 h-10 rounded-full bg-[#c30059]/10 flex items-center justify-center group-hover:bg-[#c30059]/20\">\n                    <i class=\"fas fa-ticket-alt text-[#c30059]\"></i>\n                  </div>\n                  <div class=\"text-left\">\n                    <p class=\"font-medium\">Use Subscription Code</p>\n                    <p class=\"text-sm text-white/60\">Redeem subscription code</p>\n                  </div>\n                </div>\n                <i class=\"fas fa-chevron-right text-white/40 group-hover:text-[#c30059]\"></i>\n              </button>\n            </div>\n          </div>\n          <!-- Code Input Dialog -->\n          <div v-if=\"showCodeInput\" class=\"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50\">\n            <div class=\"bg-[#1d1d1d] rounded-xl w-full max-w-md p-6\">\n              <div class=\"flex justify-between items-center mb-6\">\n                <h3 class=\"text-xl font-bold\">Enter Subscription Code</h3>\n                <button @click=\"showCodeInput = false\" class=\"text-white/60 hover:text-white\">\n                  <i class=\"fas fa-times\"></i>\n                </button>\n              </div>\n              <div class=\"space-y-4\">\n                <div>\n                  <label class=\"block text-sm text-white/60 mb-2\">Subscription Code</label>\n                  <input \n                    v-model=\"subscriptionCode\"\n                    type=\"text\"\n                    class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors uppercase\"\n                    placeholder=\"Enter your code here\"\n                    @input=\"validateCode\"\n                  />\n                  <p v-if=\"codeError\" class=\"mt-2 text-sm text-red-500\">{{ codeError }}</p>\n                </div>\n                <button \n                  @click=\"handleCodeSubmit\"\n                  :disabled=\"!isValidCode\"\n                  class=\"w-full py-3 px-6 bg-gradient-to-r from-[#c30059] to-[#7c1d44] text-white font-bold rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Activate Subscription\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- FAQ Section (unchanged) -->\n    <div class=\"mt-16 mb-24 md:mb-8\">\n      <h2 class=\"text-2xl font-bold mb-8 text-center\">Frequently Asked Questions</h2>\n      <div class=\"max-w-3xl mx-auto space-y-4 pb-20 md:pb-0\">\n        <div class=\"bg-[#1d1d1d] rounded-lg p-4\">\n          <button class=\"flex items-center justify-between w-full text-left\">\n            <span class=\"font-semibold\">What payment methods do you accept?</span>\n            <i class=\"fas fa-chevron-down text-[#c30059]\"></i>\n          </button>\n        </div>\n        <div class=\"bg-[#1d1d1d] rounded-lg p-4\">\n          <button class=\"flex items-center justify-between w-full text-left\">\n            <span class=\"font-semibold\">Can I cancel my subscription anytime?</span>\n            <i class=\"fas fa-chevron-down text-[#c30059]\"></i>\n          </button>\n        </div>\n        <div class=\"bg-[#1d1d1d] rounded-lg p-4\">\n          <button class=\"flex items-center justify-between w-full text-left\">\n            <span class=\"font-semibold\">How many devices can I watch on simultaneously?</span>\n            <i class=\"fas fa-chevron-down text-[#c30059]\"></i>\n          </button>\n        </div>\n      </div>\n    </div>\n    <!-- Mobile Fixed Bottom Bar -->\n    <div v-if=\"selectedPlan\" class=\"fixed bottom-0 left-0 right-0 p-4 bg-[#121212]/95 backdrop-blur-md border-t border-white/10 md:hidden z-50 mb-[72px]\">\n      <div class=\"flex items-center justify-between mb-2\">\n        <div>\n          <p class=\"text-sm text-white/60\">Selected Plan</p>\n          <p class=\"font-bold text-[#c30059]\">{{ selectedPlan.name }}</p>\n        </div>\n        <div class=\"text-right\">\n          <p class=\"text-sm text-white/60\">Total Amount</p>\n          <p class=\"font-bold text-[#c30059]\">₹{{ selectedPlan.price }}</p>\n        </div>\n      </div>\n      <div class=\"grid grid-cols-2 gap-2\">\n        <button \n          @click=\"handlePaymentGateway\"\n          :disabled=\"isProcessingPayment\"\n          class=\"py-3 px-4 bg-gradient-to-r from-[#c30059] to-[#7c1d44] text-white font-bold rounded-lg hover:opacity-90 transition-opacity flex items-center justify-center gap-2\"\n        >\n          <i class=\"fas fa-credit-card\" v-if=\"!isProcessingPayment\"></i>\n          <i class=\"fas fa-spinner fa-spin\" v-else></i>\n          <span v-if=\"isProcessingPayment\">Processing...</span>\n          <span v-else>Pay Online</span>\n        </button>\n        <button \n          @click=\"showCodeInput = true\"\n          class=\"py-3 px-4 bg-[#1a1a1a] text-white font-bold rounded-lg hover:bg-[#252525] transition-colors flex items-center justify-center gap-2 border border-white/10\"\n        >\n          <i class=\"fas fa-ticket-alt\"></i>\n          <span>Use Subscription Code</span>\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { useStore } from 'vuex';\nimport { ref, computed, onMounted, watch } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\n\nexport default {\n  name: 'SubscriptionPlans',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const showCodeInput = ref(false);\n    const subscriptionCode = ref('');\n    const codeError = ref('');\n    const isValidCode = ref(false);\n    const isProcessingPayment = ref(false);\n\n    const plans = ref([]);\n    const selectedPlan = ref(null);\n    const selectedPlanId = ref(null);\n\n    // Use computed properties from store\n    const isAuthenticated = computed(() => store.getters.isAuthenticated);\n    const user = computed(() => store.getters.currentUser);\n    const token = computed(() => store.getters.token);\n\n    // Fetch plans from backend on mount\n    onMounted(async () => {\n      try {\n        const response = await axios.get('/users/subscription-plans/');\n        plans.value = response.data.plans;\n        if (plans.value.length > 0) {\n          selectedPlan.value = plans.value[0];\n          selectedPlanId.value = plans.value[0].id;\n        }\n      } catch (error) {\n        console.error('Failed to fetch plans:', error);\n      }\n      store.dispatch('initializeStore');\n      \n      // Check for plan in URL\n      const urlParams = new URLSearchParams(window.location.search);\n      const planType = urlParams.get('plan');\n      if (planType && plans.value.length > 0) {\n        const plan = plans.value.find(p => p.id === planType);\n        if (plan) {\n          selectedPlan.value = plan;\n          selectedPlanId.value = plan.id;\n        }\n      }\n      \n      // Check and clean expired orders on page load\n      checkAndCleanExpiredOrders();\n    });\n\n    // Watch for plan selector change\n    const onPlanChange = () => {\n      const plan = plans.value.find(p => p.id === selectedPlanId.value);\n      if (plan) {\n        selectedPlan.value = plan;\n      }\n    };\n\n    watch(selectedPlanId, onPlanChange);\n\n    // Check for expired orders and clean up\n    const checkAndCleanExpiredOrders = () => {\n      const paymentOrder = localStorage.getItem('payment_order');\n      if (paymentOrder) {\n        try {\n          const orderData = JSON.parse(paymentOrder);\n          const orderTime = orderData.created_at;\n          const currentTime = Date.now();\n          const timeDiff = currentTime - orderTime;\n          \n          // If order is older than 30 minutes, remove it\n          if (timeDiff > 30 * 60 * 1000) { // 30 minutes\n            localStorage.removeItem('payment_order');\n            console.log('Expired payment order removed');\n            return false;\n          }\n          return true;\n        } catch (error) {\n          localStorage.removeItem('payment_order');\n          return false;\n        }\n      }\n      return false;\n    };\n\n    // Create new order function\n    const createNewOrder = async () => {\n      try {\n        const orderResponse = await axios.post('/api/payment/create-order/', {\n          amount: selectedPlan.value.price,\n          currency: 'INR',\n          plan_id: selectedPlan.value.id,\n          phone: user.value.phone\n        });\n\n        console.log('New order created:', orderResponse.data);\n\n        if (!orderResponse.data || !orderResponse.data.key_id) {\n          throw new Error('Invalid order response from server');\n        }\n\n        // Store new order in localStorage with timestamp\n        const orderData = {\n          ...orderResponse.data,\n          created_at: Date.now(),\n          plan_id: selectedPlan.value.id,\n          phone: user.value.phone\n        };\n        localStorage.setItem('payment_order', JSON.stringify(orderData));\n\n        return orderData;\n      } catch (error) {\n        console.error('Error creating new order:', error);\n        throw error;\n      }\n    };\n\n    // Use existing order function\n    const useExistingOrder = (orderData) => {\n      console.log('Using existing order:', orderData.order_id);\n      return orderData;\n    };\n\n    const handlePaymentGateway = async () => {\n      isProcessingPayment.value = true;\n      try {\n        console.log('Payment gateway initiated');\n        console.log('Auth status:', isAuthenticated.value);\n        console.log('User:', user.value);\n        console.log('Token:', token.value);\n\n        // Check authentication and token\n        if (!isAuthenticated.value || !user.value || !token.value) {\n          console.log('User not authenticated or missing token, redirecting to login');\n          router.push({\n            path: '/login',\n            query: { \n              redirect: '/plans',\n              plan: selectedPlan.value.id\n            }\n          });\n          isProcessingPayment.value = false;\n          return;\n        }\n\n        // Check if registration and location details are complete\n        const hasCompletedRegistration = user.value.first_name && \n                                       user.value.last_name && \n                                       user.value.address &&\n                                       user.value.state &&\n                                       user.value.district &&\n                                       user.value.constituency;\n\n        if (!hasCompletedRegistration) {\n          console.log('Registration or location details incomplete, redirecting to profile update');\n          store.dispatch('showToast', {\n            message: 'Please complete your profile with all location details',\n            type: 'warning',\n            duration: 5000\n          });\n          router.push({\n            path: '/profile/update',\n            query: { \n              redirect: '/plans',\n              plan: selectedPlan.value.id\n            }\n          });\n          isProcessingPayment.value = false;\n          return;\n        }\n\n        // Set authorization header\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token.value}`;\n\n        // Show loading state\n        store.commit('setLoading', true);\n        \n        console.log('Creating order for plan:', selectedPlan.value);\n        \n        // Check for existing valid order\n        const hasValidOrder = checkAndCleanExpiredOrders();\n        let orderData;\n        \n        if (hasValidOrder) {\n          // Use existing order\n          const existingOrder = JSON.parse(localStorage.getItem('payment_order'));\n          orderData = useExistingOrder(existingOrder);\n        } else {\n          // Create new order\n          orderData = await createNewOrder();\n        }\n\n        console.log('Order data:', orderData);\n\n        // Hide loading state\n        store.commit('setLoading', false);\n\n        if (!orderData || !orderData.key_id) {\n          throw new Error('Invalid order response from server');\n        }\n\n        try {\n          // Initialize Razorpay\n          const options = {\n            key: orderData.key_id,\n            amount: orderData.amount,\n            currency: orderData.currency,\n            name: 'No1 OTT',\n            description: `${selectedPlan.value.name} Subscription`,\n            order_id: orderData.order_id,\n            prefill: {\n              name: user.value?.first_name || '',\n              email: user.value?.email || '',\n              contact: user.value?.phone || ''\n            },\n            theme: {\n              color: '#c30059'\n            },\n            handler: async (response) => {\n              try {\n                store.commit('setLoading', true);\n                console.log('=== PAYMENT SUCCESSFUL ===');\n                console.log('Payment response:', response);\n                \n                // Store payment details in localStorage for backup verification\n                const paymentData = {\n                  payment_id: response.razorpay_payment_id,\n                  order_id: response.razorpay_order_id,\n                  signature: response.razorpay_signature,\n                  plan_id: selectedPlan.value.id,\n                  phone: user.value.phone,\n                  timestamp: Date.now(),\n                  retry_count: 0,\n                  amount: selectedPlan.value.price,\n                  plan_name: selectedPlan.value.name\n                };\n                \n                console.log('Storing payment data in localStorage:', paymentData);\n                localStorage.setItem('pending_payment', JSON.stringify(paymentData));\n\n                // Try immediate verification\n                console.log('Attempting immediate payment verification...');\n                const verifyResponse = await axios.post('/users/verify-payment/', {\n                  razorpay_payment_id: response.razorpay_payment_id,\n                  razorpay_order_id: response.razorpay_order_id,\n                  razorpay_signature: response.razorpay_signature,\n                  plan_id: selectedPlan.value.id,\n                  phone: user.value.phone\n                });\n\n                console.log('Verification response:', verifyResponse.data);\n\n                if (verifyResponse.data.status === 'success') {\n                  // Clear pending payment from localStorage\n                  localStorage.removeItem('pending_payment');\n                  \n                  // Update user subscription in store\n                  store.commit('setSubscription', verifyResponse.data.subscription);\n                  store.dispatch('showToast', {\n                    message: 'Payment successful! Your subscription is now active.',\n                    type: 'success'\n                  });\n                  console.log('Payment verified successfully, redirecting to profile');\n                  router.push('/profile');\n                } else {\n                  throw new Error(verifyResponse.data.message || 'Payment verification failed');\n                }\n              } catch (error) {\n                console.error('=== PAYMENT VERIFICATION FAILED ===');\n                console.error('Error details:', error);\n                console.error('Error response:', error.response?.data);\n                \n                // Don't remove pending_payment from localStorage - let App.vue handle it\n                store.dispatch('showToast', {\n                  message: 'Payment successful! Please wait a moment for verification. You will be notified once your subscription is active.',\n                  type: 'warning'\n                });\n                console.log('Redirecting to profile, payment data stored for retry');\n                router.push('/profile');\n              } finally {\n                store.commit('setLoading', false);\n              }\n            },\n            webview_intent: true\n          };\n\n          // Create and open Razorpay\n          console.log('Opening Razorpay with options:', options);\n          const rzp = new window.Razorpay(options);\n          rzp.on('payment.failed', function (response) {\n            isProcessingPayment.value = false;\n            store.commit('setLoading', false);\n            alert(`Payment failed: ${response.error.description}`);\n          });\n          \n          rzp.open();\n          // Hide loader after a short delay to ensure Razorpay UI is visible\n          setTimeout(() => { isProcessingPayment.value = false; }, 1000);\n        } catch (error) {\n          console.error('Order creation failed:', error);\n          store.commit('setLoading', false);\n          \n          if (error.response) {\n            if (error.response.status === 401) {\n              // Clear invalid session and redirect to login\n              store.dispatch('logout');\n              router.push({\n                path: '/login',\n                query: { \n                  redirect: '/plans',\n                  plan: selectedPlan.value.id\n                }\n              });\n            } else {\n              alert(`Server error: ${error.response.data.message || 'Please try again later'}`);\n            }\n          } else if (error.request) {\n            alert('Network error. Please check your internet connection.');\n          } else {\n            alert('Unable to create order. Please try again.');\n          }\n        }\n      } catch (error) {\n        console.error('Payment gateway error:', error);\n        store.commit('setLoading', false);\n        alert('Something went wrong. Please try again.');\n      }\n    };\n\n    const validateCode = async () => {\n      try {\n        // Show loading state\n        store.commit('setLoading', true);\n        \n        // Basic validation\n        if (!subscriptionCode.value) {\n          codeError.value = 'Please enter a subscription code';\n          isValidCode.value = false;\n          return;\n        }\n\n        // Get user phone from store\n        const phone = store.getters.currentUser?.phone;\n        \n        if (!phone) {\n          store.dispatch('showToast', {\n            message: 'Please login to continue',\n            type: 'error'\n          });\n          router.push({\n            name: 'login',\n            query: { redirect: router.currentRoute.value.fullPath }\n          });\n          return;\n        }\n\n        // Call API to validate code\n        const response = await axios.post('/users/validate-coupon/', {\n          code: subscriptionCode.value,\n          phone: phone,\n          amount: selectedPlan.value.price,\n          plan_id: selectedPlan.value.id\n        });\n\n        if (response.data.status === 'success') {\n          isValidCode.value = true;\n          codeError.value = '';\n          store.dispatch('showToast', {\n            message: 'Code is valid! Click Activate to use it',\n            type: 'success'\n          });\n        } else {\n          isValidCode.value = false;\n          codeError.value = response.data.message || 'Invalid code';\n          store.dispatch('showToast', {\n            message: codeError.value,\n            type: 'error'\n          });\n        }\n      } catch (error) {\n        console.error('Code validation error:', error);\n        isValidCode.value = false;\n        codeError.value = error.response?.data?.message || 'Error validating code. Please try again.';\n        store.dispatch('showToast', {\n          message: codeError.value,\n          type: 'error'\n        });\n      } finally {\n        store.commit('setLoading', false);\n      }\n    };\n\n    const handleCodeSubmit = async () => {\n      if (!isValidCode.value) return;\n\n      try {\n        // Show loading state\n        store.commit('setLoading', true);\n        \n        // Get user from Vuex store\n        const user = store.getters.currentUser;\n        const phone = user?.phone || localStorage.getItem('phone');\n        \n        if (!phone) {\n          store.dispatch('showToast', {\n            message: 'Please login to continue',\n            type: 'error'\n          });\n          router.push({\n            name: 'login',\n            query: { redirect: router.currentRoute.value.fullPath }\n          });\n          store.commit('setLoading', false);\n          return;\n        }\n\n        // Check if registration and location details are complete (same as Pay Online)\n        const hasCompletedRegistration = user && user.first_name && \n                                         user.last_name && \n                                         user.address &&\n                                         user.state &&\n                                         user.district &&\n                                         user.constituency;\n\n        if (!hasCompletedRegistration) {\n          store.dispatch('showToast', {\n            message: 'Please complete your profile with all location details',\n            type: 'warning',\n            duration: 5000\n          });\n          router.push({\n            path: '/profile/update',\n            query: { \n              redirect: router.currentRoute.value.fullPath,\n              code: subscriptionCode.value\n            }\n          });\n          store.commit('setLoading', false);\n          return;\n        }\n        \n        // Call API to activate subscription\n        const response = await axios.post('/users/apply-coupon-subscription/', {\n          code: subscriptionCode.value,\n          phone: phone,\n          plan_id: selectedPlan.value.id\n        });\n\n        if (response.data.status === 'success') {\n          // Update user subscription in store\n          store.commit('setSubscription', response.data.subscription);\n          \n          // Show success message\n          store.dispatch('showToast', {\n            message: 'Subscription activated successfully!',\n            type: 'success'\n          });\n          \n          // Close code input dialog\n          showCodeInput.value = false;\n          \n          // Redirect to profile page\n          router.push('/profile');\n        } else {\n          throw new Error(response.data.message || 'Failed to activate subscription');\n        }\n      } catch (error) {\n        console.error('Code activation error:', error);\n        \n        // Show error message\n        store.dispatch('showToast', {\n          message: error.response?.data?.message || 'Error activating subscription. Please try again.',\n          type: 'error'\n        });\n\n        if (error.response?.status === 404) {\n          // User not found - redirect to login (same as Pay Online)\n          router.push({\n            path: '/login',\n            query: { \n              redirect: router.currentRoute.value.fullPath,\n              phone: localStorage.getItem('phone')\n            }\n          });\n        } else if (!localStorage.getItem('phone')) {\n          // Not logged in - redirect to login\n          router.push({\n            name: 'login',\n            query: { redirect: router.currentRoute.value.fullPath }\n          });\n        }\n      } finally {\n        store.commit('setLoading', false);\n      }\n    };\n\n\n\n    return {\n      plans,\n      selectedPlan,\n      selectedPlanId,\n      showCodeInput,\n      subscriptionCode,\n      codeError,\n      isValidCode,\n      isProcessingPayment,\n      handlePaymentGateway,\n      validateCode,\n      handleCodeSubmit,\n      onPlanChange,\n      checkAndCleanExpiredOrders // Expose order cleanup method\n    };\n  }\n}\n</script>\n\n<style scoped>\n.gradient-text {\n  background: linear-gradient(90deg, #c30059 0%, #7c1d44 100%);\n  -webkit-background-clip: text;\n  background-clip: text;\n  -webkit-text-fill-color: transparent;\n}\n\n/* Add these responsive styles */\n@media screen and (max-width: 1024px) {\n  .max-w-7xl {\n    max-width: 100%;\n  }\n}\n\n@media screen and (max-width: 768px) {\n  .grid {\n    gap: 1rem;\n  }\n  \n  .px-4 {\n    padding-left: 1rem;\n    padding-right: 1rem;\n  }\n\n  /* Add padding for mobile nav */\n  .pb-32 {\n    padding-bottom: 8rem;\n  }\n}\n\n@media screen and (max-width: 640px) {\n  .grid {\n    grid-template-columns: 1fr;\n  }\n  \n  .overflow-x-auto {\n    -webkit-overflow-scrolling: touch;\n  }\n  \n  .text-2xl {\n    font-size: 1.5rem;\n  }\n  \n  .py-4 {\n    padding-top: 0.75rem;\n    padding-bottom: 0.75rem;\n  }\n  \n  .px-6 {\n    padding-left: 1rem;\n    padding-right: 1rem;\n  }\n\n  /* Add bottom padding to account for fixed button */\n  .pb-24 {\n    padding-bottom: 6rem;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}