{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport { useStore } from 'vuex';\nimport { ref, computed, onMounted, onUnmounted, nextTick } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport { Html5Qrcode } from 'html5-qrcode';\nexport default {\n  name: 'DeviceActivation',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const activationCode = ref('');\n    const isActivating = ref(false);\n    const errorMessage = ref('');\n    const successMessage = ref('');\n    const showQRScanner = ref(false);\n    const isScanning = ref(false);\n    const qrScannerError = ref('');\n    let html5QrCode = null;\n\n    // Computed properties from store\n    const isAuthenticated = computed(() => store.getters.isAuthenticated);\n    const user = computed(() => store.getters.currentUser);\n    const token = computed(() => store.getters.token);\n\n    // Format activation code (uppercase, remove spaces)\n    const formatCode = () => {\n      activationCode.value = activationCode.value.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 8);\n    };\n\n    // Extract activation code from QR code URL or text\n    const extractCodeFromQR = qrData => {\n      try {\n        // Check if it's a URL with code parameter\n        const url = new URL(qrData);\n        const code = url.searchParams.get('code');\n        if (code) {\n          return code.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 8);\n        }\n      } catch (e) {\n        // Not a URL, might be direct code\n      }\n\n      // Try to extract 8-character code from the string\n      const codeMatch = qrData.match(/[A-Z0-9]{8}/);\n      if (codeMatch) {\n        return codeMatch[0];\n      }\n\n      // Return the string itself if it's 8 characters\n      const cleaned = qrData.toUpperCase().replace(/[^A-Z0-9]/g, '');\n      if (cleaned.length === 8) {\n        return cleaned;\n      }\n      return null;\n    };\n\n    // Open QR Scanner\n    const openQRScanner = async () => {\n      try {\n        showQRScanner.value = true;\n        qrScannerError.value = '';\n        isScanning.value = false;\n\n        // Wait for DOM to update and element to be available\n        await nextTick();\n        await new Promise(resolve => setTimeout(resolve, 300));\n\n        // Check if element exists\n        const qrReaderElement = document.getElementById(\"qr-reader\");\n        if (!qrReaderElement) {\n          throw new Error('QR reader element not found');\n        }\n        const qrCodeSuccessCallback = decodedText => {\n          console.log('QR Code scanned:', decodedText);\n          const extractedCode = extractCodeFromQR(decodedText);\n          if (extractedCode && extractedCode.length === 8) {\n            activationCode.value = extractedCode;\n            formatCode();\n            stopQRScanner();\n            showQRScanner.value = false;\n\n            // Show success message\n            store.dispatch('showToast', {\n              message: 'QR Code scanned successfully!',\n              type: 'success'\n            });\n          } else {\n            qrScannerError.value = 'Invalid QR code. Please scan a valid activation code QR.';\n          }\n        };\n        const qrCodeErrorCallback = errorMessage => {\n          // Ignore continuous scanning errors\n          if (errorMessage && (errorMessage.includes('NotFoundException') || errorMessage.includes('No MultiFormat Readers'))) {\n            return;\n          }\n          console.log('QR Code error:', errorMessage);\n        };\n\n        // Stop any existing scanner first\n        if (html5QrCode) {\n          try {\n            await html5QrCode.stop();\n            await html5QrCode.clear();\n          } catch (e) {\n            console.log('Error stopping existing scanner:', e);\n          }\n        }\n        html5QrCode = new Html5Qrcode(\"qr-reader\");\n\n        // Try to get available cameras first\n        const cameras = await Html5Qrcode.getCameras();\n        console.log('Available cameras:', cameras);\n        let cameraId = null;\n        if (cameras && cameras.length > 0) {\n          // Prefer back camera (environment)\n          const backCamera = cameras.find(cam => cam.label.toLowerCase().includes('back') || cam.label.toLowerCase().includes('rear'));\n          cameraId = backCamera ? backCamera.id : cameras[0].id;\n        }\n\n        // Start scanning\n        const config = {\n          fps: 10,\n          qrbox: {\n            width: 250,\n            height: 250\n          },\n          aspectRatio: 1.0\n        };\n        if (cameraId) {\n          await html5QrCode.start(cameraId, config, qrCodeSuccessCallback, qrCodeErrorCallback);\n        } else {\n          // Fallback to facingMode\n          await html5QrCode.start({\n            facingMode: \"environment\"\n          }, config, qrCodeSuccessCallback, qrCodeErrorCallback);\n        }\n        isScanning.value = true;\n        qrScannerError.value = '';\n      } catch (error) {\n        console.error('QR Scanner error:', error);\n        let errorMsg = 'Failed to start camera. ';\n        if (error.message && error.message.includes('Permission')) {\n          errorMsg += 'Please allow camera access in your browser settings.';\n        } else if (error.message && error.message.includes('not found')) {\n          errorMsg += 'Camera not found. Please check your device.';\n        } else {\n          errorMsg += error.message || 'Please try again.';\n        }\n        qrScannerError.value = errorMsg;\n        isScanning.value = false;\n        // Don't close modal on error, let user see the error message\n      }\n    };\n\n    // Stop QR Scanner\n    const stopQRScanner = async () => {\n      if (html5QrCode && isScanning.value) {\n        try {\n          await html5QrCode.stop();\n          await html5QrCode.clear();\n          html5QrCode = null;\n          isScanning.value = false;\n        } catch (error) {\n          console.error('Error stopping QR scanner:', error);\n        }\n      }\n    };\n\n    // Close QR Scanner\n    const closeQRScanner = async () => {\n      await stopQRScanner();\n      showQRScanner.value = false;\n      qrScannerError.value = '';\n    };\n\n    // Activate device\n    const activateDevice = async () => {\n      if (!isAuthenticated.value || !activationCode.value || activationCode.value.length !== 8) {\n        return;\n      }\n      isActivating.value = true;\n      errorMessage.value = '';\n      successMessage.value = '';\n      try {\n        // Set authorization header\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token.value}`;\n\n        // Call activation API\n        const response = await axios.post('/users/api/device-activation/', {\n          activation_code: activationCode.value,\n          device_id: `web_${Date.now()}`,\n          // Generate a temporary device ID\n          device_name: 'Web Activation',\n          device_type: 'web',\n          phone: user.value.phone\n        });\n        if (response.data.status === 'success') {\n          successMessage.value = 'Device activated successfully! Your TV should now have access to premium content.';\n\n          // Show success toast\n          store.dispatch('showToast', {\n            message: 'Device activated successfully!',\n            type: 'success'\n          });\n\n          // Redirect to profile after a delay\n          setTimeout(() => {\n            router.push('/profile');\n          }, 3000);\n        } else {\n          throw new Error(response.data.message || 'Failed to activate device');\n        }\n      } catch (error) {\n        console.error('Activation error:', error);\n        errorMessage.value = error.response?.data?.message || 'Failed to activate device. Please try again.';\n\n        // Show error toast\n        store.dispatch('showToast', {\n          message: errorMessage.value,\n          type: 'error'\n        });\n      } finally {\n        isActivating.value = false;\n      }\n    };\n\n    // Check for code in URL parameters\n    onMounted(() => {\n      const urlParams = new URLSearchParams(window.location.search);\n      const code = urlParams.get('code');\n      if (code) {\n        activationCode.value = code;\n        formatCode();\n      }\n    });\n\n    // Cleanup on unmount\n    onUnmounted(async () => {\n      await stopQRScanner();\n    });\n    return {\n      activationCode,\n      isActivating,\n      errorMessage,\n      successMessage,\n      isAuthenticated,\n      user,\n      showQRScanner,\n      isScanning,\n      qrScannerError,\n      formatCode,\n      activateDevice,\n      openQRScanner,\n      stopQRScanner,\n      closeQRScanner\n    };\n  }\n};","map":{"version":3,"names":["useStore","ref","computed","onMounted","onUnmounted","nextTick","useRouter","axios","Html5Qrcode","name","setup","store","router","activationCode","isActivating","errorMessage","successMessage","showQRScanner","isScanning","qrScannerError","html5QrCode","isAuthenticated","getters","user","currentUser","token","formatCode","value","toUpperCase","replace","slice","extractCodeFromQR","qrData","url","URL","code","searchParams","get","e","codeMatch","match","cleaned","length","openQRScanner","Promise","resolve","setTimeout","qrReaderElement","document","getElementById","Error","qrCodeSuccessCallback","decodedText","console","log","extractedCode","stopQRScanner","dispatch","message","type","qrCodeErrorCallback","includes","stop","clear","cameras","getCameras","cameraId","backCamera","find","cam","label","toLowerCase","id","config","fps","qrbox","width","height","aspectRatio","start","facingMode","error","errorMsg","closeQRScanner","activateDevice","defaults","headers","common","response","post","activation_code","device_id","Date","now","device_name","device_type","phone","data","status","push","urlParams","URLSearchParams","window","location","search"],"sources":["F:\\ott_tv\\ott\\ott_frontend\\src\\views\\DeviceActivation.vue"],"sourcesContent":["<template>\r\n  <div class=\"min-h-screen bg-gradient-to-br from-[#0a0a0a] via-[#1a1a1a] to-[#0f0f0f] text-white\">\r\n    <!-- Header -->\r\n    <div class=\"px-4 py-6\">\r\n      <div class=\"max-w-7xl mx-auto\">\r\n        <router-link to=\"/\" class=\"flex items-center gap-3 text-white/80 hover:text-white transition-colors group\">\r\n          <div class=\"w-10 h-10 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-lg flex items-center justify-center group-hover:scale-105 transition-transform\">\r\n            <i class=\"fas fa-arrow-left text-lg\"></i>\r\n          </div>\r\n          <span class=\"font-medium\">Back to Home</span>\r\n        </router-link>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Main Content -->\r\n    <div class=\"px-4 py-8\">\r\n      <div class=\"max-w-4xl mx-auto\">\r\n        <div class=\"text-center mb-12\">\r\n          <h1 class=\"text-4xl md:text-5xl font-bold mb-4\">\r\n            Activate Your <span class=\"text-[#c30059]\">TV Device</span>\r\n          </h1>\r\n          <p class=\"text-lg text-white/70 max-w-2xl mx-auto\">\r\n            Enter the activation code displayed on your TV screen to link your device to your account\r\n          </p>\r\n        </div>\r\n\r\n        <div class=\"bg-gradient-to-br from-[#1a1a1a] to-[#2a2a2a] rounded-3xl border border-white/10 p-8 max-w-2xl mx-auto\">\r\n          <!-- Activation Form -->\r\n          <div class=\"space-y-6\">\r\n            <div>\r\n              <label class=\"block text-sm font-medium text-white/80 mb-3\">Activation Code</label>\r\n              <div class=\"flex gap-3\">\r\n                <input \r\n                  v-model=\"activationCode\"\r\n                  type=\"text\"\r\n                  class=\"flex-1 bg-[#0a0a0a] border border-white/10 rounded-xl h-14 px-4 text-white text-lg font-mono tracking-wider focus:border-[#c30059] focus:outline-none focus:ring-2 focus:ring-[#c30059]/20 transition-all uppercase placeholder-white/40 text-center\"\r\n                  placeholder=\"ENTER CODE\"\r\n                  maxlength=\"8\"\r\n                  @input=\"formatCode\"\r\n                />\r\n                <button\r\n                  @click=\"openQRScanner\"\r\n                  type=\"button\"\r\n                  class=\"px-6 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] text-white font-medium rounded-xl hover:shadow-lg hover:shadow-[#c30059]/25 transition-all duration-300 flex items-center justify-center gap-2\"\r\n                  title=\"Scan QR Code\"\r\n                >\r\n                  <i class=\"fas fa-qrcode text-xl\"></i>\r\n                  <span class=\"hidden sm:inline\">Scan QR</span>\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- User Info (if logged in) -->\r\n            <div v-if=\"isAuthenticated\" class=\"bg-[#0a0a0a]/50 border border-white/10 rounded-xl p-4\">\r\n              <div class=\"flex items-center gap-3\">\r\n                <div class=\"w-10 h-10 rounded-full bg-gradient-to-r from-[#c30059] to-[#ff6b9d] flex items-center justify-center\">\r\n                  <i class=\"fas fa-user text-white\"></i>\r\n                </div>\r\n                <div>\r\n                  <div class=\"font-medium text-white\">{{ user.first_name }} {{ user.last_name }}</div>\r\n                  <div class=\"text-sm text-white/60\">{{ user.phone }}</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Login Prompt (if not logged in) -->\r\n            <div v-else class=\"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4\">\r\n              <div class=\"flex items-start gap-3\">\r\n                <i class=\"fas fa-exclamation-triangle text-amber-400 mt-0.5\"></i>\r\n                <div>\r\n                  <div class=\"font-medium text-amber-400 mb-1\">Login Required</div>\r\n                  <p class=\"text-sm text-amber-300\">\r\n                    You need to be logged in to activate your device. Please login or create an account.\r\n                  </p>\r\n                  <router-link \r\n                    to=\"/login\" \r\n                    class=\"inline-block mt-3 px-4 py-2 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] text-white text-sm font-medium rounded-lg hover:shadow-lg hover:shadow-[#c30059]/25 transition-all\"\r\n                  >\r\n                    Login to Continue\r\n                  </router-link>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Activate Button -->\r\n            <button \r\n              @click=\"activateDevice\"\r\n              :disabled=\"!isAuthenticated || !activationCode || activationCode.length !== 8 || isActivating\"\r\n              class=\"w-full py-4 px-6 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] text-white font-bold rounded-xl hover:shadow-lg hover:shadow-[#c30059]/25 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-none\"\r\n            >\r\n              <span v-if=\"isActivating\">\r\n                <i class=\"fas fa-spinner fa-spin mr-2\"></i>\r\n                Activating...\r\n              </span>\r\n              <span v-else>\r\n                <i class=\"fas fa-tv mr-2\"></i>\r\n                Activate Device\r\n              </span>\r\n            </button>\r\n\r\n            <!-- Error Message -->\r\n            <div v-if=\"errorMessage\" class=\"p-4 bg-red-500/10 border border-red-500/30 rounded-xl\">\r\n              <div class=\"flex items-center gap-2 text-red-400\">\r\n                <i class=\"fas fa-exclamation-circle\"></i>\r\n                <span>{{ errorMessage }}</span>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Success Message -->\r\n            <div v-if=\"successMessage\" class=\"p-4 bg-green-500/10 border border-green-500/30 rounded-xl\">\r\n              <div class=\"flex items-center gap-2 text-green-400\">\r\n                <i class=\"fas fa-check-circle\"></i>\r\n                <span>{{ successMessage }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Instructions -->\r\n        <div class=\"mt-12 max-w-3xl mx-auto\">\r\n          <h2 class=\"text-2xl font-bold text-center mb-8\">How to Activate</h2>\r\n          <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n            <div class=\"bg-[#1a1a1a]/50 border border-white/10 rounded-2xl p-6 text-center\">\r\n              <div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-2xl flex items-center justify-center\">\r\n                <span class=\"text-2xl font-bold text-white\">1</span>\r\n              </div>\r\n              <h3 class=\"text-lg font-bold mb-2\">Open App on TV</h3>\r\n              <p class=\"text-white/60 text-sm\">\r\n                Launch the OTT TV app on your smart TV or streaming device\r\n              </p>\r\n            </div>\r\n            \r\n            <div class=\"bg-[#1a1a1a]/50 border border-white/10 rounded-2xl p-6 text-center\">\r\n              <div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-2xl flex items-center justify-center\">\r\n                <span class=\"text-2xl font-bold text-white\">2</span>\r\n              </div>\r\n              <h3 class=\"text-lg font-bold mb-2\">Get Activation Code</h3>\r\n              <p class=\"text-white/60 text-sm\">\r\n                Note the 8-character code displayed on your TV screen\r\n              </p>\r\n            </div>\r\n            \r\n            <div class=\"bg-[#1a1a1a]/50 border border-white/10 rounded-2xl p-6 text-center\">\r\n              <div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-[#c30059] to-[#ff6b9d] rounded-2xl flex items-center justify-center\">\r\n                <span class=\"text-2xl font-bold text-white\">3</span>\r\n              </div>\r\n              <h3 class=\"text-lg font-bold mb-2\">Enter Code Here</h3>\r\n              <p class=\"text-white/60 text-sm\">\r\n                Type the code above and click Activate Device\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- QR Scanner Modal -->\r\n    <div v-if=\"showQRScanner\" class=\"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4\">\r\n      <div class=\"bg-gradient-to-br from-[#1a1a1a] to-[#2a2a2a] rounded-3xl border border-white/10 p-6 max-w-md w-full\">\r\n        <div class=\"flex items-center justify-between mb-4\">\r\n          <h3 class=\"text-xl font-bold text-white\">Scan QR Code</h3>\r\n          <button\r\n            @click=\"closeQRScanner\"\r\n            class=\"text-white/60 hover:text-white transition-colors\"\r\n          >\r\n            <i class=\"fas fa-times text-2xl\"></i>\r\n          </button>\r\n        </div>\r\n        \r\n        <div class=\"mb-4 relative\">\r\n          <div id=\"qr-reader\" class=\"w-full rounded-xl overflow-hidden bg-black/50\" style=\"min-height: 300px;\"></div>\r\n          <div v-if=\"!isScanning && !qrScannerError\" class=\"absolute inset-0 flex items-center justify-center bg-black/50 rounded-xl pointer-events-none\">\r\n            <div class=\"text-center\">\r\n              <i class=\"fas fa-spinner fa-spin text-white text-3xl mb-2\"></i>\r\n              <p class=\"text-white text-sm\">Initializing camera...</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div v-if=\"qrScannerError\" class=\"mb-4 p-3 bg-red-500/10 border border-red-500/30 rounded-xl\">\r\n          <p class=\"text-red-400 text-sm\">{{ qrScannerError }}</p>\r\n        </div>\r\n        \r\n        <div class=\"flex gap-3\">\r\n          <button\r\n            @click=\"closeQRScanner\"\r\n            class=\"flex-1 py-3 px-4 bg-white/10 text-white font-medium rounded-xl hover:bg-white/20 transition-all\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            @click=\"stopQRScanner\"\r\n            v-if=\"isScanning\"\r\n            class=\"flex-1 py-3 px-4 bg-red-500/20 text-red-400 font-medium rounded-xl hover:bg-red-500/30 transition-all\"\r\n          >\r\n            Stop Scanner\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { useStore } from 'vuex';\r\nimport { ref, computed, onMounted, onUnmounted, nextTick } from 'vue';\r\nimport { useRouter } from 'vue-router';\r\nimport axios from 'axios';\r\nimport { Html5Qrcode } from 'html5-qrcode';\r\n\r\nexport default {\r\n  name: 'DeviceActivation',\r\n  setup() {\r\n    const store = useStore();\r\n    const router = useRouter();\r\n    \r\n    const activationCode = ref('');\r\n    const isActivating = ref(false);\r\n    const errorMessage = ref('');\r\n    const successMessage = ref('');\r\n    const showQRScanner = ref(false);\r\n    const isScanning = ref(false);\r\n    const qrScannerError = ref('');\r\n    let html5QrCode = null;\r\n    \r\n    // Computed properties from store\r\n    const isAuthenticated = computed(() => store.getters.isAuthenticated);\r\n    const user = computed(() => store.getters.currentUser);\r\n    const token = computed(() => store.getters.token);\r\n    \r\n    // Format activation code (uppercase, remove spaces)\r\n    const formatCode = () => {\r\n      activationCode.value = activationCode.value\r\n        .toUpperCase()\r\n        .replace(/[^A-Z0-9]/g, '')\r\n        .slice(0, 8);\r\n    };\r\n    \r\n    // Extract activation code from QR code URL or text\r\n    const extractCodeFromQR = (qrData) => {\r\n      try {\r\n        // Check if it's a URL with code parameter\r\n        const url = new URL(qrData);\r\n        const code = url.searchParams.get('code');\r\n        if (code) {\r\n          return code.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 8);\r\n        }\r\n      } catch (e) {\r\n        // Not a URL, might be direct code\r\n      }\r\n      \r\n      // Try to extract 8-character code from the string\r\n      const codeMatch = qrData.match(/[A-Z0-9]{8}/);\r\n      if (codeMatch) {\r\n        return codeMatch[0];\r\n      }\r\n      \r\n      // Return the string itself if it's 8 characters\r\n      const cleaned = qrData.toUpperCase().replace(/[^A-Z0-9]/g, '');\r\n      if (cleaned.length === 8) {\r\n        return cleaned;\r\n      }\r\n      \r\n      return null;\r\n    };\r\n    \r\n    // Open QR Scanner\r\n    const openQRScanner = async () => {\r\n      try {\r\n        showQRScanner.value = true;\r\n        qrScannerError.value = '';\r\n        isScanning.value = false;\r\n        \r\n        // Wait for DOM to update and element to be available\r\n        await nextTick();\r\n        await new Promise(resolve => setTimeout(resolve, 300));\r\n        \r\n        // Check if element exists\r\n        const qrReaderElement = document.getElementById(\"qr-reader\");\r\n        if (!qrReaderElement) {\r\n          throw new Error('QR reader element not found');\r\n        }\r\n        \r\n        const qrCodeSuccessCallback = (decodedText) => {\r\n          console.log('QR Code scanned:', decodedText);\r\n          \r\n          const extractedCode = extractCodeFromQR(decodedText);\r\n          if (extractedCode && extractedCode.length === 8) {\r\n            activationCode.value = extractedCode;\r\n            formatCode();\r\n            stopQRScanner();\r\n            showQRScanner.value = false;\r\n            \r\n            // Show success message\r\n            store.dispatch('showToast', {\r\n              message: 'QR Code scanned successfully!',\r\n              type: 'success'\r\n            });\r\n          } else {\r\n            qrScannerError.value = 'Invalid QR code. Please scan a valid activation code QR.';\r\n          }\r\n        };\r\n        \r\n        const qrCodeErrorCallback = (errorMessage) => {\r\n          // Ignore continuous scanning errors\r\n          if (errorMessage && (\r\n            errorMessage.includes('NotFoundException') || \r\n            errorMessage.includes('No MultiFormat Readers')\r\n          )) {\r\n            return;\r\n          }\r\n          console.log('QR Code error:', errorMessage);\r\n        };\r\n        \r\n        // Stop any existing scanner first\r\n        if (html5QrCode) {\r\n          try {\r\n            await html5QrCode.stop();\r\n            await html5QrCode.clear();\r\n          } catch (e) {\r\n            console.log('Error stopping existing scanner:', e);\r\n          }\r\n        }\r\n        \r\n        html5QrCode = new Html5Qrcode(\"qr-reader\");\r\n        \r\n        // Try to get available cameras first\r\n        const cameras = await Html5Qrcode.getCameras();\r\n        console.log('Available cameras:', cameras);\r\n        \r\n        let cameraId = null;\r\n        if (cameras && cameras.length > 0) {\r\n          // Prefer back camera (environment)\r\n          const backCamera = cameras.find(cam => cam.label.toLowerCase().includes('back') || cam.label.toLowerCase().includes('rear'));\r\n          cameraId = backCamera ? backCamera.id : cameras[0].id;\r\n        }\r\n        \r\n        // Start scanning\r\n        const config = {\r\n          fps: 10,\r\n          qrbox: { width: 250, height: 250 },\r\n          aspectRatio: 1.0\r\n        };\r\n        \r\n        if (cameraId) {\r\n          await html5QrCode.start(\r\n            cameraId,\r\n            config,\r\n            qrCodeSuccessCallback,\r\n            qrCodeErrorCallback\r\n          );\r\n        } else {\r\n          // Fallback to facingMode\r\n          await html5QrCode.start(\r\n            { facingMode: \"environment\" },\r\n            config,\r\n            qrCodeSuccessCallback,\r\n            qrCodeErrorCallback\r\n          );\r\n        }\r\n        \r\n        isScanning.value = true;\r\n        qrScannerError.value = '';\r\n      } catch (error) {\r\n        console.error('QR Scanner error:', error);\r\n        let errorMsg = 'Failed to start camera. ';\r\n        \r\n        if (error.message && error.message.includes('Permission')) {\r\n          errorMsg += 'Please allow camera access in your browser settings.';\r\n        } else if (error.message && error.message.includes('not found')) {\r\n          errorMsg += 'Camera not found. Please check your device.';\r\n        } else {\r\n          errorMsg += error.message || 'Please try again.';\r\n        }\r\n        \r\n        qrScannerError.value = errorMsg;\r\n        isScanning.value = false;\r\n        // Don't close modal on error, let user see the error message\r\n      }\r\n    };\r\n    \r\n    // Stop QR Scanner\r\n    const stopQRScanner = async () => {\r\n      if (html5QrCode && isScanning.value) {\r\n        try {\r\n          await html5QrCode.stop();\r\n          await html5QrCode.clear();\r\n          html5QrCode = null;\r\n          isScanning.value = false;\r\n        } catch (error) {\r\n          console.error('Error stopping QR scanner:', error);\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Close QR Scanner\r\n    const closeQRScanner = async () => {\r\n      await stopQRScanner();\r\n      showQRScanner.value = false;\r\n      qrScannerError.value = '';\r\n    };\r\n    \r\n    // Activate device\r\n    const activateDevice = async () => {\r\n      if (!isAuthenticated.value || !activationCode.value || activationCode.value.length !== 8) {\r\n        return;\r\n      }\r\n      \r\n      isActivating.value = true;\r\n      errorMessage.value = '';\r\n      successMessage.value = '';\r\n      \r\n      try {\r\n        // Set authorization header\r\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token.value}`;\r\n        \r\n        // Call activation API\r\n        const response = await axios.post('/users/api/device-activation/', {\r\n          activation_code: activationCode.value,\r\n          device_id: `web_${Date.now()}`, // Generate a temporary device ID\r\n          device_name: 'Web Activation',\r\n          device_type: 'web',\r\n          phone: user.value.phone\r\n        });\r\n        \r\n        if (response.data.status === 'success') {\r\n          successMessage.value = 'Device activated successfully! Your TV should now have access to premium content.';\r\n          \r\n          // Show success toast\r\n          store.dispatch('showToast', {\r\n            message: 'Device activated successfully!',\r\n            type: 'success'\r\n          });\r\n          \r\n          // Redirect to profile after a delay\r\n          setTimeout(() => {\r\n            router.push('/profile');\r\n          }, 3000);\r\n        } else {\r\n          throw new Error(response.data.message || 'Failed to activate device');\r\n        }\r\n      } catch (error) {\r\n        console.error('Activation error:', error);\r\n        errorMessage.value = error.response?.data?.message || 'Failed to activate device. Please try again.';\r\n        \r\n        // Show error toast\r\n        store.dispatch('showToast', {\r\n          message: errorMessage.value,\r\n          type: 'error'\r\n        });\r\n      } finally {\r\n        isActivating.value = false;\r\n      }\r\n    };\r\n    \r\n    // Check for code in URL parameters\r\n    onMounted(() => {\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const code = urlParams.get('code');\r\n      if (code) {\r\n        activationCode.value = code;\r\n        formatCode();\r\n      }\r\n    });\r\n    \r\n    // Cleanup on unmount\r\n    onUnmounted(async () => {\r\n      await stopQRScanner();\r\n    });\r\n    \r\n    return {\r\n      activationCode,\r\n      isActivating,\r\n      errorMessage,\r\n      successMessage,\r\n      isAuthenticated,\r\n      user,\r\n      showQRScanner,\r\n      isScanning,\r\n      qrScannerError,\r\n      formatCode,\r\n      activateDevice,\r\n      openQRScanner,\r\n      stopQRScanner,\r\n      closeQRScanner\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n/* QR Scanner Styles */\r\n#qr-reader {\r\n  min-height: 300px;\r\n  width: 100%;\r\n  position: relative;\r\n}\r\n\r\n#qr-reader__dashboard_section {\r\n  display: none !important;\r\n}\r\n\r\n#qr-reader__camera_selection {\r\n  display: none !important;\r\n}\r\n\r\n/* Override html5-qrcode styles for better appearance */\r\n#qr-reader__scan_region {\r\n  border: 2px solid #c30059 !important;\r\n  border-radius: 12px !important;\r\n}\r\n\r\n#qr-reader__scan_region video {\r\n  border-radius: 12px !important;\r\n  width: 100% !important;\r\n  height: auto !important;\r\n}\r\n\r\n/* Responsive adjustments */\r\n@media (max-width: 640px) {\r\n  #qr-reader {\r\n    min-height: 250px;\r\n  }\r\n}\r\n</style>\r\n\r\n<style>\r\n/* Global styles for QR scanner (not scoped) */\r\n#qr-reader {\r\n  width: 100% !important;\r\n}\r\n\r\n#qr-reader__scan_region {\r\n  width: 100% !important;\r\n}\r\n\r\n#qr-reader__scan_region video {\r\n  width: 100% !important;\r\n  height: auto !important;\r\n  object-fit: cover !important;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}