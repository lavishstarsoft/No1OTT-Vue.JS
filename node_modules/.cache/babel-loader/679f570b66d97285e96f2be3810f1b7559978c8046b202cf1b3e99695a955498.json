{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"min-h-screen bg-[#121212] flex flex-col\"\n};\nconst _hoisted_2 = {\n  class: \"flex-grow\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_view = _resolveComponent(\"router-view\");\n  const _component_MobileNav = _resolveComponent(\"MobileNav\");\n  const _component_ToastNotification = _resolveComponent(\"ToastNotification\");\n  const _component_PopupModal = _resolveComponent(\"PopupModal\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_router_view), $options.showMobileNav ? (_openBlock(), _createBlock(_component_MobileNav, {\n    key: 0\n  })) : _createCommentVNode(\"\", true), _createVNode(_component_ToastNotification), _createVNode(_component_PopupModal, {\n    onPopupAction: $options.handlePopupAction\n  }, null, 8, [\"onPopupAction\"])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_router_view","$options","showMobileNav","_createBlock","_component_MobileNav","key","_component_ToastNotification","_component_PopupModal","onPopupAction","handlePopupAction"],"sources":["D:\\OTT\\ott_frontend\\src\\App.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-[#121212] flex flex-col\">\n    <div class=\"flex-grow\">\n      <router-view></router-view>\n      <MobileNav v-if=\"showMobileNav\" />\n      <ToastNotification />\n      <PopupModal @popup-action=\"handlePopupAction\" />\n    </div>\n  </div>\n</template>\n\n<script>\nimport MobileNav from './components/MobileNav.vue'\nimport ToastNotification from '@/components/Toast.vue'\nimport PopupModal from '@/components/PopupModal.vue'\n\nexport default {\n  name: 'App',\n  data() {\n    return {\n      scrollCheckInterval: null\n    }\n  },\n  components: {\n    MobileNav,\n    ToastNotification,\n    PopupModal\n  },\n  computed: {\n    showMobileNav() {\n      const hideOnRoutes = ['/login', '/register', '/mini-register'];\n      return !hideOnRoutes.includes(this.$route.path);\n    }\n  },\n  watch: {\n    // Watch for route changes to ensure scroll is restored\n    '$route'() {\n      // Ensure scroll is enabled when route changes\n      this.$nextTick(() => {\n        this.ensurePageScrollability();\n      });\n    }\n  },\n  mounted() {\n    console.log('App mounted, checking authentication status');\n    \n    // Ensure page scrolling is enabled on app mount\n    this.ensurePageScrollability();\n    \n    // Check if user is authenticated\n    const isAuthenticated = this.$store.getters.isAuthenticated;\n    const user = this.$store.getters.currentUser;\n    \n    console.log('Authentication status:', { isAuthenticated, user: user ? 'exists' : 'null' });\n    \n    // Check and clean expired orders on page load\n    this.checkAndCleanExpiredOrders();\n    \n    // Only check notifications and payments if user is authenticated\n    if (isAuthenticated && user) {\n    // Check for success messages\n    this.checkAndShowToast('registrationSuccess', 'registrationMessage');\n    this.checkAndShowToast('loginSuccess', 'loginMessage');\n      // Check for pending payments on mount\n      this.checkPendingPayments();\n      // Check for user notifications (like account deletion)\n      this.checkUserNotifications();\n      \n      // Set up intervals for background checking\n      // Check pending payments every 30 seconds\n      this.paymentCheckInterval = setInterval(() => {\n        this.checkPendingPayments();\n      }, 30000);\n      \n      // Check subscription status every 2 minutes\n      this.subscriptionCheckInterval = setInterval(() => {\n        this.checkSubscriptionStatus();\n      }, 120000);\n      \n      // Listen for app resume/focus\n      window.addEventListener('focus', this.checkPendingPayments);\n      window.addEventListener('focus', this.checkUserNotifications);\n      window.addEventListener('focus', this.checkAndCleanExpiredOrders);\n    } else {\n      console.log('User not authenticated, skipping background checks');\n    }\n    \n    // Add global event listeners for scroll restoration\n    window.addEventListener('beforeunload', this.ensurePageScrollability);\n    window.addEventListener('pagehide', this.ensurePageScrollability);\n    \n    // Add periodic scroll check (every 5 seconds)\n    this.scrollCheckInterval = setInterval(() => {\n      if (document.body.style.overflow === 'hidden') {\n        console.log('‚ö†Ô∏è Scroll blocked detected, restoring...');\n        this.ensurePageScrollability();\n      }\n    }, 5000);\n  },\n  beforeUnmount() {\n    // Clear all intervals\n    if (this.paymentCheckInterval) {\n      clearInterval(this.paymentCheckInterval);\n    }\n    if (this.subscriptionCheckInterval) {\n      clearInterval(this.subscriptionCheckInterval);\n    }\n    \n    // Clear event listeners\n    window.removeEventListener('focus', this.checkPendingPayments);\n    window.removeEventListener('focus', this.checkUserNotifications);\n    window.removeEventListener('focus', this.checkAndCleanExpiredOrders);\n    window.removeEventListener('beforeunload', this.ensurePageScrollability);\n    window.removeEventListener('pagehide', this.ensurePageScrollability);\n    \n    // Clear the scroll check interval\n    if (this.scrollCheckInterval) {\n      clearInterval(this.scrollCheckInterval);\n    }\n  },\n  methods: {\n    checkAndShowToast(successKey, messageKey) {\n      const isSuccess = localStorage.getItem(successKey);\n      if (isSuccess === 'true') {\n        // Show success toast\n        try {\n          if (this.$toast) {\n            this.$toast.success(localStorage.getItem(messageKey) || 'Operation completed successfully!', {\n              position: 'top-right',\n              duration: 3000\n            });\n          }\n        } catch (error) {\n          console.warn('Toast notification failed:', error);\n        }\n        // Clear the success message\n        localStorage.removeItem(successKey);\n        localStorage.removeItem(messageKey);\n      }\n    },\n    async checkPendingPayments() {\n      const pendingPayment = localStorage.getItem('pending_payment');\n      if (pendingPayment) {\n        try {\n          const paymentData = JSON.parse(pendingPayment);\n          console.log('=== CHECKING PENDING PAYMENT ===');\n          console.log('Payment data:', paymentData);\n          \n          // 15 ‡∞®‡∞ø‡∞Æ‡∞ø‡∞∑‡∞æ‡∞≤ ‡∞≤‡±ã‡∞™‡∞≤ payment ‡∞Ö‡∞Ø‡∞ø‡∞§‡±á ‡∞Æ‡∞æ‡∞§‡±ç‡∞∞‡∞Æ‡±á\n          const timeDiff = Date.now() - paymentData.timestamp;\n          console.log('Time difference:', timeDiff, 'ms');\n          \n          if (timeDiff < 15 * 60 * 1000) {\n            console.log('Payment is within time limit, proceeding with verification');\n            \n            // Retry count check\n            if (paymentData.retry_count >= 10) {\n              console.log('Max retries reached, removing pending payment');\n              localStorage.removeItem('pending_payment');\n              return;\n            }\n            \n            console.log('Attempting payment verification...');\n            // Backend ‡∞ï‡∞ø verify-payment API call ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø\n            const verifyResponse = await this.$axios.post('/users/verify-payment/', {\n              razorpay_payment_id: paymentData.payment_id,\n              razorpay_order_id: paymentData.order_id,\n              razorpay_signature: paymentData.signature,\n              plan_id: paymentData.plan_id,\n              phone: paymentData.phone || this.$store.getters.currentUser?.phone\n            });\n            \n            console.log('Verification response:', verifyResponse.data);\n            \n            if (verifyResponse.data.status === 'success') {\n              localStorage.removeItem('pending_payment');\n              this.$store.commit('setSubscription', verifyResponse.data.subscription);\n              this.$store.dispatch('showToast', {\n                message: 'Payment successful! Your subscription is now active.',\n                type: 'success'\n              });\n              console.log('Pending payment verified successfully');\n            } else {\n              console.log('Payment verification failed:', verifyResponse.data);\n              // Increment retry count\n              paymentData.retry_count = (paymentData.retry_count || 0) + 1;\n              localStorage.setItem('pending_payment', JSON.stringify(paymentData));\n              console.log('Updated retry count:', paymentData.retry_count);\n            }\n          } else {\n            // Payment ‡∞ö‡∞æ‡∞≤‡∞æ ‡∞™‡∞æ‡∞§‡∞¶‡∞ø ‡∞Ö‡∞Ø‡∞ø‡∞§‡±á, localStorage ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞§‡±Ä‡∞∏‡±á‡∞Ø‡∞Ç‡∞°‡∞ø\n            localStorage.removeItem('pending_payment');\n            console.log('Pending payment expired, removed from localStorage');\n          }\n        } catch (error) {\n          console.error('Error checking pending payment:', error);\n          // Increment retry count on error\n          try {\n            const paymentData = JSON.parse(pendingPayment);\n            paymentData.retry_count = (paymentData.retry_count || 0) + 1;\n            localStorage.setItem('pending_payment', JSON.stringify(paymentData));\n            console.log('Error occurred, updated retry count:', paymentData.retry_count);\n          } catch (parseError) {\n            console.error('Error updating retry count:', parseError);\n          }\n        }\n      } else {\n        console.log('No pending payment found in localStorage');\n      }\n      \n      // Also check subscription status directly\n      await this.checkSubscriptionStatus();\n    },\n    \n    // Check and clean expired orders\n    checkAndCleanExpiredOrders() {\n      try {\n        const paymentOrder = localStorage.getItem('payment_order');\n        if (paymentOrder) {\n          const orderData = JSON.parse(paymentOrder);\n          const orderTime = orderData.created_at;\n          const currentTime = Date.now();\n          const timeDiff = currentTime - orderTime;\n          \n          // If order is older than 30 minutes, remove it\n          if (timeDiff > 30 * 60 * 1000) { // 30 minutes\n            localStorage.removeItem('payment_order');\n            console.log('Expired payment order removed from localStorage');\n          } else {\n            console.log('Valid payment order found, keeping it');\n          }\n        } else {\n          console.log('No payment order found in localStorage');\n        }\n      } catch (error) {\n        console.error('Error checking expired orders:', error);\n        // Remove corrupted data\n        localStorage.removeItem('payment_order');\n      }\n    },\n    \n    async checkSubscriptionStatus() {\n      try {\n        const user = this.$store.getters.currentUser;\n        if (!user || !user.phone) {\n          console.log('No user found, skipping subscription check');\n          return;\n        }\n        \n        console.log('=== CHECKING SUBSCRIPTION STATUS ===');\n        console.log('User phone:', user.phone);\n        \n        const response = await this.$axios.get('/users/check-subscription-status/', {\n          params: { phone: user.phone }\n        });\n        \n        console.log('Subscription status response:', response.data);\n        \n        if (response.data.status === 'success') {\n          if (response.data.is_subscribed) {\n            console.log('User has active subscription:', response.data.subscription);\n            // Update store with subscription data\n            this.$store.commit('setSubscription', response.data.subscription);\n            \n            // Clear any pending payments since subscription is active\n            localStorage.removeItem('pending_payment');\n            console.log('Cleared pending payment from localStorage');\n            \n            this.$store.dispatch('showToast', {\n              message: 'Your subscription is active!',\n              type: 'success'\n            });\n          } else {\n            console.log('User has no active subscription');\n            // Check if there's a pending payment\n            const pendingPayment = localStorage.getItem('pending_payment');\n            if (pendingPayment) {\n              console.log('Found pending payment, will retry verification');\n            }\n          }\n        } else {\n          console.log('Subscription status check failed:', response.data);\n        }\n      } catch (error) {\n        console.error('Error checking subscription status:', error);\n        console.error('Error details:', error.response?.data);\n      }\n    },\n    async checkUserNotifications() {\n      try {\n        // Check if user is authenticated\n        const isAuthenticated = this.$store.getters.isAuthenticated;\n        const user = this.$store.getters.currentUser;\n        \n        if (!isAuthenticated || !user || !user.phone) {\n          console.log('User not authenticated, skipping notification check');\n          return;\n        }\n\n        console.log('Checking notifications for user:', user.phone);\n\n        const response = await this.$axios.get(`/users/check-notifications/?phone=${user.phone}`);\n        \n        if (response.data.status === 'success') {\n          // Check if user still exists in database\n          if (response.data.user_exists === false) {\n            console.log('User no longer exists in database, logging out');\n            \n            // Complete logout process\n            this.performCompleteLogout('Your account has been deleted. You have been logged out.');\n            return;\n          }\n\n          // Check for notifications\n          if (response.data.has_notifications) {\n            console.log('Found notifications:', response.data.notifications);\n            \n            // Check for account deletion notification\n            const accountDeletedNotification = response.data.notifications.find(\n              notification => notification.type === 'account_deleted'\n            );\n\n            if (accountDeletedNotification) {\n              console.log('Account deletion notification found, logging out user');\n              \n              // Complete logout process\n              this.performCompleteLogout('Your account has been deleted by admin. You have been logged out.');\n            }\n          } else {\n            console.log('No notifications found');\n          }\n        }\n      } catch (error) {\n        console.error('Error checking user notifications:', error);\n      }\n    },\n    performCompleteLogout(message) {\n      console.log('Performing complete logout');\n      \n      // Clear all localStorage and sessionStorage\n      localStorage.clear();\n      sessionStorage.clear();\n      \n      // Clear specific items to be sure\n      const itemsToRemove = [\n        'user', 'isAuthenticated', 'token', 'subscription', 'csrfToken',\n        'pending_payment', 'registrationSuccess', 'registrationMessage',\n        'loginSuccess', 'loginMessage', 'hasCompletedRegistration', 'app_version'\n      ];\n      \n      itemsToRemove.forEach(item => {\n        localStorage.removeItem(item);\n        sessionStorage.removeItem(item);\n      });\n      \n      // Clear store\n      this.$store.commit('logout');\n      \n      // Clear all cookies\n      document.cookie.split(\";\").forEach(function(c) { \n        document.cookie = c.replace(/^ +/, \"\").replace(/=.*/, \"=;expires=\" + new Date().toUTCString() + \";path=/\"); \n      });\n      \n      // Clear axios default headers\n      if (this.$axios && this.$axios.defaults) {\n        this.$axios.defaults.headers.common['Authorization'] = '';\n        this.$axios.defaults.headers.common['X-CSRFToken'] = '';\n      }\n      \n      // Show notification\n      this.$store.dispatch('showToast', {\n        message: message || 'You have been logged out.',\n        type: 'error',\n        duration: 5000\n      });\n\n      // Redirect to login page\n      this.$router.push('/login');\n      \n      console.log('Complete logout finished');\n    },\n    handlePopupAction() {\n      // Handle popup action - you can add custom logic here\n      console.log('Popup action handled');\n    },\n    \n    // Ensure page scrolling is enabled\n    ensurePageScrollability() {\n      console.log('üîß Ensuring page scrollability...');\n      \n      // Reset body styles\n      document.body.style.overflow = 'auto';\n      document.body.style.position = 'static';\n      document.body.style.height = 'auto';\n      document.body.style.width = 'auto';\n      document.body.style.transform = 'none';\n      document.body.style.willChange = 'auto';\n      document.body.style.touchAction = 'auto';\n      document.body.style.pointerEvents = 'auto';\n      document.body.style.userSelect = 'auto';\n      document.body.style.webkitUserSelect = 'auto';\n      document.body.style.webkitOverflowScrolling = 'touch';\n      \n      // Reset html styles\n      document.documentElement.style.overflow = 'auto';\n      document.documentElement.style.height = 'auto';\n      document.documentElement.style.position = 'static';\n      document.documentElement.style.touchAction = 'auto';\n      \n      // Remove any video-related classes\n      document.body.classList.remove('vjs-fullscreen', 'video-playing', 'no-scroll', 'force-scrollable');\n      document.documentElement.classList.remove('vjs-fullscreen', 'video-playing', 'no-scroll');\n      \n      // Clear any inline styles that might block scroll\n      document.body.style.cssText = document.body.style.cssText.replace(/overflow:\\s*[^;]+;?/g, 'overflow: auto;');\n      document.documentElement.style.cssText = document.documentElement.style.cssText.replace(/overflow:\\s*[^;]+;?/g, 'overflow: auto;');\n      \n      // Force a reflow to ensure styles are applied\n      void document.body.offsetHeight;\n      void document.documentElement.offsetHeight;\n      \n      // Test scroll functionality\n      window.scrollTo(0, 1);\n      window.scrollTo(0, 0);\n      \n      console.log('‚úÖ Page scrollability ensured');\n    }\n  }\n}\n</script>\n\n<style>\nbody {\n  margin: 0;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  background: #121212;\n  color: white;\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n\nhtml {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n\n#app {\n  min-height: 100vh;\n  overflow-x: hidden;\n}\n\n/* Ensure scrolling works properly */\n.min-h-screen {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n\n/* Force scrollable class for emergency use */\n.force-scrollable {\n  overflow: auto !important;\n  position: static !important;\n  height: auto !important;\n  width: auto !important;\n  transform: none !important;\n  will-change: auto !important;\n  touch-action: auto !important;\n  pointer-events: auto !important;\n}\n</style>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAyC;;EAC7CA,KAAK,EAAC;AAAW;;;;;;uBADxBC,mBAAA,CAOM,OAPNC,UAOM,GANJC,mBAAA,CAKM,OALNC,UAKM,GAJJC,YAAA,CAA2BC,sBAAA,GACVC,QAAA,CAAAC,aAAa,I,cAA9BC,YAAA,CAAkCC,oBAAA;IAAAC,GAAA;EAAA,M,+BAClCN,YAAA,CAAqBO,4BAAA,GACrBP,YAAA,CAAgDQ,qBAAA;IAAnCC,aAAY,EAAEP,QAAA,CAAAQ;EAAiB,+B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}