{"ast":null,"code":"import api from '@/utils/api';\nexport default {\n  name: 'AdvertisementPlayer',\n  props: {\n    videoId: {\n      type: Number,\n      required: true\n    },\n    userId: {\n      type: Number,\n      required: true\n    },\n    adType: {\n      type: String,\n      default: 'pre_roll'\n    }\n  },\n  data() {\n    return {\n      showAd: false,\n      currentAd: null,\n      adQueue: [],\n      currentAdIndex: 0,\n      skipCountdown: 0,\n      canSkip: false,\n      videoDuration: 0,\n      watchedDuration: 0,\n      impressionTracked: false\n    };\n  },\n  async mounted() {\n    await this.loadAdvertisements();\n  },\n  methods: {\n    async loadAdvertisements() {\n      console.log('üîç Loading advertisements for video:', this.videoId, 'adType:', this.adType);\n      try {\n        const response = await api.get(`/api/video/${this.videoId}/ads/`);\n        console.log('üì° API Response:', response.data);\n        const ads = response.data[this.adType] || [];\n        console.log('üì∫ Ads for', this.adType, ':', ads);\n        if (ads.length > 0) {\n          this.adQueue = ads;\n          this.showAd = true;\n          console.log('‚úÖ Showing ads, queue length:', this.adQueue.length);\n          this.playNextAd();\n        } else {\n          console.log('‚ùå No ads found for type:', this.adType);\n          this.$emit('no-ads');\n        }\n      } catch (error) {\n        console.error('‚ùå Error loading advertisements:', error);\n        this.$emit('no-ads');\n      }\n    },\n    playNextAd() {\n      if (this.currentAdIndex < this.adQueue.length) {\n        this.currentAd = this.adQueue[this.currentAdIndex];\n        this.skipCountdown = this.currentAd.skip_after || 0;\n        this.canSkip = this.currentAd.skip_after > 0;\n        this.$nextTick(() => {\n          if (this.$refs.videoPlayer) {\n            this.$refs.videoPlayer.play();\n            this.trackImpression();\n          }\n        });\n      } else {\n        this.finishAdSequence();\n      }\n    },\n    onVideoLoad() {\n      this.videoDuration = this.$refs.videoPlayer.duration;\n    },\n    onTimeUpdate() {\n      if (this.$refs.videoPlayer) {\n        this.watchedDuration = this.$refs.videoPlayer.currentTime;\n\n        // Update skip countdown\n        if (this.canSkip && this.skipCountdown > 0) {\n          this.skipCountdown = Math.max(0, this.currentAd.skip_after - this.watchedDuration);\n        }\n      }\n    },\n    onAdEnd() {\n      this.currentAdIndex++;\n      if (this.currentAdIndex < this.adQueue.length) {\n        this.playNextAd();\n      } else {\n        this.finishAdSequence();\n      }\n    },\n    skipAd() {\n      this.currentAdIndex++;\n      if (this.currentAdIndex < this.adQueue.length) {\n        this.playNextAd();\n      } else {\n        this.finishAdSequence();\n      }\n    },\n    closeAd() {\n      this.finishAdSequence();\n    },\n    async onAdClick() {\n      if (this.currentAd && this.currentAd.external_url) {\n        // Track click\n        await this.trackClick();\n\n        // Open external URL\n        window.open(this.currentAd.external_url, '_blank');\n      }\n    },\n    async trackImpression() {\n      if (!this.impressionTracked && this.currentAd) {\n        try {\n          await api.post(`/api/advertisements/${this.currentAd.id}/track_impression/`, {\n            user_id: this.userId,\n            video_id: this.videoId,\n            impression_type: this.adType\n          });\n          this.impressionTracked = true;\n        } catch (error) {\n          console.error('Error tracking impression:', error);\n        }\n      }\n    },\n    async trackClick() {\n      if (this.currentAd) {\n        try {\n          await api.post(`/api/advertisements/${this.currentAd.id}/track_click/`, {\n            user_id: this.userId,\n            video_id: this.videoId\n          });\n        } catch (error) {\n          console.error('Error tracking click:', error);\n        }\n      }\n    },\n    finishAdSequence() {\n      this.showAd = false;\n      this.$emit('ads-finished');\n    }\n  }\n};","map":{"version":3,"names":["api","name","props","videoId","type","Number","required","userId","adType","String","default","data","showAd","currentAd","adQueue","currentAdIndex","skipCountdown","canSkip","videoDuration","watchedDuration","impressionTracked","mounted","loadAdvertisements","methods","console","log","response","get","ads","length","playNextAd","$emit","error","skip_after","$nextTick","$refs","videoPlayer","play","trackImpression","finishAdSequence","onVideoLoad","duration","onTimeUpdate","currentTime","Math","max","onAdEnd","skipAd","closeAd","onAdClick","external_url","trackClick","window","open","post","id","user_id","video_id","impression_type"],"sources":["D:\\OTT\\ott_frontend\\ott_frontend\\src\\components\\AdvertisementPlayer.vue"],"sourcesContent":["<template>\n  <div class=\"advertisement-player\" v-if=\"showAd\">\n    <div class=\"ad-overlay\">\n      <div class=\"ad-container\">\n        <!-- Ad Header -->\n        <div class=\"ad-header\">\n          <div class=\"ad-badge\">\n            <i class=\"fas fa-ad\"></i>\n            Advertisement\n          </div>\n          <div class=\"ad-controls\">\n            <span v-if=\"canSkip\" class=\"skip-timer\">\n              Skip in {{ skipCountdown }}s\n            </span>\n            <button \n              v-if=\"canSkip && skipCountdown <= 0\" \n              @click=\"skipAd\"\n              class=\"skip-button\"\n            >\n              Skip Ad\n            </button>\n            <button @click=\"closeAd\" class=\"close-button\">\n              <i class=\"fas fa-times\"></i>\n            </button>\n          </div>\n        </div>\n\n        <!-- Video Player -->\n        <div class=\"video-container\">\n          <video\n            ref=\"videoPlayer\"\n            :src=\"currentAd.video_file\"\n            @loadedmetadata=\"onVideoLoad\"\n            @timeupdate=\"onTimeUpdate\"\n            @ended=\"onAdEnd\"\n            @click=\"onAdClick\"\n            class=\"ad-video\"\n            controls\n            preload=\"metadata\"\n          >\n            Your browser does not support the video tag.\n          </video>\n        </div>\n\n        <!-- Ad Info -->\n        <div class=\"ad-info\">\n          <h3 class=\"ad-title\">{{ currentAd.title }}</h3>\n          <p class=\"ad-description\">{{ currentAd.description }}</p>\n          <button \n            v-if=\"currentAd.external_url\"\n            @click=\"onAdClick\"\n            class=\"cta-button\"\n          >\n            {{ currentAd.call_to_action || 'Learn More' }}\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport api from '@/utils/api'\n\nexport default {\n  name: 'AdvertisementPlayer',\n  props: {\n    videoId: {\n      type: Number,\n      required: true\n    },\n    userId: {\n      type: Number,\n      required: true\n    },\n    adType: {\n      type: String,\n      default: 'pre_roll'\n    }\n  },\n  data() {\n    return {\n      showAd: false,\n      currentAd: null,\n      adQueue: [],\n      currentAdIndex: 0,\n      skipCountdown: 0,\n      canSkip: false,\n      videoDuration: 0,\n      watchedDuration: 0,\n      impressionTracked: false\n    }\n  },\n  async mounted() {\n    await this.loadAdvertisements()\n  },\n  methods: {\n    async loadAdvertisements() {\n      console.log('üîç Loading advertisements for video:', this.videoId, 'adType:', this.adType)\n      try {\n        const response = await api.get(`/api/video/${this.videoId}/ads/`)\n        console.log('üì° API Response:', response.data)\n        const ads = response.data[this.adType] || []\n        console.log('üì∫ Ads for', this.adType, ':', ads)\n        \n        if (ads.length > 0) {\n          this.adQueue = ads\n          this.showAd = true\n          console.log('‚úÖ Showing ads, queue length:', this.adQueue.length)\n          this.playNextAd()\n        } else {\n          console.log('‚ùå No ads found for type:', this.adType)\n          this.$emit('no-ads')\n        }\n      } catch (error) {\n        console.error('‚ùå Error loading advertisements:', error)\n        this.$emit('no-ads')\n      }\n    },\n\n    playNextAd() {\n      if (this.currentAdIndex < this.adQueue.length) {\n        this.currentAd = this.adQueue[this.currentAdIndex]\n        this.skipCountdown = this.currentAd.skip_after || 0\n        this.canSkip = this.currentAd.skip_after > 0\n        \n        this.$nextTick(() => {\n          if (this.$refs.videoPlayer) {\n            this.$refs.videoPlayer.play()\n            this.trackImpression()\n          }\n        })\n      } else {\n        this.finishAdSequence()\n      }\n    },\n\n    onVideoLoad() {\n      this.videoDuration = this.$refs.videoPlayer.duration\n    },\n\n    onTimeUpdate() {\n      if (this.$refs.videoPlayer) {\n        this.watchedDuration = this.$refs.videoPlayer.currentTime\n        \n        // Update skip countdown\n        if (this.canSkip && this.skipCountdown > 0) {\n          this.skipCountdown = Math.max(0, this.currentAd.skip_after - this.watchedDuration)\n        }\n      }\n    },\n\n    onAdEnd() {\n      this.currentAdIndex++\n      if (this.currentAdIndex < this.adQueue.length) {\n        this.playNextAd()\n      } else {\n        this.finishAdSequence()\n      }\n    },\n\n    skipAd() {\n      this.currentAdIndex++\n      if (this.currentAdIndex < this.adQueue.length) {\n        this.playNextAd()\n      } else {\n        this.finishAdSequence()\n      }\n    },\n\n    closeAd() {\n      this.finishAdSequence()\n    },\n\n    async onAdClick() {\n      if (this.currentAd && this.currentAd.external_url) {\n        // Track click\n        await this.trackClick()\n        \n        // Open external URL\n        window.open(this.currentAd.external_url, '_blank')\n      }\n    },\n\n    async trackImpression() {\n      if (!this.impressionTracked && this.currentAd) {\n        try {\n          await api.post(`/api/advertisements/${this.currentAd.id}/track_impression/`, {\n            user_id: this.userId,\n            video_id: this.videoId,\n            impression_type: this.adType\n          })\n          this.impressionTracked = true\n        } catch (error) {\n          console.error('Error tracking impression:', error)\n        }\n      }\n    },\n\n    async trackClick() {\n      if (this.currentAd) {\n        try {\n          await api.post(`/api/advertisements/${this.currentAd.id}/track_click/`, {\n            user_id: this.userId,\n            video_id: this.videoId\n          })\n        } catch (error) {\n          console.error('Error tracking click:', error)\n        }\n      }\n    },\n\n    finishAdSequence() {\n      this.showAd = false\n      this.$emit('ads-finished')\n    }\n  }\n}\n</script>\n\n<style scoped>\n.advertisement-player {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 9999;\n  background: rgba(0, 0, 0, 0.9);\n}\n\n.ad-overlay {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  height: 100%;\n  padding: 20px;\n}\n\n.ad-container {\n  background: #1a1a1a;\n  border-radius: 12px;\n  max-width: 800px;\n  width: 100%;\n  overflow: hidden;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);\n}\n\n.ad-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 20px;\n  background: #2a2a2a;\n  border-bottom: 1px solid #333;\n}\n\n.ad-badge {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #ff6b35;\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.ad-controls {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.skip-timer {\n  color: #888;\n  font-size: 14px;\n}\n\n.skip-button {\n  background: #ff6b35;\n  color: white;\n  border: none;\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.skip-button:hover {\n  background: #e55a2b;\n}\n\n.close-button {\n  background: none;\n  border: none;\n  color: #888;\n  font-size: 18px;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  transition: color 0.2s;\n}\n\n.close-button:hover {\n  color: white;\n}\n\n.video-container {\n  position: relative;\n  width: 100%;\n  background: #000;\n}\n\n.ad-video {\n  width: 100%;\n  height: auto;\n  cursor: pointer;\n}\n\n.ad-info {\n  padding: 20px;\n  background: #1a1a1a;\n}\n\n.ad-title {\n  color: white;\n  font-size: 18px;\n  font-weight: 600;\n  margin-bottom: 8px;\n}\n\n.ad-description {\n  color: #ccc;\n  font-size: 14px;\n  line-height: 1.5;\n  margin-bottom: 16px;\n}\n\n.cta-button {\n  background: linear-gradient(135deg, #ff6b35, #f7931e);\n  color: white;\n  border: none;\n  padding: 12px 24px;\n  border-radius: 8px;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: transform 0.2s;\n}\n\n.cta-button:hover {\n  transform: translateY(-2px);\n}\n\n@media (max-width: 768px) {\n  .ad-overlay {\n    padding: 10px;\n  }\n  \n  .ad-container {\n    max-width: 100%;\n  }\n  \n  .ad-header {\n    padding: 10px 15px;\n  }\n  \n  .ad-info {\n    padding: 15px;\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}