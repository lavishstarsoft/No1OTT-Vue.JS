{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport axios from 'axios';\nexport default {\n  name: 'RegistrationPage',\n  data() {\n    return {\n      form: {\n        firstName: '',\n        lastName: '',\n        email: '',\n        state: '',\n        district: '',\n        constituency: '',\n        mandal: '',\n        manualMandal: '',\n        village: '',\n        manualVillage: '',\n        address: '',\n        pincode: '',\n        termsAccepted: false,\n        phone: '',\n        referralCode: ''\n      },\n      token: null,\n      errors: {},\n      districts: [],\n      constituencies: [],\n      mandals: [],\n      villages: [],\n      states: [],\n      isLoadingStates: false,\n      isLoadingGoogleMaps: false,\n      apiBaseUrl: 'http://192.168.0.128:8001',\n      addressSuggestions: [],\n      placesService: null,\n      geocoder: null,\n      googleMapsLoaded: false,\n      selectedPlace: null,\n      googleMapsScriptLoaded: false,\n      isManualMandal: false,\n      isManualVillage: false,\n      isLoadingAddresses: false,\n      isLoadingPincode: false,\n      pincodeSuggestions: [],\n      addressSearchTimeout: null,\n      isLoading: false,\n      googleMapsApiKey: 'AIzaSyAYUmDhZ4ZWfwL15I2pYhEKcxhKEzEh2No',\n      // Google Maps API Key\n      isValidatingReferral: false,\n      referralStatus: {\n        valid: false,\n        message: ''\n      }\n    };\n  },\n  methods: {\n    async fetchStates() {\n      console.log('fetchStates method called');\n      try {\n        this.isLoadingStates = true;\n        this.errors.state = null;\n        const statesUrl = `${this.apiBaseUrl}/api/states/`;\n        console.log('Fetching states from URL:', statesUrl);\n        const response = await fetch(statesUrl, {\n          method: 'GET',\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n          },\n          credentials: 'include' // Add this to include cookies if needed\n        });\n        console.log('API Response status:', response.status);\n        if (!response.ok) {\n          throw new Error(`Server returned ${response.status}: ${response.statusText}`);\n        }\n        const data = await response.json();\n        console.log('Received states data:', data);\n        if (!Array.isArray(data)) {\n          throw new Error('Expected array of states but received different format');\n        }\n\n        // Process the states\n        this.states = data.map(state => ({\n          value: state.id,\n          label: state.name\n        }));\n        console.log('Processed states:', this.states);\n        if (this.states.length === 0) {\n          this.errors.state = 'No states available. Please try again.';\n        }\n      } catch (error) {\n        console.error('Error in fetchStates:', error);\n        this.errors.state = `Failed to load states: ${error.message}`;\n      } finally {\n        this.isLoadingStates = false;\n      }\n    },\n    async handleSubmit() {\n      console.log('Handle submit called');\n      if (this.validateForm()) {\n        let registrationResponse = null;\n        try {\n          console.log('Form validation passed, proceeding with submission');\n          this.isLoading = true;\n          this.errors = {};\n\n          // Get CSRF token\n          const csrfToken = localStorage.getItem('csrfToken');\n\n          // Prepare registration data\n          const registrationData = {\n            first_name: this.form.firstName,\n            last_name: this.form.lastName,\n            email: this.form.email,\n            phone: this.form.phone,\n            state: this.form.state,\n            district: this.form.district,\n            constituency: this.form.constituency,\n            mandal: this.isManualMandal ? this.form.manualMandal : this.form.mandal,\n            village: this.isManualVillage ? this.form.manualVillage : this.form.village,\n            address: this.form.address,\n            pincode: this.form.pincode,\n            referral_code: this.form.referralCode || null\n          };\n          console.log('Sending registration data:', registrationData);\n\n          // Complete registration\n          console.log('Completing registration...');\n          registrationResponse = await fetch(`${this.apiBaseUrl}/users/complete-registration/`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json',\n              'X-CSRFToken': csrfToken,\n              'X-Requested-With': 'XMLHttpRequest'\n            },\n            credentials: 'include',\n            body: JSON.stringify(registrationData)\n          });\n          console.log('Registration response status:', registrationResponse.status);\n          const registrationResult = await registrationResponse.json();\n          console.log('Registration response:', registrationResult);\n          if (registrationResponse.ok) {\n            console.log('Registration successful, updating local storage');\n            // Update stored user data\n            if (registrationResult.user) {\n              localStorage.setItem('user', JSON.stringify(registrationResult.user));\n            }\n            // Update CSRF token\n            if (registrationResult.csrf_token) {\n              localStorage.setItem('csrfToken', registrationResult.csrf_token);\n            }\n            localStorage.setItem('phone', this.form.phone);\n\n            // Store success message in localStorage for home page\n            localStorage.setItem('registrationSuccess', 'true');\n            localStorage.setItem('registrationMessage', 'Registration completed successfully!');\n\n            // Redirect to home page\n            window.location.href = '/';\n          } else {\n            throw new Error(registrationResult.message || 'Registration failed');\n          }\n        } catch (error) {\n          console.error('Registration error:', error);\n          this.errors.general = error.message || 'An error occurred during registration. Please try again.';\n          try {\n            // Show error toast if available\n            if (this.$toast) {\n              this.$toast.error(this.errors.general, {\n                position: 'top-right',\n                duration: 3000\n              });\n            }\n          } catch (toastError) {\n            console.warn('Toast notification failed:', toastError);\n          }\n\n          // If unauthorized, redirect to login\n          if (registrationResponse?.status === 401) {\n            window.location.href = '/login';\n          }\n        } finally {\n          this.isLoading = false;\n        }\n      }\n    },\n    async registerDevice(token) {\n      try {\n        const deviceData = {\n          device_type: 'web',\n          device_name: navigator.userAgent,\n          device_id: 'web-' + Math.random().toString(36).substr(2, 9),\n          device_model: navigator.platform,\n          os_version: navigator.userAgent,\n          app_version: '1.0.0'\n        };\n        const response = await fetch(`${this.apiBaseUrl}/devices/`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${token}`,\n            'X-Requested-With': 'XMLHttpRequest'\n          },\n          body: JSON.stringify(deviceData)\n        });\n        if (!response.ok) {\n          console.error('Failed to register device');\n        }\n      } catch (error) {\n        console.error('Error registering device:', error);\n      }\n    },\n    async handleAddressInput() {\n      if (!this.form.address || !this.googleMapsLoaded) {\n        this.addressSuggestions = [];\n        return;\n      }\n      if (this.addressSearchTimeout) {\n        clearTimeout(this.addressSearchTimeout);\n      }\n      this.isLoadingAddresses = true;\n      this.addressSearchTimeout = setTimeout(async () => {\n        try {\n          // Get the selected location names\n          const selectedState = this.states.find(s => s.value === this.form.state)?.label || '';\n          const selectedDistrict = this.districts.find(d => d.value === this.form.district)?.label || '';\n          const selectedConstituency = this.constituencies.find(c => c.value === this.form.constituency)?.label || '';\n          const selectedMandal = this.isManualMandal ? this.form.manualMandal : this.mandals.find(m => m.value === this.form.mandal)?.label || '';\n          const selectedVillage = this.isManualVillage ? this.form.manualVillage : this.villages.find(v => v.value === this.form.village)?.label || '';\n\n          // Build the search query with location context including constituency\n          const searchQuery = `${this.form.address}, ${selectedVillage}, ${selectedMandal}, ${selectedConstituency} constituency, ${selectedDistrict}, ${selectedState}, India`;\n          const predictions = await this.getPlacePredictions(searchQuery, true);\n          this.addressSuggestions = predictions;\n        } catch (error) {\n          console.error('Error fetching address suggestions:', error);\n          this.errors.maps = 'Unable to fetch address suggestions. Please try again.';\n        } finally {\n          this.isLoadingAddresses = false;\n        }\n      }, 300);\n    },\n    async getPlacePredictions(searchQuery, isDirectSearch = false) {\n      if (!this.placesService) {\n        console.error('Places service not initialized');\n        return [];\n      }\n      return new Promise((resolve, reject) => {\n        const options = {\n          input: searchQuery,\n          componentRestrictions: {\n            country: 'IN'\n          },\n          language: 'en',\n          types: isDirectSearch ? ['address', 'establishment'] : ['geocode']\n        };\n        this.placesService.getPlacePredictions(options, (results, status) => {\n          console.log('Places API response:', {\n            status,\n            results,\n            query: searchQuery\n          });\n          if (status === window.google.maps.places.PlacesServiceStatus.OK && results) {\n            resolve(results);\n          } else if (status === window.google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {\n            resolve([]);\n          } else {\n            console.warn('Places API returned status:', status);\n            reject(new Error(`Places API returned status: ${status}`));\n          }\n        });\n      });\n    },\n    async selectAddress(suggestion) {\n      this.isLoadingPincode = true;\n      try {\n        const placeResult = await this.getPlaceDetails(suggestion.place_id);\n        console.log('Selected place details:', placeResult);\n        const formattedAddress = this.formatAddress(placeResult);\n        this.form.address = formattedAddress;\n        const pincode = await this.extractPincode(placeResult);\n        if (pincode) {\n          this.form.pincode = pincode;\n          delete this.errors.pincode;\n        }\n        this.addressSuggestions = [];\n        this.selectedPlace = placeResult;\n      } catch (error) {\n        console.error('Error in selectAddress:', error);\n        this.errors.maps = 'Error retrieving address details. Please try again.';\n      } finally {\n        this.isLoadingPincode = false;\n      }\n    },\n    formatAddress(placeResult) {\n      const components = {\n        street_number: '',\n        route: '',\n        sublocality_level_1: '',\n        locality: '',\n        administrative_area_level_2: '',\n        administrative_area_level_1: '',\n        postal_code: ''\n      };\n      placeResult.address_components.forEach(component => {\n        const type = component.types[0];\n        if (Object.prototype.hasOwnProperty.call(components, type)) {\n          components[type] = component.long_name;\n        }\n      });\n      let formattedAddress = '';\n      if (components.street_number) formattedAddress += components.street_number + ' ';\n      if (components.route) formattedAddress += components.route + ', ';\n      if (components.sublocality_level_1) formattedAddress += components.sublocality_level_1 + ', ';\n      if (components.locality) formattedAddress += components.locality + ', ';\n      if (components.administrative_area_level_2) formattedAddress += components.administrative_area_level_2 + ', ';\n      if (components.administrative_area_level_1) formattedAddress += components.administrative_area_level_1;\n      if (components.postal_code) formattedAddress += ' - ' + components.postal_code;\n      return formattedAddress.trim().replace(/,\\s*$/, '');\n    },\n    async getPlaceDetails(placeId) {\n      return new Promise((resolve, reject) => {\n        this.detailedPlacesService.getDetails({\n          placeId: placeId,\n          fields: ['address_components', 'formatted_address', 'geometry', 'name']\n        }, (result, status) => {\n          if (status === 'OK') {\n            resolve(result);\n          } else {\n            reject(new Error(`Place details failed with status: ${status}`));\n          }\n        });\n      });\n    },\n    async extractPincode(placeResult) {\n      for (const component of placeResult.address_components) {\n        if (component.types.includes('postal_code')) {\n          return component.long_name;\n        }\n      }\n      if (placeResult.geometry?.location) {\n        try {\n          return await this.getPincodeFromCoordinates(placeResult.geometry.location.lat(), placeResult.geometry.location.lng());\n        } catch (error) {\n          console.warn('Failed to get pincode from coordinates:', error);\n        }\n      }\n      return null;\n    },\n    async getPincodeFromCoordinates(lat, lng) {\n      return new Promise((resolve, reject) => {\n        if (!this.geocoder) {\n          this.geocoder = new window.google.maps.Geocoder();\n        }\n        this.geocoder.geocode({\n          location: {\n            lat,\n            lng\n          }\n        }, (results, status) => {\n          if (status === 'OK') {\n            for (let result of results) {\n              for (let component of result.address_components) {\n                if (component.types.includes('postal_code')) {\n                  resolve(component.long_name);\n                  return;\n                }\n              }\n            }\n            reject(new Error('No pincode found in geocoding results'));\n          } else {\n            reject(new Error(`Geocoding failed with status: ${status}`));\n          }\n        });\n      });\n    },\n    async fetchDistricts(stateId) {\n      try {\n        console.log('Fetching districts for state:', stateId);\n        const response = await fetch(`${this.apiBaseUrl}/api/frontend/districts/?state_id=${stateId}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const result = await response.json();\n        console.log('Districts API response:', result);\n        if (result.status === 'success') {\n          this.districts = result.data.map(district => ({\n            value: district.id,\n            label: district.name\n          }));\n          console.log('Mapped districts:', this.districts);\n        } else {\n          console.error('Error fetching districts:', result.message);\n          this.errors.district = 'Failed to load districts. Please try again.';\n        }\n      } catch (error) {\n        console.error('Error fetching districts:', error);\n        this.errors.district = 'Failed to load districts. Please check your connection.';\n      }\n    },\n    async fetchConstituencies(districtId) {\n      try {\n        console.log('Fetching constituencies for district:', districtId);\n        const response = await fetch(`${this.apiBaseUrl}/api/frontend/constituencies/?district_id=${districtId}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const result = await response.json();\n        console.log('Constituencies API response:', result);\n        if (result.status === 'success') {\n          this.constituencies = result.data.map(constituency => ({\n            value: constituency.id,\n            label: constituency.name\n          }));\n          console.log('Mapped constituencies:', this.constituencies);\n        } else {\n          console.error('Error fetching constituencies:', result.message);\n          this.errors.constituency = 'Failed to load constituencies. Please try again.';\n        }\n      } catch (error) {\n        console.error('Error fetching constituencies:', error);\n        this.errors.constituency = 'Failed to load constituencies. Please check your connection.';\n      }\n    },\n    async fetchMandals(constituencyId) {\n      try {\n        console.log('Fetching mandals for constituency:', constituencyId);\n        const response = await fetch(`${this.apiBaseUrl}/api/frontend/mandals/?constituency_id=${constituencyId}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const result = await response.json();\n        console.log('Mandals API response:', result);\n        if (result.status === 'success') {\n          this.mandals = result.data.map(mandal => ({\n            value: mandal.id,\n            label: mandal.name\n          }));\n          console.log('Mapped mandals:', this.mandals);\n        } else {\n          console.error('Error fetching mandals:', result.message);\n          this.errors.mandal = 'Failed to load mandals. Please try again.';\n        }\n      } catch (error) {\n        console.error('Error fetching mandals:', error);\n        this.errors.mandal = 'Failed to load mandals. Please check your connection.';\n      }\n    },\n    async fetchVillages(mandalId) {\n      try {\n        console.log('Fetching villages for mandal:', mandalId);\n        const response = await fetch(`${this.apiBaseUrl}/api/frontend/villages/?mandal_id=${mandalId}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const result = await response.json();\n        console.log('Villages API response:', result);\n        if (result.status === 'success') {\n          this.villages = result.data.map(village => ({\n            value: village.id,\n            label: village.name\n          }));\n          console.log('Mapped villages:', this.villages);\n        } else {\n          console.error('Error fetching villages:', result.message);\n          this.errors.village = 'Failed to load villages. Please try again.';\n        }\n      } catch (error) {\n        console.error('Error fetching villages:', error);\n        this.errors.village = 'Failed to load villages. Please check your connection.';\n      }\n    },\n    async handleStateChange() {\n      console.log('State changed to:', this.form.state);\n      // Reset dependent fields\n      this.form.district = '';\n      this.form.constituency = '';\n      this.form.mandal = '';\n      this.form.village = '';\n      this.districts = [];\n      this.constituencies = [];\n      this.mandals = [];\n      this.villages = [];\n      if (this.form.state) {\n        await this.fetchDistricts(this.form.state);\n      }\n    },\n    async handleDistrictChange() {\n      console.log('District changed to:', this.form.district);\n      // Reset dependent fields\n      this.form.constituency = '';\n      this.form.mandal = '';\n      this.form.village = '';\n      this.constituencies = [];\n      this.mandals = [];\n      this.villages = [];\n      if (this.form.district) {\n        await this.fetchConstituencies(this.form.district);\n      }\n    },\n    async handleConstituencyChange() {\n      console.log('Constituency changed to:', this.form.constituency);\n      // Reset dependent fields\n      this.form.mandal = '';\n      this.form.village = '';\n      this.mandals = [];\n      this.villages = [];\n      if (this.form.constituency) {\n        await this.fetchMandals(this.form.constituency);\n      }\n    },\n    async handleMandalChange() {\n      console.log('Mandal changed to:', this.form.mandal);\n      // Reset dependent fields\n      this.form.village = '';\n      this.form.manualVillage = '';\n      this.villages = [];\n      this.addressSuggestions = [];\n      this.form.address = '';\n      this.form.pincode = '';\n      if (this.form.mandal) {\n        await this.fetchVillages(this.form.mandal);\n      }\n    },\n    async handleVillageChange() {\n      // Reset address fields\n      this.form.address = '';\n      this.form.pincode = '';\n      this.addressSuggestions = [];\n\n      // Trigger address search when village is selected\n      if (this.form.village) {\n        await this.searchAddress();\n      }\n    },\n    allowOnlyNumbers(event) {\n      // Allow only number keys (0-9) and navigation keys\n      const isNumber = /[0-9]/.test(event.key);\n      const isNavigationKey = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab'].includes(event.key);\n      if (!isNumber && !isNavigationKey) {\n        event.preventDefault();\n      }\n\n      // Prevent input if length is already 6 and not deleting\n      if (this.form.pincode.length >= 6 && !isNavigationKey) {\n        event.preventDefault();\n      }\n    },\n    validatePincode(event) {\n      // Remove any non-numeric characters\n      this.form.pincode = event.target.value.replace(/\\D/g, '').slice(0, 6);\n\n      // Clear error if valid, show error if invalid\n      if (this.form.pincode.length === 6) {\n        delete this.errors.pincode;\n      } else if (this.form.pincode.length > 0) {\n        this.errors.pincode = 'Pincode must be exactly 6 digits';\n      }\n    },\n    toggleMandalInput() {\n      this.isManualMandal = !this.isManualMandal;\n      if (this.isManualMandal) {\n        this.form.mandal = '';\n        this.form.manualMandal = '';\n      } else {\n        this.form.manualMandal = '';\n      }\n      // Clear dependent fields\n      this.form.village = '';\n      this.form.manualVillage = '';\n      this.villages = [];\n    },\n    toggleVillageInput() {\n      this.isManualVillage = !this.isManualVillage;\n      if (this.isManualVillage) {\n        this.form.village = '';\n        this.form.manualVillage = '';\n      } else {\n        this.form.manualVillage = '';\n      }\n    },\n    handleManualMandalChange() {\n      // Clear village when mandal changes\n      this.form.village = '';\n      this.form.manualVillage = '';\n      this.villages = [];\n      if (this.form.manualMandal) {\n        delete this.errors.mandal;\n        this.fetchManualMandal(this.form.manualMandal);\n      }\n    },\n    handleManualVillageChange() {\n      if (this.form.manualVillage) {\n        delete this.errors.village;\n        this.fetchManualVillage(this.form.manualVillage);\n        this.searchAddressWithManualLocation();\n      }\n    },\n    async fetchManualMandal(mandalName) {\n      try {\n        const response = await fetch(`${this.apiBaseUrl}/mandals/search/?name=${encodeURIComponent(mandalName)}&constituency_id=${this.form.constituency}`);\n        const result = await response.json();\n        if (result.status === 'success' && result.data.length > 0) {\n          // If exact match found, use it\n          const exactMatch = result.data.find(m => m.name.toLowerCase() === mandalName.toLowerCase());\n          if (exactMatch) {\n            this.form.mandal = exactMatch.id;\n            await this.fetchVillages(exactMatch.id);\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching manual mandal:', error);\n      }\n    },\n    async fetchManualVillage(villageName) {\n      try {\n        const mandalId = this.form.mandal || '';\n        const response = await fetch(`${this.apiBaseUrl}/villages/search/?name=${encodeURIComponent(villageName)}&mandal_id=${mandalId}`);\n        const result = await response.json();\n        if (result.status === 'success' && result.data.length > 0) {\n          // If exact match found, use it\n          const exactMatch = result.data.find(v => v.name.toLowerCase() === villageName.toLowerCase());\n          if (exactMatch) {\n            this.form.village = exactMatch.id;\n            this.searchAddress();\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching manual village:', error);\n      }\n    },\n    async searchAddressWithManualLocation() {\n      if (!this.googleMapsLoaded) return;\n      try {\n        // Get the selected location names\n        const selectedState = this.states.find(s => s.value === this.form.state)?.label || '';\n        const selectedDistrict = this.districts.find(d => d.value === this.form.district)?.label || '';\n        const selectedConstituency = this.constituencies.find(c => c.value === this.form.constituency)?.label || '';\n        const mandalName = this.isManualMandal ? this.form.manualMandal : this.mandals.find(m => m.value === this.form.mandal)?.label || '';\n        const villageName = this.isManualVillage ? this.form.manualVillage : this.villages.find(v => v.value === this.form.village)?.label || '';\n        if (!villageName) return;\n\n        // First try with full address including constituency\n        let searchQuery = `${villageName}, ${mandalName}, ${selectedConstituency} constituency, ${selectedDistrict}, ${selectedState}, India`;\n        let predictions = await this.getPlacePredictions(searchQuery);\n\n        // If no results, try without constituency\n        if (!predictions.length) {\n          searchQuery = `${villageName}, ${mandalName}, ${selectedDistrict}, ${selectedState}, India`;\n          predictions = await this.getPlacePredictions(searchQuery);\n        }\n\n        // If still no results, try with village and district format\n        if (!predictions.length) {\n          searchQuery = `${villageName} village, ${selectedConstituency} constituency, ${selectedDistrict} district, ${selectedState}, India`;\n          predictions = await this.getPlacePredictions(searchQuery);\n        }\n        this.addressSuggestions = predictions;\n\n        // Auto-select if only one result\n        if (predictions.length === 1) {\n          await this.selectAddress(predictions[0]);\n        }\n      } catch (error) {\n        console.error('Error in manual location search:', error);\n      }\n    },\n    validateForm() {\n      console.log('Validating form...');\n      this.errors = {};\n      let isValid = true;\n\n      // Required fields validation\n      if (!this.form.firstName) {\n        this.errors.firstName = 'First name is required';\n        isValid = false;\n      }\n      if (!this.form.lastName) {\n        this.errors.lastName = 'Last name is required';\n        isValid = false;\n      }\n      // Email validation (only if provided)\n      if (this.form.email && !this.isValidEmail(this.form.email)) {\n        this.errors.email = 'Please enter a valid email address';\n        isValid = false;\n      }\n      if (!this.form.state) {\n        this.errors.state = 'State is required';\n        isValid = false;\n      }\n      if (!this.form.district) {\n        this.errors.district = 'District is required';\n        isValid = false;\n      }\n      if (!this.form.constituency) {\n        this.errors.constituency = 'Constituency is required';\n        isValid = false;\n      }\n\n      // Mandal validation\n      if (!this.isManualMandal && !this.form.mandal) {\n        this.errors.mandal = 'Mandal is required';\n        isValid = false;\n      } else if (this.isManualMandal && !this.form.manualMandal) {\n        this.errors.mandal = 'Mandal name is required';\n        isValid = false;\n      }\n\n      // Village validation\n      if (!this.isManualVillage && !this.form.village) {\n        this.errors.village = 'Village is required';\n        isValid = false;\n      } else if (this.isManualVillage && !this.form.manualVillage) {\n        this.errors.village = 'Village name is required';\n        isValid = false;\n      }\n\n      // Address and Pincode validation\n      if (!this.form.address) {\n        this.errors.address = 'Address is required';\n        isValid = false;\n      }\n      if (!this.form.pincode) {\n        this.errors.pincode = 'Pincode is required';\n        isValid = false;\n      } else if (!/^\\d{6}$/.test(this.form.pincode)) {\n        this.errors.pincode = 'Pincode must be exactly 6 digits';\n        isValid = false;\n      }\n\n      // Terms acceptance\n      if (!this.form.termsAccepted) {\n        this.errors.terms = 'You must accept the Terms & Conditions to continue';\n        isValid = false;\n      }\n\n      // Referral code validation (only if provided)\n      if (this.form.referralCode && !this.referralStatus.valid) {\n        this.errors.referralCode = 'Please verify the referral code';\n        isValid = false;\n      }\n      console.log('Validation result:', {\n        isValid,\n        errors: this.errors\n      });\n      return isValid;\n    },\n    isValidEmail(email) {\n      const re = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n      return re.test(email);\n    },\n    initGoogleMaps() {\n      return new Promise((resolve, reject) => {\n        try {\n          console.log('Starting Google Maps initialization');\n          this.isLoadingGoogleMaps = true;\n\n          // Check if script is already loaded\n          if (window.google && window.google.maps) {\n            console.log('Google Maps already loaded, initializing services');\n            this.initPlacesService();\n            this.isLoadingGoogleMaps = false;\n            this.googleMapsLoaded = true;\n            resolve();\n            return;\n          }\n\n          // Create script element\n          const script = document.createElement('script');\n          script.src = `https://maps.googleapis.com/maps/api/js?key=${this.googleMapsApiKey}&libraries=places&callback=initGoogleCallback`;\n          script.async = true;\n          script.defer = true;\n\n          // Define callback\n          window.initGoogleCallback = () => {\n            console.log('Google Maps loaded successfully');\n            this.googleMapsScriptLoaded = true;\n            this.initPlacesService();\n            this.googleMapsLoaded = true;\n            this.isLoadingGoogleMaps = false;\n            resolve();\n          };\n\n          // Error handling\n          script.onerror = error => {\n            console.error('Error loading Google Maps:', error);\n            this.errors.maps = 'Failed to load Google Maps. Please check your internet connection.';\n            this.isLoadingGoogleMaps = false;\n            reject(error);\n          };\n\n          // Add script to document\n          document.head.appendChild(script);\n          console.log('Google Maps script added to document');\n        } catch (error) {\n          console.error('Error in initGoogleMaps:', error);\n          this.errors.maps = 'Failed to initialize Google Maps.';\n          this.isLoadingGoogleMaps = false;\n          reject(error);\n        }\n      });\n    },\n    initPlacesService() {\n      try {\n        console.log('Initializing Places Service');\n        if (!window.google || !window.google.maps) {\n          throw new Error('Google Maps not loaded');\n        }\n\n        // Remove existing map div if any\n        const existingMapDiv = document.getElementById('places-service-map');\n        if (existingMapDiv) {\n          existingMapDiv.remove();\n        }\n\n        // Create hidden div for PlacesService\n        const mapDiv = document.createElement('div');\n        mapDiv.style.display = 'none';\n        mapDiv.id = 'places-service-map';\n        document.body.appendChild(mapDiv);\n\n        // Initialize map for PlacesService\n        const map = new window.google.maps.Map(mapDiv, {\n          center: {\n            lat: -34.397,\n            lng: 150.644\n          },\n          zoom: 8\n        });\n\n        // Initialize services\n        this.placesService = new window.google.maps.places.AutocompleteService();\n        this.geocoder = new window.google.maps.Geocoder();\n        this.detailedPlacesService = new window.google.maps.places.PlacesService(map);\n        console.log('Places service initialized successfully');\n        this.googleMapsLoaded = true;\n        delete this.errors.maps;\n      } catch (error) {\n        console.error('Error initializing places service:', error);\n        this.errors.maps = 'Failed to initialize location services.';\n        this.googleMapsLoaded = false;\n      }\n    },\n    async searchAddress() {\n      console.log('searchAddress called with current state:', {\n        googleMapsLoaded: this.googleMapsLoaded,\n        placesService: !!this.placesService,\n        village: this.form.village\n      });\n      if (!this.googleMapsLoaded || !this.placesService) {\n        console.log('Reinitializing Google Maps');\n        try {\n          await this.initGoogleMaps();\n        } catch (error) {\n          console.error('Failed to reinitialize Google Maps:', error);\n          return;\n        }\n      }\n      if (!this.form.village) {\n        console.log('No village selected');\n        return;\n      }\n      try {\n        const selectedState = this.states.find(s => s.value === this.form.state)?.label || '';\n        const selectedDistrict = this.districts.find(d => d.value === this.form.district)?.label || '';\n        const selectedConstituency = this.constituencies.find(c => c.value === this.form.constituency)?.label || '';\n        const selectedMandal = this.mandals.find(m => m.value === this.form.mandal)?.label || '';\n        const selectedVillage = this.villages.find(v => v.value === this.form.village)?.label || '';\n        console.log('Searching with location data:', {\n          state: selectedState,\n          district: selectedDistrict,\n          constituency: selectedConstituency,\n          mandal: selectedMandal,\n          village: selectedVillage\n        });\n\n        // First try with full address including constituency\n        let searchQuery = `${selectedVillage}, ${selectedMandal}, ${selectedConstituency} constituency, ${selectedDistrict}, ${selectedState}, India`;\n        console.log('Trying search with query:', searchQuery);\n        let predictions = await this.getPlacePredictions(searchQuery);\n\n        // If no results, try without constituency\n        if (!predictions.length) {\n          searchQuery = `${selectedVillage}, ${selectedMandal}, ${selectedDistrict}, ${selectedState}, India`;\n          console.log('Retrying with simplified query:', searchQuery);\n          predictions = await this.getPlacePredictions(searchQuery);\n        }\n        this.addressSuggestions = predictions;\n        console.log('Got address suggestions:', predictions);\n        if (predictions.length === 1) {\n          await this.selectAddress(predictions[0]);\n        }\n      } catch (error) {\n        console.error('Error in searchAddress:', error);\n        this.errors.maps = 'Unable to fetch address suggestions. Please try again.';\n      }\n    },\n    handleReferralInput() {\n      // Convert to uppercase\n      this.form.referralCode = this.form.referralCode.toUpperCase();\n      // Reset validation status\n      this.referralStatus.valid = false;\n      this.referralStatus.message = '';\n      this.errors.referralCode = '';\n    },\n    async verifyReferralCode() {\n      if (!this.form.referralCode) return;\n      this.isValidatingReferral = true;\n      this.errors.referralCode = '';\n      try {\n        const response = await axios.get(`${this.apiBaseUrl}/users/verify-referral/`, {\n          params: {\n            code: this.form.referralCode\n          },\n          headers: {\n            'Accept': 'application/json'\n          }\n        });\n        const data = response.data;\n        if (data.status === 'success') {\n          this.referralStatus.valid = true;\n          this.referralStatus.message = 'Valid referral code';\n          this.errors.referralCode = '';\n        } else {\n          this.referralStatus.valid = false;\n          this.errors.referralCode = data.message || 'Invalid referral code';\n        }\n      } catch (error) {\n        console.error('Error verifying referral code:', error);\n        this.errors.referralCode = error.response?.data?.message || 'Failed to verify referral code';\n        this.referralStatus.valid = false;\n      } finally {\n        this.isValidatingReferral = false;\n      }\n    }\n  },\n  async created() {\n    console.log('Component created - Starting initialization');\n    try {\n      // Get phone number and token from query params or localStorage\n      this.form.phone = this.$route.query.phone || localStorage.getItem('phone') || '';\n\n      // Try to get token from multiple sources\n      this.token = this.$route.query.token || localStorage.getItem('token') || localStorage.getItem('user') && JSON.parse(localStorage.getItem('user')).token;\n      console.log('Initial token:', this.token);\n      if (!this.form.phone) {\n        console.error('Missing phone number');\n        this.errors.general = 'Missing phone number. Please try logging in again.';\n        this.$router.push('/login');\n        return;\n      }\n      if (!this.token) {\n        console.error('Missing token');\n        this.errors.general = 'Authentication token is missing. Please try logging in again.';\n        this.$router.push('/login');\n        return;\n      }\n\n      // Store phone number in localStorage if not already there\n      if (!localStorage.getItem('phone')) {\n        localStorage.setItem('phone', this.form.phone);\n      }\n\n      // Initialize Google Maps first\n      console.log('Initializing Google Maps');\n      await this.initGoogleMaps();\n      console.log('Starting to fetch states');\n      await this.fetchStates();\n\n      // Check for referral code in URL\n      const urlParams = new URLSearchParams(window.location.search);\n      const referralCode = urlParams.get('ref');\n      if (referralCode) {\n        this.form.referralCode = referralCode.toUpperCase();\n        // Automatically verify the referral code\n        await this.verifyReferralCode();\n      }\n    } catch (error) {\n      console.error('Error in component creation:', error);\n      this.errors.general = 'Failed to initialize the form. Please refresh the page.';\n    }\n  },\n  mounted() {\n    console.log('Component mounted - Checking states:', {\n      statesLength: this.states.length,\n      states: this.states\n    });\n\n    // If states are empty, try loading them again\n    if (this.states.length === 0 && !this.isLoadingStates) {\n      console.log('States are empty, fetching again');\n      this.fetchStates();\n    }\n  },\n  beforeUnmount() {\n    const mapDiv = document.getElementById('places-service-map');\n    if (mapDiv) {\n      mapDiv.remove();\n    }\n  }\n};","map":{"version":3,"names":["axios","name","data","form","firstName","lastName","email","state","district","constituency","mandal","manualMandal","village","manualVillage","address","pincode","termsAccepted","phone","referralCode","token","errors","districts","constituencies","mandals","villages","states","isLoadingStates","isLoadingGoogleMaps","apiBaseUrl","addressSuggestions","placesService","geocoder","googleMapsLoaded","selectedPlace","googleMapsScriptLoaded","isManualMandal","isManualVillage","isLoadingAddresses","isLoadingPincode","pincodeSuggestions","addressSearchTimeout","isLoading","googleMapsApiKey","isValidatingReferral","referralStatus","valid","message","methods","fetchStates","console","log","statesUrl","response","fetch","method","headers","credentials","status","ok","Error","statusText","json","Array","isArray","map","value","id","label","length","error","handleSubmit","validateForm","registrationResponse","csrfToken","localStorage","getItem","registrationData","first_name","last_name","referral_code","body","JSON","stringify","registrationResult","user","setItem","csrf_token","window","location","href","general","$toast","position","duration","toastError","warn","registerDevice","deviceData","device_type","device_name","navigator","userAgent","device_id","Math","random","toString","substr","device_model","platform","os_version","app_version","handleAddressInput","clearTimeout","setTimeout","selectedState","find","s","selectedDistrict","d","selectedConstituency","c","selectedMandal","m","selectedVillage","v","searchQuery","predictions","getPlacePredictions","maps","isDirectSearch","Promise","resolve","reject","options","input","componentRestrictions","country","language","types","results","query","google","places","PlacesServiceStatus","OK","ZERO_RESULTS","selectAddress","suggestion","placeResult","getPlaceDetails","place_id","formattedAddress","formatAddress","extractPincode","components","street_number","route","sublocality_level_1","locality","administrative_area_level_2","administrative_area_level_1","postal_code","address_components","forEach","component","type","Object","prototype","hasOwnProperty","call","long_name","trim","replace","placeId","detailedPlacesService","getDetails","fields","result","includes","geometry","getPincodeFromCoordinates","lat","lng","Geocoder","geocode","fetchDistricts","stateId","fetchConstituencies","districtId","fetchMandals","constituencyId","fetchVillages","mandalId","handleStateChange","handleDistrictChange","handleConstituencyChange","handleMandalChange","handleVillageChange","searchAddress","allowOnlyNumbers","event","isNumber","test","key","isNavigationKey","preventDefault","validatePincode","target","slice","toggleMandalInput","toggleVillageInput","handleManualMandalChange","fetchManualMandal","handleManualVillageChange","fetchManualVillage","searchAddressWithManualLocation","mandalName","encodeURIComponent","exactMatch","toLowerCase","villageName","isValid","isValidEmail","terms","re","initGoogleMaps","initPlacesService","script","document","createElement","src","async","defer","initGoogleCallback","onerror","head","appendChild","existingMapDiv","getElementById","remove","mapDiv","style","display","Map","center","zoom","AutocompleteService","PlacesService","handleReferralInput","toUpperCase","verifyReferralCode","get","params","code","created","$route","parse","$router","push","urlParams","URLSearchParams","search","mounted","statesLength","beforeUnmount"],"sources":["D:\\OTT\\ott_frontend\\src\\components\\RegistrationPage.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-[#121212] flex items-center justify-center px-4 py-10\">\n    <!-- Back Button -->\n    <button \n      @click=\"$router.push('/home')\"\n      class=\"absolute top-6 left-6 text-white/70 hover:text-white\"\n    >\n      <i class=\"fas fa-arrow-left text-xl\"></i>\n    </button>\n\n    <!-- Main Content -->\n    <div class=\"w-full max-w-4xl\">\n      <!-- Logo -->\n      <div class=\"text-center mb-8\">\n        <img src=\"@/assets/ott.jpg\" alt=\"Logo\" class=\"h-12 mx-auto mb-4\">\n        <h1 class=\"text-2xl font-bold text-white\">Complete Your Profile</h1>\n        <p class=\"text-white/60 mt-2\">Please fill in your details to continue</p>\n      </div>\n\n      <!-- Registration Form -->\n      <div class=\"bg-[#1d1d1d] rounded-xl p-6 md:p-8\">\n        <form @submit.prevent=\"handleSubmit\" class=\"space-y-6\" novalidate>\n          <!-- Personal Information Section -->\n          <div class=\"space-y-6\">\n            <h3 class=\"text-xl font-semibold text-[#c30059] border-b border-[#c30059] pb-2\">\n              Personal Information\n            </h3>\n            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <!-- First Name -->\n              <div>\n                <label class=\"block text-white/90 text-sm mb-2\">\n                  First name <span class=\"text-[#ff4d4d]\">*</span>\n                </label>\n                <input \n                  v-model=\"form.firstName\"\n                  type=\"text\"\n                  class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors\"\n                  :class=\"{'border-[#ff4d4d]': errors.firstName}\"\n                />\n                <p v-if=\"errors.firstName\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.firstName }}</p>\n              </div>\n\n              <!-- Last Name -->\n              <div>\n                <label class=\"block text-white/90 text-sm mb-2\">\n                  Last name <span class=\"text-[#ff4d4d]\">*</span>\n                </label>\n                <input \n                  v-model=\"form.lastName\"\n                  type=\"text\"\n                  class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors\"\n                  :class=\"{'border-[#ff4d4d]': errors.lastName}\"\n                />\n                <p v-if=\"errors.lastName\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.lastName }}</p>\n              </div>\n\n              <!-- Email (Full Width) -->\n              <div class=\"md:col-span-2\">\n                <label class=\"block text-white/90 text-sm mb-2\">\n                  Email Address <span class=\"text-gray-500\">(Optional)</span>\n                </label>\n                <input \n                  v-model=\"form.email\"\n                  type=\"email\"\n                  class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors\"\n                  :class=\"{'border-[#ff4d4d]': errors.email}\"\n                  placeholder=\"Enter your email (optional)\"\n                />\n                <p v-if=\"errors.email\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.email }}</p>\n              </div>\n\n              <!-- Referral Code Field -->\n              <div class=\"space-y-2 md:col-span-2\">\n                <label class=\"block text-sm font-medium text-gray-300\">\n                  Referral Code <span class=\"text-gray-500\">(Optional)</span>\n                </label>\n                <div class=\"flex gap-4\">\n                  <div class=\"relative flex-1\">\n                    <input\n                      v-model=\"form.referralCode\"\n                      type=\"text\"\n                      class=\"w-full px-4 py-2 rounded-lg bg-[#2a2a2a] border border-gray-700 focus:border-[#c30059] focus:ring-2 focus:ring-[#c30059] text-white uppercase\"\n                      placeholder=\"Enter referral code\"\n                      :disabled=\"isValidatingReferral || referralStatus.valid\"\n                      @input=\"handleReferralInput\"\n                    />\n                    <div v-if=\"isValidatingReferral\" class=\"absolute right-3 top-1/2 -translate-y-1/2\">\n                      <div class=\"animate-spin rounded-full h-5 w-5 border-2 border-white/20 border-t-[#c30059]\"></div>\n                    </div>\n                    <div v-if=\"referralStatus.valid\" class=\"absolute right-3 top-1/2 -translate-y-1/2 text-green-500\">\n                      <i class=\"fas fa-check-circle\"></i>\n                    </div>\n                  </div>\n                  <button\n                    v-if=\"!referralStatus.valid\"\n                    type=\"button\"\n                    @click=\"verifyReferralCode\"\n                    :disabled=\"!form.referralCode || isValidatingReferral\"\n                    class=\"px-6 py-2 rounded-lg bg-[#c30059] text-white hover:bg-[#ff4d4d] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n                  >\n                    <span>Verify</span>\n                  </button>\n                </div>\n                <p v-if=\"errors.referralCode\" class=\"text-[#ff4d4d] text-sm mt-1 flex items-center gap-2\">\n                  <i class=\"fas fa-exclamation-circle\"></i>\n                  {{ errors.referralCode }}\n                </p>\n                <p v-if=\"referralStatus.valid\" class=\"text-green-500 text-sm mt-1 flex items-center gap-2\">\n                  <i class=\"fas fa-check-circle\"></i>\n                  Valid referral code\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <!-- Location Information Section -->\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <!-- State -->\n            <div>\n              <label class=\"block text-white/90 text-sm mb-2\">\n                1. State <span class=\"text-[#ff4d4d]\">*</span>\n              </label>\n              <div class=\"relative\">\n                <select \n                  v-model=\"form.state\"\n                  @change=\"handleStateChange\"\n                  class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors appearance-none\"\n                  :class=\"{'border-[#ff4d4d]': errors.state}\"\n                  :disabled=\"isLoadingStates\"\n                >\n                  <option value=\"\">{{ isLoadingStates ? 'Loading states...' : 'Select State' }}</option>\n                  <option \n                    v-for=\"state in states\" \n                    :key=\"state.value\" \n                    :value=\"state.value\"\n                  >\n                    {{ state.label }}\n                  </option>\n                </select>\n                <!-- Loading Spinner -->\n                <div v-if=\"isLoadingStates\" class=\"absolute right-10 top-1/2 -translate-y-1/2\">\n                  <div class=\"animate-spin rounded-full h-5 w-5 border-2 border-white/20 border-t-[#c30059]\"></div>\n                </div>\n              </div>\n              <p v-if=\"errors.state\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.state }}</p>\n            </div>\n\n            <!-- District -->\n            <div>\n              <label class=\"block text-white/90 text-sm mb-2\">\n                2. District <span class=\"text-[#ff4d4d]\">*</span>\n              </label>\n              <select \n                v-model=\"form.district\"\n                @change=\"handleDistrictChange\"\n                class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors appearance-none\"\n                :class=\"{'border-[#ff4d4d]': errors.district}\"\n                :disabled=\"!form.state\"\n              >\n                <option value=\"\">Select District</option>\n                <option v-for=\"district in districts\" :key=\"district.value\" :value=\"district.value\">\n                  {{ district.label }}\n                </option>\n              </select>\n              <p v-if=\"errors.district\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.district }}</p>\n            </div>\n\n            <!-- Constituency -->\n            <div>\n              <label class=\"block text-white/90 text-sm mb-2\">\n                3. Constituency <span class=\"text-[#ff4d4d]\">*</span>\n              </label>\n              <select \n                v-model=\"form.constituency\"\n                @change=\"handleConstituencyChange\"\n                class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors appearance-none\"\n                :class=\"{'border-[#ff4d4d]': errors.constituency}\"\n                :disabled=\"!form.district\"\n              >\n                <option value=\"\">Select Constituency</option>\n                <option v-for=\"constituency in constituencies\" :key=\"constituency.value\" :value=\"constituency.value\">\n                  {{ constituency.label }}\n                </option>\n              </select>\n              <p v-if=\"errors.constituency\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.constituency }}</p>\n            </div>\n\n            <!-- Mandal -->\n            <div>\n              <label class=\"block text-white/90 text-sm mb-2\">\n                4. Mandal <span class=\"text-[#ff4d4d]\">*</span>\n              </label>\n              <div class=\"relative\">\n                <select \n                  v-if=\"!isManualMandal\"\n                  v-model=\"form.mandal\"\n                  @change=\"handleMandalChange\"\n                  class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors appearance-none\"\n                  :class=\"{'border-[#ff4d4d]': errors.mandal}\"\n                  :disabled=\"!form.constituency\"\n                >\n                  <option value=\"\">Select Mandal</option>\n                  <option v-for=\"mandal in mandals\" :key=\"mandal.value\" :value=\"mandal.value\">\n                    {{ mandal.label }}\n                  </option>\n                </select>\n                <input \n                  v-else\n                  v-model=\"form.manualMandal\"\n                  type=\"text\"\n                  class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors\"\n                  :class=\"{'border-[#ff4d4d]': errors.mandal}\"\n                  placeholder=\"Enter Mandal name\"\n                  @input=\"handleManualMandalChange\"\n                />\n                <button \n                  @click=\"toggleMandalInput\"\n                  class=\"absolute right-12 top-1/2 -translate-y-1/2 text-white/60 hover:text-white text-sm underline\"\n                  type=\"button\"\n                >\n                  {{ isManualMandal ? 'Select from list' : 'Enter manually' }}\n                </button>\n              </div>\n              <p v-if=\"errors.mandal\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.mandal }}</p>\n            </div>\n\n            <!-- Village -->\n            <div>\n              <label class=\"block text-white/90 text-sm mb-2\">\n                5. Village <span class=\"text-[#ff4d4d]\">*</span>\n              </label>\n              <div class=\"relative\">\n                <select \n                  v-if=\"!isManualVillage\"\n                  v-model=\"form.village\"\n                  @change=\"handleVillageChange\"\n                  class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors appearance-none\"\n                  :class=\"{'border-[#ff4d4d]': errors.village}\"\n                  :disabled=\"!form.mandal\"\n                >\n                  <option value=\"\">Select Village</option>\n                  <option v-for=\"village in villages\" :key=\"village.value\" :value=\"village.value\">\n                    {{ village.label }}\n                  </option>\n                </select>\n                <input \n                  v-else\n                  v-model=\"form.manualVillage\"\n                  type=\"text\"\n                  class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors\"\n                  :class=\"{'border-[#ff4d4d]': errors.village}\"\n                  placeholder=\"Enter Village name\"\n                  @input=\"handleManualVillageChange\"\n                />\n                <button \n                  @click=\"toggleVillageInput\"\n                  class=\"absolute right-12 top-1/2 -translate-y-1/2 text-white/60 hover:text-white text-sm underline\"\n                  type=\"button\"\n                >\n                  {{ isManualVillage ? 'Select from list' : 'Enter manually' }}\n                </button>\n              </div>\n              <p v-if=\"errors.village\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.village }}</p>\n            </div>\n\n            <!-- Pincode -->\n            <div>\n              <label class=\"block text-white/90 text-sm mb-2\">\n                6. Pincode <span class=\"text-[#ff4d4d]\">*</span>\n              </label>\n              <div class=\"relative\">\n                <input \n                  v-model=\"form.pincode\"\n                  type=\"number\"\n                  inputmode=\"numeric\"\n                  pattern=\"[0-9]*\"\n                  @input=\"validatePincode\"\n                  @keypress=\"allowOnlyNumbers\"\n                  maxlength=\"6\"\n                  class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                  :class=\"{'border-[#ff4d4d]': errors.pincode}\"\n                  placeholder=\"Enter 6-digit pincode\"\n                />\n                <!-- Loading indicator for pincode -->\n                <div v-if=\"isLoadingPincode\" class=\"absolute right-4 top-1/2 -translate-y-1/2\">\n                  <div class=\"animate-spin rounded-full h-5 w-5 border-2 border-white/20 border-t-[#c30059]\"></div>\n                </div>\n              </div>\n              <p v-if=\"errors.pincode\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.pincode }}</p>\n              <!-- Pincode suggestions -->\n              <div v-if=\"pincodeSuggestions.length > 0\" \n                   class=\"mt-1 bg-[#1d1d1d] border border-white/10 rounded-lg shadow-lg max-h-40 overflow-y-auto\">\n                <div v-for=\"(suggestion, index) in pincodeSuggestions\" \n                     :key=\"index\"\n                     @click=\"selectPincode(suggestion)\"\n                     class=\"px-4 py-2 text-white hover:bg-[#2d2d2d] cursor-pointer\">\n                  <div class=\"font-medium\">{{ suggestion.pincode }}</div>\n                  <div class=\"text-sm text-white/60\">{{ suggestion.area }}</div>\n                </div>\n              </div>\n            </div>\n\n            <!-- Address with Autocomplete -->\n            <div class=\"md:col-span-2\">\n              <label class=\"block text-white/90 text-sm mb-2\">\n                7. Address <span class=\"text-[#ff4d4d]\">*</span>\n              </label>\n              <div class=\"relative\">\n                <input \n                  ref=\"addressInput\"\n                  v-model=\"form.address\"\n                  type=\"text\"\n                  class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 text-white focus:border-[#c30059] focus:outline-none transition-colors\"\n                  :class=\"{'border-[#ff4d4d]': errors.address}\"\n                  placeholder=\"Start typing your address...\"\n                  @input=\"handleAddressInput\"\n                />\n                <!-- Loading indicator -->\n                <div v-if=\"isLoadingAddresses\" class=\"absolute right-4 top-1/2 -translate-y-1/2\">\n                  <div class=\"animate-spin rounded-full h-5 w-5 border-2 border-white/20 border-t-[#c30059]\"></div>\n                </div>\n                <!-- Address Suggestions Dropdown -->\n                <div v-if=\"addressSuggestions.length > 0\" \n                     class=\"absolute z-50 w-full mt-1 bg-[#1d1d1d] border border-white/10 rounded-lg shadow-lg max-h-60 overflow-y-auto\">\n                  <div v-for=\"(suggestion, index) in addressSuggestions\" \n                       :key=\"index\"\n                       @click=\"selectAddress(suggestion)\"\n                       class=\"px-4 py-3 text-white hover:bg-[#2d2d2d] cursor-pointer flex items-start\">\n                    <div>\n                      <div class=\"font-medium\">{{ suggestion.structured_formatting?.main_text || suggestion.description }}</div>\n                      <div class=\"text-sm text-white/60\">{{ suggestion.structured_formatting?.secondary_text }}</div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <p v-if=\"errors.address\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.address }}</p>\n            </div>\n          </div>\n\n          <!-- Terms and Submit Section -->\n          <div class=\"space-y-6 pt-4\">\n            <!-- Terms Checkbox -->\n            <div class=\"flex items-start space-x-3\">\n              <input \n                type=\"checkbox\"\n                id=\"terms\"\n                v-model=\"form.termsAccepted\"\n                class=\"mt-1 rounded border-white/30 bg-transparent text-[#c30059] focus:ring-[#c30059] focus:ring-offset-0 focus:ring-offset-transparent\"\n              >\n              <label for=\"terms\" class=\"text-white/80 text-sm\">\n                I accept OTT's \n                <a href=\"#\" class=\"text-[#c30059] hover:text-[#ff4d4d] underline decoration-dotted underline-offset-2\">Terms & Conditions</a>\n                and\n                <a href=\"#\" class=\"text-[#c30059] hover:text-[#ff4d4d] underline decoration-dotted underline-offset-2\">Privacy Statement</a>\n              </label>\n            </div>\n            <p v-if=\"errors.terms\" class=\"mt-1 text-[#ff4d4d] text-sm\">{{ errors.terms }}</p>\n\n            <!-- Submit Button -->\n            <button \n              type=\"submit\"\n              :disabled=\"isLoading\"\n              class=\"w-full bg-gradient-to-r from-[#c30059] to-[#ff4d4d] text-white py-4 rounded-lg font-medium text-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed relative\"\n            >\n              <span v-if=\"!isLoading\">Complete Registration</span>\n              <div v-else class=\"absolute inset-0 flex items-center justify-center\">\n                <div class=\"animate-spin rounded-full h-6 w-6 border-2 border-white/20 border-t-white\"></div>\n              </div>\n            </button>\n\n            <!-- General Error Message -->\n            <div v-if=\"errors.general\" class=\"mt-4 p-4 bg-red-500/10 border border-red-500/20 rounded-lg\">\n              <p class=\"text-red-500 text-sm text-center\">{{ errors.general }}</p>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\n\nexport default {\n  name: 'RegistrationPage',\n  data() {\n    return {\n      form: {\n        firstName: '',\n        lastName: '',\n        email: '',\n        state: '',\n        district: '',\n        constituency: '',\n        mandal: '',\n        manualMandal: '',\n        village: '',\n        manualVillage: '',\n        address: '',\n        pincode: '',\n        termsAccepted: false,\n        phone: '',\n        referralCode: '',\n      },\n      token: null,\n      errors: {},\n      districts: [],\n      constituencies: [],\n      mandals: [],\n      villages: [],\n      states: [],\n      isLoadingStates: false,\n      isLoadingGoogleMaps: false,\n      apiBaseUrl: 'http://192.168.0.128:8001',\n      addressSuggestions: [],\n      placesService: null,\n      geocoder: null,\n      googleMapsLoaded: false,\n      selectedPlace: null,\n      googleMapsScriptLoaded: false,\n      isManualMandal: false,\n      isManualVillage: false,\n      isLoadingAddresses: false,\n      isLoadingPincode: false,\n      pincodeSuggestions: [],\n      addressSearchTimeout: null,\n      isLoading: false,\n      googleMapsApiKey: 'AIzaSyAYUmDhZ4ZWfwL15I2pYhEKcxhKEzEh2No', // Google Maps API Key\n      isValidatingReferral: false,\n      referralStatus: {\n        valid: false,\n        message: ''\n      }\n    };\n  },\n\n  methods: {\n    async fetchStates() {\n      console.log('fetchStates method called');\n      try {\n        this.isLoadingStates = true;\n        this.errors.state = null;\n        \n        const statesUrl = `${this.apiBaseUrl}/api/states/`;\n        console.log('Fetching states from URL:', statesUrl);\n\n        const response = await fetch(statesUrl, {\n          method: 'GET',\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json',\n          },\n          credentials: 'include' // Add this to include cookies if needed\n        });\n\n        console.log('API Response status:', response.status);\n\n        if (!response.ok) {\n          throw new Error(`Server returned ${response.status}: ${response.statusText}`);\n        }\n\n        const data = await response.json();\n        console.log('Received states data:', data);\n\n        if (!Array.isArray(data)) {\n          throw new Error('Expected array of states but received different format');\n        }\n\n        // Process the states\n        this.states = data.map(state => ({\n          value: state.id,\n          label: state.name\n        }));\n\n        console.log('Processed states:', this.states);\n\n        if (this.states.length === 0) {\n          this.errors.state = 'No states available. Please try again.';\n        }\n      } catch (error) {\n        console.error('Error in fetchStates:', error);\n        this.errors.state = `Failed to load states: ${error.message}`;\n      } finally {\n        this.isLoadingStates = false;\n      }\n    },\n\n    async handleSubmit() {\n      console.log('Handle submit called');\n      if (this.validateForm()) {\n        let registrationResponse = null;\n        try {\n          console.log('Form validation passed, proceeding with submission');\n          this.isLoading = true;\n          this.errors = {};\n\n          // Get CSRF token\n          const csrfToken = localStorage.getItem('csrfToken');\n\n          // Prepare registration data\n          const registrationData = {\n            first_name: this.form.firstName,\n            last_name: this.form.lastName,\n            email: this.form.email,\n            phone: this.form.phone,\n            state: this.form.state,\n            district: this.form.district,\n            constituency: this.form.constituency,\n            mandal: this.isManualMandal ? this.form.manualMandal : this.form.mandal,\n            village: this.isManualVillage ? this.form.manualVillage : this.form.village,\n            address: this.form.address,\n            pincode: this.form.pincode,\n            referral_code: this.form.referralCode || null,\n          };\n\n          console.log('Sending registration data:', registrationData);\n\n          // Complete registration\n          console.log('Completing registration...');\n          registrationResponse = await fetch(`${this.apiBaseUrl}/users/complete-registration/`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json',\n              'X-CSRFToken': csrfToken,\n              'X-Requested-With': 'XMLHttpRequest'\n            },\n            credentials: 'include',\n            body: JSON.stringify(registrationData)\n          });\n\n          console.log('Registration response status:', registrationResponse.status);\n          const registrationResult = await registrationResponse.json();\n          console.log('Registration response:', registrationResult);\n\n          if (registrationResponse.ok) {\n            console.log('Registration successful, updating local storage');\n            // Update stored user data\n            if (registrationResult.user) {\n              localStorage.setItem('user', JSON.stringify(registrationResult.user));\n            }\n            // Update CSRF token\n            if (registrationResult.csrf_token) {\n              localStorage.setItem('csrfToken', registrationResult.csrf_token);\n            }\n            localStorage.setItem('phone', this.form.phone);\n\n            // Store success message in localStorage for home page\n            localStorage.setItem('registrationSuccess', 'true');\n            localStorage.setItem('registrationMessage', 'Registration completed successfully!');\n\n            // Redirect to home page\n            window.location.href = '/';\n          } else {\n            throw new Error(registrationResult.message || 'Registration failed');\n          }\n        } catch (error) {\n          console.error('Registration error:', error);\n          this.errors.general = error.message || 'An error occurred during registration. Please try again.';\n          \n          try {\n            // Show error toast if available\n            if (this.$toast) {\n              this.$toast.error(this.errors.general, {\n                position: 'top-right',\n                duration: 3000\n              });\n            }\n          } catch (toastError) {\n            console.warn('Toast notification failed:', toastError);\n          }\n\n          // If unauthorized, redirect to login\n          if (registrationResponse?.status === 401) {\n            window.location.href = '/login';\n          }\n        } finally {\n          this.isLoading = false;\n        }\n      }\n    },\n\n    async registerDevice(token) {\n      try {\n        const deviceData = {\n          device_type: 'web',\n          device_name: navigator.userAgent,\n          device_id: 'web-' + Math.random().toString(36).substr(2, 9),\n          device_model: navigator.platform,\n          os_version: navigator.userAgent,\n          app_version: '1.0.0'\n        };\n\n        const response = await fetch(`${this.apiBaseUrl}/devices/`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${token}`,\n            'X-Requested-With': 'XMLHttpRequest'\n          },\n          body: JSON.stringify(deviceData)\n        });\n\n        if (!response.ok) {\n          console.error('Failed to register device');\n        }\n      } catch (error) {\n        console.error('Error registering device:', error);\n      }\n    },\n\n    async handleAddressInput() {\n      if (!this.form.address || !this.googleMapsLoaded) {\n        this.addressSuggestions = [];\n        return;\n      }\n\n      if (this.addressSearchTimeout) {\n        clearTimeout(this.addressSearchTimeout);\n      }\n\n      this.isLoadingAddresses = true;\n\n      this.addressSearchTimeout = setTimeout(async () => {\n        try {\n          // Get the selected location names\n          const selectedState = this.states.find(s => s.value === this.form.state)?.label || '';\n          const selectedDistrict = this.districts.find(d => d.value === this.form.district)?.label || '';\n          const selectedConstituency = this.constituencies.find(c => c.value === this.form.constituency)?.label || '';\n          const selectedMandal = this.isManualMandal ? this.form.manualMandal : \n                                this.mandals.find(m => m.value === this.form.mandal)?.label || '';\n          const selectedVillage = this.isManualVillage ? this.form.manualVillage :\n                                 this.villages.find(v => v.value === this.form.village)?.label || '';\n\n          // Build the search query with location context including constituency\n          const searchQuery = `${this.form.address}, ${selectedVillage}, ${selectedMandal}, ${selectedConstituency} constituency, ${selectedDistrict}, ${selectedState}, India`;\n          \n          const predictions = await this.getPlacePredictions(searchQuery, true);\n          this.addressSuggestions = predictions;\n        } catch (error) {\n          console.error('Error fetching address suggestions:', error);\n          this.errors.maps = 'Unable to fetch address suggestions. Please try again.';\n        } finally {\n          this.isLoadingAddresses = false;\n        }\n      }, 300);\n    },\n\n    async getPlacePredictions(searchQuery, isDirectSearch = false) {\n      if (!this.placesService) {\n        console.error('Places service not initialized');\n        return [];\n      }\n\n      return new Promise((resolve, reject) => {\n        const options = {\n          input: searchQuery,\n          componentRestrictions: { country: 'IN' },\n          language: 'en',\n          types: isDirectSearch ? ['address', 'establishment'] : ['geocode']\n        };\n\n        this.placesService.getPlacePredictions(options, (results, status) => {\n          console.log('Places API response:', { status, results, query: searchQuery });\n          \n          if (status === window.google.maps.places.PlacesServiceStatus.OK && results) {\n            resolve(results);\n          } else if (status === window.google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {\n            resolve([]);\n          } else {\n            console.warn('Places API returned status:', status);\n            reject(new Error(`Places API returned status: ${status}`));\n          }\n        });\n      });\n    },\n\n    async selectAddress(suggestion) {\n      this.isLoadingPincode = true;\n      try {\n        const placeResult = await this.getPlaceDetails(suggestion.place_id);\n        console.log('Selected place details:', placeResult);\n\n        const formattedAddress = this.formatAddress(placeResult);\n        this.form.address = formattedAddress;\n\n        const pincode = await this.extractPincode(placeResult);\n        if (pincode) {\n          this.form.pincode = pincode;\n          delete this.errors.pincode;\n        }\n\n        this.addressSuggestions = [];\n        this.selectedPlace = placeResult;\n\n      } catch (error) {\n        console.error('Error in selectAddress:', error);\n        this.errors.maps = 'Error retrieving address details. Please try again.';\n      } finally {\n        this.isLoadingPincode = false;\n      }\n    },\n\n    formatAddress(placeResult) {\n      const components = {\n        street_number: '',\n        route: '',\n        sublocality_level_1: '',\n        locality: '',\n        administrative_area_level_2: '',\n        administrative_area_level_1: '',\n        postal_code: ''\n      };\n\n      placeResult.address_components.forEach(component => {\n        const type = component.types[0];\n        if (Object.prototype.hasOwnProperty.call(components, type)) {\n          components[type] = component.long_name;\n        }\n      });\n\n      let formattedAddress = '';\n      if (components.street_number) formattedAddress += components.street_number + ' ';\n      if (components.route) formattedAddress += components.route + ', ';\n      if (components.sublocality_level_1) formattedAddress += components.sublocality_level_1 + ', ';\n      if (components.locality) formattedAddress += components.locality + ', ';\n      if (components.administrative_area_level_2) formattedAddress += components.administrative_area_level_2 + ', ';\n      if (components.administrative_area_level_1) formattedAddress += components.administrative_area_level_1;\n      if (components.postal_code) formattedAddress += ' - ' + components.postal_code;\n\n      return formattedAddress.trim().replace(/,\\s*$/, '');\n    },\n\n    async getPlaceDetails(placeId) {\n      return new Promise((resolve, reject) => {\n        this.detailedPlacesService.getDetails({\n          placeId: placeId,\n          fields: ['address_components', 'formatted_address', 'geometry', 'name']\n        }, (result, status) => {\n          if (status === 'OK') {\n            resolve(result);\n          } else {\n            reject(new Error(`Place details failed with status: ${status}`));\n          }\n        });\n      });\n    },\n\n    async extractPincode(placeResult) {\n      for (const component of placeResult.address_components) {\n        if (component.types.includes('postal_code')) {\n          return component.long_name;\n        }\n      }\n\n      if (placeResult.geometry?.location) {\n        try {\n          return await this.getPincodeFromCoordinates(\n            placeResult.geometry.location.lat(),\n            placeResult.geometry.location.lng()\n          );\n        } catch (error) {\n          console.warn('Failed to get pincode from coordinates:', error);\n        }\n      }\n\n      return null;\n    },\n\n    async getPincodeFromCoordinates(lat, lng) {\n      return new Promise((resolve, reject) => {\n        if (!this.geocoder) {\n          this.geocoder = new window.google.maps.Geocoder();\n        }\n\n        this.geocoder.geocode({\n          location: { lat, lng }\n        }, (results, status) => {\n          if (status === 'OK') {\n            for (let result of results) {\n              for (let component of result.address_components) {\n                if (component.types.includes('postal_code')) {\n                  resolve(component.long_name);\n                  return;\n                }\n              }\n            }\n            reject(new Error('No pincode found in geocoding results'));\n          } else {\n            reject(new Error(`Geocoding failed with status: ${status}`));\n          }\n        });\n      });\n    },\n\n    async fetchDistricts(stateId) {\n      try {\n        console.log('Fetching districts for state:', stateId);\n        const response = await fetch(`${this.apiBaseUrl}/api/frontend/districts/?state_id=${stateId}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const result = await response.json();\n        console.log('Districts API response:', result);\n\n        if (result.status === 'success') {\n          this.districts = result.data.map(district => ({\n            value: district.id,\n            label: district.name\n          }));\n          console.log('Mapped districts:', this.districts);\n        } else {\n          console.error('Error fetching districts:', result.message);\n          this.errors.district = 'Failed to load districts. Please try again.';\n        }\n      } catch (error) {\n        console.error('Error fetching districts:', error);\n        this.errors.district = 'Failed to load districts. Please check your connection.';\n      }\n    },\n\n    async fetchConstituencies(districtId) {\n      try {\n        console.log('Fetching constituencies for district:', districtId);\n        const response = await fetch(`${this.apiBaseUrl}/api/frontend/constituencies/?district_id=${districtId}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const result = await response.json();\n        console.log('Constituencies API response:', result);\n\n        if (result.status === 'success') {\n          this.constituencies = result.data.map(constituency => ({\n            value: constituency.id,\n            label: constituency.name\n          }));\n          console.log('Mapped constituencies:', this.constituencies);\n        } else {\n          console.error('Error fetching constituencies:', result.message);\n          this.errors.constituency = 'Failed to load constituencies. Please try again.';\n        }\n      } catch (error) {\n        console.error('Error fetching constituencies:', error);\n        this.errors.constituency = 'Failed to load constituencies. Please check your connection.';\n      }\n    },\n\n    async fetchMandals(constituencyId) {\n      try {\n        console.log('Fetching mandals for constituency:', constituencyId);\n        const response = await fetch(`${this.apiBaseUrl}/api/frontend/mandals/?constituency_id=${constituencyId}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const result = await response.json();\n        console.log('Mandals API response:', result);\n\n        if (result.status === 'success') {\n          this.mandals = result.data.map(mandal => ({\n            value: mandal.id,\n            label: mandal.name\n          }));\n          console.log('Mapped mandals:', this.mandals);\n        } else {\n          console.error('Error fetching mandals:', result.message);\n          this.errors.mandal = 'Failed to load mandals. Please try again.';\n        }\n      } catch (error) {\n        console.error('Error fetching mandals:', error);\n        this.errors.mandal = 'Failed to load mandals. Please check your connection.';\n      }\n    },\n\n    async fetchVillages(mandalId) {\n      try {\n        console.log('Fetching villages for mandal:', mandalId);\n        const response = await fetch(`${this.apiBaseUrl}/api/frontend/villages/?mandal_id=${mandalId}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const result = await response.json();\n        console.log('Villages API response:', result);\n\n        if (result.status === 'success') {\n          this.villages = result.data.map(village => ({\n            value: village.id,\n            label: village.name\n          }));\n          console.log('Mapped villages:', this.villages);\n        } else {\n          console.error('Error fetching villages:', result.message);\n          this.errors.village = 'Failed to load villages. Please try again.';\n        }\n      } catch (error) {\n        console.error('Error fetching villages:', error);\n        this.errors.village = 'Failed to load villages. Please check your connection.';\n      }\n    },\n\n    async handleStateChange() {\n      console.log('State changed to:', this.form.state);\n      // Reset dependent fields\n      this.form.district = '';\n      this.form.constituency = '';\n      this.form.mandal = '';\n      this.form.village = '';\n      this.districts = [];\n      this.constituencies = [];\n      this.mandals = [];\n      this.villages = [];\n\n      if (this.form.state) {\n        await this.fetchDistricts(this.form.state);\n      }\n    },\n\n    async handleDistrictChange() {\n      console.log('District changed to:', this.form.district);\n      // Reset dependent fields\n      this.form.constituency = '';\n      this.form.mandal = '';\n      this.form.village = '';\n      this.constituencies = [];\n      this.mandals = [];\n      this.villages = [];\n\n      if (this.form.district) {\n        await this.fetchConstituencies(this.form.district);\n      }\n    },\n\n    async handleConstituencyChange() {\n      console.log('Constituency changed to:', this.form.constituency);\n      // Reset dependent fields\n      this.form.mandal = '';\n      this.form.village = '';\n      this.mandals = [];\n      this.villages = [];\n\n      if (this.form.constituency) {\n        await this.fetchMandals(this.form.constituency);\n      }\n    },\n\n    async handleMandalChange() {\n      console.log('Mandal changed to:', this.form.mandal);\n      // Reset dependent fields\n      this.form.village = '';\n      this.form.manualVillage = '';\n      this.villages = [];\n      this.addressSuggestions = [];\n      this.form.address = '';\n      this.form.pincode = '';\n\n      if (this.form.mandal) {\n        await this.fetchVillages(this.form.mandal);\n      }\n    },\n\n    async handleVillageChange() {\n      // Reset address fields\n      this.form.address = '';\n      this.form.pincode = '';\n      this.addressSuggestions = [];\n      \n      // Trigger address search when village is selected\n      if (this.form.village) {\n        await this.searchAddress();\n      }\n    },\n\n    allowOnlyNumbers(event) {\n      // Allow only number keys (0-9) and navigation keys\n      const isNumber = /[0-9]/.test(event.key);\n      const isNavigationKey = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab'].includes(event.key);\n      \n      if (!isNumber && !isNavigationKey) {\n        event.preventDefault();\n      }\n\n      // Prevent input if length is already 6 and not deleting\n      if (this.form.pincode.length >= 6 && !isNavigationKey) {\n        event.preventDefault();\n      }\n    },\n\n    validatePincode(event) {\n      // Remove any non-numeric characters\n      this.form.pincode = event.target.value.replace(/\\D/g, '').slice(0, 6);\n      \n      // Clear error if valid, show error if invalid\n      if (this.form.pincode.length === 6) {\n        delete this.errors.pincode;\n      } else if (this.form.pincode.length > 0) {\n        this.errors.pincode = 'Pincode must be exactly 6 digits';\n      }\n    },\n\n    toggleMandalInput() {\n      this.isManualMandal = !this.isManualMandal;\n      if (this.isManualMandal) {\n        this.form.mandal = '';\n        this.form.manualMandal = '';\n      } else {\n        this.form.manualMandal = '';\n      }\n      // Clear dependent fields\n      this.form.village = '';\n      this.form.manualVillage = '';\n      this.villages = [];\n    },\n\n    toggleVillageInput() {\n      this.isManualVillage = !this.isManualVillage;\n      if (this.isManualVillage) {\n        this.form.village = '';\n        this.form.manualVillage = '';\n      } else {\n        this.form.manualVillage = '';\n      }\n    },\n\n    handleManualMandalChange() {\n      // Clear village when mandal changes\n      this.form.village = '';\n      this.form.manualVillage = '';\n      this.villages = [];\n      \n      if (this.form.manualMandal) {\n        delete this.errors.mandal;\n        this.fetchManualMandal(this.form.manualMandal);\n      }\n    },\n\n    handleManualVillageChange() {\n      if (this.form.manualVillage) {\n        delete this.errors.village;\n        this.fetchManualVillage(this.form.manualVillage);\n        this.searchAddressWithManualLocation();\n      }\n    },\n\n    async fetchManualMandal(mandalName) {\n      try {\n        const response = await fetch(`${this.apiBaseUrl}/mandals/search/?name=${encodeURIComponent(mandalName)}&constituency_id=${this.form.constituency}`);\n        const result = await response.json();\n        if (result.status === 'success' && result.data.length > 0) {\n          // If exact match found, use it\n          const exactMatch = result.data.find(m => m.name.toLowerCase() === mandalName.toLowerCase());\n          if (exactMatch) {\n            this.form.mandal = exactMatch.id;\n            await this.fetchVillages(exactMatch.id);\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching manual mandal:', error);\n      }\n    },\n\n    async fetchManualVillage(villageName) {\n      try {\n        const mandalId = this.form.mandal || '';\n        const response = await fetch(`${this.apiBaseUrl}/villages/search/?name=${encodeURIComponent(villageName)}&mandal_id=${mandalId}`);\n        const result = await response.json();\n        if (result.status === 'success' && result.data.length > 0) {\n          // If exact match found, use it\n          const exactMatch = result.data.find(v => v.name.toLowerCase() === villageName.toLowerCase());\n          if (exactMatch) {\n            this.form.village = exactMatch.id;\n            this.searchAddress();\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching manual village:', error);\n      }\n    },\n\n    async searchAddressWithManualLocation() {\n      if (!this.googleMapsLoaded) return;\n\n      try {\n        // Get the selected location names\n        const selectedState = this.states.find(s => s.value === this.form.state)?.label || '';\n        const selectedDistrict = this.districts.find(d => d.value === this.form.district)?.label || '';\n        const selectedConstituency = this.constituencies.find(c => c.value === this.form.constituency)?.label || '';\n        const mandalName = this.isManualMandal ? this.form.manualMandal : \n                          this.mandals.find(m => m.value === this.form.mandal)?.label || '';\n        const villageName = this.isManualVillage ? this.form.manualVillage :\n                           this.villages.find(v => v.value === this.form.village)?.label || '';\n\n        if (!villageName) return;\n\n        // First try with full address including constituency\n        let searchQuery = `${villageName}, ${mandalName}, ${selectedConstituency} constituency, ${selectedDistrict}, ${selectedState}, India`;\n        let predictions = await this.getPlacePredictions(searchQuery);\n\n        // If no results, try without constituency\n        if (!predictions.length) {\n          searchQuery = `${villageName}, ${mandalName}, ${selectedDistrict}, ${selectedState}, India`;\n          predictions = await this.getPlacePredictions(searchQuery);\n        }\n\n        // If still no results, try with village and district format\n        if (!predictions.length) {\n          searchQuery = `${villageName} village, ${selectedConstituency} constituency, ${selectedDistrict} district, ${selectedState}, India`;\n          predictions = await this.getPlacePredictions(searchQuery);\n        }\n\n        this.addressSuggestions = predictions;\n\n        // Auto-select if only one result\n        if (predictions.length === 1) {\n          await this.selectAddress(predictions[0]);\n        }\n      } catch (error) {\n        console.error('Error in manual location search:', error);\n      }\n    },\n\n    validateForm() {\n      console.log('Validating form...');\n      this.errors = {};\n      let isValid = true;\n      \n      // Required fields validation\n      if (!this.form.firstName) {\n        this.errors.firstName = 'First name is required';\n        isValid = false;\n      }\n      if (!this.form.lastName) {\n        this.errors.lastName = 'Last name is required';\n        isValid = false;\n      }\n      // Email validation (only if provided)\n      if (this.form.email && !this.isValidEmail(this.form.email)) {\n        this.errors.email = 'Please enter a valid email address';\n        isValid = false;\n      }\n      if (!this.form.state) {\n        this.errors.state = 'State is required';\n        isValid = false;\n      }\n      if (!this.form.district) {\n        this.errors.district = 'District is required';\n        isValid = false;\n      }\n      if (!this.form.constituency) {\n        this.errors.constituency = 'Constituency is required';\n        isValid = false;\n      }\n      \n      // Mandal validation\n      if (!this.isManualMandal && !this.form.mandal) {\n        this.errors.mandal = 'Mandal is required';\n        isValid = false;\n      } else if (this.isManualMandal && !this.form.manualMandal) {\n        this.errors.mandal = 'Mandal name is required';\n        isValid = false;\n      }\n\n      // Village validation\n      if (!this.isManualVillage && !this.form.village) {\n        this.errors.village = 'Village is required';\n        isValid = false;\n      } else if (this.isManualVillage && !this.form.manualVillage) {\n        this.errors.village = 'Village name is required';\n        isValid = false;\n      }\n\n      // Address and Pincode validation\n      if (!this.form.address) {\n        this.errors.address = 'Address is required';\n        isValid = false;\n      }\n      if (!this.form.pincode) {\n        this.errors.pincode = 'Pincode is required';\n        isValid = false;\n      } else if (!/^\\d{6}$/.test(this.form.pincode)) {\n        this.errors.pincode = 'Pincode must be exactly 6 digits';\n        isValid = false;\n      }\n\n      // Terms acceptance\n      if (!this.form.termsAccepted) {\n        this.errors.terms = 'You must accept the Terms & Conditions to continue';\n        isValid = false;\n      }\n\n      // Referral code validation (only if provided)\n      if (this.form.referralCode && !this.referralStatus.valid) {\n        this.errors.referralCode = 'Please verify the referral code';\n        isValid = false;\n      }\n\n      console.log('Validation result:', { isValid, errors: this.errors });\n      return isValid;\n    },\n\n    isValidEmail(email) {\n      const re = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n      return re.test(email);\n    },\n\n    initGoogleMaps() {\n      return new Promise((resolve, reject) => {\n        try {\n          console.log('Starting Google Maps initialization');\n          this.isLoadingGoogleMaps = true;\n\n          // Check if script is already loaded\n          if (window.google && window.google.maps) {\n            console.log('Google Maps already loaded, initializing services');\n            this.initPlacesService();\n            this.isLoadingGoogleMaps = false;\n            this.googleMapsLoaded = true;\n            resolve();\n            return;\n          }\n\n          // Create script element\n          const script = document.createElement('script');\n          script.src = `https://maps.googleapis.com/maps/api/js?key=${this.googleMapsApiKey}&libraries=places&callback=initGoogleCallback`;\n          script.async = true;\n          script.defer = true;\n\n          // Define callback\n          window.initGoogleCallback = () => {\n            console.log('Google Maps loaded successfully');\n            this.googleMapsScriptLoaded = true;\n            this.initPlacesService();\n            this.googleMapsLoaded = true;\n            this.isLoadingGoogleMaps = false;\n            resolve();\n          };\n\n          // Error handling\n          script.onerror = (error) => {\n            console.error('Error loading Google Maps:', error);\n            this.errors.maps = 'Failed to load Google Maps. Please check your internet connection.';\n            this.isLoadingGoogleMaps = false;\n            reject(error);\n          };\n\n          // Add script to document\n          document.head.appendChild(script);\n          console.log('Google Maps script added to document');\n        } catch (error) {\n          console.error('Error in initGoogleMaps:', error);\n          this.errors.maps = 'Failed to initialize Google Maps.';\n          this.isLoadingGoogleMaps = false;\n          reject(error);\n        }\n      });\n    },\n\n    initPlacesService() {\n      try {\n        console.log('Initializing Places Service');\n        if (!window.google || !window.google.maps) {\n          throw new Error('Google Maps not loaded');\n        }\n\n        // Remove existing map div if any\n        const existingMapDiv = document.getElementById('places-service-map');\n        if (existingMapDiv) {\n          existingMapDiv.remove();\n        }\n\n        // Create hidden div for PlacesService\n        const mapDiv = document.createElement('div');\n        mapDiv.style.display = 'none';\n        mapDiv.id = 'places-service-map';\n        document.body.appendChild(mapDiv);\n\n        // Initialize map for PlacesService\n        const map = new window.google.maps.Map(mapDiv, {\n          center: { lat: -34.397, lng: 150.644 },\n          zoom: 8\n        });\n\n        // Initialize services\n        this.placesService = new window.google.maps.places.AutocompleteService();\n        this.geocoder = new window.google.maps.Geocoder();\n        this.detailedPlacesService = new window.google.maps.places.PlacesService(map);\n        \n        console.log('Places service initialized successfully');\n        this.googleMapsLoaded = true;\n        delete this.errors.maps;\n      } catch (error) {\n        console.error('Error initializing places service:', error);\n        this.errors.maps = 'Failed to initialize location services.';\n        this.googleMapsLoaded = false;\n      }\n    },\n\n    async searchAddress() {\n      console.log('searchAddress called with current state:', {\n        googleMapsLoaded: this.googleMapsLoaded,\n        placesService: !!this.placesService,\n        village: this.form.village\n      });\n\n      if (!this.googleMapsLoaded || !this.placesService) {\n        console.log('Reinitializing Google Maps');\n        try {\n          await this.initGoogleMaps();\n        } catch (error) {\n          console.error('Failed to reinitialize Google Maps:', error);\n          return;\n        }\n      }\n\n      if (!this.form.village) {\n        console.log('No village selected');\n        return;\n      }\n\n      try {\n        const selectedState = this.states.find(s => s.value === this.form.state)?.label || '';\n        const selectedDistrict = this.districts.find(d => d.value === this.form.district)?.label || '';\n        const selectedConstituency = this.constituencies.find(c => c.value === this.form.constituency)?.label || '';\n        const selectedMandal = this.mandals.find(m => m.value === this.form.mandal)?.label || '';\n        const selectedVillage = this.villages.find(v => v.value === this.form.village)?.label || '';\n\n        console.log('Searching with location data:', {\n          state: selectedState,\n          district: selectedDistrict,\n          constituency: selectedConstituency,\n          mandal: selectedMandal,\n          village: selectedVillage\n        });\n\n        // First try with full address including constituency\n        let searchQuery = `${selectedVillage}, ${selectedMandal}, ${selectedConstituency} constituency, ${selectedDistrict}, ${selectedState}, India`;\n        console.log('Trying search with query:', searchQuery);\n        let predictions = await this.getPlacePredictions(searchQuery);\n\n        // If no results, try without constituency\n        if (!predictions.length) {\n          searchQuery = `${selectedVillage}, ${selectedMandal}, ${selectedDistrict}, ${selectedState}, India`;\n          console.log('Retrying with simplified query:', searchQuery);\n          predictions = await this.getPlacePredictions(searchQuery);\n        }\n\n        this.addressSuggestions = predictions;\n        console.log('Got address suggestions:', predictions);\n\n        if (predictions.length === 1) {\n          await this.selectAddress(predictions[0]);\n        }\n      } catch (error) {\n        console.error('Error in searchAddress:', error);\n        this.errors.maps = 'Unable to fetch address suggestions. Please try again.';\n      }\n    },\n\n    handleReferralInput() {\n      // Convert to uppercase\n      this.form.referralCode = this.form.referralCode.toUpperCase();\n      // Reset validation status\n      this.referralStatus.valid = false;\n      this.referralStatus.message = '';\n      this.errors.referralCode = '';\n    },\n\n    async verifyReferralCode() {\n      if (!this.form.referralCode) return;\n      \n      this.isValidatingReferral = true;\n      this.errors.referralCode = '';\n      \n      try {\n        const response = await axios.get(`${this.apiBaseUrl}/users/verify-referral/`, {\n          params: {\n            code: this.form.referralCode\n          },\n          headers: {\n            'Accept': 'application/json'\n          }\n        });\n\n        const data = response.data;\n        \n        if (data.status === 'success') {\n          this.referralStatus.valid = true;\n          this.referralStatus.message = 'Valid referral code';\n          this.errors.referralCode = '';\n        } else {\n          this.referralStatus.valid = false;\n          this.errors.referralCode = data.message || 'Invalid referral code';\n        }\n      } catch (error) {\n        console.error('Error verifying referral code:', error);\n        this.errors.referralCode = error.response?.data?.message || 'Failed to verify referral code';\n        this.referralStatus.valid = false;\n      } finally {\n        this.isValidatingReferral = false;\n      }\n    },\n  },\n\n  async created() {\n    console.log('Component created - Starting initialization');\n    try {\n      // Get phone number and token from query params or localStorage\n      this.form.phone = this.$route.query.phone || localStorage.getItem('phone') || '';\n      \n      // Try to get token from multiple sources\n      this.token = this.$route.query.token || \n                  localStorage.getItem('token') || \n                  (localStorage.getItem('user') && JSON.parse(localStorage.getItem('user')).token);\n      \n      console.log('Initial token:', this.token);\n\n      if (!this.form.phone) {\n        console.error('Missing phone number');\n        this.errors.general = 'Missing phone number. Please try logging in again.';\n        this.$router.push('/login');\n        return;\n      }\n\n      if (!this.token) {\n        console.error('Missing token');\n        this.errors.general = 'Authentication token is missing. Please try logging in again.';\n        this.$router.push('/login');\n        return;\n      }\n\n      // Store phone number in localStorage if not already there\n      if (!localStorage.getItem('phone')) {\n        localStorage.setItem('phone', this.form.phone);\n      }\n\n      // Initialize Google Maps first\n      console.log('Initializing Google Maps');\n      await this.initGoogleMaps();\n\n      console.log('Starting to fetch states');\n      await this.fetchStates();\n\n      // Check for referral code in URL\n      const urlParams = new URLSearchParams(window.location.search);\n      const referralCode = urlParams.get('ref');\n      \n      if (referralCode) {\n        this.form.referralCode = referralCode.toUpperCase();\n        // Automatically verify the referral code\n        await this.verifyReferralCode();\n      }\n    } catch (error) {\n      console.error('Error in component creation:', error);\n      this.errors.general = 'Failed to initialize the form. Please refresh the page.';\n    }\n  },\n\n  mounted() {\n    console.log('Component mounted - Checking states:', {\n      statesLength: this.states.length,\n      states: this.states\n    });\n    \n    // If states are empty, try loading them again\n    if (this.states.length === 0 && !this.isLoadingStates) {\n      console.log('States are empty, fetching again');\n      this.fetchStates();\n    }\n  },\n\n  beforeUnmount() {\n    const mapDiv = document.getElementById('places-service-map');\n    if (mapDiv) {\n      mapDiv.remove();\n    }\n  }\n};\n</script>\n\n<style scoped>\n/* Disabled select styling */\nselect:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n/* Custom select arrow */\nselect {\n  background-image: url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e\");\n  background-position: right 0.5rem center;\n  background-repeat: no-repeat;\n  background-size: 1.5em 1.5em;\n}\n\n/* Remove autofill background */\ninput:-webkit-autofill,\ninput:-webkit-autofill:hover,\ninput:-webkit-autofill:focus,\ninput:-webkit-autofill:active {\n  -webkit-box-shadow: 0 0 0 30px #121212 inset !important;\n  -webkit-text-fill-color: white !important;\n}\n\n/* Address Suggestions Dropdown Styles */\n.suggestions-dropdown {\n  scrollbar-width: thin;\n  scrollbar-color: #c30059 #1d1d1d;\n}\n\n.suggestions-dropdown::-webkit-scrollbar {\n  width: 6px;\n}\n\n.suggestions-dropdown::-webkit-scrollbar-track {\n  background: #1d1d1d;\n}\n\n.suggestions-dropdown::-webkit-scrollbar-thumb {\n  background-color: #c30059;\n  border-radius: 3px;\n}\n\n/* Loading overlay */\n.loading-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.7);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n}\n\n.spinner {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(255, 255, 255, 0.3);\n  border-radius: 50%;\n  border-top-color: #c30059;\n  animation: spin 1s ease-in-out infinite;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n/* Error message styles */\n.error-message {\n  color: #ff4d4d;\n  font-size: 0.875rem;\n  margin-top: 0.5rem;\n  display: flex;\n  align-items: center;\n}\n\n.error-message i {\n  margin-right: 0.5rem;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}