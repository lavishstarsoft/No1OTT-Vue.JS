{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport AppHeader from '../components/Header.vue';\nimport AppFooter from '../components/Footer.vue';\nimport AdvancedVideoPlayer from '../components/AdvancedVideoPlayer.vue';\nimport axios from 'axios';\nimport { watchlistAPI } from '@/utils/api';\nimport videojs from 'video.js';\nimport 'video.js/dist/video-js.css';\nimport store from '@/store';\n\n// Define API base URL constant\nconst API_BASE_URL = 'https://ott.no1news.in';\n\n// Create axios instance with default config\nconst axiosInstance = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Add request interceptor to add token\naxiosInstance.interceptors.request.use(config => {\n  const token = store.getters.token;\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\nexport default {\n  name: 'MovieDetails',\n  components: {\n    AppHeader,\n    AppFooter,\n    AdvancedVideoPlayer\n  },\n  props: {\n    id: {\n      type: [Number, String],\n      required: true\n    }\n  },\n  data() {\n    return {\n      movie: {},\n      inWatchlist: false,\n      isSearchActive: false,\n      isVideoPlaying: false,\n      controlsVisible: true,\n      isVideoPaused: false,\n      controlsTimeout: null,\n      isMobileDevice: false,\n      videoInteractionDelay: 2500,\n      videoUrl: '',\n      streamType: 'hls',\n      isUserSubscribed: false,\n      promoStartDelay: 3000,\n      // 3 seconds delay before starting promo\n      drmConfig: {\n        // DRM configuration if needed\n        // Example for Widevine:\n        servers: {\n          'com.widevine.alpha': 'https://license.url/widevine'\n        },\n        // Example for Clear Key:\n        clearKeys: {\n          // keyId: 'key' pairs\n        }\n      },\n      playerSettings: {\n        defaultQuality: 'auto',\n        preferredQualityIndex: 1,\n        skipInterval: 10,\n        // seconds\n        keyboardShortcutsEnabled: true,\n        rememberLastPosition: true,\n        autoQualitySwitch: true\n      },\n      canScrollLeft: {\n        category: false,\n        related: false,\n        recentlyAdded: false\n      },\n      canScrollRight: {\n        category: true,\n        related: true,\n        recentlyAdded: true\n      },\n      categoryVideos: [],\n      recentlyAddedVideos: [],\n      relatedMovies: [{\n        id: 101,\n        title: 'Midnight Mystery',\n        thumbnail_url: 'https://i.ibb.co/cDfWsvC/related1.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/cDfWsvC/related1.jpg',\n        video_type: 'free'\n      }, {\n        id: 102,\n        title: 'The Stranger',\n        thumbnail_url: 'https://i.ibb.co/DkFnm7g/related2.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/DkFnm7g/related2.jpg',\n        video_type: 'paid'\n      }, {\n        id: 103,\n        title: 'Dark Echo',\n        thumbnail_url: 'https://i.ibb.co/MRVvFDZ/related3.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/MRVvFDZ/related3.jpg',\n        video_type: 'free'\n      }, {\n        id: 104,\n        title: 'Silent Night',\n        thumbnail_url: 'https://i.ibb.co/5cG2WXF/related4.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/5cG2WXF/related4.jpg',\n        video_type: 'rental'\n      }, {\n        id: 105,\n        title: 'The Guilty',\n        thumbnail_url: 'https://i.ibb.co/mBVR2KM/related5.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/mBVR2KM/related5.jpg',\n        video_type: 'free'\n      }, {\n        id: 106,\n        title: 'Trance',\n        thumbnail_url: 'https://i.ibb.co/hWD1BXg/related6.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/hWD1BXg/related6.jpg',\n        video_type: 'paid'\n      }, {\n        id: 107,\n        title: 'Haunted House',\n        thumbnail_url: 'https://i.ibb.co/k8DQzTF/related7.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/k8DQzTF/related7.jpg',\n        video_type: 'free'\n      }, {\n        id: 108,\n        title: 'Night Watch',\n        thumbnail_url: 'https://i.ibb.co/hyCJTBL/related8.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/hyCJTBL/related8.jpg',\n        video_type: 'rental'\n      }, {\n        id: 109,\n        title: 'The Missing',\n        thumbnail_url: 'https://i.ibb.co/dj8rS0M/related9.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/dj8rS0M/related9.jpg',\n        video_type: 'free'\n      }, {\n        id: 110,\n        title: 'Fear Factor',\n        thumbnail_url: 'https://i.ibb.co/8XvX1fL/related10.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/8XvX1fL/related10.jpg',\n        video_type: 'paid'\n      }, {\n        id: 111,\n        title: 'Paranormal',\n        thumbnail_url: 'https://i.ibb.co/r57Kzc5/related11.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/r57Kzc5/related11.jpg',\n        video_type: 'free'\n      }, {\n        id: 112,\n        title: 'Last Breath',\n        thumbnail_url: 'https://i.ibb.co/B6wS7HK/related12.jpg',\n        portrait_thumbnail_url: 'https://i.ibb.co/B6wS7HK/related12.jpg',\n        video_type: 'rental'\n      }],\n      heroVideo: null,\n      hls: null,\n      showPaymentPopup: false,\n      userSubscriptionStatus: null,\n      showRentalPopup: false,\n      rentalInfo: null,\n      isSubscribed: false,\n      isPromoLoading: true,\n      promoVideoError: null,\n      isPlayingPromo: false,\n      isInWatchlist: false,\n      showShareDialog: false,\n      copyStatus: 'Copy',\n      promoHasError: false,\n      videojsPlayer: null,\n      shakaPromoPlayer: null,\n      isPromoPlaying: false\n    };\n  },\n  computed: {\n    // Get current user ID from localStorage\n    currentUserId() {\n      const user = localStorage.getItem('user');\n      if (user) {\n        try {\n          const userData = JSON.parse(user);\n          return userData.id || 1; // Default to 1 if no user ID\n        } catch (e) {\n          return 1; // Default to 1 if parsing fails\n        }\n      }\n      return 1; // Default to 1 if no user data\n    },\n    // Get the appropriate stream type based on the video URL or device capabilities\n    computedStreamType() {\n      // Check if the URL ends with specific extensions\n      if (this.videoUrl.includes('.m3u8')) {\n        return 'hls';\n      } else if (this.videoUrl.includes('.mpd')) {\n        return 'dash';\n      } else if (this.videoUrl.includes('.mp4')) {\n        // Explicitly handle MP4 files\n        return 'mp4';\n      }\n      // Default fallback\n      return 'mp4';\n    },\n    // Get the year from created_at\n    movieYear() {\n      if (this.movie && this.movie.created_at) {\n        return new Date(this.movie.created_at).getFullYear();\n      }\n      return new Date().getFullYear(); // Fallback to current year\n    },\n    // Format duration from seconds to hours and minutes\n    formattedDuration() {\n      if (!this.movie || !this.movie.duration) return '';\n      const totalSeconds = parseInt(this.movie.duration);\n      if (isNaN(totalSeconds)) return '';\n      const hours = Math.floor(totalSeconds / 3600);\n      const minutes = Math.floor(totalSeconds % 3600 / 60);\n      if (hours === 0) {\n        return `${minutes}m`;\n      } else if (minutes === 0) {\n        return `${hours}h`;\n      } else {\n        return `${hours}h ${minutes}m`;\n      }\n    },\n    // Get category name\n    categoryName() {\n      if (!this.movie) return '';\n      return this.movie.category_name || ''; // Directly use category_name from API\n    },\n    // Get formatted categories\n    formattedCategories() {\n      if (!this.movie || !this.movie.categories) return '';\n      return this.movie.categories.map(cat => cat.name).join(', ');\n    },\n    shareUrl() {\n      if (typeof window !== 'undefined') {\n        return window.location.href;\n      }\n      return '';\n    },\n    // Check if promo button should be shown\n    shouldShowPromoButton() {\n      return this.movie && this.movie.promo_hls_url && this.movie.promo_hls_url.trim() !== '';\n      // Removed promoHasError check - button should show even if CORS error\n      // User can still try to play after fixing CORS\n    }\n  },\n  watch: {\n    // Watch for route changes to reset scroll position when navigating between movie details pages\n    '$route'() {\n      window.scrollTo(0, 0);\n      this.fetchMovieDetails().then(() => {\n        // Initialize hero video after fetching new movie details\n        this.$nextTick(() => {\n          this.initializeHeroVideo();\n        });\n      });\n    },\n    // Update stream type based on the video URL\n    videoUrl: {\n      immediate: true,\n      handler(newUrl) {\n        // Update stream type based on the new URL\n        if (newUrl) {\n          this.streamType = this.computedStreamType;\n        }\n      }\n    },\n    // Add watcher for movie data\n    movie: {\n      immediate: true,\n      handler(newMovie) {\n        if (newMovie && (newMovie.promo_hls_url || newMovie.promo_video_url)) {\n          this.$nextTick(() => {\n            this.initializeHeroVideo();\n          });\n        }\n\n        // Update meta tags when movie data changes\n        if (newMovie) {\n          this.$nextTick(() => {\n            this.updateMetaTags();\n          });\n        }\n      }\n    },\n    // Debug watcher for isPromoPlaying\n    isPromoPlaying(val) {\n      console.log('isPromoPlaying changed:', val);\n    }\n  },\n  mounted() {\n    // Initialize hero video with HLS\n    this.initializeHeroVideo();\n    this.$nextTick(() => {\n      this.checkScrollButtons('categoryContainer', 'category');\n      this.checkScrollButtons('relatedContainer', 'related');\n      this.checkScrollButtons('recentlyAddedContainer', 'recentlyAdded');\n\n      // Check if mobile device\n      this.checkDeviceType();\n\n      // Listen for resize events to update device type\n      window.addEventListener('resize', this.checkDeviceType);\n\n      // Add scroll event listener for header background\n      window.addEventListener('scroll', this.handleScroll);\n\n      // Update meta tags after component is mounted\n      if (this.movie) {\n        this.updateMetaTags();\n      }\n    });\n  },\n  beforeUnmount() {\n    // Clean up HLS instance\n    if (this.hls) {\n      this.hls.destroy();\n    }\n\n    // Clean up resize listener\n    window.removeEventListener('resize', this.checkDeviceType);\n\n    // Clean up scroll listener\n    window.removeEventListener('scroll', this.handleScroll);\n\n    // Clear any active control timeouts\n    if (this.controlsTimeout) {\n      clearTimeout(this.controlsTimeout);\n    }\n    if (this.videojsPlayer) {\n      this.videojsPlayer.dispose();\n      this.videojsPlayer = null;\n    }\n  },\n  created() {\n    // Get video URL from route params if available\n    if (this.$route.params.videoUrl) {\n      this.videoUrl = this.$route.params.videoUrl;\n      this.streamType = this.$route.params.videoType || 'hls';\n    }\n\n    // Check subscription status\n    this.checkUserSubscription().then(isSubscribed => {\n      this.isUserSubscribed = isSubscribed;\n    });\n\n    // Fetch movie details\n    this.fetchMovieDetails();\n\n    // Load any saved player preferences from localStorage\n    this.loadPlayerPreferences();\n    this.checkWatchlistStatus();\n  },\n  methods: {\n    formatWatchPeriod(days) {\n      if (!days) return '';\n      return `${days} ${days === 1 ? 'day' : 'days'}`;\n    },\n    loadPlayerPreferences() {\n      // Load user preferences from localStorage\n      const savedPreferences = localStorage.getItem('player-preferences');\n      if (savedPreferences) {\n        try {\n          const preferences = JSON.parse(savedPreferences);\n          // Apply only the properties that exist in our settings object\n          Object.keys(this.playerSettings).forEach(key => {\n            if (preferences[key] !== undefined) {\n              this.playerSettings[key] = preferences[key];\n            }\n          });\n        } catch (e) {\n          console.error('Error parsing saved player preferences', e);\n        }\n      }\n    },\n    savePlayerPreferences() {\n      // Save current player settings to localStorage\n      localStorage.setItem('player-preferences', JSON.stringify(this.playerSettings));\n    },\n    initializeHeroVideo() {\n      const video = this.$refs.heroVideo;\n      if (!video) {\n        console.error('Video element not found');\n        return;\n      }\n      const videoSrc = this.movie.promo_hls_url || this.movie.video_url;\n      if (!videoSrc) {\n        console.error('No video source available');\n        return;\n      }\n\n      // Detect format\n      const isMPD = videoSrc.toLowerCase().includes('.mpd');\n      const isHLS = videoSrc.toLowerCase().includes('.m3u8');\n      if (!isMPD && !isHLS) {\n        console.error('Unsupported video format. Only HLS (.m3u8) and MPD (.mpd) are supported');\n        return;\n      }\n\n      // Dispose previous players if they exist\n      if (this.videojsPlayer) {\n        this.videojsPlayer.dispose();\n        this.videojsPlayer = null;\n      }\n      if (this.shakaPromoPlayer) {\n        this.shakaPromoPlayer.destroy();\n        this.shakaPromoPlayer = null;\n      }\n\n      // Ensure video is muted for autoplay\n      video.muted = true;\n      if (isMPD) {\n        // Use Shaka Player for MPD\n        this.initializeShakaPromoPlayer(video, videoSrc);\n      } else {\n        // Use Video.js for HLS\n        this.initializeVideoJsPromoPlayer(video, videoSrc);\n      }\n    },\n    initializeShakaPromoPlayer(video, videoSrc) {\n      console.log('ðŸŽ¬ Initializing Shaka Player for promo MPD');\n\n      // Import Shaka Player dynamically\n      import('shaka-player/dist/shaka-player.ui.js').then(shaka => {\n        // Install polyfills\n        shaka.polyfill.installAll();\n\n        // Check browser support\n        if (!shaka.Player.isBrowserSupported()) {\n          console.error('Browser not supported for Shaka Player');\n          this.promoHasError = true;\n          return;\n        }\n\n        // Create Shaka player\n        this.shakaPromoPlayer = new shaka.Player();\n        this.shakaPromoPlayer.attach(video);\n\n        // Configure\n        this.shakaPromoPlayer.configure({\n          streaming: {\n            bufferingGoal: 30,\n            rebufferingGoal: 2,\n            bufferBehind: 15\n          },\n          abr: {\n            enabled: true\n          }\n        });\n\n        // Error handling\n        this.shakaPromoPlayer.addEventListener('error', event => {\n          const error = event.detail;\n          console.error('Shaka promo error:', error);\n\n          // Don't hide button for CORS errors - user needs to fix S3 config\n          // Only hide for critical player errors\n          if (error.code !== shaka.util.Error.Code.BAD_HTTP_STATUS && error.code !== shaka.util.Error.Code.HTTP_ERROR) {\n            this.promoHasError = true;\n          }\n          this.handlePromoVideoError(error);\n        });\n\n        // Load manifest\n        this.shakaPromoPlayer.load(videoSrc).then(() => {\n          console.log('ðŸŽ¬ Promo MPD loaded successfully');\n          this.isPromoLoading = false;\n\n          // Attempt autoplay\n          video.play().catch(err => {\n            console.log('Promo autoplay prevented:', err);\n            this.isPromoLoading = false;\n          });\n        }).catch(error => {\n          console.error('Error loading promo MPD:', error);\n\n          // Don't hide button for CORS errors\n          if (error.code !== shaka.util.Error.Code.BAD_HTTP_STATUS && error.code !== shaka.util.Error.Code.HTTP_ERROR) {\n            this.promoHasError = true;\n          }\n          this.isPromoLoading = false;\n        });\n      }).catch(error => {\n        console.error('Error importing Shaka Player:', error);\n        this.promoHasError = true;\n        this.isPromoLoading = false;\n      });\n    },\n    initializeVideoJsPromoPlayer(video, videoSrc) {\n      console.log('ðŸŽ¬ Initializing Video.js for promo HLS');\n      this.videojsPlayer = videojs(video, {\n        sources: [{\n          src: videoSrc,\n          type: 'application/x-mpegURL'\n        }],\n        controls: true,\n        autoplay: true,\n        // Enable autoplay\n        muted: true,\n        // Ensure muted for autoplay\n        preload: 'auto',\n        fluid: true\n      });\n      this.videojsPlayer.ready(() => {\n        this.isPromoLoading = false;\n        this.videojsPlayer.muted(true); // Ensure muted\n        this.videojsPlayer.play().catch(e => {\n          console.error('Auto-play prevented:', e);\n        });\n      });\n      this.videojsPlayer.on('error', () => {\n        this.promoVideoError = this.videojsPlayer.error();\n        console.error('Video.js error:', this.promoVideoError);\n      });\n    },\n    onPromoVideoCanPlay() {\n      console.log('Video can play');\n      const video = this.$refs.heroVideo;\n      if (video) {\n        video.play().catch(error => {\n          console.error('Play failed:', error);\n        });\n      }\n    },\n    onPromoVideoLoaded() {\n      console.log('Promo video loaded successfully');\n      this.isPromoLoading = false;\n      const video = this.$refs.heroVideo;\n      if (video) {\n        video.classList.add('playing');\n        // Ensure video is muted and playing\n        video.muted = true;\n        video.play().catch(error => {\n          console.error('Play failed:', error);\n        });\n      }\n    },\n    onPromoVideoWaiting() {\n      console.log('Promo video waiting/buffering');\n      this.isPromoLoading = true;\n    },\n    onPromoVideoPlaying() {\n      this.isPromoPlaying = true;\n      this.isPromoLoading = false;\n      const video = this.$refs.heroVideo;\n      if (video) {\n        video.classList.add('playing');\n      }\n    },\n    handlePromoVideoError(error) {\n      console.error('Promo video error:', error);\n      this.promoVideoError = error;\n      const video = this.$refs.heroVideo;\n      if (video) {\n        video.classList.remove('playing');\n      }\n    },\n    async checkUserSubscription() {\n      try {\n        const phone = localStorage.getItem('phone');\n        if (!phone) return false;\n        const response = await axios.get(`${API_BASE_URL}/users/profile/?phone=${phone}`);\n        console.log('Subscription API response:', response.data); // DEBUG\n        if (response.data && response.data.status === 'success') {\n          const user = response.data.user;\n          console.log('User from API:', user); // DEBUG\n          // Check if user has active subscription\n          if (user.is_subscribed && user.subscription_end_date) {\n            const endDate = new Date(user.subscription_end_date);\n            const now = new Date();\n            const isActive = endDate > now;\n            console.log('is_subscribed:', user.is_subscribed, 'endDate:', endDate, 'now:', now, 'isActive:', isActive); // DEBUG\n            return isActive;\n          }\n        }\n        return false;\n      } catch (error) {\n        console.error('Error checking subscription:', error);\n        return false;\n      }\n    },\n    async checkRentalStatus() {\n      try {\n        const phone = localStorage.getItem('phone');\n        if (!phone) return null;\n        const response = await axios.get(`${API_BASE_URL}/api/rentals/check/?phone=${phone}&video_id=${this.movie.id}`);\n        if (response.data && response.data.status === 'success') {\n          return response.data.rental;\n        }\n        return null;\n      } catch (error) {\n        console.error('Error checking rental status:', error);\n        return null;\n      }\n    },\n    goToRentalPayment() {\n      this.showRentalPopup = false;\n      this.$router.push(`/movie/${this.movie.id}/rent`);\n    },\n    async playMovie() {\n      try {\n        console.log('playMovie() called - checking video URL');\n        // First check if we have a valid video URL\n        if (!this.movie.hls_url) {\n          throw new Error('No video URL available');\n        }\n\n        // Check user subscription status first\n        const isSubscribed = await this.checkUserSubscription();\n        console.log('User subscription status:', isSubscribed);\n\n        // Rental video logic\n        if (this.movie.video_type === 'rental') {\n          if (isSubscribed) {\n            // Premium user: play directly without showing rental popup\n            console.log('Premium user - playing directly');\n            this.controlsVisible = true;\n            this.isVideoPaused = false;\n            this.isVideoPlaying = true;\n            this.videoUrl = this.movie.hls_url;\n            this.streamType = 'hls';\n            document.body.style.overflow = 'hidden';\n            this.$nextTick(() => {\n              if (this.$refs.videoPlayer) {\n                this.resetControlsTimer();\n              } else {\n                console.error('Video player reference not found');\n                throw new Error('Video player initialization failed');\n              }\n            });\n          } else {\n            // Free user: check rental status\n            console.log('Free user - checking rental status');\n            const rentalInfo = await this.checkRentalStatus();\n            if (rentalInfo && rentalInfo.is_active) {\n              // Rental is active, allow playback\n              console.log('Active rental found - playing video');\n              this.controlsVisible = true;\n              this.isVideoPaused = false;\n              this.isVideoPlaying = true;\n              this.videoUrl = this.movie.hls_url;\n              this.streamType = 'hls';\n              document.body.style.overflow = 'hidden';\n              this.$nextTick(() => {\n                if (this.$refs.videoPlayer) {\n                  this.resetControlsTimer();\n                } else {\n                  console.error('Video player reference not found');\n                  throw new Error('Video player initialization failed');\n                }\n              });\n            } else {\n              // No active rental, redirect to rental page\n              console.log('No active rental - redirecting to rental page');\n              this.$router.push(`/movie/${this.movie.id}/rent`);\n            }\n          }\n          return;\n        }\n\n        // Paid video logic\n        if (this.movie.video_type === 'paid') {\n          if (!isSubscribed) {\n            // If not subscribed, redirect to subscription page\n            this.$router.push({\n              name: 'SubscriptionPlans',\n              query: {\n                redirect: this.$route.fullPath,\n                video_id: this.movie.id\n              }\n            });\n            return;\n          }\n        }\n\n        // Free video or user is subscribed, proceed with playback\n        console.log('Playing free/paid video');\n        this.controlsVisible = true;\n        this.isVideoPaused = false;\n        this.isVideoPlaying = true;\n        this.videoUrl = this.movie.hls_url;\n        this.streamType = 'hls';\n        document.body.style.overflow = 'hidden';\n        this.$nextTick(() => {\n          if (this.$refs.videoPlayer) {\n            this.resetControlsTimer();\n          } else {\n            console.error('Video player reference not found');\n            throw new Error('Video player initialization failed');\n          }\n        });\n      } catch (error) {\n        console.error('Error playing video:', error);\n        this.$store.dispatch('showToast', {\n          message: 'Sorry, the video is not available at the moment. Please try again later.',\n          type: 'error'\n        });\n        this.isVideoPlaying = false;\n        document.body.style.overflow = 'auto';\n      }\n    },\n    closeVideo() {\n      this.isVideoPlaying = false;\n      this.isPlayingPromo = false;\n\n      // Save the player preferences when closing the player\n      this.savePlayerPreferences();\n\n      // Restore body scrolling\n      document.body.style.overflow = '';\n    },\n    async toggleWatchlist() {\n      try {\n        // Get authentication state from localStorage\n        const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';\n        const token = localStorage.getItem('token');\n        if (!isAuthenticated || !token) {\n          // Store current path for redirect after login\n          const currentPath = this.$route.fullPath;\n          // Redirect to login with return URL\n          this.$router.push({\n            path: '/login',\n            query: {\n              redirect: currentPath\n            }\n          });\n          return;\n        }\n\n        // Show loading state\n        this.$store.commit('setLoading', true);\n        const response = await watchlistAPI.toggle(this.id);\n        if (response.data.status === 'success') {\n          this.isInWatchlist = response.data.in_watchlist;\n          // Show success message\n          this.$store.dispatch('showToast', {\n            message: response.data.message,\n            type: 'success'\n          });\n        }\n      } catch (error) {\n        console.error('Error toggling watchlist:', error);\n        // Show error message\n        this.$store.dispatch('showToast', {\n          message: 'Failed to update watchlist. Please try again.',\n          type: 'error'\n        });\n      } finally {\n        this.$store.commit('setLoading', false);\n      }\n    },\n    async checkWatchlistStatus() {\n      try {\n        // Check authentication from localStorage\n        const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';\n        const token = localStorage.getItem('token');\n        if (!isAuthenticated || !token) return;\n        const response = await watchlistAPI.getStatus(this.id);\n        this.isInWatchlist = response.data.in_watchlist;\n      } catch (error) {\n        console.error('Error checking watchlist status:', error);\n      }\n    },\n    shareMovie() {\n      // Get the current URL for sharing \n      const shareUrl = this.shareUrl;\n\n      // Get the best available image URL\n      const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n\n      // Prepare share data with image\n      const shareData = {\n        title: this.movie.title,\n        text: this.movie.description,\n        url: shareUrl\n      };\n\n      // Add image to share data if available\n      if (imageUrl) {\n        shareData.files = [imageUrl];\n      }\n\n      // Check if Web Share API is supported\n      if (typeof navigator !== 'undefined' && navigator.share && this.isMobileDevice) {\n        // For mobile devices, try to share with image\n        if (imageUrl && navigator.canShare && navigator.canShare(shareData)) {\n          navigator.share(shareData).then(() => {\n            this.$store.dispatch('showToast', {\n              message: 'Shared successfully with image!',\n              type: 'success'\n            });\n          }).catch(error => {\n            console.error('Error sharing with image:', error);\n            // Fallback to sharing without image\n            this.shareWithoutImage(this.shareUrl);\n          });\n        } else {\n          // Fallback to sharing without image\n          this.shareWithoutImage(this.shareUrl);\n        }\n      } else {\n        // Fallback for desktop or unsupported browsers\n        this.showShareDialog = true;\n      }\n    },\n    shareWithoutImage(shareUrl) {\n      const shareData = {\n        title: this.movie.title,\n        text: this.movie.description,\n        url: shareUrl\n      };\n      navigator.share(shareData).then(() => {\n        this.$store.dispatch('showToast', {\n          message: 'Shared successfully!',\n          type: 'success'\n        });\n      }).catch(error => {\n        console.error('Error sharing:', error);\n        this.showShareDialog = true;\n      });\n    },\n    updateMetaTags() {\n      if (!this.movie) return;\n      const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n      const shareUrl = this.shareUrl;\n      const title = this.movie.title;\n      const description = this.movie.description;\n      console.log('Updating meta tags for:', title);\n      console.log('Image URL:', imageUrl);\n      console.log('Share URL:', shareUrl);\n\n      // Update or create meta tags for Open Graph\n      this.updateMetaTag('og:title', title);\n      this.updateMetaTag('og:description', description);\n      this.updateMetaTag('og:image', imageUrl);\n      this.updateMetaTag('og:url', shareUrl);\n      this.updateMetaTag('og:type', 'video.movie');\n      this.updateMetaTag('og:site_name', 'No1 OTT');\n\n      // Update or create meta tags for Twitter Card\n      this.updateMetaTag('twitter:card', 'summary_large_image');\n      this.updateMetaTag('twitter:title', title);\n      this.updateMetaTag('twitter:description', description);\n      this.updateMetaTag('twitter:image', imageUrl);\n      this.updateMetaTag('twitter:url', shareUrl);\n\n      // Update page title\n      document.title = `${title} - No1 OTT`;\n      console.log('Meta tags updated successfully');\n    },\n    updateMetaTag(name, content) {\n      if (!content) return;\n      let meta = document.querySelector(`meta[name=\"${name}\"]`) || document.querySelector(`meta[property=\"${name}\"]`);\n      if (!meta) {\n        meta = document.createElement('meta');\n        if (name.startsWith('og:')) {\n          meta.setAttribute('property', name);\n        } else {\n          meta.setAttribute('name', name);\n        }\n        document.head.appendChild(meta);\n      }\n      meta.setAttribute('content', content);\n    },\n    toggleSearch() {\n      this.isSearchActive = !this.isSearchActive;\n    },\n    navigateToMovie(movieId) {\n      // Use full page refresh to ensure all components reinitialize\n      window.location.href = `/movie/${movieId}`;\n    },\n    navigateToCategory() {\n      // Navigate to category page with category ID\n      console.log('Navigating to category. Movie data:', this.movie);\n      console.log('Category ID:', this.movie.category_id);\n      console.log('Category:', this.movie.category);\n      const categoryId = this.movie.category_id || this.movie.category;\n      if (categoryId) {\n        console.log('Navigating to category ID:', categoryId);\n        // Use Vue Router for better debugging\n        this.$router.push({\n          name: 'CategoryVideos',\n          params: {\n            id: categoryId\n          }\n        });\n      } else {\n        console.error('No category ID found in movie data');\n        // Show error message to user\n        this.$store.dispatch('showToast', {\n          message: 'Category information not available',\n          type: 'error'\n        });\n      }\n    },\n    goBack() {\n      this.$router.go(-1);\n    },\n    capitalizeText(text) {\n      if (!text) return '';\n      // Split by spaces and special characters\n      return text.split(/[\\s-]+/).map(word => {\n        // Don't change case for special words\n        const specialWords = ['HD', 'UHD', '4K', 'TV', 'II', 'III', 'IV', 'SPY'];\n        if (specialWords.includes(word.toUpperCase())) {\n          return word.toUpperCase();\n        }\n        // Don't change case for articles and conjunctions in middle of title\n        const minorWords = ['a', 'an', 'the', 'and', 'but', 'or', 'for', 'nor', 'in', 'to', 'on', 'at', 'by', 'of'];\n        if (minorWords.includes(word.toLowerCase())) {\n          return word.toLowerCase();\n        }\n        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();\n      }).join(' ');\n    },\n    async fetchMovieDetails() {\n      try {\n        // Make API call to get movie details\n        const response = await axios.get(`${API_BASE_URL}/api/videos/${this.id}/`);\n        console.log('API Response:', response.data);\n        if (response.data) {\n          // Apply capitalization to title and description\n          this.movie = {\n            ...response.data,\n            title: this.capitalizeText(response.data.title),\n            description: this.capitalizeText(response.data.description)\n          };\n\n          // Update meta tags for social sharing\n          this.updateMetaTags();\n\n          // Set video URL based on available formats\n          if (response.data.hls_url) {\n            this.videoUrl = response.data.hls_url;\n            this.streamType = 'hls';\n          } else {\n            throw new Error('No video URL available');\n          }\n          console.log('Set video URL:', this.videoUrl);\n          console.log('Stream type:', this.streamType);\n\n          // Fetch related videos from same category\n          await this.fetchCategoryVideos();\n\n          // Fetch recently added videos\n          await this.fetchRecentlyAddedVideos();\n        } else {\n          throw new Error('Invalid response data');\n        }\n      } catch (error) {\n        console.error('Error fetching movie details:', error);\n        this.$store.dispatch('showToast', {\n          message: 'Error loading movie details. Please try again later.',\n          type: 'error'\n        });\n      }\n    },\n    async fetchCategoryVideos() {\n      try {\n        console.log('Fetching category videos for movie:', this.movie);\n        console.log('Category ID:', this.movie.category_id);\n        console.log('Category Name:', this.movie.category_name);\n        if (!this.movie.category_id && !this.movie.category_name) {\n          console.log('No category information available');\n          // Use fallback data\n          this.categoryVideos = this.relatedMovies.slice(0, 8);\n          return;\n        }\n\n        // Use the correct API endpoint for category videos\n        const categoryId = this.movie.category_id || this.movie.category;\n        if (!categoryId) {\n          console.log('No category ID found');\n          this.categoryVideos = this.relatedMovies.slice(0, 8);\n          return;\n        }\n        const response = await axios.get(`${API_BASE_URL}/api/videos/category/${categoryId}/?page=1&page_size=12`);\n        if (response.data && response.data.status === 'success') {\n          console.log('Category videos API response:', response.data);\n\n          // Filter out current video from the results\n          let videos = response.data.data || [];\n          videos = videos.filter(video => video.id !== this.movie.id);\n          this.categoryVideos = videos.slice(0, 12).map(video => ({\n            ...video,\n            title: this.capitalizeText(video.title)\n          }));\n          console.log('Processed category videos:', this.categoryVideos);\n        } else {\n          console.log('No API response or invalid status, using fallback data');\n          // Use fallback data\n          this.categoryVideos = this.relatedMovies.slice(0, 8);\n        }\n\n        // Update scroll buttons after data loads\n        this.$nextTick(() => {\n          this.checkScrollButtons('categoryContainer', 'category');\n        });\n      } catch (error) {\n        console.error('Error fetching category videos:', error);\n        console.log('Using fallback data due to error');\n        // Use fallback data on error\n        this.categoryVideos = this.relatedMovies.slice(0, 8);\n      }\n    },\n    async fetchRecentlyAddedVideos() {\n      try {\n        console.log('Fetching recently added videos');\n        const response = await axios.get(`${API_BASE_URL}/api/videos/`, {\n          params: {\n            ordering: '-created_at',\n            limit: 20\n          }\n        });\n        let videos = [];\n        if (response.data) {\n          if (Array.isArray(response.data)) {\n            videos = response.data;\n          } else if (response.data.results) {\n            videos = response.data.results;\n          } else if (response.data.data) {\n            videos = response.data.data;\n          }\n        }\n\n        // Filter out current video from the results\n        videos = videos.filter(video => video.id !== this.movie.id);\n        this.recentlyAddedVideos = videos.slice(0, 12).map(video => ({\n          ...video,\n          title: this.capitalizeText(video.title)\n        }));\n        console.log('Processed recently added videos:', this.recentlyAddedVideos);\n\n        // Update scroll buttons after data loads\n        this.$nextTick(() => {\n          this.checkScrollButtons('recentlyAddedContainer', 'recentlyAdded');\n        });\n      } catch (error) {\n        console.error('Error fetching recently added videos:', error);\n        // Use fallback data on error\n        this.recentlyAddedVideos = this.relatedMovies.slice(0, 8);\n      }\n    },\n    checkDeviceType() {\n      // Check if mobile based on screen width or user agent\n      this.isMobileDevice = window.innerWidth < 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n\n      // Adjust video control timeout based on device type\n      this.videoInteractionDelay = this.isMobileDevice ? 3500 : 2500; // Mobile needs longer timeout\n    },\n    showControlsOnInteraction() {\n      // Make controls visible on interaction\n      this.controlsVisible = true;\n\n      // Reset the timeout when there's interaction\n      this.resetControlsTimer();\n    },\n    resetControlsTimer() {\n      // Clear any existing timeout\n      if (this.controlsTimeout) {\n        clearTimeout(this.controlsTimeout);\n      }\n\n      // If video is playing (not paused), set a timeout to hide controls\n      if (!this.isVideoPaused) {\n        this.controlsTimeout = setTimeout(() => {\n          this.controlsVisible = false;\n        }, this.videoInteractionDelay);\n      }\n    },\n    toggleControlsVisibility(event) {\n      // Prevent default behavior\n      event.preventDefault();\n\n      // Toggle controls visibility on tap/click (common OTT pattern)\n      this.controlsVisible = !this.controlsVisible;\n      if (this.controlsVisible && !this.isVideoPaused) {\n        // If showing controls and video is playing, reset the timer\n        this.resetControlsTimer();\n      }\n    },\n    onVideoPlay() {\n      this.isVideoPaused = false;\n      this.resetControlsTimer(); // Start the timer to hide controls\n    },\n    onVideoPause() {\n      this.isVideoPaused = true;\n      this.controlsVisible = true; // Always show controls when paused\n\n      // Clear any existing timeout\n      if (this.controlsTimeout) {\n        clearTimeout(this.controlsTimeout);\n      }\n    },\n    handleVideoError(errorMessage) {\n      console.error('Video playback error:', errorMessage);\n\n      // If DASH format fails, try falling back to MP4\n      if (this.streamType === 'dash' && this.videoUrl.includes('.mpd')) {\n        this.streamType = 'mp4';\n        this.videoUrl = 'https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8';\n        console.log('Falling back to MP4 format');\n\n        // Retry with MP4\n        if (this.$refs.videoPlayer) {\n          this.$refs.videoPlayer.retry();\n        }\n      }\n    },\n    checkScrollButtons(containerId, section) {\n      const container = this.$refs[containerId];\n      if (!container) return;\n\n      // Check if we can scroll left\n      this.canScrollLeft[section] = container.scrollLeft > 0;\n\n      // Check if we can scroll right\n      const maxScroll = container.scrollWidth - container.clientWidth;\n      this.canScrollRight[section] = container.scrollLeft < maxScroll - 1; // -1 for rounding errors\n    },\n    scrollLeft(containerId) {\n      const container = this.$refs[containerId];\n      if (!container) return;\n      const cardWidth = containerId === 'categoryContainer' || containerId === 'recentlyAddedContainer' ? 160 : 180; // Adjust based on card width\n      const visibleWidth = container.clientWidth;\n      const cardsToScroll = Math.floor(visibleWidth / cardWidth);\n      const scrollAmount = cardWidth * cardsToScroll;\n      const targetScroll = Math.max(0, container.scrollLeft - scrollAmount);\n      container.scrollTo({\n        left: targetScroll,\n        behavior: 'smooth'\n      });\n    },\n    scrollRight(containerId) {\n      const container = this.$refs[containerId];\n      if (!container) return;\n      const cardWidth = containerId === 'categoryContainer' || containerId === 'recentlyAddedContainer' ? 160 : 180; // Adjust based on card width\n      const visibleWidth = container.clientWidth;\n      const cardsToScroll = Math.floor(visibleWidth / cardWidth);\n      const scrollAmount = cardWidth * cardsToScroll;\n      const maxScroll = container.scrollWidth - container.clientWidth;\n      const targetScroll = Math.min(maxScroll, container.scrollLeft + scrollAmount);\n      container.scrollTo({\n        left: targetScroll,\n        behavior: 'smooth'\n      });\n    },\n    handleScroll() {\n      const header = document.querySelector('.header-with-gradient');\n      if (header) {\n        if (window.scrollY > 50) {\n          header.classList.add('scrolled');\n        } else {\n          header.classList.remove('scrolled');\n        }\n      }\n    },\n    // Handle subscription payment\n    handleSubscribe() {\n      // Close the payment popup\n      this.showPaymentPopup = false;\n      // Redirect to subscription plans page\n      this.$router.push({\n        name: 'SubscriptionPlans',\n        query: {\n          redirect: this.$route.fullPath,\n          // Store current movie page URL\n          video_id: this.movie.id // Pass video ID\n        }\n      });\n    },\n    // Close payment popup\n    closePaymentPopup() {\n      this.showPaymentPopup = false;\n    },\n    handlePromoVideoEnd() {\n      console.log('Promo video ended');\n      const video = this.$refs.heroVideo;\n      if (video) {\n        // Reset to beginning and play again\n        video.currentTime = 0;\n        video.play().catch(error => {\n          console.log('Error replaying promo video:', error);\n        });\n      }\n      this.isPromoPlaying = false;\n    },\n    // Helper to initialize or update video.js player for promo/main video\n    initVideoJsPlayer(videoEl, videoSrc) {\n      if (!videoEl) return;\n      // Only initialize if not already initialized\n      if (!videoEl._videojsPlayer) {\n        videoEl._videojsPlayer = videojs(videoEl, {\n          controls: true,\n          autoplay: true,\n          muted: true,\n          preload: 'auto',\n          fluid: true\n        });\n        videoEl._videojsPlayer.on('error', () => {\n          this.promoVideoError = videoEl._videojsPlayer.error();\n          console.error('Video.js error:', this.promoVideoError);\n        });\n      }\n      // Only update source if changed\n      if (videoEl._videojsPlayer.currentSrc() !== videoSrc) {\n        videoEl._videojsPlayer.src({\n          src: videoSrc,\n          type: 'application/x-mpegURL'\n        });\n      }\n      // Reset playing state before playback\n      this.isPromoPlaying = false;\n      videoEl._videojsPlayer.off('playing'); // Remove previous listeners\n      videoEl._videojsPlayer.on('playing', () => {\n        this.isPromoPlaying = true;\n        this.$forceUpdate(); // Ensure Vue reactivity\n        console.log('video.js playing event fired, isPromoPlaying set to true');\n      });\n      videoEl._videojsPlayer.ready(() => {\n        videoEl._videojsPlayer.muted(true);\n        videoEl._videojsPlayer.play().then(() => {\n          console.log('Video should be playing');\n          console.log('Player state:', videoEl._videojsPlayer.paused(), videoEl._videojsPlayer.currentSrc());\n        }).catch(e => {\n          console.error('Auto-play prevented:', e);\n        });\n      });\n      // Add native error event logging\n      videoEl.addEventListener('error', e => {\n        console.error('Native video error:', e);\n      });\n    },\n    async playPromo() {\n      try {\n        console.log('playPromo() called - checking promo URL');\n\n        // Check if we have a valid promo URL\n        if (!this.movie.promo_hls_url) {\n          throw new Error('No promo video URL available');\n        }\n\n        // Set video URL and detect format\n        this.videoUrl = this.movie.promo_hls_url;\n\n        // Auto-detect stream type based on URL\n        if (this.videoUrl.includes('.mpd')) {\n          this.streamType = 'dash';\n        } else if (this.videoUrl.includes('.m3u8')) {\n          this.streamType = 'hls';\n        } else {\n          this.streamType = 'hls'; // Default to HLS\n        }\n        console.log('Playing promo with URL:', this.videoUrl);\n        console.log('Stream type:', this.streamType);\n\n        // Use AdvancedVideoPlayer (same as full video)\n        this.controlsVisible = true;\n        this.isVideoPaused = false;\n        this.isVideoPlaying = true;\n        this.isPlayingPromo = true;\n\n        // Hide body scroll\n        document.body.style.overflow = 'hidden';\n        this.$nextTick(() => {\n          if (this.$refs.videoPlayer) {\n            this.resetControlsTimer();\n          } else {\n            console.error('Video player reference not found');\n            throw new Error('Video player initialization failed');\n          }\n        });\n      } catch (error) {\n        console.error('Error playing promo video:', error);\n        this.$store.dispatch('showToast', {\n          message: 'Sorry, the promo video is not available at the moment. Please try again later.',\n          type: 'error'\n        });\n        this.isVideoPlaying = false;\n        this.isPlayingPromo = false;\n        document.body.style.overflow = 'auto';\n      }\n    },\n    shareToWhatsApp() {\n      const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n      const text = `Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`;\n\n      // For WhatsApp, we need to use a different approach for image sharing\n      if (imageUrl && this.isMobileDevice) {\n        // Try to use native sharing with image for mobile devices\n        const shareData = {\n          title: this.movie.title,\n          text: text,\n          url: this.shareUrl,\n          files: [imageUrl]\n        };\n        if (navigator.canShare && navigator.canShare(shareData)) {\n          navigator.share(shareData).then(() => {\n            this.$store.dispatch('showToast', {\n              message: 'Shared to WhatsApp with image!',\n              type: 'success'\n            });\n          }).catch(error => {\n            console.error('WhatsApp share error:', error);\n            // Fallback to text-only WhatsApp sharing\n            this.shareToWhatsAppTextOnly(text);\n          });\n        } else {\n          // Fallback to text-only WhatsApp sharing\n          this.shareToWhatsAppTextOnly(text);\n        }\n      } else {\n        // Desktop or no image available - use text-only sharing\n        this.shareToWhatsAppTextOnly(text);\n      }\n      this.showShareDialog = false;\n    },\n    shareToWhatsAppTextOnly(text) {\n      // Use the share URL directly to trigger rich preview\n      const shareText = `${text}\\n\\n${this.shareUrl}`;\n      const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(shareText)}`;\n      if (typeof window !== 'undefined') {\n        window.open(whatsappUrl, '_blank');\n      }\n    },\n    // Alternative method for WhatsApp image sharing using canvas\n    async shareToWhatsAppWithImage() {\n      try {\n        const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n        if (!imageUrl) {\n          this.shareToWhatsAppTextOnly(`Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`);\n          return;\n        }\n\n        // Create a canvas with the image and text overlay\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n\n        // Set canvas size\n        canvas.width = 600;\n        canvas.height = 400;\n\n        // Load the image\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.onload = () => {\n          // Draw the image\n          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n\n          // Add a semi-transparent overlay for text readability\n          ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';\n          ctx.fillRect(0, canvas.height - 120, canvas.width, 120);\n\n          // Add text\n          ctx.fillStyle = 'white';\n          ctx.font = 'bold 24px Arial';\n          ctx.textAlign = 'center';\n          ctx.fillText(this.movie.title, canvas.width / 2, canvas.height - 80);\n          ctx.font = '16px Arial';\n          ctx.fillText('Watch on No1 OTT', canvas.width / 2, canvas.height - 50);\n\n          // Convert canvas to blob\n          canvas.toBlob(blob => {\n            if (blob) {\n              // Create a file from the blob\n              const file = new File([blob], 'movie-share.jpg', {\n                type: 'image/jpeg'\n              });\n\n              // Try to share with the generated image\n              const shareData = {\n                title: this.movie.title,\n                text: `Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.shareUrl}`,\n                files: [file]\n              };\n              if (navigator.canShare && navigator.canShare(shareData)) {\n                navigator.share(shareData).then(() => {\n                  this.$store.dispatch('showToast', {\n                    message: 'Shared to WhatsApp with image!',\n                    type: 'success'\n                  });\n                }).catch(error => {\n                  console.error('WhatsApp share error:', error);\n                  this.shareToWhatsAppTextOnly(`Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`);\n                });\n              } else {\n                this.shareToWhatsAppTextOnly(`Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`);\n              }\n            }\n          }, 'image/jpeg', 0.8);\n        };\n        img.onerror = () => {\n          // If image fails to load, fallback to text-only\n          this.shareToWhatsAppTextOnly(`Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`);\n        };\n        img.src = imageUrl;\n      } catch (error) {\n        console.error('Error creating WhatsApp image share:', error);\n        this.shareToWhatsAppTextOnly(`Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`);\n      }\n    },\n    shareToFacebook() {\n      const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n      let facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(this.shareUrl)}`;\n\n      // Add image URL to Facebook share if available\n      if (imageUrl) {\n        facebookUrl += `&picture=${encodeURIComponent(imageUrl)}`;\n      }\n      if (typeof window !== 'undefined') {\n        window.open(facebookUrl, '_blank');\n      }\n      this.showShareDialog = false;\n    },\n    shareToTwitter() {\n      const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n      const text = `Check out \"${this.movie.title}\" on No1 OTT!`;\n      let twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(this.shareUrl)}`;\n\n      // Add image URL to Twitter share if available\n      if (imageUrl) {\n        twitterUrl += `&image=${encodeURIComponent(imageUrl)}`;\n      }\n      if (typeof window !== 'undefined') {\n        window.open(twitterUrl, '_blank');\n      }\n      this.showShareDialog = false;\n    },\n    async copyShareLink() {\n      if (typeof navigator === 'undefined') return;\n      try {\n        await navigator.clipboard.writeText(this.shareUrl);\n        this.copyStatus = 'Copied!';\n\n        // Show success toast\n        this.$store.dispatch('showToast', {\n          message: 'Link copied to clipboard!',\n          type: 'success'\n        });\n\n        // Reset copy status after 2 seconds\n        setTimeout(() => {\n          this.copyStatus = 'Copy';\n        }, 2000);\n      } catch (err) {\n        console.error('Failed to copy:', err);\n\n        // Fallback for older browsers\n        if (this.$refs.shareLink) {\n          this.$refs.shareLink.select();\n          document.execCommand('copy');\n          this.copyStatus = 'Copied!';\n          setTimeout(() => {\n            this.copyStatus = 'Copy';\n          }, 2000);\n        }\n      }\n    },\n    // Test social media preview\n    testSocialPreview() {\n      const testUrl = `${window.location.origin}/movie/${this.movie.id}?test=true`;\n      console.log('Testing social preview with URL:', testUrl);\n\n      // Open in new tab for testing\n      window.open(testUrl, '_blank');\n      this.$store.dispatch('showToast', {\n        message: 'Social preview test opened in new tab!',\n        type: 'info'\n      });\n    }\n  }\n};","map":{"version":3,"names":["AppHeader","AppFooter","AdvancedVideoPlayer","axios","watchlistAPI","videojs","store","API_BASE_URL","axiosInstance","create","baseURL","headers","interceptors","request","use","config","token","getters","Authorization","error","Promise","reject","name","components","props","id","type","Number","String","required","data","movie","inWatchlist","isSearchActive","isVideoPlaying","controlsVisible","isVideoPaused","controlsTimeout","isMobileDevice","videoInteractionDelay","videoUrl","streamType","isUserSubscribed","promoStartDelay","drmConfig","servers","clearKeys","playerSettings","defaultQuality","preferredQualityIndex","skipInterval","keyboardShortcutsEnabled","rememberLastPosition","autoQualitySwitch","canScrollLeft","category","related","recentlyAdded","canScrollRight","categoryVideos","recentlyAddedVideos","relatedMovies","title","thumbnail_url","portrait_thumbnail_url","video_type","heroVideo","hls","showPaymentPopup","userSubscriptionStatus","showRentalPopup","rentalInfo","isSubscribed","isPromoLoading","promoVideoError","isPlayingPromo","isInWatchlist","showShareDialog","copyStatus","promoHasError","videojsPlayer","shakaPromoPlayer","isPromoPlaying","computed","currentUserId","user","localStorage","getItem","userData","JSON","parse","e","computedStreamType","includes","movieYear","created_at","Date","getFullYear","formattedDuration","duration","totalSeconds","parseInt","isNaN","hours","Math","floor","minutes","categoryName","category_name","formattedCategories","categories","map","cat","join","shareUrl","window","location","href","shouldShowPromoButton","promo_hls_url","trim","watch","$route","scrollTo","fetchMovieDetails","then","$nextTick","initializeHeroVideo","immediate","handler","newUrl","newMovie","promo_video_url","updateMetaTags","val","console","log","mounted","checkScrollButtons","checkDeviceType","addEventListener","handleScroll","beforeUnmount","destroy","removeEventListener","clearTimeout","dispose","created","params","videoType","checkUserSubscription","loadPlayerPreferences","checkWatchlistStatus","methods","formatWatchPeriod","days","savedPreferences","preferences","Object","keys","forEach","key","undefined","savePlayerPreferences","setItem","stringify","video","$refs","videoSrc","video_url","isMPD","toLowerCase","isHLS","muted","initializeShakaPromoPlayer","initializeVideoJsPromoPlayer","shaka","polyfill","installAll","Player","isBrowserSupported","attach","configure","streaming","bufferingGoal","rebufferingGoal","bufferBehind","abr","enabled","event","detail","code","util","Error","Code","BAD_HTTP_STATUS","HTTP_ERROR","handlePromoVideoError","load","play","catch","err","sources","src","controls","autoplay","preload","fluid","ready","on","onPromoVideoCanPlay","onPromoVideoLoaded","classList","add","onPromoVideoWaiting","onPromoVideoPlaying","remove","phone","response","get","status","is_subscribed","subscription_end_date","endDate","now","isActive","checkRentalStatus","rental","goToRentalPayment","$router","push","playMovie","hls_url","document","body","style","overflow","videoPlayer","resetControlsTimer","is_active","query","redirect","fullPath","video_id","$store","dispatch","message","closeVideo","toggleWatchlist","isAuthenticated","currentPath","path","commit","toggle","in_watchlist","getStatus","shareMovie","imageUrl","poster_url","shareData","text","description","url","files","navigator","share","canShare","shareWithoutImage","updateMetaTag","content","meta","querySelector","createElement","startsWith","setAttribute","head","appendChild","toggleSearch","navigateToMovie","movieId","navigateToCategory","category_id","categoryId","goBack","go","capitalizeText","split","word","specialWords","toUpperCase","minorWords","charAt","slice","fetchCategoryVideos","fetchRecentlyAddedVideos","videos","filter","ordering","limit","Array","isArray","results","innerWidth","test","userAgent","showControlsOnInteraction","setTimeout","toggleControlsVisibility","preventDefault","onVideoPlay","onVideoPause","handleVideoError","errorMessage","retry","containerId","section","container","scrollLeft","maxScroll","scrollWidth","clientWidth","cardWidth","visibleWidth","cardsToScroll","scrollAmount","targetScroll","max","left","behavior","scrollRight","min","header","scrollY","handleSubscribe","closePaymentPopup","handlePromoVideoEnd","currentTime","initVideoJsPlayer","videoEl","_videojsPlayer","currentSrc","off","$forceUpdate","paused","playPromo","shareToWhatsApp","shareToWhatsAppTextOnly","shareText","whatsappUrl","encodeURIComponent","open","shareToWhatsAppWithImage","canvas","ctx","getContext","width","height","img","Image","crossOrigin","onload","drawImage","fillStyle","fillRect","font","textAlign","fillText","toBlob","blob","file","File","onerror","shareToFacebook","facebookUrl","shareToTwitter","twitterUrl","copyShareLink","clipboard","writeText","shareLink","select","execCommand","testSocialPreview","testUrl","origin"],"sources":["/Users/saisudhakarmanchala/Documents/No1OTT/ott_frontend_mpd/src/views/MovieDetails.vue"],"sourcesContent":["<template>\n  <div class=\"movie-details-wrapper bg-[#121212] text-white min-h-screen\">\n    <!-- Advanced Video Player modal - Full screen when active -->\n    <div v-if=\"isVideoPlaying\" class=\"advanced-video-player-modal\" @mousemove=\"showControlsOnInteraction\" @touchstart=\"showControlsOnInteraction\" @click=\"toggleControlsVisibility\">\n      <AdvancedVideoPlayer \n        ref=\"videoPlayer\"\n        :src=\"videoUrl\"\n        :title=\"movie.title\"\n        :video-id=\"movie.id\"\n        :user-id=\"currentUserId\"\n        :streamType=\"streamType\"\n        :autoplay=\"true\"\n        :isLive=\"false\"\n        :drmConfig=\"drmConfig\"\n        :controlsVisible=\"controlsVisible\"\n        @close=\"closeVideo\"\n        @play=\"onVideoPlay\"\n        @pause=\"onVideoPause\"\n        @interaction=\"showControlsOnInteraction\"\n        @error=\"handleVideoError\"\n      />\n    </div>\n\n    <!-- Desktop header with gradient overlay -->\n    <div class=\"hide-on-mobile header-with-gradient\">\n      <AppHeader @toggle-search=\"toggleSearch\" :hideBackButton=\"true\" />\n    </div>\n    \n    <div class=\"movie-detail-container\">\n      <!-- Hero Banner Section with Backdrop Image -->\n      <div class=\"movie-backdrop\">\n        <!-- Thumbnail background -->\n        <img \n          :src=\"isMobileDevice && movie.portrait_thumbnail_url ? movie.portrait_thumbnail_url : movie.thumbnail_url\" \n          alt=\"Movie Thumbnail\"\n          :class=\"['backdrop-image', {'portrait-mobile': isMobileDevice && movie.portrait_thumbnail_url}]\"\n          v-show=\"!isPromoPlaying && !isPromoLoading\"\n        />\n        <!-- Video overlay -->\n        <div v-if=\"movie.promo_hls_url\" class=\"video-container\">\n          <!-- Loading spinner -->\n          <div v-if=\"isPromoLoading\" class=\"video-loading\"></div>\n          <video \n            ref=\"heroVideo\"\n            class=\"backdrop-video\"\n            :poster=\"movie.thumbnail_url\"\n            autoplay\n            muted\n            loop\n            playsinline\n            preload=\"auto\"\n            @loadeddata=\"onPromoVideoLoaded\"\n            @ended=\"handlePromoVideoEnd\"\n            @error=\"handlePromoVideoError\"\n            @waiting=\"onPromoVideoWaiting\"\n            @playing=\"onPromoVideoPlaying\"\n            @canplay=\"onPromoVideoCanPlay\"\n            v-show=\"isPromoPlaying && !isPromoLoading\"\n            style=\"width: 100vw; max-width: 100vw; aspect-ratio: 16/9; object-fit: contain; background: #000; display: block; margin: 0 auto; max-height: 70vh;\"\n          >\n          </video>\n        </div>\n        <div class=\"backdrop-gradient\"></div>\n      </div>\n\n      <!-- Mobile-only back button -->\n      <button \n        class=\"back-btn mobile-only-element\"\n        @click=\"goBack\"\n      >\n        <i class=\"fas fa-arrow-left\"></i>\n      </button>\n\n      <!-- Movie Info Section -->\n      <div class=\"movie-info-container\">\n        <!-- Movie Badges -->\n        <div class=\"movie-badges\">\n          <span v-if=\"movie.video_type === 'paid'\" class=\"badge premium\">\n            <i class=\"fas fa-crown mr-1\"></i>\n            Premium\n          </span>\n          <span v-if=\"movie.is4K\" class=\"badge quality\">4K</span>\n        </div>\n\n        <!-- Movie Title -->\n        <h1 class=\"movie-title\">{{ movie.title }}</h1>\n        \n        <!-- Movie Meta Info -->\n        <div class=\"movie-meta\">\n          <span>{{ movieYear }}</span>\n          <span class=\"dot-divider\"></span>\n          <span>{{ formattedDuration }}</span>\n          <span class=\"dot-divider\"></span>\n          <span>{{ categoryName }}</span>\n          <!-- Rental price display for rental videos (only for free users) -->\n          <template v-if=\"movie.video_type === 'rental' && movie.prices && movie.prices.length && !isUserSubscribed\">\n            <span class=\"dot-divider\"></span>\n            <span class=\"badge premium\">\n              <i class=\"fas fa-ticket-alt mr-1\"></i>\n              Rental:\n              <template v-for=\"(price, idx) in movie.prices\" :key=\"price.id\">\n                â‚¹{{ price.rental_price }} for {{ formatWatchPeriod(price.rental_duration) }}<span v-if=\"idx < movie.prices.length - 1\">, </span>\n              </template>\n            </span>\n          </template>\n          <span v-if=\"movie.video_type === 'paid' && movie.rental_price\" class=\"premium-price ml-2\">\n            â‚¹{{ movie.rental_price }}\n          </span>\n        </div>\n        \n        <!-- Movie Tags -->\n        <div v-if=\"movie.mood1 || movie.mood2\" class=\"movie-tags\">\n          <span v-if=\"movie.mood1\" class=\"tag\">{{ movie.mood1 }}</span>\n          <span v-if=\"movie.mood2\" class=\"tag\">{{ movie.mood2 }}</span>\n        </div>\n        \n        <!-- Movie Description -->\n        <p class=\"movie-description\">\n          {{ movie.description }}\n        </p>\n        \n        <!-- Action Buttons - Unified design for both desktop and mobile -->\n        <div class=\"action-buttons\">\n          <button v-if=\"shouldShowPromoButton\" class=\"play-button\" @click=\"playPromo\">\n            <i class=\"fas fa-film\"></i>\n            <span>Promo</span>\n          </button>\n\n          <button class=\"play-button\" @click=\"playMovie\">\n            <i class=\"fas fa-play\"></i>\n            <span>Full Video</span>\n          </button>\n          \n          <button \n            class=\"secondary-button\" \n            @click=\"toggleWatchlist\"\n            :class=\"{ 'in-watchlist': isInWatchlist }\"\n          >\n            <i :class=\"['fas', isInWatchlist ? 'fa-bookmark' : 'fa-bookmark-o']\"></i>\n            {{ isInWatchlist ? 'Remove from Watchlist' : 'Add to Watchlist' }}\n          </button>\n          <button class=\"action-button\" @click=\"shareMovie\">\n            <i class=\"fas fa-share-alt\"></i>\n            <span class=\"action-label\">Share</span>\n          </button>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Main content sections with carousel style like Home page -->\n    <main class=\"pl-4 sm:pl-6 md:pl-10 py-4 space-y-8 relative overflow-hidden\">\n      <!-- Related Videos by Category Section -->\n      <section>\n        <div class=\"flex justify-between items-center mb-3 pr-4\">\n          <h2 class=\"gradient-text font-semibold text-base md:text-lg\">\n            {{ categoryName }} \n          </h2>\n          <a \n            class=\"text-white font-semibold text-sm hover:underline whitespace-nowrap cursor-pointer\" \n            @click=\"navigateToCategory\"\n          >\n            View All\n          </a>\n        </div>\n        <div class=\"relative carousel-container\">\n          <button\n            v-if=\"canScrollLeft.category\"\n            aria-label=\"Previous Category Videos\"\n            class=\"scroll-button left-scroll-button\"\n            @click=\"scrollLeft('categoryContainer')\"\n          >\n            <i class=\"fas fa-chevron-left\"></i>\n          </button>\n          <div\n            class=\"flex gap-4 overflow-x-auto scrollbar-hide scroll-container snap-x snap-mandatory\"\n            ref=\"categoryContainer\"\n            @scroll=\"checkScrollButtons('categoryContainer', 'category')\"\n          >\n            <div class=\"flex gap-4 pr-4 carousel-inner-container\">\n              <div \n                v-for=\"(video, index) in categoryVideos\" \n                :key=\"index\" \n                class=\"related-movie-card snap-start\"\n                @click=\"navigateToMovie(video.id)\"\n              >\n                <div class=\"relative rounded-md overflow-hidden card-container\">\n                  <img :src=\"video.portrait_thumbnail_url || video.thumbnail_url || video.poster_url\" :alt=\"video.title\" class=\"related-movie-image\">\n                  <!-- Premium badge for paid videos -->\n                  <div v-if=\"video.video_type === 'paid'\" class=\"absolute top-2 right-2\">\n                    <span class=\"bg-gradient-to-r from-[#c30059] to-[#ff0062] text-white text-xs px-2 py-1 rounded-full font-semibold\">\n                      <i class=\"fas fa-crown mr-1\"></i>Premium\n                    </span>\n                </div>\n                  <!-- 4K badge -->\n                  <div v-if=\"video.is4K\" class=\"absolute top-2 left-2\">\n                    <span class=\"bg-blue-600 text-white text-xs px-2 py-1 rounded-full font-semibold\">\n                      4K\n                    </span>\n                </div>\n                </div>\n                <p class=\"related-movie-title mt-1 text-xs font-semibold truncate card-text\">\n                  {{ capitalizeText(video.title) }}\n                </p>\n              </div>\n            </div>\n          </div>\n          <button\n            v-if=\"canScrollRight.category\"\n            aria-label=\"Next Category Videos\"\n            class=\"scroll-button right-scroll-button\"\n            @click=\"scrollRight('categoryContainer')\"\n          >\n            <i class=\"fas fa-chevron-right\"></i>\n          </button>\n        </div>\n      </section>\n      \n\n      <!-- Recently Added Section -->\n      <section>\n        <div class=\"flex justify-between items-center mb-3 pr-4\">\n          <h2 class=\"gradient-text font-semibold text-base md:text-lg\">\n            Recently Added\n          </h2>\n        </div>\n        <div class=\"relative carousel-container\">\n          <button\n            v-if=\"canScrollLeft.recentlyAdded\"\n            aria-label=\"Previous Recently Added\"\n            class=\"scroll-button left-scroll-button\"\n            @click=\"scrollLeft('recentlyAddedContainer')\"\n          >\n            <i class=\"fas fa-chevron-left\"></i>\n          </button>\n          <div\n            class=\"flex gap-4 overflow-x-auto scrollbar-hide scroll-container snap-x snap-mandatory\"\n            ref=\"recentlyAddedContainer\"\n            @scroll=\"checkScrollButtons('recentlyAddedContainer', 'recentlyAdded')\"\n          >\n            <div class=\"flex gap-4 pr-4 carousel-inner-container\">\n              <div \n                v-for=\"(video, index) in recentlyAddedVideos\" \n                :key=\"index\" \n                class=\"related-movie-card snap-start\"\n                @click=\"navigateToMovie(video.id)\"\n              >\n                <div class=\"relative rounded-md overflow-hidden card-container\">\n                  <img :src=\"video.portrait_thumbnail_url || video.thumbnail_url || video.poster_url\" :alt=\"video.title\" class=\"related-movie-image\">\n                  <!-- Premium badge for paid videos -->\n                  <div v-if=\"video.video_type === 'paid'\" class=\"absolute top-2 right-2 flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-r from-[#c30059] to-[#ff0062] shadow\">\n                    <i class=\"fas fa-crown text-white text-base\"></i>\n                  </div>\n                  <!-- 4K badge -->\n                  <div v-if=\"video.is4K\" class=\"absolute bottom-2 left-2\">\n                    <span class=\"bg-blue-600 text-white text-xs px-2 py-1 rounded-full font-semibold\">\n                      4K\n                    </span>\n                  </div>\n                </div>\n                <p class=\"related-movie-title mt-1 text-xs font-semibold truncate card-text\">\n                  {{ capitalizeText(video.title) }}\n                </p>\n              </div>\n            </div>\n          </div>\n          <button\n            v-if=\"canScrollRight.recentlyAdded\"\n            aria-label=\"Next Recently Added\"\n            class=\"scroll-button right-scroll-button\"\n            @click=\"scrollRight('recentlyAddedContainer')\"\n          >\n            <i class=\"fas fa-chevron-right\"></i>\n          </button>\n        </div>\n      </section>\n    </main>\n\n    <!-- Mobile Search Bar -->\n    <div class=\"mobile-search-bar\" :class=\"{ active: isSearchActive }\">\n      <input type=\"text\" placeholder=\"Search movies, shows and more...\">\n      <button class=\"text-white\" @click=\"toggleSearch\">\n        <i class=\"fas fa-times\"></i>\n      </button>\n    </div>\n\n    <!-- Payment Popup -->\n    <div v-if=\"showPaymentPopup\" class=\"payment-popup-overlay\">\n      <div class=\"payment-popup\">\n        <div class=\"popup-header\">\n          <div class=\"flex items-center gap-3\">\n            <div class=\"premium-badge\">\n              <i class=\"fas fa-crown\"></i>\n            </div>\n            <div>\n              <h2 class=\"text-xl font-bold\">Premium Content</h2>\n              <p class=\"text-sm text-white/60\">Subscribe to Continue Watching</p>\n            </div>\n          </div>\n          <button @click=\"closePaymentPopup\" class=\"close-button\">\n            <i class=\"fas fa-times\"></i>\n          </button>\n        </div>\n        \n        <div class=\"popup-content\">\n          <!-- Movie Preview -->\n          <div class=\"movie-preview\">\n            <img :src=\"movie.thumbnail_url || movie.poster_url\" alt=\"Movie Thumbnail\" class=\"popup-thumbnail\">\n            <div class=\"movie-info\">\n              <h3 class=\"movie-title\">{{ movie.title }}</h3>\n              <div class=\"flex items-center gap-2 text-sm text-white/60\">\n                <span v-if=\"formattedDuration\">{{ formattedDuration }}</span>\n                <span v-if=\"formattedDuration && categoryName\" class=\"dot-divider\"></span>\n                <span>{{ categoryName }}</span>\n              </div>\n            </div>\n          </div>\n\n          <!-- Premium Features -->\n          <div class=\"premium-features\">\n            <h4 class=\"text-lg font-semibold mb-4\">Premium Benefits</h4>\n            <div class=\"features-grid\">\n              <div class=\"feature-item\">\n                <i class=\"fas fa-film text-[#c30059]\"></i>\n                <div>\n                  <p class=\"font-medium\">All Premium Content</p>\n                  <p class=\"text-sm text-white/60\">Unlimited access to premium movies & shows</p>\n                </div>\n              </div>\n              <div class=\"feature-item\">\n                <i class=\"fas fa-tv text-[#c30059]\"></i>\n                <div>\n                  <p class=\"font-medium\">Watch on Any Device</p>\n                  <p class=\"text-sm text-white/60\">TV, laptop, phone, or tablet</p>\n                </div>\n              </div>\n              <div class=\"feature-item\">\n                <i class=\"fas fa-ban text-[#c30059]\"></i>\n                <div>\n                  <p class=\"font-medium\">Ad-Free Experience</p>\n                  <p class=\"text-sm text-white/60\">Uninterrupted entertainment</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- Action Button -->\n          <button @click=\"handleSubscribe\" class=\"subscribe-button\">\n            <span>View Plans & Subscribe</span>\n            <i class=\"fas fa-arrow-right\"></i>\n          </button>\n\n          <!-- Price Note -->\n          <p class=\"text-center text-sm text-white/60 mt-4\">\n            Plans start from â‚¹365/year (â‚¹1/day)\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <!-- Add Rental Popup -->\n    <div v-if=\"showRentalPopup\" class=\"payment-popup-overlay\">\n      <div class=\"payment-popup\">\n        <div class=\"popup-header\">\n          <div class=\"flex items-center gap-3\">\n            <div class=\"premium-badge\">\n              <i class=\"fas fa-ticket-alt\"></i>\n            </div>\n            <div>\n              <h2 class=\"text-xl font-bold\">{{ movie.title }}</h2>\n              <p class=\"text-sm text-white/60\">\n                {{ formatWatchPeriod(movie.prices[0].rental_duration) }} Rental\n              </p>\n            </div>\n          </div>\n          <button @click=\"showRentalPopup = false\" class=\"close-button\">\n            <i class=\"fas fa-times\"></i>\n          </button>\n        </div>\n        \n        <div class=\"popup-content\">\n          <!-- Movie Preview -->\n          <div class=\"movie-preview\">\n            <img :src=\"movie.thumbnail_url || movie.poster_url\" alt=\"Movie Thumbnail\" class=\"popup-thumbnail\">\n            <div class=\"movie-info\">\n              <h3 class=\"movie-title\">{{ movie.title }}</h3>\n              <div class=\"flex items-center gap-2 text-sm text-white/60\">\n                <span v-if=\"formattedDuration\">{{ formattedDuration }}</span>\n                <span v-if=\"formattedDuration && categoryName\" class=\"dot-divider\"></span>\n                <span>{{ categoryName }}</span>\n              </div>\n            </div>\n          </div>\n\n          <!-- Rental Details -->\n          <div class=\"rental-details bg-white/5 rounded-lg p-4 my-4\">\n            <div class=\"flex justify-between items-center mb-2\">\n              <span class=\"text-white/60\">Rental Price</span>\n              <span class=\"text-xl font-bold\">â‚¹{{ movie.prices[0].rental_price }}</span>\n            </div>\n            <div class=\"flex justify-between items-center\">\n              <span class=\"text-white/60\">Watch Period</span>\n              <span>{{ formatWatchPeriod(movie.prices[0].rental_duration) }}</span>\n            </div>\n          </div>\n\n          <!-- Action Button -->\n          <button @click=\"goToRentalPayment\" class=\"subscribe-button\">\n            <span>Rent for {{ formatWatchPeriod(movie.prices[0].rental_duration) }} at â‚¹{{ movie.prices[0].rental_price }}</span>\n            <i class=\"fas fa-arrow-right\"></i>\n          </button>\n\n          <!-- Terms -->\n          <p class=\"text-center text-sm text-white/60 mt-4\">\n            Available to watch for {{ formatWatchPeriod(movie.prices[0].rental_duration) }} after payment\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <AppFooter />\n\n    <!-- Share Dialog -->\n    <div v-if=\"showShareDialog\" class=\"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 backdrop-blur-sm\">\n      <div class=\"bg-[#1d1d1d] rounded-xl w-full max-w-md p-6\">\n        <div class=\"flex justify-between items-center mb-6\">\n          <h3 class=\"text-xl font-bold\">Share \"{{ movie.title }}\"</h3>\n          <button @click=\"showShareDialog = false\" class=\"text-white/60 hover:text-white\">\n            <i class=\"fas fa-times\"></i>\n          </button>\n        </div>\n\n        <!-- Movie Preview with Image -->\n        <div class=\"flex items-center gap-4 mb-6 p-4 bg-[#121212] rounded-lg\">\n          <img \n            :src=\"movie.thumbnail_url || movie.portrait_thumbnail_url || movie.poster_url\" \n            :alt=\"movie.title\"\n            class=\"w-16 h-24 object-cover rounded-lg\"\n          />\n          <div class=\"flex-1\">\n            <h4 class=\"font-semibold text-white mb-1\">{{ movie.title }}</h4>\n            <p class=\"text-sm text-gray-400 line-clamp-2\">{{ movie.description }}</p>\n          </div>\n        </div>\n\n        <!-- Share Options -->\n        <div class=\"grid grid-cols-2 gap-4 mb-6\">\n          <!-- WhatsApp -->\n          <button \n            @click=\"shareToWhatsAppWithImage\"\n            class=\"flex items-center gap-3 bg-[#25D366]/10 p-4 rounded-lg hover:bg-[#25D366]/20 transition-all\"\n          >\n            <i class=\"fab fa-whatsapp text-[#25D366] text-2xl\"></i>\n            <span>WhatsApp</span>\n          </button>\n\n          <!-- Facebook -->\n          <button \n            @click=\"shareToFacebook\"\n            class=\"flex items-center gap-3 bg-[#1877F2]/10 p-4 rounded-lg hover:bg-[#1877F2]/20 transition-all\"\n          >\n            <i class=\"fab fa-facebook text-[#1877F2] text-2xl\"></i>\n            <span>Facebook</span>\n          </button>\n\n          <!-- Twitter -->\n          <button \n            @click=\"shareToTwitter\"\n            class=\"flex items-center gap-3 bg-[#1DA1F2]/10 p-4 rounded-lg hover:bg-[#1DA1F2]/20 transition-all\"\n          >\n            <i class=\"fab fa-twitter text-[#1DA1F2] text-2xl\"></i>\n            <span>Twitter</span>\n          </button>\n\n          <!-- Copy Link -->\n          <button \n            @click=\"copyShareLink\"\n            class=\"flex items-center gap-3 bg-white/10 p-4 rounded-lg hover:bg-white/20 transition-all\"\n          >\n            <i class=\"fas fa-link text-white text-2xl\"></i>\n            <span>Copy Link</span>\n          </button>\n        </div>\n\n        <!-- Test Social Preview Button -->\n        <div class=\"mb-6\">\n          <button \n            @click=\"testSocialPreview\"\n            class=\"w-full flex items-center justify-center gap-3 bg-[#c30059]/10 p-4 rounded-lg hover:bg-[#c30059]/20 transition-all border border-[#c30059]/20\"\n          >\n            <i class=\"fas fa-eye text-[#c30059] text-xl\"></i>\n            <span class=\"text-[#c30059] font-medium\">Test Social Media Preview</span>\n          </button>\n        </div>\n\n        <!-- Share Link -->\n        <div class=\"relative\">\n          <input \n            ref=\"shareLink\"\n            type=\"text\"\n            :value=\"shareUrl\"\n            class=\"w-full bg-[#121212] border border-white/10 rounded-lg h-12 px-4 pr-24 text-white focus:border-[#c30059] focus:outline-none transition-colors\"\n            readonly\n          />\n          <button \n            @click=\"copyShareLink\"\n            class=\"absolute right-2 top-1/2 -translate-y-1/2 text-sm text-[#c30059] hover:text-[#a80048] transition-colors\"\n          >\n            {{ copyStatus }}\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport AppHeader from '../components/Header.vue'\nimport AppFooter from '../components/Footer.vue'\nimport AdvancedVideoPlayer from '../components/AdvancedVideoPlayer.vue'\nimport axios from 'axios'\nimport { watchlistAPI } from '@/utils/api'\nimport videojs from 'video.js';\nimport 'video.js/dist/video-js.css';\nimport store from '@/store';\n\n// Define API base URL constant\nconst API_BASE_URL = 'https://ott.no1news.in'\n\n// Create axios instance with default config\nconst axiosInstance = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Add request interceptor to add token\naxiosInstance.interceptors.request.use(\n  (config) => {\n    const token = store.getters.token;\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\nexport default {\n  name: 'MovieDetails',\n  components: {\n    AppHeader,\n    AppFooter,\n    AdvancedVideoPlayer\n  },\n  props: {\n    id: {\n      type: [Number, String],\n      required: true\n    }\n  },\n  data() {\n    return {\n      movie: {},\n      inWatchlist: false,\n      isSearchActive: false,\n      isVideoPlaying: false,\n      controlsVisible: true,\n      isVideoPaused: false,\n      controlsTimeout: null,\n      isMobileDevice: false,\n      videoInteractionDelay: 2500,\n      videoUrl: '',\n      streamType: 'hls',\n      isUserSubscribed: false,\n      promoStartDelay: 3000, // 3 seconds delay before starting promo\n      drmConfig: {\n        // DRM configuration if needed\n        // Example for Widevine:\n        servers: {\n          'com.widevine.alpha': 'https://license.url/widevine'\n        },\n        // Example for Clear Key:\n        clearKeys: {\n          // keyId: 'key' pairs\n        }\n      },\n      playerSettings: {\n        defaultQuality: 'auto',\n        preferredQualityIndex: 1,\n        skipInterval: 10, // seconds\n        keyboardShortcutsEnabled: true,\n        rememberLastPosition: true,\n        autoQualitySwitch: true\n      },\n      canScrollLeft: {\n        category: false,\n        related: false,\n        recentlyAdded: false\n      },\n      canScrollRight: {\n        category: true,\n        related: true,\n        recentlyAdded: true\n      },\n      categoryVideos: [],\n      recentlyAddedVideos: [],\n      relatedMovies: [\n        {\n          id: 101,\n          title: 'Midnight Mystery',\n          thumbnail_url: 'https://i.ibb.co/cDfWsvC/related1.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/cDfWsvC/related1.jpg',\n          video_type: 'free'\n        },\n        {\n          id: 102,\n          title: 'The Stranger',\n          thumbnail_url: 'https://i.ibb.co/DkFnm7g/related2.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/DkFnm7g/related2.jpg',\n          video_type: 'paid'\n        },\n        {\n          id: 103,\n          title: 'Dark Echo',\n          thumbnail_url: 'https://i.ibb.co/MRVvFDZ/related3.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/MRVvFDZ/related3.jpg',\n          video_type: 'free'\n        },\n        {\n          id: 104,\n          title: 'Silent Night',\n          thumbnail_url: 'https://i.ibb.co/5cG2WXF/related4.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/5cG2WXF/related4.jpg',\n          video_type: 'rental'\n        },\n        {\n          id: 105,\n          title: 'The Guilty',\n          thumbnail_url: 'https://i.ibb.co/mBVR2KM/related5.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/mBVR2KM/related5.jpg',\n          video_type: 'free'\n        },\n        {\n          id: 106,\n          title: 'Trance',\n          thumbnail_url: 'https://i.ibb.co/hWD1BXg/related6.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/hWD1BXg/related6.jpg',\n          video_type: 'paid'\n        },\n        {\n          id: 107,\n          title: 'Haunted House',\n          thumbnail_url: 'https://i.ibb.co/k8DQzTF/related7.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/k8DQzTF/related7.jpg',\n          video_type: 'free'\n        },\n        {\n          id: 108,\n          title: 'Night Watch',\n          thumbnail_url: 'https://i.ibb.co/hyCJTBL/related8.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/hyCJTBL/related8.jpg',\n          video_type: 'rental'\n        },\n        {\n          id: 109,\n          title: 'The Missing',\n          thumbnail_url: 'https://i.ibb.co/dj8rS0M/related9.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/dj8rS0M/related9.jpg',\n          video_type: 'free'\n        },\n        {\n          id: 110,\n          title: 'Fear Factor',\n          thumbnail_url: 'https://i.ibb.co/8XvX1fL/related10.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/8XvX1fL/related10.jpg',\n          video_type: 'paid'\n        },\n        {\n          id: 111,\n          title: 'Paranormal',\n          thumbnail_url: 'https://i.ibb.co/r57Kzc5/related11.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/r57Kzc5/related11.jpg',\n          video_type: 'free'\n        },\n        {\n          id: 112,\n          title: 'Last Breath',\n          thumbnail_url: 'https://i.ibb.co/B6wS7HK/related12.jpg',\n          portrait_thumbnail_url: 'https://i.ibb.co/B6wS7HK/related12.jpg',\n          video_type: 'rental'\n        }\n      ],\n      heroVideo: null,\n      hls: null,\n      showPaymentPopup: false,\n      userSubscriptionStatus: null,\n      showRentalPopup: false,\n      rentalInfo: null,\n      isSubscribed: false,\n      isPromoLoading: true,\n      promoVideoError: null,\n      isPlayingPromo: false,\n      isInWatchlist: false,\n      showShareDialog: false,\n      copyStatus: 'Copy',\n      promoHasError: false,\n      videojsPlayer: null,\n      shakaPromoPlayer: null,\n      isPromoPlaying: false\n    }\n  },\n  computed: {\n    // Get current user ID from localStorage\n    currentUserId() {\n      const user = localStorage.getItem('user');\n      if (user) {\n        try {\n          const userData = JSON.parse(user);\n          return userData.id || 1; // Default to 1 if no user ID\n        } catch (e) {\n          return 1; // Default to 1 if parsing fails\n        }\n      }\n      return 1; // Default to 1 if no user data\n    },\n    // Get the appropriate stream type based on the video URL or device capabilities\n    computedStreamType() {\n      // Check if the URL ends with specific extensions\n      if (this.videoUrl.includes('.m3u8')) {\n        return 'hls';\n      } else if (this.videoUrl.includes('.mpd')) {\n        return 'dash';\n      } else if (this.videoUrl.includes('.mp4')) {\n        // Explicitly handle MP4 files\n        return 'mp4';\n      }\n      // Default fallback\n      return 'mp4';\n    },\n    // Get the year from created_at\n    movieYear() {\n      if (this.movie && this.movie.created_at) {\n        return new Date(this.movie.created_at).getFullYear();\n      }\n      return new Date().getFullYear(); // Fallback to current year\n    },\n    // Format duration from seconds to hours and minutes\n    formattedDuration() {\n      if (!this.movie || !this.movie.duration) return '';\n      \n      const totalSeconds = parseInt(this.movie.duration);\n      if (isNaN(totalSeconds)) return '';\n      \n      const hours = Math.floor(totalSeconds / 3600);\n      const minutes = Math.floor((totalSeconds % 3600) / 60);\n      \n      if (hours === 0) {\n        return `${minutes}m`;\n      } else if (minutes === 0) {\n        return `${hours}h`;\n      } else {\n        return `${hours}h ${minutes}m`;\n      }\n    },\n    // Get category name\n    categoryName() {\n      if (!this.movie) return '';\n      return this.movie.category_name || ''; // Directly use category_name from API\n    },\n    // Get formatted categories\n    formattedCategories() {\n      if (!this.movie || !this.movie.categories) return '';\n      return this.movie.categories.map(cat => cat.name).join(', ');\n    },\n    \n    shareUrl() {\n      if (typeof window !== 'undefined') {\n        return window.location.href;\n      }\n      return '';\n    },\n    \n    // Check if promo button should be shown\n    shouldShowPromoButton() {\n      return this.movie && \n             this.movie.promo_hls_url && \n             this.movie.promo_hls_url.trim() !== '';\n      // Removed promoHasError check - button should show even if CORS error\n      // User can still try to play after fixing CORS\n    }\n  },\n  watch: {\n    // Watch for route changes to reset scroll position when navigating between movie details pages\n    '$route'() {\n      window.scrollTo(0, 0);\n      this.fetchMovieDetails().then(() => {\n        // Initialize hero video after fetching new movie details\n        this.$nextTick(() => {\n          this.initializeHeroVideo();\n        });\n      });\n    },\n    // Update stream type based on the video URL\n    videoUrl: {\n      immediate: true,\n      handler(newUrl) {\n        // Update stream type based on the new URL\n        if (newUrl) {\n          this.streamType = this.computedStreamType;\n        }\n      }\n    },\n    // Add watcher for movie data\n    movie: {\n      immediate: true,\n      handler(newMovie) {\n        if (newMovie && (newMovie.promo_hls_url || newMovie.promo_video_url)) {\n          this.$nextTick(() => {\n            this.initializeHeroVideo();\n          });\n        }\n        \n        // Update meta tags when movie data changes\n        if (newMovie) {\n          this.$nextTick(() => {\n            this.updateMetaTags();\n          });\n        }\n      }\n    },\n    // Debug watcher for isPromoPlaying\n    isPromoPlaying(val) {\n      console.log('isPromoPlaying changed:', val);\n    }\n  },\n  mounted() {\n    // Initialize hero video with HLS\n    this.initializeHeroVideo();\n    \n    this.$nextTick(() => {\n      this.checkScrollButtons('categoryContainer', 'category')\n      this.checkScrollButtons('relatedContainer', 'related')\n      this.checkScrollButtons('recentlyAddedContainer', 'recentlyAdded')\n      \n      // Check if mobile device\n      this.checkDeviceType()\n      \n      // Listen for resize events to update device type\n      window.addEventListener('resize', this.checkDeviceType)\n\n      // Add scroll event listener for header background\n      window.addEventListener('scroll', this.handleScroll)\n      \n      // Update meta tags after component is mounted\n      if (this.movie) {\n        this.updateMetaTags();\n      }\n    })\n  },\n  beforeUnmount() {\n    // Clean up HLS instance\n    if (this.hls) {\n      this.hls.destroy();\n    }\n    \n    // Clean up resize listener\n    window.removeEventListener('resize', this.checkDeviceType)\n    \n    // Clean up scroll listener\n    window.removeEventListener('scroll', this.handleScroll)\n    \n    // Clear any active control timeouts\n    if (this.controlsTimeout) {\n      clearTimeout(this.controlsTimeout)\n    }\n    if (this.videojsPlayer) {\n      this.videojsPlayer.dispose();\n      this.videojsPlayer = null;\n    }\n  },\n  created() {\n    // Get video URL from route params if available\n    if (this.$route.params.videoUrl) {\n      this.videoUrl = this.$route.params.videoUrl;\n      this.streamType = this.$route.params.videoType || 'hls';\n    }\n    \n    // Check subscription status\n    this.checkUserSubscription().then(isSubscribed => {\n      this.isUserSubscribed = isSubscribed;\n    });\n    \n    // Fetch movie details\n    this.fetchMovieDetails();\n    \n    // Load any saved player preferences from localStorage\n    this.loadPlayerPreferences();\n    this.checkWatchlistStatus();\n  },\n  methods: {\n    formatWatchPeriod(days) {\n      if (!days) return '';\n      return `${days} ${days === 1 ? 'day' : 'days'}`;\n    },\n    \n    loadPlayerPreferences() {\n      // Load user preferences from localStorage\n      const savedPreferences = localStorage.getItem('player-preferences');\n      if (savedPreferences) {\n        try {\n          const preferences = JSON.parse(savedPreferences);\n          // Apply only the properties that exist in our settings object\n          Object.keys(this.playerSettings).forEach(key => {\n            if (preferences[key] !== undefined) {\n              this.playerSettings[key] = preferences[key];\n            }\n          });\n        } catch (e) {\n          console.error('Error parsing saved player preferences', e);\n        }\n      }\n    },\n    savePlayerPreferences() {\n      // Save current player settings to localStorage\n      localStorage.setItem('player-preferences', JSON.stringify(this.playerSettings));\n    },\n    initializeHeroVideo() {\n      const video = this.$refs.heroVideo;\n      if (!video) {\n        console.error('Video element not found');\n        return;\n      }\n      const videoSrc = this.movie.promo_hls_url || this.movie.video_url;\n      if (!videoSrc) {\n        console.error('No video source available');\n        return;\n      }\n\n      // Detect format\n      const isMPD = videoSrc.toLowerCase().includes('.mpd');\n      const isHLS = videoSrc.toLowerCase().includes('.m3u8');\n\n      if (!isMPD && !isHLS) {\n        console.error('Unsupported video format. Only HLS (.m3u8) and MPD (.mpd) are supported');\n        return;\n      }\n\n      // Dispose previous players if they exist\n      if (this.videojsPlayer) {\n        this.videojsPlayer.dispose();\n        this.videojsPlayer = null;\n      }\n      if (this.shakaPromoPlayer) {\n        this.shakaPromoPlayer.destroy();\n        this.shakaPromoPlayer = null;\n      }\n\n      // Ensure video is muted for autoplay\n      video.muted = true;\n\n      if (isMPD) {\n        // Use Shaka Player for MPD\n        this.initializeShakaPromoPlayer(video, videoSrc);\n      } else {\n        // Use Video.js for HLS\n        this.initializeVideoJsPromoPlayer(video, videoSrc);\n      }\n    },\n\n    initializeShakaPromoPlayer(video, videoSrc) {\n      console.log('ðŸŽ¬ Initializing Shaka Player for promo MPD');\n      \n      // Import Shaka Player dynamically\n      import('shaka-player/dist/shaka-player.ui.js').then((shaka) => {\n        // Install polyfills\n        shaka.polyfill.installAll();\n        \n        // Check browser support\n        if (!shaka.Player.isBrowserSupported()) {\n          console.error('Browser not supported for Shaka Player');\n          this.promoHasError = true;\n          return;\n        }\n        \n        // Create Shaka player\n        this.shakaPromoPlayer = new shaka.Player();\n        this.shakaPromoPlayer.attach(video);\n        \n        // Configure\n        this.shakaPromoPlayer.configure({\n          streaming: {\n            bufferingGoal: 30,\n            rebufferingGoal: 2,\n            bufferBehind: 15\n          },\n          abr: {\n            enabled: true\n          }\n        });\n        \n        // Error handling\n        this.shakaPromoPlayer.addEventListener('error', (event) => {\n          const error = event.detail;\n          console.error('Shaka promo error:', error);\n          \n          // Don't hide button for CORS errors - user needs to fix S3 config\n          // Only hide for critical player errors\n          if (error.code !== shaka.util.Error.Code.BAD_HTTP_STATUS && \n              error.code !== shaka.util.Error.Code.HTTP_ERROR) {\n            this.promoHasError = true;\n          }\n          \n          this.handlePromoVideoError(error);\n        });\n        \n        // Load manifest\n        this.shakaPromoPlayer.load(videoSrc).then(() => {\n          console.log('ðŸŽ¬ Promo MPD loaded successfully');\n          this.isPromoLoading = false;\n          \n          // Attempt autoplay\n          video.play().catch(err => {\n            console.log('Promo autoplay prevented:', err);\n            this.isPromoLoading = false;\n          });\n        }).catch((error) => {\n          console.error('Error loading promo MPD:', error);\n          \n          // Don't hide button for CORS errors\n          if (error.code !== shaka.util.Error.Code.BAD_HTTP_STATUS && \n              error.code !== shaka.util.Error.Code.HTTP_ERROR) {\n            this.promoHasError = true;\n          }\n          \n          this.isPromoLoading = false;\n        });\n      }).catch((error) => {\n        console.error('Error importing Shaka Player:', error);\n        this.promoHasError = true;\n        this.isPromoLoading = false;\n      });\n    },\n\n    initializeVideoJsPromoPlayer(video, videoSrc) {\n      console.log('ðŸŽ¬ Initializing Video.js for promo HLS');\n      \n      this.videojsPlayer = videojs(video, {\n        sources: [{\n          src: videoSrc,\n          type: 'application/x-mpegURL'\n        }],\n        controls: true,\n        autoplay: true, // Enable autoplay\n        muted: true,    // Ensure muted for autoplay\n        preload: 'auto',\n        fluid: true\n      });\n      this.videojsPlayer.ready(() => {\n        this.isPromoLoading = false;\n        this.videojsPlayer.muted(true); // Ensure muted\n        this.videojsPlayer.play().catch(e => {\n          console.error('Auto-play prevented:', e);\n        });\n      });\n      this.videojsPlayer.on('error', () => {\n        this.promoVideoError = this.videojsPlayer.error();\n        console.error('Video.js error:', this.promoVideoError);\n      });\n    },\n    onPromoVideoCanPlay() {\n      console.log('Video can play');\n      const video = this.$refs.heroVideo;\n      if (video) {\n        video.play().catch(error => {\n          console.error('Play failed:', error);\n        });\n      }\n    },\n    onPromoVideoLoaded() {\n      console.log('Promo video loaded successfully');\n      this.isPromoLoading = false;\n      const video = this.$refs.heroVideo;\n      if (video) {\n        video.classList.add('playing');\n        // Ensure video is muted and playing\n        video.muted = true;\n        video.play().catch(error => {\n          console.error('Play failed:', error);\n        });\n      }\n    },\n    onPromoVideoWaiting() {\n      console.log('Promo video waiting/buffering');\n      this.isPromoLoading = true;\n    },\n    onPromoVideoPlaying() {\n      this.isPromoPlaying = true;\n      this.isPromoLoading = false;\n      const video = this.$refs.heroVideo;\n      if (video) {\n        video.classList.add('playing');\n      }\n    },\n    handlePromoVideoError(error) {\n      console.error('Promo video error:', error);\n      this.promoVideoError = error;\n      const video = this.$refs.heroVideo;\n      if (video) {\n        video.classList.remove('playing');\n      }\n    },\n    async checkUserSubscription() {\n      try {\n        const phone = localStorage.getItem('phone');\n        if (!phone) return false;\n\n        const response = await axios.get(`${API_BASE_URL}/users/profile/?phone=${phone}`);\n        console.log('Subscription API response:', response.data); // DEBUG\n        if (response.data && response.data.status === 'success') {\n          const user = response.data.user;\n          console.log('User from API:', user); // DEBUG\n          // Check if user has active subscription\n          if (user.is_subscribed && user.subscription_end_date) {\n            const endDate = new Date(user.subscription_end_date);\n            const now = new Date();\n            const isActive = endDate > now;\n            console.log('is_subscribed:', user.is_subscribed, 'endDate:', endDate, 'now:', now, 'isActive:', isActive); // DEBUG\n            return isActive;\n          }\n        }\n        return false;\n      } catch (error) {\n        console.error('Error checking subscription:', error);\n        return false;\n      }\n    },\n    async checkRentalStatus() {\n      try {\n        const phone = localStorage.getItem('phone');\n        if (!phone) return null;\n\n        const response = await axios.get(`${API_BASE_URL}/api/rentals/check/?phone=${phone}&video_id=${this.movie.id}`);\n        if (response.data && response.data.status === 'success') {\n          return response.data.rental;\n        }\n        return null;\n      } catch (error) {\n        console.error('Error checking rental status:', error);\n        return null;\n      }\n    },\n    goToRentalPayment() {\n      this.showRentalPopup = false;\n      this.$router.push(`/movie/${this.movie.id}/rent`);\n    },\n    async playMovie() {\n      try {\n        console.log('playMovie() called - checking video URL');\n        // First check if we have a valid video URL\n        if (!this.movie.hls_url) {\n          throw new Error('No video URL available');\n        }\n\n        // Check user subscription status first\n        const isSubscribed = await this.checkUserSubscription();\n        console.log('User subscription status:', isSubscribed);\n\n        // Rental video logic\n        if (this.movie.video_type === 'rental') {\n          if (isSubscribed) {\n            // Premium user: play directly without showing rental popup\n            console.log('Premium user - playing directly');\n            this.controlsVisible = true;\n            this.isVideoPaused = false;\n            this.isVideoPlaying = true;\n            this.videoUrl = this.movie.hls_url;\n            this.streamType = 'hls';\n            document.body.style.overflow = 'hidden';\n            this.$nextTick(() => {\n              if (this.$refs.videoPlayer) {\n                this.resetControlsTimer();\n              } else {\n                console.error('Video player reference not found');\n                throw new Error('Video player initialization failed');\n              }\n            });\n          } else {\n            // Free user: check rental status\n            console.log('Free user - checking rental status');\n            const rentalInfo = await this.checkRentalStatus();\n            if (rentalInfo && rentalInfo.is_active) {\n              // Rental is active, allow playback\n              console.log('Active rental found - playing video');\n              this.controlsVisible = true;\n              this.isVideoPaused = false;\n              this.isVideoPlaying = true;\n              this.videoUrl = this.movie.hls_url;\n              this.streamType = 'hls';\n              document.body.style.overflow = 'hidden';\n              this.$nextTick(() => {\n                if (this.$refs.videoPlayer) {\n                  this.resetControlsTimer();\n                } else {\n                  console.error('Video player reference not found');\n                  throw new Error('Video player initialization failed');\n                }\n              });\n            } else {\n              // No active rental, redirect to rental page\n              console.log('No active rental - redirecting to rental page');\n              this.$router.push(`/movie/${this.movie.id}/rent`);\n            }\n          }\n          return;\n        }\n\n        // Paid video logic\n        if (this.movie.video_type === 'paid') {\n          if (!isSubscribed) {\n            // If not subscribed, redirect to subscription page\n            this.$router.push({\n              name: 'SubscriptionPlans',\n              query: {\n                redirect: this.$route.fullPath,\n                video_id: this.movie.id\n              }\n            });\n            return;\n          }\n        }\n\n        // Free video or user is subscribed, proceed with playback\n        console.log('Playing free/paid video');\n        this.controlsVisible = true;\n        this.isVideoPaused = false;\n        this.isVideoPlaying = true;\n        this.videoUrl = this.movie.hls_url;\n        this.streamType = 'hls';\n        document.body.style.overflow = 'hidden';\n        this.$nextTick(() => {\n          if (this.$refs.videoPlayer) {\n            this.resetControlsTimer();\n          } else {\n            console.error('Video player reference not found');\n            throw new Error('Video player initialization failed');\n          }\n        });\n      } catch (error) {\n        console.error('Error playing video:', error);\n        this.$store.dispatch('showToast', {\n          message: 'Sorry, the video is not available at the moment. Please try again later.',\n          type: 'error'\n        });\n        this.isVideoPlaying = false;\n        document.body.style.overflow = 'auto';\n      }\n    },\n    closeVideo() {\n      this.isVideoPlaying = false;\n      this.isPlayingPromo = false;\n      \n      // Save the player preferences when closing the player\n      this.savePlayerPreferences();\n      \n      // Restore body scrolling\n      document.body.style.overflow = '';\n    },\n    async toggleWatchlist() {\n      try {\n        // Get authentication state from localStorage\n        const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';\n        const token = localStorage.getItem('token');\n\n        if (!isAuthenticated || !token) {\n          // Store current path for redirect after login\n          const currentPath = this.$route.fullPath;\n          // Redirect to login with return URL\n          this.$router.push({\n            path: '/login',\n            query: { redirect: currentPath }\n          });\n          return;\n        }\n\n        // Show loading state\n        this.$store.commit('setLoading', true);\n\n        const response = await watchlistAPI.toggle(this.id);\n\n        if (response.data.status === 'success') {\n          this.isInWatchlist = response.data.in_watchlist;\n          // Show success message\n          this.$store.dispatch('showToast', {\n            message: response.data.message,\n            type: 'success'\n          });\n        }\n      } catch (error) {\n        console.error('Error toggling watchlist:', error);\n        // Show error message\n        this.$store.dispatch('showToast', {\n          message: 'Failed to update watchlist. Please try again.',\n          type: 'error'\n        });\n      } finally {\n        this.$store.commit('setLoading', false);\n      }\n    },\n    async checkWatchlistStatus() {\n      try {\n        // Check authentication from localStorage\n        const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';\n        const token = localStorage.getItem('token');\n\n        if (!isAuthenticated || !token) return;\n\n        const response = await watchlistAPI.getStatus(this.id);\n        this.isInWatchlist = response.data.in_watchlist;\n      } catch (error) {\n        console.error('Error checking watchlist status:', error);\n      }\n    },\n    shareMovie() {\n      // Get the current URL for sharing \n      const shareUrl = this.shareUrl;\n      \n      // Get the best available image URL\n      const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n      \n      // Prepare share data with image\n      const shareData = {\n        title: this.movie.title,\n        text: this.movie.description,\n        url: shareUrl\n      };\n\n      // Add image to share data if available\n      if (imageUrl) {\n        shareData.files = [imageUrl];\n      }\n\n      // Check if Web Share API is supported\n      if (typeof navigator !== 'undefined' && navigator.share && this.isMobileDevice) {\n        // For mobile devices, try to share with image\n        if (imageUrl && navigator.canShare && navigator.canShare(shareData)) {\n          navigator.share(shareData)\n            .then(() => {\n              this.$store.dispatch('showToast', {\n                message: 'Shared successfully with image!',\n                type: 'success'\n              });\n            })\n            .catch((error) => {\n              console.error('Error sharing with image:', error);\n              // Fallback to sharing without image\n              this.shareWithoutImage(this.shareUrl);\n            });\n        } else {\n          // Fallback to sharing without image\n          this.shareWithoutImage(this.shareUrl);\n        }\n      } else {\n        // Fallback for desktop or unsupported browsers\n        this.showShareDialog = true;\n      }\n    },\n\n    shareWithoutImage(shareUrl) {\n      const shareData = {\n        title: this.movie.title,\n        text: this.movie.description,\n        url: shareUrl\n      };\n\n      navigator.share(shareData)\n        .then(() => {\n          this.$store.dispatch('showToast', {\n            message: 'Shared successfully!',\n            type: 'success'\n          });\n        })\n        .catch((error) => {\n          console.error('Error sharing:', error);\n          this.showShareDialog = true;\n        });\n    },\n    \n    updateMetaTags() {\n      if (!this.movie) return;\n      \n      const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n      const shareUrl = this.shareUrl;\n      const title = this.movie.title;\n      const description = this.movie.description;\n      \n      console.log('Updating meta tags for:', title);\n      console.log('Image URL:', imageUrl);\n      console.log('Share URL:', shareUrl);\n      \n      // Update or create meta tags for Open Graph\n      this.updateMetaTag('og:title', title);\n      this.updateMetaTag('og:description', description);\n      this.updateMetaTag('og:image', imageUrl);\n      this.updateMetaTag('og:url', shareUrl);\n      this.updateMetaTag('og:type', 'video.movie');\n      this.updateMetaTag('og:site_name', 'No1 OTT');\n      \n      // Update or create meta tags for Twitter Card\n      this.updateMetaTag('twitter:card', 'summary_large_image');\n      this.updateMetaTag('twitter:title', title);\n      this.updateMetaTag('twitter:description', description);\n      this.updateMetaTag('twitter:image', imageUrl);\n      this.updateMetaTag('twitter:url', shareUrl);\n      \n      // Update page title\n      document.title = `${title} - No1 OTT`;\n      \n      console.log('Meta tags updated successfully');\n    },\n    \n    updateMetaTag(name, content) {\n      if (!content) return;\n      \n      let meta = document.querySelector(`meta[name=\"${name}\"]`) || \n                 document.querySelector(`meta[property=\"${name}\"]`);\n      \n      if (!meta) {\n        meta = document.createElement('meta');\n        if (name.startsWith('og:')) {\n          meta.setAttribute('property', name);\n        } else {\n          meta.setAttribute('name', name);\n        }\n        document.head.appendChild(meta);\n      }\n      \n      meta.setAttribute('content', content);\n    },\n    toggleSearch() {\n      this.isSearchActive = !this.isSearchActive;\n    },\n    navigateToMovie(movieId) {\n      // Use full page refresh to ensure all components reinitialize\n      window.location.href = `/movie/${movieId}`;\n    },\n    navigateToCategory() {\n      // Navigate to category page with category ID\n      console.log('Navigating to category. Movie data:', this.movie);\n      console.log('Category ID:', this.movie.category_id);\n      console.log('Category:', this.movie.category);\n      \n      const categoryId = this.movie.category_id || this.movie.category;\n      \n      if (categoryId) {\n        console.log('Navigating to category ID:', categoryId);\n        // Use Vue Router for better debugging\n      this.$router.push({\n          name: 'CategoryVideos',\n          params: { id: categoryId }\n      });\n      } else {\n        console.error('No category ID found in movie data');\n        // Show error message to user\n        this.$store.dispatch('showToast', {\n          message: 'Category information not available',\n          type: 'error'\n        });\n      }\n    },\n    goBack() {\n      this.$router.go(-1);\n    },\n    capitalizeText(text) {\n      if (!text) return '';\n      // Split by spaces and special characters\n      return text.split(/[\\s-]+/).map(word => {\n        // Don't change case for special words\n        const specialWords = ['HD', 'UHD', '4K', 'TV', 'II', 'III', 'IV', 'SPY'];\n        if (specialWords.includes(word.toUpperCase())) {\n          return word.toUpperCase();\n        }\n        // Don't change case for articles and conjunctions in middle of title\n        const minorWords = ['a', 'an', 'the', 'and', 'but', 'or', 'for', 'nor', 'in', 'to', 'on', 'at', 'by', 'of'];\n        if (minorWords.includes(word.toLowerCase())) {\n          return word.toLowerCase();\n        }\n        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();\n      }).join(' ');\n    },\n    async fetchMovieDetails() {\n      try {\n        // Make API call to get movie details\n        const response = await axios.get(`${API_BASE_URL}/api/videos/${this.id}/`);\n        console.log('API Response:', response.data);\n        \n        if (response.data) {\n          // Apply capitalization to title and description\n          this.movie = {\n            ...response.data,\n            title: this.capitalizeText(response.data.title),\n            description: this.capitalizeText(response.data.description)\n          };\n          \n          // Update meta tags for social sharing\n          this.updateMetaTags();\n          \n          // Set video URL based on available formats\n          if (response.data.hls_url) {\n            this.videoUrl = response.data.hls_url;\n            this.streamType = 'hls';\n          } else {\n            throw new Error('No video URL available');\n          }\n          \n          console.log('Set video URL:', this.videoUrl);\n          console.log('Stream type:', this.streamType);\n          \n          // Fetch related videos from same category\n          await this.fetchCategoryVideos();\n          \n          // Fetch recently added videos\n          await this.fetchRecentlyAddedVideos();\n        } else {\n          throw new Error('Invalid response data');\n        }\n      } catch (error) {\n        console.error('Error fetching movie details:', error);\n        this.$store.dispatch('showToast', {\n          message: 'Error loading movie details. Please try again later.',\n          type: 'error'\n        });\n      }\n    },\n    async fetchCategoryVideos() {\n      try {\n        console.log('Fetching category videos for movie:', this.movie);\n        console.log('Category ID:', this.movie.category_id);\n        console.log('Category Name:', this.movie.category_name);\n        \n        if (!this.movie.category_id && !this.movie.category_name) {\n          console.log('No category information available');\n          // Use fallback data\n          this.categoryVideos = this.relatedMovies.slice(0, 8);\n          return;\n        }\n        \n        // Use the correct API endpoint for category videos\n        const categoryId = this.movie.category_id || this.movie.category;\n        if (!categoryId) {\n          console.log('No category ID found');\n          this.categoryVideos = this.relatedMovies.slice(0, 8);\n          return;\n        }\n        \n        const response = await axios.get(`${API_BASE_URL}/api/videos/category/${categoryId}/?page=1&page_size=12`);\n        \n        if (response.data && response.data.status === 'success') {\n          console.log('Category videos API response:', response.data);\n          \n          // Filter out current video from the results\n          let videos = response.data.data || [];\n          videos = videos.filter(video => video.id !== this.movie.id);\n          \n          this.categoryVideos = videos.slice(0, 12).map(video => ({\n            ...video,\n            title: this.capitalizeText(video.title)\n          }));\n          \n          console.log('Processed category videos:', this.categoryVideos);\n        } else {\n          console.log('No API response or invalid status, using fallback data');\n          // Use fallback data\n          this.categoryVideos = this.relatedMovies.slice(0, 8);\n        }\n        \n        // Update scroll buttons after data loads\n        this.$nextTick(() => {\n          this.checkScrollButtons('categoryContainer', 'category');\n        });\n        \n      } catch (error) {\n        console.error('Error fetching category videos:', error);\n        console.log('Using fallback data due to error');\n        // Use fallback data on error\n        this.categoryVideos = this.relatedMovies.slice(0, 8);\n              }\n      },\n      async fetchRecentlyAddedVideos() {\n        try {\n          console.log('Fetching recently added videos');\n          const response = await axios.get(`${API_BASE_URL}/api/videos/`, {\n            params: {\n              ordering: '-created_at',\n              limit: 20\n            }\n          });\n\n          let videos = [];\n          if (response.data) {\n            if (Array.isArray(response.data)) {\n              videos = response.data;\n            } else if (response.data.results) {\n              videos = response.data.results;\n            } else if (response.data.data) {\n              videos = response.data.data;\n            }\n          }\n\n          // Filter out current video from the results\n          videos = videos.filter(video => video.id !== this.movie.id);\n\n          this.recentlyAddedVideos = videos.slice(0, 12).map(video => ({\n            ...video,\n            title: this.capitalizeText(video.title)\n          }));\n\n          console.log('Processed recently added videos:', this.recentlyAddedVideos);\n\n          // Update scroll buttons after data loads\n          this.$nextTick(() => {\n            this.checkScrollButtons('recentlyAddedContainer', 'recentlyAdded');\n          });\n\n        } catch (error) {\n          console.error('Error fetching recently added videos:', error);\n          // Use fallback data on error\n          this.recentlyAddedVideos = this.relatedMovies.slice(0, 8);\n      }\n    },\n    checkDeviceType() {\n      // Check if mobile based on screen width or user agent\n      this.isMobileDevice = window.innerWidth < 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n      \n      // Adjust video control timeout based on device type\n      this.videoInteractionDelay = this.isMobileDevice ? 3500 : 2500; // Mobile needs longer timeout\n    },\n    showControlsOnInteraction() {\n      // Make controls visible on interaction\n      this.controlsVisible = true;\n      \n      // Reset the timeout when there's interaction\n      this.resetControlsTimer();\n    },\n    resetControlsTimer() {\n      // Clear any existing timeout\n      if (this.controlsTimeout) {\n        clearTimeout(this.controlsTimeout);\n      }\n      \n      // If video is playing (not paused), set a timeout to hide controls\n      if (!this.isVideoPaused) {\n        this.controlsTimeout = setTimeout(() => {\n          this.controlsVisible = false;\n        }, this.videoInteractionDelay);\n      }\n    },\n    toggleControlsVisibility(event) {\n      // Prevent default behavior\n      event.preventDefault();\n      \n      // Toggle controls visibility on tap/click (common OTT pattern)\n      this.controlsVisible = !this.controlsVisible;\n      \n      if (this.controlsVisible && !this.isVideoPaused) {\n        // If showing controls and video is playing, reset the timer\n        this.resetControlsTimer();\n      }\n    },\n    onVideoPlay() {\n      this.isVideoPaused = false;\n      this.resetControlsTimer(); // Start the timer to hide controls\n    },\n    onVideoPause() {\n      this.isVideoPaused = true;\n      this.controlsVisible = true; // Always show controls when paused\n      \n      // Clear any existing timeout\n      if (this.controlsTimeout) {\n        clearTimeout(this.controlsTimeout);\n      }\n    },\n    handleVideoError(errorMessage) {\n      console.error('Video playback error:', errorMessage);\n      \n      // If DASH format fails, try falling back to MP4\n      if (this.streamType === 'dash' && this.videoUrl.includes('.mpd')) {\n        this.streamType = 'mp4';\n        this.videoUrl = 'https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8';\n        console.log('Falling back to MP4 format');\n        \n        // Retry with MP4\n        if (this.$refs.videoPlayer) {\n          this.$refs.videoPlayer.retry();\n        }\n      }\n    },\n    checkScrollButtons(containerId, section) {\n      const container = this.$refs[containerId]\n      if (!container) return\n      \n      // Check if we can scroll left\n      this.canScrollLeft[section] = container.scrollLeft > 0\n      \n      // Check if we can scroll right\n      const maxScroll = container.scrollWidth - container.clientWidth\n      this.canScrollRight[section] = container.scrollLeft < maxScroll - 1 // -1 for rounding errors\n    },\n    scrollLeft(containerId) {\n      const container = this.$refs[containerId]\n      if (!container) return\n\n      const cardWidth = containerId === 'categoryContainer' || containerId === 'recentlyAddedContainer' ? 160 : 180 // Adjust based on card width\n      const visibleWidth = container.clientWidth\n      const cardsToScroll = Math.floor(visibleWidth / cardWidth)\n      const scrollAmount = cardWidth * cardsToScroll\n\n      const targetScroll = Math.max(0, container.scrollLeft - scrollAmount)\n      \n      container.scrollTo({\n        left: targetScroll,\n        behavior: 'smooth'\n      })\n    },\n    scrollRight(containerId) {\n      const container = this.$refs[containerId]\n      if (!container) return\n\n      const cardWidth = containerId === 'categoryContainer' || containerId === 'recentlyAddedContainer' ? 160 : 180 // Adjust based on card width\n      const visibleWidth = container.clientWidth\n      const cardsToScroll = Math.floor(visibleWidth / cardWidth)\n      const scrollAmount = cardWidth * cardsToScroll\n\n      const maxScroll = container.scrollWidth - container.clientWidth\n      const targetScroll = Math.min(maxScroll, container.scrollLeft + scrollAmount)\n      \n      container.scrollTo({\n        left: targetScroll,\n        behavior: 'smooth'\n      })\n    },\n    handleScroll() {\n      const header = document.querySelector('.header-with-gradient')\n      if (header) {\n        if (window.scrollY > 50) {\n          header.classList.add('scrolled')\n        } else {\n          header.classList.remove('scrolled')\n        }\n      }\n    },\n    // Handle subscription payment\n    handleSubscribe() {\n      // Close the payment popup\n      this.showPaymentPopup = false;\n      // Redirect to subscription plans page\n      this.$router.push({\n        name: 'SubscriptionPlans',\n        query: { \n          redirect: this.$route.fullPath, // Store current movie page URL\n          video_id: this.movie.id // Pass video ID\n        }\n      });\n    },\n    // Close payment popup\n    closePaymentPopup() {\n      this.showPaymentPopup = false;\n    },\n    handlePromoVideoEnd() {\n      console.log('Promo video ended');\n      const video = this.$refs.heroVideo;\n      if (video) {\n        // Reset to beginning and play again\n        video.currentTime = 0;\n        video.play().catch(error => {\n          console.log('Error replaying promo video:', error);\n        });\n      }\n      this.isPromoPlaying = false;\n    },\n    // Helper to initialize or update video.js player for promo/main video\n    initVideoJsPlayer(videoEl, videoSrc) {\n      if (!videoEl) return;\n      // Only initialize if not already initialized\n      if (!videoEl._videojsPlayer) {\n        videoEl._videojsPlayer = videojs(videoEl, {\n          controls: true,\n          autoplay: true,\n          muted: true,\n          preload: 'auto',\n          fluid: true\n        });\n        videoEl._videojsPlayer.on('error', () => {\n          this.promoVideoError = videoEl._videojsPlayer.error();\n          console.error('Video.js error:', this.promoVideoError);\n        });\n      }\n      // Only update source if changed\n      if (videoEl._videojsPlayer.currentSrc() !== videoSrc) {\n        videoEl._videojsPlayer.src({ src: videoSrc, type: 'application/x-mpegURL' });\n      }\n      // Reset playing state before playback\n      this.isPromoPlaying = false;\n      videoEl._videojsPlayer.off('playing'); // Remove previous listeners\n      videoEl._videojsPlayer.on('playing', () => {\n        this.isPromoPlaying = true;\n        this.$forceUpdate(); // Ensure Vue reactivity\n        console.log('video.js playing event fired, isPromoPlaying set to true');\n      });\n      videoEl._videojsPlayer.ready(() => {\n        videoEl._videojsPlayer.muted(true);\n        videoEl._videojsPlayer.play().then(() => {\n          console.log('Video should be playing');\n          console.log('Player state:', videoEl._videojsPlayer.paused(), videoEl._videojsPlayer.currentSrc());\n        }).catch(e => {\n          console.error('Auto-play prevented:', e);\n        });\n      });\n      // Add native error event logging\n      videoEl.addEventListener('error', (e) => {\n        console.error('Native video error:', e);\n      });\n    },\n    async playPromo() {\n      try {\n        console.log('playPromo() called - checking promo URL');\n        \n        // Check if we have a valid promo URL\n        if (!this.movie.promo_hls_url) {\n          throw new Error('No promo video URL available');\n        }\n\n        // Set video URL and detect format\n        this.videoUrl = this.movie.promo_hls_url;\n        \n        // Auto-detect stream type based on URL\n        if (this.videoUrl.includes('.mpd')) {\n          this.streamType = 'dash';\n        } else if (this.videoUrl.includes('.m3u8')) {\n          this.streamType = 'hls';\n        } else {\n          this.streamType = 'hls'; // Default to HLS\n        }\n\n        console.log('Playing promo with URL:', this.videoUrl);\n        console.log('Stream type:', this.streamType);\n\n        // Use AdvancedVideoPlayer (same as full video)\n        this.controlsVisible = true;\n        this.isVideoPaused = false;\n        this.isVideoPlaying = true;\n        this.isPlayingPromo = true;\n        \n        // Hide body scroll\n        document.body.style.overflow = 'hidden';\n        \n        this.$nextTick(() => {\n          if (this.$refs.videoPlayer) {\n            this.resetControlsTimer();\n          } else {\n            console.error('Video player reference not found');\n            throw new Error('Video player initialization failed');\n          }\n        });\n      } catch (error) {\n        console.error('Error playing promo video:', error);\n        this.$store.dispatch('showToast', {\n          message: 'Sorry, the promo video is not available at the moment. Please try again later.',\n          type: 'error'\n        });\n        this.isVideoPlaying = false;\n        this.isPlayingPromo = false;\n        document.body.style.overflow = 'auto';\n      }\n    },\n    shareToWhatsApp() {\n      const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n      const text = `Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`;\n      \n      // For WhatsApp, we need to use a different approach for image sharing\n      if (imageUrl && this.isMobileDevice) {\n        // Try to use native sharing with image for mobile devices\n        const shareData = {\n          title: this.movie.title,\n          text: text,\n          url: this.shareUrl,\n          files: [imageUrl]\n        };\n        \n        if (navigator.canShare && navigator.canShare(shareData)) {\n          navigator.share(shareData)\n            .then(() => {\n              this.$store.dispatch('showToast', {\n                message: 'Shared to WhatsApp with image!',\n                type: 'success'\n              });\n            })\n            .catch((error) => {\n              console.error('WhatsApp share error:', error);\n              // Fallback to text-only WhatsApp sharing\n              this.shareToWhatsAppTextOnly(text);\n            });\n        } else {\n          // Fallback to text-only WhatsApp sharing\n          this.shareToWhatsAppTextOnly(text);\n        }\n      } else {\n        // Desktop or no image available - use text-only sharing\n        this.shareToWhatsAppTextOnly(text);\n      }\n      \n      this.showShareDialog = false;\n    },\n\n    shareToWhatsAppTextOnly(text) {\n      // Use the share URL directly to trigger rich preview\n      const shareText = `${text}\\n\\n${this.shareUrl}`;\n      const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(shareText)}`;\n      if (typeof window !== 'undefined') {\n        window.open(whatsappUrl, '_blank');\n      }\n    },\n\n    // Alternative method for WhatsApp image sharing using canvas\n    async shareToWhatsAppWithImage() {\n      try {\n        const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n        \n        if (!imageUrl) {\n          this.shareToWhatsAppTextOnly(`Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`);\n          return;\n        }\n\n        // Create a canvas with the image and text overlay\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        \n        // Set canvas size\n        canvas.width = 600;\n        canvas.height = 400;\n        \n        // Load the image\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        \n        img.onload = () => {\n          // Draw the image\n          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n          \n          // Add a semi-transparent overlay for text readability\n          ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';\n          ctx.fillRect(0, canvas.height - 120, canvas.width, 120);\n          \n          // Add text\n          ctx.fillStyle = 'white';\n          ctx.font = 'bold 24px Arial';\n          ctx.textAlign = 'center';\n          ctx.fillText(this.movie.title, canvas.width / 2, canvas.height - 80);\n          \n          ctx.font = '16px Arial';\n          ctx.fillText('Watch on No1 OTT', canvas.width / 2, canvas.height - 50);\n          \n          // Convert canvas to blob\n          canvas.toBlob((blob) => {\n            if (blob) {\n              // Create a file from the blob\n              const file = new File([blob], 'movie-share.jpg', { type: 'image/jpeg' });\n              \n              // Try to share with the generated image\n              const shareData = {\n                title: this.movie.title,\n                text: `Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.shareUrl}`,\n                files: [file]\n              };\n              \n              if (navigator.canShare && navigator.canShare(shareData)) {\n                navigator.share(shareData)\n                  .then(() => {\n                    this.$store.dispatch('showToast', {\n                      message: 'Shared to WhatsApp with image!',\n                      type: 'success'\n                    });\n                  })\n                  .catch((error) => {\n                    console.error('WhatsApp share error:', error);\n                    this.shareToWhatsAppTextOnly(`Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`);\n                  });\n              } else {\n                this.shareToWhatsAppTextOnly(`Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`);\n              }\n            }\n          }, 'image/jpeg', 0.8);\n        };\n        \n        img.onerror = () => {\n          // If image fails to load, fallback to text-only\n          this.shareToWhatsAppTextOnly(`Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`);\n        };\n        \n        img.src = imageUrl;\n        \n      } catch (error) {\n        console.error('Error creating WhatsApp image share:', error);\n        this.shareToWhatsAppTextOnly(`Check out \"${this.movie.title}\" on No1 OTT!\\n\\n${this.movie.description}\\n\\n${this.shareUrl}`);\n      }\n    },\n    shareToFacebook() {\n      const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n      let facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(this.shareUrl)}`;\n      \n      // Add image URL to Facebook share if available\n      if (imageUrl) {\n        facebookUrl += `&picture=${encodeURIComponent(imageUrl)}`;\n      }\n      \n      if (typeof window !== 'undefined') {\n        window.open(facebookUrl, '_blank');\n      }\n      this.showShareDialog = false;\n    },\n    shareToTwitter() {\n      const imageUrl = this.movie.thumbnail_url || this.movie.portrait_thumbnail_url || this.movie.poster_url;\n      const text = `Check out \"${this.movie.title}\" on No1 OTT!`;\n      let twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(this.shareUrl)}`;\n      \n      // Add image URL to Twitter share if available\n      if (imageUrl) {\n        twitterUrl += `&image=${encodeURIComponent(imageUrl)}`;\n      }\n      \n      if (typeof window !== 'undefined') {\n        window.open(twitterUrl, '_blank');\n      }\n      this.showShareDialog = false;\n    },\n    async copyShareLink() {\n      if (typeof navigator === 'undefined') return;\n      \n      try {\n        await navigator.clipboard.writeText(this.shareUrl);\n        this.copyStatus = 'Copied!';\n        \n        // Show success toast\n        this.$store.dispatch('showToast', {\n          message: 'Link copied to clipboard!',\n          type: 'success'\n        });\n\n        // Reset copy status after 2 seconds\n        setTimeout(() => {\n          this.copyStatus = 'Copy';\n        }, 2000);\n      } catch (err) {\n        console.error('Failed to copy:', err);\n        \n        // Fallback for older browsers\n        if (this.$refs.shareLink) {\n          this.$refs.shareLink.select();\n          document.execCommand('copy');\n          \n          this.copyStatus = 'Copied!';\n          setTimeout(() => {\n            this.copyStatus = 'Copy';\n          }, 2000);\n        }\n      }\n    },\n    \n    // Test social media preview\n    testSocialPreview() {\n      const testUrl = `${window.location.origin}/movie/${this.movie.id}?test=true`;\n      console.log('Testing social preview with URL:', testUrl);\n      \n      // Open in new tab for testing\n      window.open(testUrl, '_blank');\n      \n      this.$store.dispatch('showToast', {\n        message: 'Social preview test opened in new tab!',\n        type: 'info'\n      });\n    }\n  }\n};\n</script>\n\n<style scoped>\n/* Advanced Video Player modal - Full screen */\n.advanced-video-player-modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #000;\n  z-index: 100;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  /* Remove overflow: hidden to allow centering */\n}\n\n:deep(.video-element) {\n  width: 100vw !important;\n  height: 100vh !important;\n  max-width: 100vw;\n  max-height: 100vh;\n  aspect-ratio: 16 / 9;\n  object-fit: contain !important;\n  background: #000;\n  display: block;\n  margin: 0 auto;\n}\n\n@media (max-width: 768px) {\n  .advanced-video-player-modal {\n    padding: 0;\n    width: 100vw;\n    height: 100vh;\n    min-width: 100vw;\n    min-height: 100vh;\n  }\n  :deep(.video-element) {\n    width: 100vw !important;\n    height: 100vh !important;\n    aspect-ratio: 16 / 9;\n    object-fit: contain !important;\n    background: #000;\n  }\n}\n\n/* Container fix for horizontal scrolling */\n.movie-details-wrapper {\n  position: relative;\n  overflow-x: hidden;\n  width: 100%;\n  max-width: 100vw;\n}\n\n/* Header gradient overlay to blend with movie backdrop */\n.header-with-gradient {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  z-index: 30;\n  background: linear-gradient(to bottom, \n    rgba(0, 0, 0, 0.9) 0%,\n    rgba(0, 0, 0, 0.7) 60%,\n    rgba(0, 0, 0, 0.4) 80%,\n    rgba(0, 0, 0, 0) 100%);\n  height: 120px;\n  transition: background 0.3s ease;\n}\n\n.header-with-gradient.scrolled {\n  background: #121212;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);\n}\n\n/* Make the header background transparent by default */\n.header-with-gradient :deep(.header) {\n  background: transparent !important;\n  transition: background 0.3s ease;\n}\n\n.header-with-gradient.scrolled :deep(.header) {\n  background: #121212 !important;\n  backdrop-filter: blur(10px);\n}\n\n.movie-detail-container {\n  position: relative;\n  height: 100vh;\n  min-height: 600px;\n  max-height: 800px;\n  padding-top: 0;\n  overflow: hidden;\n  width: 100%;\n}\n\n/* Back button styling */\n.back-btn {\n  position: absolute;\n  top: 1rem;\n  left: 1rem;\n  z-index: 20;\n  background: rgba(0, 0, 0, 0.5);\n  color: white;\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  display: none; /* Hidden by default (desktop) */\n  align-items: center;\n  justify-content: center;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.back-btn:hover {\n  background: rgba(0, 0, 0, 0.7);\n}\n\n/* Unified action buttons styling inspired by major OTT platforms */\n.action-buttons {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin: 1.5rem 0;\n  flex-wrap: wrap;\n}\n\n.play-button {\n  background: linear-gradient(45deg, #c30059, #ff0062);\n  color: white;\n  font-weight: 600;\n  border-radius: 8px;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(195, 0, 89, 0.3);\n  position: relative;\n  overflow: hidden;\n  white-space: nowrap;    \n  width: auto;             \n  min-width: unset;        \n  max-width: unset;         \n  display: inline-flex;     \n  align-items: center;\n  justify-content: center;\n  padding: 8px 16px;        \n  gap: 8px;\n}\n\n.play-button::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0));\n  transform: translateX(-100%) rotate(45deg);\n  transition: transform 0.6s ease;\n}\n\n.play-button:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 20px rgba(195, 0, 89, 0.4);\n}\n\n.play-button:hover::before {\n  transform: translateX(100%) rotate(45deg);\n}\n\n.play-button:active {\n  transform: translateY(0);\n  box-shadow: 0 4px 15px rgba(195, 0, 89, 0.3);\n}\n\n.play-button i {\n  font-size: 1.1rem;\n}\n\n/* Promo button with glass effect */\nbutton[class*=\"play-button\"]:first-child {\n  background: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(10px);\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);\n}\n\nbutton[class*=\"play-button\"]:first-child:hover {\n  background: rgba(255, 255, 255, 0.15);\n  border-color: rgba(255, 255, 255, 0.3);\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);\n}\n\nbutton[class*=\"play-button\"]:first-child:active {\n  transform: translateY(0);\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);\n}\n\n/* Mobile responsive styles */\n@media (max-width: 768px) {\n  .action-buttons {\n    gap: 0.75rem;\n    margin: 1rem 0;\n  }\n\n  .play-button {\n    padding: 0.75rem 1.5rem;\n    min-width: 120px;\n    font-size: 0.9rem;\n  }\n\n  .play-button i {\n    font-size: 1rem;\n  }\n\n  /* Stack buttons on very small screens */\n  @media (max-width: 360px) {\n    .action-buttons {\n      flex-direction: column;\n      width: 100%;\n    }\n\n    .play-button {\n      width: 100%;\n      justify-content: center;\n    }\n  }\n}\n\n/* Add shine animation for play button */\n@keyframes shine {\n  0% {\n    background-position: 200% center;\n  }\n  100% {\n    background-position: -200% center;\n  }\n}\n\n.play-button.main-play {\n  background: linear-gradient(45deg, #c30059, #ff0062, #c30059);\n  background-size: 200% auto;\n  animation: shine 8s linear infinite;\n}\n\n.action-button {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  background: rgba(255, 255, 255, 0.1);\n  color: white;\n  border-radius: 0.25rem;\n  width: 60px;\n  height: 60px;\n  padding: 0.75rem 0;\n  transition: all 0.2s;\n}\n\n.action-button:hover {\n  background: rgba(255, 255, 255, 0.2);\n}\n\n.action-button i {\n  font-size: 1.25rem;\n  margin-bottom: 0.25rem;\n}\n\n.action-label {\n  font-size: 0.7rem;\n}\n\n/* Section carousel styling to match Home page */\n.scroll-container {\n  scroll-behavior: smooth;\n  -webkit-overflow-scrolling: touch;\n  width: 100%;\n}\n\n.scrollbar-hide::-webkit-scrollbar {\n  display: none;\n}\n\n.scrollbar-hide {\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n}\n\n/* Main content section fixes */\nmain {\n  position: relative;\n  overflow-x: hidden;\n  width: 100%;\n  box-sizing: border-box;\n  max-width: 100%;\n}\n\n/* Gradient text style for section headings */\n.gradient-text {\n  background: linear-gradient(45deg, #fff 30%, rgba(255, 255, 255, 0.8));\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n}\n\n/* Scroll buttons */\n.scroll-button {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  z-index: 10;\n  width: 36px;\n  height: 36px;\n  border-radius: 50%;\n  background-color: #c30059;\n  color: white;\n  display: none;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);\n  transition: all 0.2s;\n}\n\n.scroll-button:hover {\n  transform: translateY(-50%) scale(1.1);\n  background-color: #a80048;\n}\n\n.left-scroll-button {\n  left: -18px;\n}\n\n.right-scroll-button {\n  right: 0;\n}\n\n@media (min-width: 768px) {\n  .scroll-button {\n    display: flex;\n  }\n}\n\n/* Scroll button container fix */\nsection {\n  position: relative;\n  width: 100%;\n  overflow-x: hidden;\n}\n\n/* Cast card styling */\n.cast-card {\n  min-width: 150px;\n  max-width: 150px;\n  flex-shrink: 0;\n}\n\n.cast-image {\n  width: 100%;\n  aspect-ratio: 2/3;\n  border-radius: 0.5rem;\n  overflow: hidden;\n  margin-bottom: 0.5rem;\n}\n\n.cast-image img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  transition: transform 0.3s ease;\n}\n\n.cast-card:hover img {\n  transform: scale(1.05);\n}\n\n.cast-name {\n  font-size: 0.95rem;\n  font-weight: 600;\n  margin-bottom: 0.25rem;\n}\n\n.cast-role {\n  font-size: 0.8rem;\n  color: rgba(255, 255, 255, 0.7);\n}\n\n/* Related movie card styling */\n.related-movie-card {\n  min-width: 160px;\n  max-width: 160px;\n  flex-shrink: 0;\n  cursor: pointer;\n}\n\n.card-container {\n  width: 100%;\n  max-width: 160px;\n  height: 240px;\n  transition: transform 0.3s ease;\n  cursor: pointer;\n  background-color: #1d1d1d;\n}\n\n.related-movie-card:hover .card-container {\n  transform: translateY(-8px) scale(1.05);\n  z-index: 10;\n}\n\n.related-movie-image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.card-text {\n  transition: transform 0.3s ease;\n}\n\n.related-movie-card:hover .card-text {\n  transform: scale(1.1);\n}\n\n/* Mobile-only elements */\n.mobile-only-element {\n  display: none; /* Hidden by default */\n}\n\n/* Hide elements on mobile */\n.hide-on-mobile {\n  display: block;\n}\n\n/* Media query for mobile devices */\n@media (max-width: 768px) {\n  .mobile-only-element {\n    display: flex; /* Show on mobile */\n  }\n  \n  .hide-on-mobile {\n    display: none; /* Hide on mobile */\n  }\n  \n  .movie-detail-container {\n    padding-top: 0; /* Remove padding since header is hidden */\n  }\n  \n  /* Additional mobile-specific styles */\n  .movie-backdrop {\n    height: 70vh; /* Increase height for portrait view */\n  }\n\n  /* Mobile action buttons styling */\n  .action-buttons {\n    margin-top: 0.25rem;\n    margin-bottom: 0.25rem;\n  }\n  \n  .play-button, .promo-button {\n    flex: 1;\n    padding: 0.75rem 1rem;\n  }\n  \n  .action-button {\n    width: 48px;\n    height: 48px;\n  }\n  \n  .action-label {\n    display: none; /* Hide labels on mobile for cleaner UI */\n  }\n\n  main {\n    padding-top: 0;\n    padding-bottom: 0;\n  }\n\n  section {\n    margin-bottom: 0.25rem;\n  }\n\n  .movie-info-container {\n    padding: 0.75rem;\n    padding-top: calc(40vh);\n  }\n\n  .movie-description {\n    margin-bottom: 0.5rem;\n  }\n\n  .movie-meta {\n    margin-bottom: 0.25rem;\n  }\n\n  .movie-tags {\n    margin-bottom: 0.25rem;\n  }\n\n  .movie-badges {\n    margin-bottom: 0.25rem;\n  }\n\n  .movie-title {\n    margin-bottom: 0.25rem;\n  }\n}\n\n.movie-backdrop {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 0;\n  overflow: hidden;\n  background: #121212;\n  \n  @media (max-width: 768px) {\n    height: 70vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: #000;\n  }\n}\n\n.backdrop-image {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  transform: scale(1.1);\n  opacity: 1;\n  transition: opacity 0.5s ease;\n  will-change: opacity;\n  backface-visibility: hidden;\n  -webkit-backface-visibility: hidden;\n}\n\n.video-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 1;\n}\n\n.backdrop-video {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n  transform: scale(1.1);\n  opacity: 0;\n  transition: opacity 0.5s ease;\n  will-change: opacity;\n  backface-visibility: hidden;\n  -webkit-backface-visibility: hidden;\n}\n\n.backdrop-video.playing {\n  opacity: 1;\n}\n\n/* When video is playing, fade out the thumbnail */\n.backdrop-video.playing + .backdrop-image {\n  opacity: 0;\n}\n\n/* Loading spinner for video */\n.video-loading {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 3;\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(255, 255, 255, 0.3);\n  border-radius: 50%;\n  border-top-color: #fff;\n  animation: spin 1s ease-in-out infinite;\n}\n\n@keyframes spin {\n  to { transform: translate(-50%, -50%) rotate(360deg); }\n}\n\n.backdrop-gradient {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(\n    to bottom,\n    rgba(18, 18, 18, 0.3) 0%,\n    rgba(18, 18, 18, 0.7) 50%,\n    rgba(18, 18, 18, 1) 100%\n  );\n  z-index: 2;\n  pointer-events: none;\n}\n\n.movie-info-container {\n  position: relative;\n  z-index: 10;\n  padding: 2rem;\n  padding-top: calc(50vh);\n  max-width: 800px;\n}\n\n.movie-badges {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.75rem;\n}\n\n.badge {\n  font-size: 0.75rem;\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n  font-weight: 600;\n  text-transform: uppercase;\n  display: inline-flex;\n  align-items: center;\n}\n\n.premium {\n  background: linear-gradient(45deg, #c30059, #ff0062);\n  padding: 0.4rem 0.8rem;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  text-transform: uppercase;\n  font-size: 0.8rem;\n  letter-spacing: 0.5px;\n  border-radius: 4px;\n  box-shadow: 0 2px 4px rgba(195, 0, 89, 0.3);\n  transition: all 0.3s ease;\n}\n\n.premium:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 8px rgba(195, 0, 89, 0.4);\n}\n\n.premium i {\n  font-size: 0.9rem;\n  color: #FFD700;\n}\n\n.premium-price {\n  color: #c30059;\n  font-weight: 600;\n  background: rgba(195, 0, 89, 0.1);\n  padding: 0.2rem 0.6rem;\n  border-radius: 4px;\n  font-size: 0.85rem;\n}\n\n.quality {\n  background-color: #0066cc;\n}\n\n.movie-title {\n  font-size: 2.5rem;\n  font-weight: 700;\n  margin-bottom: 0.5rem;\n}\n\n.movie-meta {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n  margin-bottom: 1rem;\n  font-size: 0.875rem;\n  color: rgba(255, 255, 255, 0.8);\n}\n\n.dot-divider {\n  display: inline-block;\n  width: 4px;\n  height: 4px;\n  border-radius: 50%;\n  background-color: rgba(255, 255, 255, 0.5);\n}\n\n.movie-tags {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 1rem;\n}\n\n.tag {\n  font-size: 0.75rem;\n  padding: 0.25rem 0.5rem;\n  border-radius: 1rem;\n  background-color: rgba(255, 255, 255, 0.1);\n  color: rgba(255, 255, 255, 0.8);\n}\n\n.movie-description {\n  font-size: 0.95rem;\n  line-height: 1.6;\n  margin-bottom: 1.5rem;\n  color: rgba(255, 255, 255, 0.9);\n  max-width: 700px;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n@media (max-width: 768px) {\n  .movie-description {\n    font-size: 0.9rem;\n    line-height: 1.5;\n    margin-bottom: 0.5rem;\n  }\n}\n\n/* Mobile Search Bar */\n.mobile-search-bar {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 60px;\n  background-color: #121212;\n  z-index: 100;\n  display: flex;\n  align-items: center;\n  padding: 0 1rem;\n  transform: translateY(-100%);\n  transition: transform 0.3s ease;\n}\n\n.mobile-search-bar.active {\n  transform: translateY(0);\n}\n\n.mobile-search-bar input {\n  flex: 1;\n  background-color: rgba(255, 255, 255, 0.1);\n  border: none;\n  color: white;\n  padding: 0.75rem 1rem;\n  border-radius: 4px;\n}\n\n.mobile-search-bar input:focus {\n  outline: none;\n  background-color: rgba(255, 255, 255, 0.15);\n}\n\n.mobile-search-bar button {\n  padding: 0.5rem;\n  margin-left: 0.5rem;\n}\n\n/* Mobile responsive styles */\n@media (max-width: 768px) {\n  .movie-detail-container {\n    height: auto;\n    max-height: none;\n    padding-bottom: 20px; /* Reduced bottom padding */\n  }\n  \n  .movie-title {\n    font-size: 1.75rem;\n  }\n}\n\n/* Additional responsive fixes */\n@media (min-width: 769px) {\n  main {\n    padding-right: 10px;\n    padding-left: 10px;\n    max-width: 100vw;\n  }\n  \n  .scroll-button {\n    z-index: 20;\n  }\n  \n  .right-scroll-button {\n    right: 10px;\n  }\n  \n  .left-scroll-button {\n    left: -10px;\n  }\n  \n  .carousel-container {\n    padding-right: 10px;\n  }\n}\n\n/* Fix for the carousel to prevent overflow */\nsection > div:first-child {\n  padding-right: 1rem;\n  box-sizing: border-box;\n  width: 100%;\n}\n\n/* Fix for the last visible elements in carousels */\n.scroll-container > div {\n  padding-right: 1rem;\n  box-sizing: border-box;\n}\n\n/* Carousel container fixes */\n.carousel-container {\n  width: 100%;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.carousel-inner-container {\n  width: fit-content;\n  padding-bottom: 1rem; /* Add space for potential scrollbar */\n}\n\n/* Payment Popup */\n.payment-popup-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.85);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  padding: 1rem;\n  backdrop-filter: blur(8px);\n}\n\n.payment-popup {\n  background-color: #1a1a1a;\n  border-radius: 16px;\n  width: 100%;\n  max-width: 480px;\n  overflow: hidden;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.popup-header {\n  padding: 1.5rem;\n  background: linear-gradient(to right, #c30059, #7c1d44);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.premium-badge {\n  width: 40px;\n  height: 40px;\n  background: rgba(255, 255, 255, 0.2);\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.premium-badge i {\n  font-size: 1.25rem;\n  color: white;\n}\n\n.close-button {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  background: rgba(255, 255, 255, 0.2);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  transition: all 0.2s;\n}\n\n.close-button:hover {\n  background: rgba(255, 255, 255, 0.3);\n  transform: scale(1.1);\n}\n\n.popup-content {\n  padding: 1.5rem;\n}\n\n.movie-preview {\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 12px;\n  padding: 1rem;\n  display: flex;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n\n.popup-thumbnail {\n  width: 120px;\n  height: 68px;\n  object-fit: cover;\n  border-radius: 8px;\n}\n\n.movie-info {\n  flex: 1;\n}\n\n.movie-title {\n  font-size: 1.1rem;\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n  color: white;\n}\n\n.premium-features {\n  background: rgba(195, 0, 89, 0.05);\n  border-radius: 12px;\n  padding: 1.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.features-grid {\n  display: grid;\n  gap: 1rem;\n}\n\n.feature-item {\n  display: flex;\n  gap: 1rem;\n  align-items: flex-start;\n}\n\n.feature-item i {\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(195, 0, 89, 0.1);\n  border-radius: 6px;\n}\n\n.subscribe-button {\n  width: 100%;\n  background: linear-gradient(to right, #c30059, #7c1d44);\n  color: white;\n  font-weight: 600;\n  padding: 1rem;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  transition: all 0.2s;\n}\n\n.subscribe-button:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 10px 20px -10px rgba(195, 0, 89, 0.5);\n}\n\n.subscribe-button:active {\n  transform: translateY(0);\n}\n\n@media (max-width: 480px) {\n  .payment-popup {\n    max-height: 90vh;\n    overflow-y: auto;\n  }\n\n  .popup-content {\n    padding: 1rem;\n  }\n\n  .movie-preview {\n    flex-direction: column;\n    align-items: center;\n    text-align: center;\n  }\n\n  .popup-thumbnail {\n    width: 100%;\n    height: auto;\n    aspect-ratio: 16/9;\n  }\n\n  .premium-features {\n    padding: 1rem;\n  }\n}\n\n/* Add these new styles for portrait mobile */\n.backdrop-image.portrait-mobile {\n  @media (max-width: 768px) {\n    object-fit: contain;\n    object-position: center;\n    height: 100%;\n    width: 100%;\n    background-color: #000;\n  }\n}\n\n.secondary-button {\n  background: rgba(255, 255, 255, 0.1);\n  color: white;\n  padding: 0.75rem 1.5rem;\n  border-radius: 8px;\n  border: 2px solid rgba(255, 255, 255, 0.2);\n  font-weight: 600;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  transition: all 0.3s ease;\n}\n\n.secondary-button:hover {\n  background: rgba(255, 255, 255, 0.2);\n  border-color: rgba(255, 255, 255, 0.3);\n}\n\n.secondary-button.in-watchlist {\n  background: rgba(255, 119, 0, 0.2);\n  border-color: rgba(255, 119, 0, 0.4);\n}\n\n.secondary-button.in-watchlist:hover {\n  background: rgba(255, 119, 0, 0.3);\n  border-color: rgba(255, 119, 0, 0.5);\n}\n\n/* Add these new styles for share dialog */\n.backdrop-blur-sm {\n  backdrop-filter: blur(8px);\n}\n\n@media (max-width: 640px) {\n  .grid-cols-2 {\n    grid-template-columns: 1fr;\n  }\n}\n\n/* Debug: Force video to be visible and sized correctly */\n.backdrop-video {\n  display: block !important;\n  opacity: 1 !important;\n  height: 100vh !important;\n  width: 100vw !important;\n  z-index: 1000 !important;\n}\n\n/* Remove video.js fluid aspect ratio padding */\n.vjs-fluid {\n  padding-top: 0 !important;\n  height: 100% !important;\n  min-height: 0 !important;\n}\n\n/* Hide video.js text information but keep controls */\n:deep(.video-js) {\n  .vjs-time-control,\n  .vjs-remaining-time,\n  .vjs-duration,\n  .vjs-current-time,\n  .vjs-time-divider {\n    display: none !important;\n  }\n\n  .vjs-progress-control {\n    height: 3px !important;\n    opacity: 0.5;\n    transition: all 0.3s;\n  }\n\n  .vjs-progress-control:hover {\n    height: 6px !important;\n    opacity: 1;\n  }\n\n  .vjs-control-bar {\n    background: linear-gradient(to top, rgba(0,0,0,0.7), transparent) !important;\n    height: 60px !important;\n    padding-bottom: 10px !important;\n  }\n}\n\n/* Video container and video element styles */\n.video-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #000;\n}\n\n.backdrop-video {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n  display: block;\n  margin: 0 auto;\n  background: #000;\n}\n\n/* Desktop specific styles */\n@media (min-width: 769px) {\n  .video-container {\n    height: 100vh !important;\n    max-height: 100vh !important;\n  }\n\n  .backdrop-video {\n    height: 100vh !important;\n    max-height: 100vh !important;\n  }\n\n  :deep(.video-js) {\n    width: 100% !important;\n    height: 100vh !important;\n    max-height: 100vh !important;\n  }\n\n  :deep(.vjs-tech) {\n    height: 100vh !important;\n    max-height: 100vh !important;\n    object-fit: contain !important;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}