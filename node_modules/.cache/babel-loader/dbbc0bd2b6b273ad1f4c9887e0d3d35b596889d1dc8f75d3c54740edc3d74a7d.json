{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nexport default {\n  name: 'PaymentVerification',\n  setup() {\n    const router = useRouter();\n    const verifying = ref(true);\n    const error = ref(null);\n    const goToProfile = () => {\n      router.push('/profile');\n    };\n    onMounted(async () => {\n      try {\n        // Immediately start redirect process\n        const startTime = performance.now();\n\n        // Check for payment success in localStorage\n        const paymentData = localStorage.getItem('payment_success');\n        if (!paymentData) {\n          error.value = 'No payment data found. Please try again.';\n          verifying.value = false;\n          return;\n        }\n        const {\n          timestamp,\n          verified\n        } = JSON.parse(paymentData);\n\n        // Check if this payment was already verified\n        if (verified) {\n          console.log('Payment already verified, redirecting...');\n          router.replace('/profile');\n          return;\n        }\n\n        // Clear the payment data from localStorage immediately\n        localStorage.removeItem('payment_success');\n\n        // Check if the payment data is not too old (within last 10 minutes)\n        const now = new Date().getTime();\n        if (now - timestamp > 10 * 60 * 1000) {\n          error.value = 'Payment verification timeout. Please contact support.';\n          verifying.value = false;\n          return;\n        }\n\n        // Calculate time spent in verification\n        const verificationTime = performance.now() - startTime;\n\n        // If verification took less than 100ms, add small delay for UI feedback\n        // If more than 100ms, redirect immediately\n        const minDisplayTime = 100;\n        const remainingTime = Math.max(0, minDisplayTime - verificationTime);\n        let retryCount = 0;\n        const maxRetries = 3;\n        const baseDelay = 1000; // Start with 1 second delay\n\n        const attemptRedirect = () => {\n          const currentDelay = remainingTime + retryCount * baseDelay; // Exponential backoff\n\n          setTimeout(() => {\n            // Try to get payment data from both storages\n            const localData = localStorage.getItem('payment_success');\n            const sessionData = sessionStorage.getItem('payment_success');\n            const paymentData = localData || sessionData;\n            if (!paymentData) {\n              console.error('Payment data lost during redirect');\n              error.value = 'Payment data not found. Please contact support.';\n              verifying.value = false;\n              return;\n            }\n\n            // Clear payment data only on successful redirect\n            router.replace('/profile').then(() => {\n              localStorage.removeItem('payment_success');\n              sessionStorage.removeItem('payment_success');\n            }).catch(err => {\n              console.error('Redirect failed:', err);\n              if (retryCount < maxRetries) {\n                retryCount++;\n                console.log(`Retrying redirect (${retryCount}/${maxRetries}) after ${currentDelay}ms...`);\n                attemptRedirect();\n              } else {\n                // Save failed redirect attempt for support\n                const failedAttempt = {\n                  timestamp: new Date().getTime(),\n                  error: err.message,\n                  retries: retryCount,\n                  paymentInfo: JSON.parse(paymentData)\n                };\n                localStorage.setItem('failed_redirect', JSON.stringify(failedAttempt));\n                error.value = 'Network issues detected. Please click the button below or contact support.';\n                verifying.value = false;\n              }\n            });\n          }, currentDelay);\n        };\n        attemptRedirect();\n      } catch (err) {\n        console.error('Payment verification error:', err);\n        error.value = 'An error occurred during payment verification. Please contact support.';\n        verifying.value = false;\n      }\n    });\n    return {\n      verifying,\n      error,\n      goToProfile\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRouter","name","setup","router","verifying","error","goToProfile","push","startTime","performance","now","paymentData","localStorage","getItem","value","timestamp","verified","JSON","parse","console","log","replace","removeItem","Date","getTime","verificationTime","minDisplayTime","remainingTime","Math","max","retryCount","maxRetries","baseDelay","attemptRedirect","currentDelay","setTimeout","localData","sessionData","sessionStorage","then","catch","err","failedAttempt","message","retries","paymentInfo","setItem","stringify"],"sources":["D:\\OTT\\ott_frontend\\src\\views\\PaymentVerification.vue"],"sourcesContent":["<template>\n  <div class=\"payment-verification\">\n    <div class=\"verification-container\">\n      <div v-if=\"verifying\" class=\"loading\">\n        <h2>Verifying Payment...</h2>\n        <p>Please wait while we confirm your payment.</p>\n      </div>\n      <div v-else-if=\"error\" class=\"error\">\n        <h2>Payment Verification Failed</h2>\n        <p>{{ error }}</p>\n        <button @click=\"goToProfile\" class=\"btn\">Go to Profile</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\n\nexport default {\n  name: 'PaymentVerification',\n  setup() {\n    const router = useRouter();\n    const verifying = ref(true);\n    const error = ref(null);\n\n    const goToProfile = () => {\n      router.push('/profile');\n    };\n\n    onMounted(async () => {\n      try {\n        // Immediately start redirect process\n        const startTime = performance.now();\n        \n        // Check for payment success in localStorage\n        const paymentData = localStorage.getItem('payment_success');\n        if (!paymentData) {\n          error.value = 'No payment data found. Please try again.';\n          verifying.value = false;\n          return;\n        }\n\n        const { timestamp, verified } = JSON.parse(paymentData);\n        \n        // Check if this payment was already verified\n        if (verified) {\n          console.log('Payment already verified, redirecting...');\n          router.replace('/profile');\n          return;\n        }\n        \n        // Clear the payment data from localStorage immediately\n        localStorage.removeItem('payment_success');\n\n        // Check if the payment data is not too old (within last 10 minutes)\n        const now = new Date().getTime();\n        if (now - timestamp > 10 * 60 * 1000) {\n          error.value = 'Payment verification timeout. Please contact support.';\n          verifying.value = false;\n          return;\n        }\n\n        // Calculate time spent in verification\n        const verificationTime = performance.now() - startTime;\n        \n        // If verification took less than 100ms, add small delay for UI feedback\n        // If more than 100ms, redirect immediately\n        const minDisplayTime = 100;\n        const remainingTime = Math.max(0, minDisplayTime - verificationTime);\n\n        let retryCount = 0;\n        const maxRetries = 3;\n        const baseDelay = 1000; // Start with 1 second delay\n        \n        const attemptRedirect = () => {\n          const currentDelay = remainingTime + (retryCount * baseDelay); // Exponential backoff\n          \n          setTimeout(() => {\n            // Try to get payment data from both storages\n            const localData = localStorage.getItem('payment_success');\n            const sessionData = sessionStorage.getItem('payment_success');\n            const paymentData = localData || sessionData;\n            \n            if (!paymentData) {\n              console.error('Payment data lost during redirect');\n              error.value = 'Payment data not found. Please contact support.';\n              verifying.value = false;\n              return;\n            }\n            \n            // Clear payment data only on successful redirect\n            router.replace('/profile').then(() => {\n              localStorage.removeItem('payment_success');\n              sessionStorage.removeItem('payment_success');\n            }).catch(err => {\n              console.error('Redirect failed:', err);\n              if (retryCount < maxRetries) {\n                retryCount++;\n                console.log(`Retrying redirect (${retryCount}/${maxRetries}) after ${currentDelay}ms...`);\n                attemptRedirect();\n              } else {\n                // Save failed redirect attempt for support\n                const failedAttempt = {\n                  timestamp: new Date().getTime(),\n                  error: err.message,\n                  retries: retryCount,\n                  paymentInfo: JSON.parse(paymentData)\n                };\n                localStorage.setItem('failed_redirect', JSON.stringify(failedAttempt));\n                \n                error.value = 'Network issues detected. Please click the button below or contact support.';\n                verifying.value = false;\n              }\n            });\n          }, currentDelay);\n        };\n        \n        attemptRedirect();\n      } catch (err) {\n        console.error('Payment verification error:', err);\n        error.value = 'An error occurred during payment verification. Please contact support.';\n        verifying.value = false;\n      }\n    });\n\n    return {\n      verifying,\n      error,\n      goToProfile\n    };\n  }\n};\n</script>\n\n<style scoped>\n.payment-verification {\n  min-height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n}\n\n.verification-container {\n  background: white;\n  border-radius: 10px;\n  padding: 30px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n  text-align: center;\n  max-width: 400px;\n  width: 100%;\n}\n\n.loading h2,\n.error h2 {\n  margin-bottom: 15px;\n  color: #333;\n}\n\n.loading p,\n.error p {\n  color: #666;\n  margin-bottom: 20px;\n}\n\n.btn {\n  background: #3399cc;\n  color: white;\n  border: none;\n  padding: 12px 30px;\n  border-radius: 5px;\n  cursor: pointer;\n  font-size: 16px;\n  transition: background 0.2s;\n}\n\n.btn:hover {\n  background: #2980b9;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}